2009 International Conference on Environmental Science and Information Application Technology

Research of Rendering Anisotropic Volume Data Directly Based on the Shear-Warp
Algorithm
Li Guo

Xie Mei

College of Electronic
Engineering，University of
Electronic Science and
Technology of China
Chengdu，china
dlbasin@163.com

College of Electronic
Engineering，University of
Electronic Science and
Technology of China
Chengdu，china
xiemei@ee.uestc.edu.cn

Peng Gang

Wu Bingrong

College of Electronic
Engineering，University
of Electronic Science and
Technology of China
Chengdu，china
balyelite@163.com

College of Electronic
Engineering，University
of Electronic Science and
Technology of China
Chengdu，china
wabing@163.com

Abstract—The traditional shear-warp rendering algorithm
is based on isotropic volume data, which is often generated
from anisotropic data by inter-slice interpolation. This
paper presents a new method that renders the anisotropic
volume data directly based on the shear-warp algorithm, in
the condition of that there is no big difference between the
slice spacing and the pixel spacing within the slice. In this
new method, the coordinates are transformed from model to
world according to the real sampling spacing of the original
data. Finally, the constructed anisotropic volume data in the
world coordinate system has the same proportion of size
with the real object. The view matrix is described as the
coordinate transformation matrix from world, not model, to
view. Using this new method to render the anisotropic
volume data directly, will not only make the volume data for
rendering accurate and decrease the preprocessing time, but
also meet both the requirements of image quality and
rendering speed by adjusting the resampling rate during the
rendering process.

transformation matrix from world, not model, to view.
Using this new method to render the anisotropic volume
data directly, the data for rendering is accurate without
interpolation; the preprocessing time is saved; at the same
time, the resampling rate can be adjusted optionally during
the rendering process. A useful implication of the third
property is that the resampling rate can be reduced for less
computation to meet the real-time rendering speed
requirement, when users interact to locate the viewing
angle; the resampling rate can also be increased for clearer
image to meet the final image quality requirement, when
users have located the viewing angle and need the clearest
final image for diagnosis. So, this new method is able to
meet both the requirements of speed and quality at the
same time. Experiments have proved this new method’s
effects.

Keywords-anisotropy; shear-warp; volume rendering;
resampling

The basic principle of the shear-warp algorithm is
shown in figure 1 [6].

I.

II.

THE SHEAR-WARP ALGORITHM

INTRODUCTION

The traditional shear-warp algorithm [1~2] is with the
understanding of the volume data being isotropic, that is
the slice spacing equals to the pixel spacing. When the
slice spacing is much larger than the pixel spacing, it is
necessary to preprocess the original sampled data to make
it isotropic, using the inter-slice interpolation [3~5] method.
Unfortunately, inter-slice interpolation has the problem of
causing image blurring, and occupies the preprocessing
time. Now, with the new generation of CT and MRI
equipments, the slice resolution has been continuously
improved; the slice spacing has also been much smaller, or
even closes to the pixel spacing. Under this condition, a
new method is presented in this paper, to render the
anisotropic volume data directly, based on the shear-warp
algorithm. In this new method, after setting up the model
coordinates for the original sampled data, the coordinates
are transformed from model to world according to the real
sampling spacing of the original data. Finally, the
constructed anisotropic volume data in the world
coordinate system has the same proportion of size with the
real object. The view matrix is described as the coordinate
978-0-7695-3682-8/09 $25.00 © 2009 IEEE
DOI 10.1109/ESIAT.2009.246

(a)

427

MC

Model
Transformation

WC

View
Transformation

VC

Projection
Transformation

PC

Norm
Transformation

NC

Window
Transformation

DC

(b)

Figure 2: General line of the 3D coordinates transformation

Figure 1: (a) Standard and (b) factorized viewing transformation

M view

Let
be the view matrix that transforms points
from object space to image space. The shear-warp
algorithm is based on the idea of a factorization of the
view matrix M view into a shear component M shear , a warp
component M warp and a principle axis transformation
M

=M

•M

•P

warp
shear
. As for a parallel
matrix P with view
projection, since the shear is parallel to the slices, the
shear factor ( M shear ) just contains a transformation that
simply translates each volume slice, in such a way that the
viewing direction becomes perpendicular to the slices. The
warp factor that transforms the intermediate image to
resulting image can be decided by M view , M shear and P

M
= M view • M sh− 1ea r • P − 1
. Because the warp
with w a rp
operation is after the projection, it becomes a 2D operation
and much faster to compute.
Briefly, the shear-warp algorithm consists of three
primary steps as follows:
1) Transform the volume data to shear space by
translating each slice using M shear .
2) Project the volume into a distorted 2D intermediate
image in shear space by compositing the resampled slices
together.
3) Transform the distorted intermediate image to
resulting image by warp operation using M warp .

III. THE NEW METHOD
A.

Coordinate transformation
The general line of the 3D coordinate transformation
is shown in figure 2. The MC,WC,VC,PC,NC and DC
express the model coordinate, world coordinate, view
coordinate, projection coordinate, norm coordinate and
device coordinate respectively. And the transformation
during the different coordinate system is implemented by
multiplying corresponding transformation matrix.

First, the model coordinate is constructed for the
original sampled data. Take the MRI data with the size of
M columns, N rows and L sections as an example, the
voxel at the location of k-th section, j-th row and i-th
column is given the model coordinate of (i-1,j-1,k-1),
while the i, j, k have the range of 1 to M,1 to N and 1 to L
respectively. Let cx, cy respectively represent the pixel
spacing in horizontal and longitudinal direction within the
slice, and cz represents the slice spacing. Then the
transformation matrix from model coordinate to world
coordinate is as follows:

Mm 2w

⎡ cx
⎢
⎢0
= ⎢
⎢0
⎢⎣ 0

0

0

cy

0

0
0

cz
0

0⎤
⎥
0⎥
⎥
0⎥
1 ⎥⎦

This matrix transforms the volume model to an anisotropic
volume data filed which has the same proportion of size
with the real object. Different from the traditional
shear-warp algorithm, here, the view matrix is used for
transforming the coordinates from world to view, not
directly from model to view in the condition of volume
data being isotropic. We use the parallel projection
algorithm to render the anisotropic data, and next we are
concerned about the factorization of the view matrix.
B.

Factorization
Let

M view3

be the upper-left 3x3 sub matrix

of M view , as described like:
⎛ m11 m12 m13 ⎞
⎜
⎟
Mview3 = ⎜ m21 m22 m23 ⎟
⎜m
⎟
⎝ 31 m32 m33 ⎠
Then, the values of sx and sy which represent the
shear factors in x-axis and y-axis respectively, decided by
the viewing direction, are computed by:

m22 m13 − m12m23
m11m22 − m21m12
m11m23 − m21m13
sy =
m11m 22 − m21m12

sx =

Here, sx and sy equal the shear spacing per each unit
distance along the principle axis. But this time, the spacing
between two adjacent slices is not necessarily the unit
distance. So, the current translating factors should be
corrected as

428

ti ' = ∇ * ti

△s’

tj ' = ∇ * tj .
ti ' , tj ' are the translating factors in

EYE

In this formula,
current new method, ti ，tj are the translating factors in
the traditional shear-warp algorithm., and ∇ represents
the real slice spacing along the principal axis. For
example, if the principal axis is the z-axis, then ∇ equals
cz, so by analogy. Finally, the shear matrix M shear in
this new method is described as follows:
⎡1
⎢
⎢0
M shear = ⎢
⎢0
⎢⎣ 0

0

sx

1
0

sy
1

0

0

θ

△s

ti ' ⎤
⎥
tj ' ⎥
⎥
0⎥
1 ⎦⎥

Resampling
In the condition of the volume data being anisotropic,
the original voxels and the resampled voxels within a slice
have the location relations as shown in figure 3.

△c

(b)
Figure 4 : (a)The standard sampling ;(b)The spacing between samples
on a viewing ray depends on both the viewing direction and the slice
spacing in the principal axis

C.

As is shown in the figure 4, the △s0 is the standard
sampling spacing along the viewing ray, and the
precomputed
opacity
is
described
as

α

e

−φΔs 0

original voxel

. After the change of the viewing
direction, the real spacing between two adjacent samples
is △s, and △c is the slice spacing. The corrected opacity

resampled voxel

will be computed as α

sto re d = 1 −

c o rre c te d = 1 −

Δs
Δs
Δc
1
Δc
=
∗
=
∗
Δs0
Δc
Δs0
Δs0
cosθ

e

−φΔs

. Here,

So, the corrected opacity will be computed as follows:

α

Figure 3: The location relation between original voxel and resampled
voxel in slice

Obviously, here the resampling weights for each voxel
in the slice are not all the same. However, we find that
every voxel in one row has the same longitudinal weights,
and every voxel in one column has the same horizontal
weights. So, it is only necessary to precompute the
resampling weights for voxels in the first column and the
first row, and then the weights for every voxel in this slice
are determinate. This fact effectively speeds up the
resampling and rendering process.
Opacity correction
In the traditional shear-warp algorithm, the opacity
correction is just for the change of the viewing direction.
But in the condition of that volume data being anisotropic,
the slice spacing along the principal axis will be different
while the viewing direction changes. So, here the opacity
correction must be for both the changes of the viewing
direction and the slice spacing.
D.

c o r r e c te d = 1 −

e

−φΔs
Δs

= 1 −

⎡ e − φ Δ s 0 ⎤ Δs 0
⎣
⎦

[

= 1 − 1 − α s to r e d

1

]co s θ

∗

Δc
Δs 0

E.

Results
The presented algorithm has been implemented on a
computer (Pentium(R) 4 2.40GHZ CPU, 256M memory),
by using the c++ program language. The source data are
respectively the binary skull data （ size:256*256*256;
spacing proportion:1:1:1 ） and the MRI data(size:
512*512*32; spacing proportion:1:1:4.2) provided by
West China Center of Medical Science of Sichuan
University. Figure 5 shows the rendering results.

EYE

(a) low resampling
△s0

(b) high resampling

(skull data: 256*256*256)

(a)

429

provided, and all the benefits of this algorithm can be
applied in the real rendering operations. So, this presented
algorithm is a very promising algorithm.
ACKNOWLEDGMENT

(c) low resampling

(d) high resampling

The authors would like to thank Zhang Fan for
guiding programming and providing some source volume
data; thank Zhen Zheng for supporting the work. Finally,
thank all people in 903 staff room.

(MRI data: 512*512*32)
Figure 5: Interaction with low resampling rate and final image with high
resampling rate

It just needs reducing the resampling rate to decrease
the computation when the user interacts for locating the
viewing angle, and increasing the resampling rate for
rendering the final image when the viewing angle has been
determinate. So, the presented algorithm is very useful to
meet both the requirements of rendering speed and final
image quality.
IV. CONCLUSIONS
By using the presented new shear-warp algorithm to
render the anisotropic volume data directly, the volume
data for rendering are accurate, having avoided the image
blurring caused by slice interpolation. Meanwhile, the
preprocessing time is decreased, the real-time interaction
comes true, and the final image quality is also satisfied.
More importantly, with the new generation of CT and
MRI equipments, the slice resolution has been
continuously improved; the slice spacing has also been
much smaller, or even closes to the pixel spacing. That is
to say the foundation of this presented algorithm is

REFERENCES
[1] Lacroute P, Levoy M. “Fast volume rendering using a Shear-Warp
factorization of the viewing transformation”, Computer Graphics,
Proceedings, 1994,July,pp.451-458
[2] Lacroute P, “Fast volume rendering using a Shear-Warp
factorization of the viewing transformation”,Technical Report:
CSL-TR-95-678, 1995.
[3] Binhe Miao, Yuanmu Deng,Feizeng Huang. “Interpolation of 3D
images based on point matching”,Chinese Journal of medical
Physics. 2000,17(1),pp.14-16
[4] A.Goshtasby,D.A. Turner,and L.V.Ackerman. “Matching of
tomographics slices for interpolation[J]”,IEEE Trans. Med Image.
1992,11(4),pp.507-515
[5] W.E,Higgins,C,J.Orlick,and
B.E.Ledell,
“Nolinear
filtering
approach to 3D Gray-scale image interpolation[J]”, IEEE Trans.Med
Image.1996,15(4),pp.580-587
[6] Schulze J P,Kraus M,Lang U, “Integrating Pre-integration into the
Shear-Warp algorithm”, Proceedings of the 2003 Eurographics/IEEE
TVCG
Workshop
on
Volume
Graphics
Tokyo:ACM
Press,2003,pp.109-118
[7] Sweeney J, Mueller K, “Shear-warp deluxe: the Shear-warp
algorithm revisited”, Proceddings of the Symposium on Data
Visualization Barcelona: Eurographics Assocaiation,2002,pp.95-104

430

