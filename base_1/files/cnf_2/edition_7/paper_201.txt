Pacific Graphics 2009
S. Lee, D. Lischinski, and Y. Yu
(Guest Editors)

Volume 28 (2009), Number 7

Generalized Discrete Ricci Flow
Yong-Liang Yang1

Ren Guo2

Feng Luo2

Shi-Min Hu1

Xianfeng Gu3

1 Tsinghua

National Laboratory for Information Science and Technology
Department of Computer Science and Technology, Tsinghua University
2 Department of Mathematics, Rutgers University
3 Department of Computer Science, Stony Brook University

Abstract
Surface Ricci flow is a powerful tool to design Riemannian metrics by user defined curvatures. Discrete surface
Ricci flow has been broadly applied for surface parameterization, shape analysis, and computational topology.
Conventional discrete Ricci flow has limitations. For meshes with low quality triangulations, if high conformality
is required, the flow may get stuck at the local optimum of the Ricci energy. If convergence to the global optimum
is enforced, the conformality may be sacrificed.
This work introduces a novel method to generalize the traditional discrete Ricci flow. The generalized Ricci flow
is more flexible, more robust and conformal for meshes with low quality triangulations. Conventional method is
based on circle packing, which requires two circles on an edge intersect each other at an acute angle. Generalized
method allows the two circles either intersect or separate from each other. This greatly improves the flexibility and
robustness of the method. Furthermore, the generalized Ricci flow preserves the convexity of the Ricci energy, this
ensures the uniqueness of the global optimum. Therefore the algorithm won’t get stuck at the local optimum.
Generalized discrete Ricci flow algorithms are explained in details for triangle meshes with both Euclidean and
hyperbolic background geometries. Its advantages are demonstrated by theoretic proofs and practical applications
in graphics, especially surface parameterization.
Categories and Subject Descriptors (according to ACM CCS): I.3.5 [Computer Graphics]: Computational Geometry
and Object Modeling —Geometric algorithms, languages, and systems

1. Introduction
1.1. Ricci Flow and Applications
Ricci flow is a powerful tool to design Riemannian metrics
using user defined curvatures. Intuitively, Ricci flow deforms
a Riemannian metric proportional to the curvature. The deformed metric will change the curvature, such that the curvature evolves according to a heat diffusion process. Eventually the curvature becomes constant everywhere. Moreover,
Ricci flow is the gradient flow of a special energy form entropy, the metric with constant curvature is the global optimum of the entropy.
Surface Ricci flow has broad applications in graphics
field, in the following, we only briefly introduce a few most
related examples. Surface parameterization refers to the process to map the surface onto a planar domain, which can be
formulated as designing a Riemannian metric of the surface,
such that all the interior points are with zero Gaussian curvatures, namely a flat metric. By changing the geodesic curvac 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.
Published by Blackwell Publishing, 9600 Garsington Road, Oxford OX4 2DQ, UK and
350 Main Street, Malden, MA 02148, USA.

tures on the boundary points, the flat metric will be changed
accordingly. By adjusting the boundary geodesic curvatures,
an optimal parameterization can be achieved, which minimizes the distortion [YKL∗ 08]. In computational topology,
Ricci flow has been applied to compute the canonical representative in each homotopy class of loops [ZJLG09]. Two
loops are homotopic, if one can deform to the other on the
surface. If the surface has a Riemannian metric with negative Gaussian curvature, then each homotopy class has a
unique closed geodesic. Given a high genus surface, Ricci
flow is used to compute the metric with −1 Gaussian curvature (hyperbolic metric). Then the closed geometric loop can
be computed in each homotopy class, which is the canonical representative of the class. Ricci flow has also been applied to the shape space [JZLG08]. Two surfaces are conformal equivalent, if there is an angle-preserving map between
them. All surfaces in R3 can be classified by the conformal
equivalence relation. All the conformal equivalence classes
form a finite dimensional Riemannian manifold, where each

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

2006

point represents a class of surfaces, a curve represent a deformation process. Given a surface in R3 , its coordinates in
this shape space can be computed using Ricci flow.
1.2. Generalization of Discrete Ricci Flow
Ricci flow deforms a Riemannian metric on the surface
in an angle-preserving manner,
namely, the metric deformation
is conformal. Locally, conformal metric deformation transforms an infinitesimal circle to
an infinitesimal circle. Fig. 1 illustrates the property of Ricci
flow. The Stanford bunny is embedded in R3 , it has an inFigure 1: Conforduced Euclidean metric. By usmal metric deformaing Ricci flow, the metric is contion maps infinitesformally deformed to a flat metimal circles to inric (with cone singularities), all
finitesimal circles.
Gaussian curvatures are zeros,
then the bunny surface is flattened onto the plane. The planar circle packing texture
shown in the upper right corner is mapped onto the surface. All the planar circles are mapped to circles, the
tangential relations are preserved. This property inspires
Thurston [Thu80] to invent discrete conformal mapping using circle packing metric as shown in Fig. 2. Given a planar
domain in frame (a), we triangulate the domain. Then we
put a circle at each vertex, and all circles are tangent to each
other. Then we change the circle radii, and keep the tangential relations. This will deform the domain to different planar
domains as shown in frame (b) and (c). The piecewise linear
mapping is a discrete conformal mapping. If we refine the
triangulation, such that the diameter of each triangle goes to
zero, then the discrete conformal mapping will converge to
the real conformal mapping under some normalization conditions. The theoretic proof is given by He et.al. [xHS96].

(a)

(b)

discrete conformal metric deformation for surfaces. Chow
and Luo [CL03] built the intrinsic relation between discrete
conformal metric deformation and surface Ricci flow. They
showed that the discrete Ricci flow is stable and leads to the
unique solution, as long as all the intersection angles (φi j in
Fig. 3) are acute. If the intersection angles are obtuse, the
solution may not be unique, the discrete curvature flow may
get stuck at the local optimum.
Unfortunately, in reality,
the acute intersection angle condition is too restricv
φ
tive. Triangle meshes obθ
tained from raw scan data or
φ
reconstructed using marcho
θ
h θ
v
v
l
ing cubes method, such as
φ
[Ju04], always have skinny
triangles. The Kitten mesh in
Fig. 4 is reconstructed usFigure 3: Conventional
ing marching cubes method
discrete Ricci flow.
[Ju04]. Fig. 4(b) shows a local region near the nose. It is
clear that there are many triangles nearly being degenerated.
1

31

1

12

2

2

1

3

3

1

23

(a)

(b)

Figure 4: Kitten model is re-triangulated using Polymender
in [Ju04], which has skinny triangles.

(c)

Figure 2: Thurston’s discrete conformal deformation using
circle packing metric.
Thurston’s circle packing method is too restrictive. Later
it is generalized from planar domains to surface domains.
Furthermore, the circles can intersect each other with acute
angles. Fig. 3 shows the circle packing on one triangle. Two
circles at the vertices of an edge intersect each other with
an acute intersection angle. The circle radii can be modified,
but the intersection angles are preserved. This gives us the

Figure 5: Bad conformality of traditional discrete surface
Ricci flow on meshes with low quality triangulations.

It is hardly to find a circle packing on the mesh, such that all
c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

2007

the intersection angles are acute. In order to ensure the convergence of the curvature flow, the intersection angles are
forced to be acute. Therefore, the circle packing metric is no
longer consistent with the original induced Euclidean metric of the mesh. The conformality of the final mapping is
compromised. Fig. 5 shows the low conformality of the surface parameterization using conventional Ricci flow method
on the mesh with low quality of triangulation. Note that
for conventional Ricci flow, there might be an optional preprocessing step to re-triangulate the input mesh [YKL∗ 08],
such that the circle packing metric and the Euclidean metric
can be more consistent.
In order to achieve high
conformality even on meshes
with bad triangulations, this
v
work generalizes the tradiθ
l
tional circle packing metl h
o h
ric shown in Fig. 3 to inθ
h
θ
versive distance circle packv
v
l
ing in Fig. 6. The conventional Ricci flow requires all
the intersection angles to be
Figure 6:
Inversive
acute. The generalized Ricci
distance discrete Ricci
flow relaxes the acute interflow.
section angle condition, such
that two circles on an edge either intersect at an acute angle or separate from each other. It
is guaranteed that given arbitrary triangular mesh with an initial induced Euclidean metric, a generalized circle packing
can be found, such that the circle packing metric is consistent with the induced Euclidean metric. Therefore, the generalized Ricci flow method guarantees high conformality.
Furthermore, we can show that the generalized Ricci flow is
the gradient flow of a convex energy. There exists a unique
global optimum, the generalized flow leads to the unique solution. In one word, the generalized Ricci flow is flexible, robust and conformal to meshes with bad triangulations. Fig. 7
shows the parameterization result of the same Kitten mesh
in Fig. 4 with high conformality. Comparing with Fig. 5, it
is obvious that the generalized Ricci flow has enormously
improved the conformality.

Figure 7: High conformality of generalized discrete surface
Ricci flow on meshes with low quality triangulations.

1

1

2

2

2

2

3

3

1

3

1

3

1.3. Contributions
Compared to traditional discrete Ricci flow [JKLG08], this
work has the following major contributions:
1. Generalizes discrete Euclidean Ricci flow (Fig. 3) to include inversive distance circle packing (Fig. 6), while the
traditional one requires two circles on an edge intersect
each other at an acute angle. This will help to largely improve the conformality of the parameterization result on
meshes with low quality triangulations.
2. Explicitly gives the geometric meaning of the Hessian
matrix of discrete Euclidean Ricci energy (see Lemma
3.7 and the appendix for the proof). In [JKLG08], the
Hessian matrix has more complicated form because it is
c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

derived by explicit computation of the discrete Ricci energy.
3. Generalizes discrete hyperbolic Ricci flow (Fig. 3) to include inversive distance circle packing (Fig. 6).
We show that both the discrete Euclidean Ricci energy and
the hyperbolic Ricci energy are convex. Therefore, the generalized Ricci flow converges to the unique solution, which
is the global optimum of the Ricci energy. The Ricci energy
can be efficiently optimized using Newton’s method.
1.4. Organizations
Section 2 briefly reviews the most related works. Section
3 explains the discrete genearlized Ricci flow for both Euclidean case and hyperbolic case. Section 4 introduces the
algorithms in details. Experimental results are reported in
Section 5. The paper is concluded in Section 6.
2. Previous Works
2.1. Mesh Parameterization
Mesh parameterization has been an active research topic in
geometry processing, it is also a fundamental tool widely
used in graphics field. Here we only briefly review the most
related works and refer readers to [FH05,SPR06,HLS07] for
more thorough surveys.
The aim of parameterization is to build a map (ideally one-to-one) from the mesh surface to 2D planar domain. Early parameterization methods [EDD∗ 95, Flo97]
treat interior mesh vertex as some convex combination of
its neighboring vertices based on Tutte’s embedding theorem [Tut63]. Taking mesh geometry into account, the simple graph Laplacian is extended to the well-known cotangent
weights [PP93] and mean value coordinates [Flo03]. These
methods generally require fixing mesh boundary onto a convex planar shape to make the mapping bijective, which usually provides parameterization results with large area distortion. Boundary free parameterization is then proposed as an
energy minimization problem in [LPRM02] and [DMA02].

2008

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

The former one approximates the Cauchy-Riemann equation
and the latter optimizes Dirichlet energy. These two methods
can achieve parameterization with much lower angle distortion and were shown to be identical in [CSD02]. More recently, Mullen et. al. [MYAD08] presented a spectral approach to reduce common artifacts of [LPRM02, DMA02]
due to positional constraints or mesh sampling irregularity and high-quality conformal parameterization can be
achieved. A local/global method was proposed in [LZX∗ 08]
to build global mapping while preserving local shape properties by using transformations taken from a restricted set,
which can significantly reduce both angle and area distortions.
Mesh parameterization can also be achieved by optimizing some energy form which measures the mapping distortions. Angle based flattening [SdS01] computes the parameterization which minimizes the differences between the corner angles of faces on the original mesh and their images
on the parameter plane. The computational efficiency of this
method is largely improved by later works in [SLMB05,
ZLS07]. To further reduce distortion, the original mesh may
be cut into small pieces as in [SSGH01, SCOGL02].
Since planar parameterization can be treated as finding a
certain mesh metric such that the curvature is nearly 0 everywhere except singular vertices, [BCGB08] proposed a
method to scale the mesh metric according to curvature specification. Our generalized Ricci flow method is also based on
metric deformation, we will discuss the most related metric deformation based parameterization methods in the next
sub-section.
2.2. Curvature flow
The theory of intrinsic curvature flows originated from differential geometry, and was later introduced into the engineering fields. In this section, we give a brief overview of
the literature that are directly related to discrete surface curvature flow.
The Ricci flow was introduced by R. Hamilton in a seminal paper [Ham82] for Riemannian manifolds of any dimension for the purpose of proving Poincaré conjecture.
Circle packing metric was introduced by Thurston
in [Thu80]. Thurston also conjectured in [Thu85] that for
a discretization of the Jordan domain in the plane, the sequence of circle packings converge to the Riemann mapping.
This was proved by Rodin and Sullivan [RS87]. Collins and
Stephenson [CS03] implemented the computational algorithm.
In [CL03], Chow and Luo introduced the discrete Ricci
flow and discrete Ricci energy on surfaces. The algorithmic
implementation of the discrete Ricci flow was carried out
by Jin et. al. [JKLG08]. Bowers and Stephenson [BS04b]
introduced inversive distance circle packing and it was used
for disk-like mesh flattening purpose in [BH03]. Guo proved
the local rigidity for Euclidean and Hyperbolic inversive distance circle packing in [Guo09].

Circle pattern was proposed by Bowers and Hurdal
[BH03], and has been proven to be a minimizer of a convex energy by Bobenko and Springborn [BS04a]. An efficient circle pattern algorithm was developed by Kharevych
et. al. [KSS06].
In [Luo04], Luo studied the discrete Yamabe flow on surfaces. Springborn et. al. [SSP08] identified the Yamabe energy introduced by Luo with the Milnor-Lobachevsky function and the heat equation for the curvature evolution with
the cotangent Laplace equation.
3. Theoretic Background
The theoretic foundation for Ricci flow on smooth surfaces has been laid down by Hamilton [Ham88] and Chow
[Cho91]. In this section, smooth surface Ricci flow is generalized to the discrete setting. We briefly introduce the most
related theories, for details, we refer readers to [GY07] for
thorough treatments.
Suppose M(V, E, F) is a simplical complex (triangle
mesh) with vertex set V , edge set E and face set F respectively. We use vi to denote the vertex, [vi , v j ] the edge connecting vi and v j , [vi , v j , vk ] the face formed by vi , v j and vk .
Definition 3.1 (Background Geometry) We say M is with a
Euclidean E2 (Hyperbolic H2 ) background geometry, if each
face is a Euclidean (Hyperbolic) triangle.
In both cases, the discrete metric is defined as edge length
satisfying triangle inequality.
Definition 3.2 (Discrete Metric) A discrete metric on M is
a function l : E → R+ , such that on each face [vi , v j , vk ], the
triangle inequality holds
li j + l jk > lki .
The corner angles are determined by the discrete metric by
Euclidean (Hyperbolic) cosine law:
⎧
2
2
2
⎨ arccos li j +lki −li j
E2
2li j lki
(1)
θi =
cosh
l
−cosh
l
cosh
l
ij
jk
ki
⎩ arccos
H2
sinh li j sinh lki

The discrete Gaussian curvature is defined as angle deficiency,
Definition 3.3 (Discrete Curvature) Suppose vi is an interior vertex, with surrounding faces [vi , v j , vk ]. The corner
jk
angle in [vi , v j , vk ] at the vertex vi is denoted as θi (or θi ).
Then the discrete curvature of vi is given by
jk

2π − ∑ j,k θi
jk
π − ∑ j,k θi

Ki =

vi ∈ ∂M
vi ∈ ∂M

(2)

where ∂M denotes the boundary of the mesh.
Similar to the smooth case, the total curvature is determined by the topology of the mesh and the background geometry:

∑ Ki + λ ∑ Ak = 2πχ(M),
i

k

c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

where χ(M) = |V | + |F| − |E| is the Euler number of M, λ is
0 if M is with E2 background geometry, λ is −1 if M is with
H2 background geometry, Ak is the area of the k-th face.

Lemma 3.7 The following symmetric relation holds for generalized discrete Ricci flow in E2 (proof can be found in Appendix):
∂θ j
∂θi
h
=
= k.
∂u j
∂ui
lk

(7)

∂θi
∂θ
∂θ
=− i − i
∂ui
∂u j ∂uk

(8)

3.1. Inversive Distance Discrete Ricci Flow
A circle packing is to associate each vertex with a circle. The
circle at vertex vi is denoted as ci . There are two situations.
1. In Fig. 3, the two circles ci and c j on an edge [vi , v j ] intersect each other, the intersection angle φi j is acute, this
is called Andreev-Thurston circle packing.
2. In Fig. 6, the two circles ci and c j on an edge [vi , v j ] are
disjoint, this is called Inversive distance circle packing.
In both cases, the inversive distance is defined as
Definition 3.4 (Inversive Distance) Suppose the length of
[vi , v j ] is li j , the radii of ci and c j are γi and γ j respectively,
then the inversive distance between ci and c j is given by
⎧ 2 2 2
⎨ li j −γi −γ j
E2
2γi γ j
I(ci , c j ) =
(3)
⎩ cosh li j −cosh γi cosh γ j H2
sinh γi sinh γ j

For Andreev-Thurston circle packing in E2 and H2 , I(ci , c j )
is exactly cos φi j .
Definition 3.5 (Inversive Distance Circle Packing Metric)
An inversive distance circle packing metric on a mesh M is
to associate each vertex vi with a circle ci , whose radius is γi ,
associate each edge [vi , v j ] with a non-negative number Ii j .
The edge length is given by
li j =

E2

γ2i + γ2j + 2Ii j γi γ j
cosh

−1

(cosh γi cosh γ j + Ii j sinh γi sinh γ j )

H2

(4)
The inversive distance circle packing metric is denoted as
(Γ, I, M), where Γ = {γi }, I = {Ii j }.
A discrete conformal deformation is to change radii γi ’s
only, and preserve inverse distance Ii j ’s. The discrete Ricci
flow is defined as follows:
Definition 3.6 (Discrete Ricci Flow) Given an inverse distance circle packing metric (Γ, I, M), the discrete Ricci flow
is
dui
= K¯ i − Ki ,
dt

(5)

where
ui =

log γi
log tanh γ2i

E2
H2

(6)

K¯ i is the user defined target curvature on mesh vertex vi .
Given a triangle [vi , v j , vk ] with a inversive distance circle
packing, there exists a unique circle c, which is orthogonal
to ci , c j , ck , shown as the red circles in Fig. 3 and Fig. 6.
The center of c is O. The distance from O to edge [vi , v j ] is
denoted as hk , the edge length of [vi , v j ] is denoted as lk .
c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

2009

and

Lemma 3.8 The following symmetric relation holds for hyperbolic Ricci flow
∂θ j
∂θi
=
,
∂u j
∂ui
albeit with a more complex formula. On one face [v1 , v2 , v3 ],
⎛
⎛
⎞
⎞
dθ1
du1
−1
⎝ dθ2 ⎠ =
M ⎝ du2 ⎠ (9)
sin θ1 sinh l2 sinh l3
dθ3
du3
⎛

1 − a2
M = ⎝ ab − c
⎛ ca1− b
⎜
Λ=⎝

a2 −1

0
0

ab − c
1 − b2
bc − a
0
1
b2 −1

⎞ ⎛
ca − b
0
bc − a ⎠ Λ ⎝ bx − z
1 − c⎞2
cx − y
0
0 ⎟
⎠

ay − z
0
cy − x

⎞
az − y
bz − x ⎠
0

1
c2 −1

0

where (a, b, c) = (cosh l1 , cosh l2 , cosh l3 ),
(cosh γ1 , cosh γ2 , cosh γ3 ).

(x, y, z) =

The detailed proof of the above lemma can be found
in [Guo09].
Let u represent the vector (u1 , u2 , · · ·un ), K represent the
vector (K1 , K2 , · · · , Kn ), where n = |V |. Fixing the inversive distances, all possible u’s that ensure the triangle inequality on each face form the admissible metric space of
M. The above lemmas prove that the differential 1-form
ω = ∑i Ki dui in the admissible metric space of M is a closed
1-form. The discrete Ricci energy
E(u) =

u

∑(K¯i − Ki)dui

(10)

u0 i

is well defined, where u0 = (0, 0, · · · , 0). The discrete Ricci
flow (Eq. 5) is the negative gradient flow of the Ricci energy.
Theorem 3.9 (Convexity of Ricci Energy) The discrete Euclidean Ricci energy is convex on the hyper plane ∑i ui = 0
in the admissible metric space. The discrete hyperbolic Ricci
energy is convex in the admissible metric space.
The basic idea to prove the above theorem is as follows.
Based on Lemma 3.7 and 3.8, it can be proved that the
Jacobian matrix of functions θ1 , θ2 , θ3 in terms of u1 ,
u2 , u3 has one zero eigenvalue with associated eigenvector
(1, 1, 1) and two negative eigenvalues. Then the differential
1-form ∑3i=1 θi dui is closed, the integration ω(u1 , u2 , u3 ) =
(u1 ,u2 ,u3 ) 3
θ du
(u01 ,u02 ,u03 ) ∑i=1 i i

is a concave function. Then by taking

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

2010

sum of all the 1-forms within each mesh triangle and according to Eq. 2, the convexity of discrete Ricci energy can
be proved. The details of the proof can be found in [CL03],
[Guo09] and [GY08]. Then we know that the metric producing the target curvature is the unique global optimum of the
Ricci energy. Therefore, discrete Ricci flow won’t get stuck
at the local optimum, and converges to the global optimum.
Figure 8: Generalized hyperbolic Ricci flow on Amphora
model.

4. Generalized Discrete Ricci Flow Algorithm
This section introduces the practical algorithms of computing mesh parameterization based generalized Ricci flow.
4.1. Compute the Initial Circle Packing Metric
Given a triangle mesh, the inversive distance circle packing
metric which exactly equals to the original Euclidean mesh
metric is computed as follows:
1. For each face [vi , v j , vk ], we compute

Figure 9: Generalized hyperbolic Ricci flow on 3 holed
Torus model.

li j + lki − l jk
=
.
2
2. For each vertex vi , the radius of ci is given by
jk
γi

7. Update ui ← ui + µi .
8. Repeat step 1 through 7, until

jk

γi = min γi .
jk

3. For each edge [vi , v j ], the inversive distance is given by
Eq. 3.

i

4.3. Flattening the Mesh

4.2. Optimize Ricci Energy
After the initial inversive distance circle packing metric is
set, the conformal metric which induces user prescribed target curvature K¯ i is computed by:
1. For each edge [vi , v j ], using current radii γi , γ j and inversive distance Ii j , compute the current edge length li j by
Eq. 4.
2. For each face [vi , v j , vk ], using the current edge length to
compute the corner angles θi , θ j , θk by Eq. 1.
3. For each vertex vi , compute the current curvature Ki using
Eq. 2.
∂θi
i
4. For each face [vi , v j , vk ], compute ∂u
and ∂θ
∂ui using Eq. 7,
j
8 or Eq. 9.
5. Form the Hessian matrix Δ of the discrete Ricci energy in
Eq. 10. It is easy to verify from Eq. 2 and Eq. 10 that the
Hessian matrix has an explicit form Δ = (hi j ):
⎧
i = j, [vi , v j ] ∈ E
⎨ −wi j
(11)
hi j =
∑k wik i = j, [vi , vk ] ∈ E
⎩
0
i = j, [vi , v j ] ∈ E
where
jk

wi j =

max |K¯ i − Ki | < ε.

jl

∂θi
∂θ
+ i .
∂u j
∂u j

6. Solve the following linear system
Δµ = K¯ i − Ki .

For generalized Euclidean Ricci flow, after the target circle
packing metric is computed, we can use Eq. 4 to get the corresponding Euclidean metric. Then the mesh can be flattened
onto the plane by the following simple algorithm.
1. Compute a homology group basis [EW05], cut the surface open along the base curves. Denote the open mesh
¯
as M.
2. Using Euclidean cosine law, flatten each triangle in M¯
isometrically on the plane.
3. Using rigid motion to glue the embedded faces of M¯ together.
For generalized hyperbolic Ricci flow, there are several
key differences to flatten the mesh compared with Euclidean
case. First, we embed the mesh onto the Poincaré disk instead of the plane. Second, the embedding of each triangle is
based on hyperbolic cosine law, instead of Euclidean cosine
law. Third, for gluing of different embedded triangles, the
rigid motions are hyperbolic rigid motions, instead of Euclidean ones. We refer readers to [JKLG08] for more details.
Fig. 8 and Fig. 9 show two high genus models parameterized
using hyperbolic inversive distance Ricci flow.

(12)
5. Experiments
In this section, we test our generalized Ricci flow algorithm
on variant models with low quality triangulations to show
2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.
c

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

Quasi−conformality of Generalized Ricci Flow on Rocker−Arm

2011
Quasi−conformality of Conventional Ricci Flow on Rocker−Arm

1800

250

1600
200

1400

Frequency

Frequency

1200
1000
800

150

100

600
400

50

200
0
0.5

(a)

(b)

1

1.5
2
2.5
Quasi−conformal Distortion Factor

3

0
0.5

3.5

(c)

(d)

1

1.5

2
2.5
3
3.5
4
Quasi−conformal Distortion Factor

4.5

5

5.5

(e)

Figure 10: Conformality comparison on Rock-Arm model. a) The original model with low quality triangulation. b) Generalized
Ricci flow result and color coded QC distortion. c) The histogram of QC distortion on mesh vertices using generalized Ricci
flow. d) Conventional Ricci flow result and color coded QC distortion. e) The histogram of QC distortion using conventional
Ricci flow.

the good conformality, flexibility and robustness of the parameterization results.
5.1. Conformality
Due to the exact equality between the original Euclidean
metric and the inversive distance circle packing metric, our
generalized Ricci flow method results in parameterization
with good conformality compared with the conventional
Ricci flow method. To quantitatively measure the conformality, we adapt the quasi-conformal(QC) distortion [SSGH01].
The distortion factor is computed within mesh triangle face
as the ratio of larger to smaller eigenvalues of the Jacobian of
the map. The ideal conformality is 1, larger value for worse
conformality. The color coded map is rendered based on the
area weighted distortion on each mesh vertex, blue for 1, red
for largest distortion value of generalized Ricci flow method.
The conformality comparison result on Rocker-Arm model
with low quality triangulation is shown in Fig. 10. Since
the original model is genus 1 boundary 0, we set the target curvature to 0 for all vertices. For traditional Ricci flow
method, we force all the intersection angles φi j to be acute,
this compromises the conformality. From the visual effect of
the checker board texture mapping, we can easily find that
the generalized Ricci flow can get results with much better
conformality. This is also verified by the color-coded map
of QC distortion. The histogram also shows that the QC distortion factors highly concentrate to 1 in generalized Ricci
flow case, while the conventional Ricci flow result diverges
much more. More results using generalized Ricci flow with
good conformality will be presented later, and the average
QC factors are listed in Table 1.
5.2. Flexibility
As the previous curvature flow based method [JKLG08]
[SSP08], our method is capable of computing the conformal
parameterization with arbitrary user prescribed target curvatures. Fig. 11 shows the results of a frog model of genus 0
and boundary 1. From Gauss-Bonnet theorem, the sum of
c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

(a)

(b)

(c)

Figure 11: Flexible boundary curvature specification of
generalized Ricci flow. a) The original model with low quality triangulation. b) Circular boundary parameterization. c)
Rectangular boundary parameterization.

target curvature on mesh vertex is 2π. After setting all inner mesh vertex target curvature to 0, the boundary vertex
curvature can be assigned proportional to its length within
the whole boundary, then we can get the circular conformal
parameterization as shown in Fig. 11(b). If a rectangular parameter domain is needed, we can choose four boundary vertices and make the target curvature equal to π/2 and set all
other mesh vertex curvature to 0. The corresponding result
is shown in Fig. 11(c).

5.3. Set the Boundary Free
After setting the initial circle packing metric based on inversive distance, we can leave the boundary as it is and only
optimize the metric of the inner part, which means we set
dui = 0 on boundary vertices. This leads to the so-called free
boundary Ricci flow which preserves the original metric on
mesh boundaries. Since there is no constraint on the mesh
boundary, the area distortion of the parameterization will be
effectively minimized [YKL∗ 08] [SSP08]. Fig. 12 shows an
example on Nicolo da Uzzano model.

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

2012

(a)

(b)

(c)

Figure 12: Free boundary generalized Ricci flow on Nicolo
da Uzzano model. a) The original model with low quality
triangulation. b) The embedded parameter domain. c) The
parameterization result with texture mapping.

5.4. Preserve Triangle Inequality
During the optimization process of the generalized Ricci
flow, the circle packing metric is updated because the vertex
radius changes. This means the induced Euclidean metric is
also changed. There is a possibility that the Euclidean triangle inequality would be violated (also see [SSP08]). Edge
swap (for inner edge) or splitting (for boundary edge) is necessary to help to achieve the global optimum. The edge swap
is performed on mesh edge whose length is larger than the
sum of the other two edges’ within a mesh face. During edge
swap, we maintain the circle radii on the swapped edge vertices. For the new edge, the corresponding inversive distance
is computed from the original Euclidean distance of the two
edge vertices of the mesh. Edge split is needed if the edge
lies on mesh boundary. In this rare case, the inversive distance circle packing metric needs to be re-initialized. Fig. 13
shows a Buste model with base cut and an inner boundary
sliced on the head. Since it is genus 0 and boundary 2, we
set target curvature to 0 everywhere. Five mesh edges are
swapped to maintain the triangle inequality and the generalized Ricci flow can be optimized. For other test cases in our
paper, only Nicolo da Uzzano model needs 6 edge swaps and
no boundary edge split is observed during the experiments.
5.5. Performance and Discussions
Our generalized Ricci flow algorithm is implemented in C++
on a PC with Intel Q9400 CPU of 2.66 GHz and 2GB RAM.
And we use Matlab C++ library to solve the sparse system
in Section 4.2. The computational time and average QC distortion is summarized in Table 1.
For traditional Ricci flow of Fig. 5 and Fig. 10(d), the
average QC distortions are 2.3570 and 1.7405 respectively,
which are much worse than the corresponding generalized
Ricci flow results. Because generalized Ricci flow based on
inversive distance is also a convex energy optimization, it
can be efficiently computed using Newton’s method as in
Section 4.2. As a result, the computational efficiency is comparable to those of traditional Ricci flow.

(a)

(d)

(b)

(e)

(f)

(c)

(g)

(h)

Figure 13: Generalized Ricci flow on Buste model. a) The
original model with low quality triangulation. b) The embedded parameter domain. c) The parameterization result with
texture mapping. d ~h) Five swapped edges during flow.
Model
Kitten
Rocker-Arm
Frog(cir.)
Frog(rect.)
Nicolo
Buste

|F|
66952
20088
22856
22856
50053
107259

Avg QC
1.0306
1.0461
1.0531
1.0443
1.0220
1.0294

Time(s)
12.8
3.8
6.5
5.2
9.4
30.6

Table 1: Statistics of generalized Ricci flow

Note that in the previous work [KSS06] based on circle
pattern, the conformal parameterization can also be computed by a convex energy optimization. The difference is
that circle pattern defined curvatures on both vertices and
faces, while our generalized discrete Ricci flow method has
only vertex curvatures. Furthermore, [KSS06] only focused
on Euclidean case, our work also handles hyperbolic case.
Compared to the metric scaling approach in [BCGB08], our
parameterization result is achieved by minimizing a convex
energy. In contrast, the metric scaling parameterization is
based on an approximation of conformal factor estimation.
There is no guarantee that a total exact flat metric can be
carried out. Their work also studied Euclidean case only.
6. Conclusion
This work generalizes discrete surface Ricci flow from
Andreev-Thurston circle packing to inversive distance circle
packing. Conventional discrete Ricci flow method can not
achieve both high stability and high conformality for meshes
with low quality triangulations. The generalized Ricci flow
algorithm greatly improves the robustness and the conforc 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

2013

mality. It preserves the convexity of the Ricci energy as well.
Therefore, the generalized Ricci flow is much more flexible,
robust, and conformal. Furthermore, this work gives the geometric interpretation of the Hessian matrix of discrete Ricci
energy based on inversive distance circle packing metric.

[FH05] F LOATER M. S., H ORMANN K.: Surface parameterization: a tutorial and survey. In Advances in Multiresolution for
Geometric Modelling. Springer, 2005, pp. 157–186.

In the future, we will find the geometric interpretation of
the Hessian of the hyperbolic Ricci energy. We will develop
parallel generalized Ricci flow algorithm and apply it for
more applications in graphics.

[Flo03] F LOATER M. S.: Mean value coordinates. Comput. Aided
Geom. Des. 20, 1 (2003), 19–27.

[Flo97] F LOATER M. S.: Parametrization and smooth approximation of surface triangulations. Comput. Aided Geom. Des. 14,
3 (1997), 231–250.

[Guo09] G UO R.: Local Rigidity of Inversive Distance Circle
Packing. Tech. Rep. arXiv.org, Mar 8 2009.
[GY07] G U X., YAU S.-T.: Computational Conformal Geometry,
vol. 3. Higher Education Press, 2007.

Acknowledgements
The models used in this paper are the courtesy of Stanford University and AIM@SHAPE shape repository. This
work is partially supported by National Basic Research
Project of China (Project Number 2006CB303102), the
Natural Science Foundation of China (Project Number
60673004, 60628202), the National High Technology Research and Development Program of China (Project Number 2007AA01Z336), the National Science Foundation
CCF-0448339, CCF-0830550, CCF-0841514 and ONR
N000140910228. Ren Guo and Feng Luo are partially supported by the National Science Foundation of USA (Project
Number 0625935, 0604352).

[GY08] G U X. D., YAU S.-T.: Computational Conformal Geometry. Advanced Lectures in Mathematics. High Education Press
and International Press, 2008.
[Ham82] H AMILTON R. S.: Three manifolds with positive Ricci
curvature. Journal of Differential Geometry. 17 (1982), 255–
306.
[Ham88] H AMILTON R. S.: The Ricci flow on surfaces. Mathematics and general relativity (Santa Cruz, CA, 1986), Contemp.
Math. Amer.Math.Soc. Providence, RI 71 (1988).
[HLS07] H ORMANN K., L ÉVY B., S HEFFER A.: Mesh parameterization: Theory and practice. In ACM SIGGRAPH Course
Notes (2007).
[JKLG08] J IN M., K IM J., L UO F., G U X.: Discrete surface
ricci flow. IEEE Transactions on Visualization and Computer
Graphics 14, 5 (2008), 1030–1043.
[Ju04] J U T.: Robust repair of polygonal models. ACM Trans.
Graph. 23, 3 (2004), 888–895.

References
[BCGB08] B EN -C HEN M., G OTSMAN C., B UNIN G.: Conformal flattening by curvature prescription and metric scaling. Computer Graphics Forum (Proc. Eurographics 2008) 27, 2 (2008),
449–458.
[BH03] B OWERS P. L., H URDAL M. K.: Planar conformal mapping of piecewise flat surfaces. In Visualization and Mathematics
III (Berlin, 2003), Springer-Verlag, pp. 3–34.
[BS04a] B OBENKO A. I., S PRINGBORN B. A.: Variational principles for circle patterns and koebe’s theorem. Transactions of
the American Mathematical Society 356 (2004), 659–689.
[BS04b] B OWERS P., S TEPHENSON K.: Uniformizing dessins
and belyi maps via circle packing. Mem.Amer.Soc. 170, 805
(2004).
[Cho91] C HOW B.: The ricci flow on the 2-sphere. J. Differential
Geom. 33, 2 (1991), 325–334.

[JZLG08] J IN M., Z ENG W., L UO F., G U X.: Computing teichmüller shape space. IEEE Transactions on Visualization and
Computer Graphics 15, 3 (2008), 504–517.
[KSS06] K HAREVYCH L., S PRINGBORN B., S CHRÖDER P.:
Discrete conformal mappings via circle patterns. ACM Trans.
Graph. 25, 2 (2006), 412–438.
[LPRM02] L ÉVY B., P ETITJEAN S., R AY N., M AILLOT J.:
Least squares conformal maps for automatic texture atlas generation. SIGGRAPH 2002 (2002), 362–371.
[Luo04] L UO F.: Combinatorial yamabe flow on surfaces. Commun. Contemp. Math. 6, 5 (2004), 765–780.
[LZX∗ 08] L IU L., Z HANG L., X U Y., G OTSMAN C., G ORTLER
S. J.: A local/global approach to mesh parameterization. Computer Graphics Forum (Proceedings of SGP 2008) 27, 5 (2008),
1495–1504.

[CL03] C HOW B., L UO F.: Combinatorial Ricci flows on surfaces. Journal Differential Geometry 63, 1 (2003), 97–129.

[MYAD08] M ULLEN P., Y IYING T., A LLIEZ P., D ESBRUN M.:
Spectral conformal parameterization. Computer Graphics Forum
(Proceedings of SGP 2008) 27, 5 (2008), 1487 – 1494.

[CS03] C OLLINS C., S TEPHENSON K.: A circle packing algorithm. Computational Geometry: Theory and Applications 25
(2003), 233–256.

[PP93] P INKALL U., P OLTHIER K.: Computing discrete minimal surfaces and their conjugates. Experimental Mathematics 2
(1993), 15–36.

[CSD02] C OHEN -S TEINER D., D ESBRUN M.:
sight: Lscm and dcp are one and the same.
www.geometry.caltech.edu/pubs/CD02.pdf (2002).

HindIn

[RS87] RODIN B., S ULLIVAN D.: The convergence of circle
packings to the riemann mapping. Journal of Differential Geometry 26, 2 (1987), 349–360.

[DMA02] D ESBRUN M., M EYER M., A LLIEZ P.: Intrinsic parameterizations of surface meshes. Computer Graphics Forum
(Proc. Eurographics 2002) 21, 3 (2002), 209–218.

[SCOGL02] S ORKINE O., C OHEN -O R D., G OLDENTHAL R.,
L ISCHINSKI D.: Bounded-distortion piecewise mesh parameterization. In IEEE Visualization (2002), pp. 355–362.

[EDD∗ 95] E CK M., D E ROSE T., D UCHAMP T., H OPPE H.,
L OUNSBERY M., S TUETZLE W.: Multiresolution analysis of
arbitrary meshes. In SIGGRAPH ’95 (1995), pp. 173–182.

[SdS01] S HEFFER A., DE S TURLER E.: Parameterization of
faced surfaces for meshing using angle based flattening. Engineering with Computers 17, 3 (2001), 326–337.

[EW05] E RICKSON J., W HITTLESEY K.: Greedy optimal homotopy and homology generators. In SODA ’05 (2005), pp. 1038–
1046.

[SLMB05]

c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

S HEFFER A., L ÉVY B., M OGILNITSKY M., B O GOMYAKOV A.: ABF++: fast and robust angle based flattening.

ACM Transactions on Graphics 24, 2 (2005), 311–330.

Y.L. Yang, R. Guo, F. Luo, S.M. Hu, X. Gu / Generalized Discrete Ricci Flow

2014

[SPR06] S HEFFER A., P RAUN E., ROSE K.: Mesh Parameterization Methods and Their Applications, vol. 2 of Foundations
and Trends in Computer Graphics and Vision. Now Publisher,
2006.
[SSGH01] S ANDER P. V., S NYDER J., G ORTLER S. J., H OPPE
H.: Texture mapping progressive meshes. In SIGGRAPH ’01
(2001), pp. 409–416.

consider vi v j O instead. Then Ri, j = 2l1k (lk2 + x2i − x2j ). Let
ϒ be the radius of the circle perpendicular to all 3 circles ci ,
c j , ck , then we have x2i = γ2i + ϒ2 , x2j = γ2j + ϒ2 . This means
Eq. 15 is also true for Inversive distance case.

[SSP08] S PRINGBORN B., S CHRÖDER P., P INKALL U.: Conformal equivalence of triangle meshes. ACM Transactions on
Graphics 27, 3 (2008), 1–11.

θi

Ri,j

xi

[Thu80] T HURSTON W. P.: Geometry and Topology of ThreeManifolds. lecture notes at Princeton university, 1980.
[Thu85]

vi

vi

lk

T HURSTON W. P.: The finite riemann mapping theorem.

vj

hk o
xj
θj

[YKL∗ 08] YANG Y.-L., K IM J., L UO F., H U S.-M., G U X.:
Optimal surface parameterization using inverse curvature map.
IEEE Transactions on Visualization and Computer Graphics 14,
5 (2008), 1054–1066.
[ZJLG09] Z ENG W., J IN M., L UO F., G U X.: Canonical homotopy class representative using hyperbolic structure. In Proc. of
IEEE Interantaional Conference on Shape Modeling and Applications (SMI) (2009).
[ZLS07] Z AYER R., L ÉVY B., S EIDEL H.-P.: Linear angle based
parameterization. In Symposium on Geometry Processing (2007),
pp. 135–141.

Ri,k

hi

θk
li

vj

o hj

hk

Rj,i

vk

lj

di,k

lk

hj
xk

[Tut63] T UTTE W. T.: How to draw a graph. Proc. London Math
13 (1963), 743–768.

hi

θj

(a)

[xHS96] XU H E Z., S CHRAMM O.: On the convergence of circle
packings to the riemann map. Invent. Math 125 (1996), 285–305.

θi

lj

Rj,k

Rk,i
θk
Rk,j

li
(b)

Figure 15: Inversive distance circle packing.
To prove Lemma 3.7, we don’t
treat two types of circle packing
metric separately because the situations are the same. Suppose A is
the area of triangle face [vi , v j , vk ],
it is well known that the following
equation holds:
∂θi
l
= i .
∂li
2A

(16)

γi

γj

t

Ri,j

lk

Figure 14: Euclidean Triangle.

Appendix: Geometry Interpretation of the Hessian
Matrix of Discrete Euclidean Ricci Energy

Then we have:

We now prove Eq. 7 in Lemma 3.7. We use the same notations of inversive distance circle packing metric as in Section 3. For simplicity, we use lk instead of li j to denote the
length of mesh edge [vi , v j ].

By applying derivative cosine law to the above equation,

Lemma 6.1 Given a Euclidean triangle with Inversive distance circle packing metric, we have
γi

∂lk
=
∂γi

lk2 + γ2i − γ2j
2lk

(14)

Proof: Obviously, we have γ2i − R2i, j = γ2j − (lk − Ri, j )2 = t 2 .
Then it can be proved by simple computation.
Note that by applying Lemma 6.1, for Andreev-Thurston
circle packing, we have
γi

∂lk
= Ri, j .
∂γi

Then from Eq. 15 and Eq. 16, we have:
γi ∂γij

(13)

Lemma 6.2 Given a Euclidean triangle as in Fig. 14, then
lk2 + γ2i − γ2j
.
2lk

∂θ j
∂θ j ∂l j ∂lk
=(
)[
−
cos θi ].
∂γi
∂l j ∂γi ∂γi
∂θ

.

Proof: It can be easily proved by simply taking ∂γ∂ i to both
sides of Eq. 4 in Euclidean case. This is also true for
Andreev-Thurston circle packing.

Ri, j =

∂θ j ∂l j ∂θ j ∂lk
∂θ j
=
+
.
∂γi
∂l j ∂γi ∂lk ∂γi

=
=
=

∂θ

∂l

∂lk
( ∂l jj )[γi ∂γji − γi ∂γ
cos θi ]
i
lj
2A [Ri,k − Ri, j cos θi ]
lj
2A · di,k .

From Fig. 15(b), we can easily find that

di,k
hk

= sin θi . Thus,

∂θ j
∂θ j
l j sin θi
lj
h
=
·h = k .
=
· h · sin(θi ) =
∂ui
∂(ln γi ) 2A k
l j lk sin θi k
lk
The above proof is also true for

∂θi
∂u j .

It is easy to prove Eq. 8 in Lemma 3.7. For a mesh face
i
[vi , v j , vk ], we have θi + θ j + θk = π. Then we have ∂θ
∂ui +
∂θ j
∂ui

k
+ ∂θ
∂ui = 0. By applying the symmetry relation in Eq. 7,
Eq. 8 can be proved.

(15)

For Inversive distance circle packing as in Fig. 15(a), although the circles may not intersect with each other, we can

c 2009 The Author(s)
Journal compilation c 2009 The Eurographics Association and Blackwell Publishing Ltd.

vk

