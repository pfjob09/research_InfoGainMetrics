Eurographics Symposium on Rendering 2008
Steve Marschner and Michael Wimmer
(Guest Editors)

Volume 27 (2008), Number 4

Real-time Shading with Filtered Importance Sampling
Jaroslav Kˇrivánek

Mark Colbert

Czech Technical University in Prague

University of Central Florida

Abstract
We propose an analysis of numerical integration based on sampling theory, whereby the integration error caused
by aliasing is suppressed by pre-filtering. We derive a pre-filter for evaluating the illumination integral yielding
filtered importance sampling, a simple GPU-based rendering algorithm for image-based lighting. Furthermore, we
extend the algorithm with real-time visibility computation. Free from any pre-computation, the algorithm supports
fully dynamic scenes and, above all, is simple to implement.
Categories and Subject Descriptors (according to ACM CCS): I.3.7 [Computer Graphics]: Three-Dimensional
Graphics and Realism - Color, shading, shadowing, and texture

Homogeneous
Diffuse with
Glossy Reflection Visibility

1. Introduction
Error of numerical integration is usually analyzed in terms
of the integrand derivatives [QSS00]. Our main contribution
is a novel approach based on sampling theory, whereby we
view the error as a consequence of aliasing [Edw07]. We
adopt pre-filtering to suppress the alias and derive the prefilter shape for the illumination integral quadrature based on
BRDF-proportional importance sampling (see Fig. 1).

Our main target application, interactive material and
lighting design [CPK06], implies the required features our
algorithm—support for a wide variety of BRDFs with spatially changing parameters and image-based lighting with
shadows [FDA03]. BRDFs, lighting, and geometry can all
be changed in real-time since no pre-computation is involved
(the MIP-maps are generated on the fly during rendering).
Although similar algorithms have been proposed,
e.g. [KVHS00, GKD07], we believe that they do not share
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.
Published by Blackwell Publishing, 9600 Garsington Road, Oxford OX4 2DQ, UK and
350 Main Street, Malden, MA 02148, USA.

Spatially-varying
Glossy Reflection

Our analysis yields filtered importance sampling, a practical GPU-based algorithm for image-based lighting of glossy
objects, described in detail in [CK07a]. BRDF importance
sampling is implemented in a GPU fragment shader and prefiltering is performed with a MIP-mapped lookup in an environment map texture. We extend the algorithm with a simple
approximate approach to compute the visibility function for
each surface point by sampling the visibility proportionally
to the environment map luminance. We show that the combination of BRDF-proportional sampling for shading and environment map-proportional sampling for visibility yields a
good compromise of rendering speed and simplicity vs. image quality.

(a)

(b)

(c)

(d)

Figure 1: Using our technique, glossy as well as diffuse
reflections can be rendered in real-time without any precomputation. Here, the rusty robot (a) contains 7,722 triangles and renders at 75.8 FPS for a 1k × 1k image on an
NVIDIA 8800 GTX. The key idea is to suppress aliasing due
to deterministic sampling (b) by pre-filtering (c) as opposed
to randomization (d).

1148

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

the simplicity, efficiency, and flexibility afforded by our approach. The price to pay is a limited accuracy of the generated shadows, the requirement of an efficient sampling formula for the supported BRDFs, and occasional blurring of
highlights. However, in lighting or material design applications, the image quality delivered by our method is largely
sufficient for an artist to understand the appearance of the
scene [Col08].
2. Related Work
Aliasing and Numerical Integration. Edwards [Edw07]
analyzed aliasing in numerical integration in the context
of mechanical systems. Related work in computer graphics includes anti-aliasing by Gaussian quadrature [LJR96,
GT96], and the pre-filtering for texture maps, notably the
re-sampling framework by Heckbert [Hec89].
Real-Time Shading for Image-Based Lighting. Early
techniques based on pre-filtered environment maps cannot
change BRDFs and lighting in real-time because of the prefiltering step [KVHS00]. Frequency space approaches using spherical harmonics [RH01, KSS02, RH02, SKS02] or
other basis functions [NRH04, WTL04, LSSS04, TS06] partially lift this limitation but the BRDFs stay static. Global effects, such as shadows, can be included using pre-computed
radiance transfer (PRT) but support for dynamic geometry
remains difficult. Dynamic BRDF changes can be enabled
at the expense of increased pre-computation time and storage cost [BAOR06, SZC∗ 07]. However, our goal is to avoid
pre-computation completely. McAllister et al. [MLH02] render spatially-varying Lafortune BRDFs by pre-convolving
the environment map with cosine lobes of varying widths.
Hensley and Scheuermann [HS06] approximate glossy reflections with a lookup into a summed-area table of the environment map. In a closely related work [GKD07], Green
et al. approximate BRDFs by a sum of Gaussian kernels
(fitted in an off-line process), which reduces rendering to a
lookup in a pre-filtered environment map. In our algorithm,
the off-line fitting is replaced by real-time BRDF importance sampling. We directly build upon the work of Colbert
and Kˇrivánek [CK07a, CK07b] from which we borrow the
idea of BRDF importance sampling and environment map
filtering. We extend their work by providing a theoretical
analysis of the filtering that clearly identifies the approximations made, introducing support for real-time shadowing,
and demonstrating a more detailed validation.
Sampling for Image-based Lighting. Methods that sample
from environment lighting [ARBJ03,KK03,ODJ04,LRR05]
may have problems with specular BRDFs. To address this issue, Havran et al. [HSK∗ 05] increase the number of samples
around the specular lobe; others sample from the product
of the lighting and the BRDF [CJAMJ05, BGH05, TCE05,
CETC06, CAM08]. Drawing a sample with these methods is involved and only pays off if a costly visibility test

is done for each. For highly specular BRDFs, rendering
is more efficient using only the BRDF for sampling, either using analytic formulas [PH04] or with data-driven approaches [CPB03, LRR04]. We use BRDF importance sampling even for low-gloss BRDF and use environment map
filtering to suppress aliasing.
Shadowing for Image-based Lighting. Approaches based
on visibility pre-computation (e.g. PRT) use different ways
to store the visibility information, such as various spherical
basis functions [SKS02,NRH04,WTL04,LSSS04,ZHL∗ 05,
TS06, GKD07], discrete directions [MSW04], visibility
cuts [AUW07] or a coherent shadow map [RGKM07]. However, the pre-computation step disables their use for scenes
with deforming geometry. Techniques for real-time ambient
occlusion in dynamic scenes exist [Bun05, SA07], but there
is not directional information. As an alternative, Kautz et
al. [KLA04] compute self-shadowing by a fast hemispherical rasterization at each vertex. Ren et al. [RWS∗ 06] replace
dynamic occluders by a sphere hierarchy and accumulates
visibility in spherical harmonics. Annen et al. [ADM∗ 08]
replace an environment map by a number of area lights and
uses a fast soft-shadow algorithm to generate the shadows.
Compared to these approaches, we strive for simplicity, flexibility, and no pre-computation, though possibly at the cost
of reduced accuracy.

3. A Sampling Theory-based Analysis of Numerical
Integration
3.1. Uniform Sampling
Consider a function g : R → R+ . We want to numerically
integrate I = αβ g(u)du. Suppose we take N regularly spaced
samples and evaluate the integral as:
I≈

β−α N
∑ g(ui ).
N i=1

(1)

Since our goal is to express the integration in terms of filtering of g, we apply sampling theory treatment to the problem [OSB99]. Assuming g periodically repeats outside the
integration domain, we interpret (1) as follows:
1. Sample the continuous signal g(u) with the period T =
(β − α)/N to get the sampled signal gs (u). In the frequency domain, this creates shifted replicas of the spectrum of g with spacing inversely proportional to T .
2. Reconstruct the continuous signal by convolving gs with
the ideal reconstruction kernel: g(u)
ˆ = (gs ⊗sincT )(u). In
the frequency domain, this cuts off the spectrum replicas.
3. Retrieve the DC term (i.e. Fourier transform at ω = 0) of
the reconstructed signal. This is, indeed, an approximation of the estimated integral:
ˆ
G(ω)

=
ω=0

iωu
g(u)e
ˆ
du

=

g(u)du.
ˆ

ω=0

c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

Aliasing. If the spectrum replicas due to sampling overlap,
the original signal cannot be exactly reconstructed. This is
aliasing. Aliasing affects the integral estimate (1) if the spectrum replicas overlap in the DC term, i.e. at frequency ω = 0.
Pre-filtering. We adopt the customary means of suppressing aliasing by pre-filtering with a low-pass filter: g (u) =
g ⊗ h(u). Since we only need the DC term, any normalized pre-filter that cuts off frequencies above the sampling
rate ensures an alias-free integral estimate. Such a pre-filter
could also cut off frequencies below the sampling rate, blurring the signal, and, in the limit, pre-filtering could result in
a constant function (equal to I/(β − α)). However, we prefer
pre-filters that preserve frequencies below the sampling rate,
blurring the least amount possible, so that we can approximate the integral on any sub-domain.
Quadrature with filtered samples. We combine prefiltering with sampling by taking filtered samples:
SUS (ui ) =

g(u )h(ui − u )du .

Using filtered samples in (1) suppresses aliasing in the integral estimate. Filtered samples can be computed efficiently if
a pre-filtered version of g, such as a MIP-map of an environment map, is available. Our analysis generalizes to multiple
dimensions so we continue in 2D.

3.2. Importance Sampling

Although designed for Monte Carlo integration, importance sampling gives good results even for deterministic
sampling, where the same set of sample directions are evaluated for each pixel. Nevertheless, the integral estimate
may still suffer from aliasing. To apply our analysis (which
only holds for uniform sampling), we first warp the integrand [CPL85] according to the inversion method, x =
P−1 (u). Since the Jacobi determinant of P is equal to the
PDF, p, we have:
I=

g(x)dx =
importance
sampling

Estimating the first integral by importance sampling is
equivalent to estimating the second one by uniform sampling. Having uniform sampling, we convolve with a prefilter, yielding a filtered sample:
g(P−1 (u ))
h(ui − u )du .
p(P−1 (u ))

SIS (ui ) =

Warping back, we finally get pre-filtering in terms of the
original, unwarped function, g(x):
SIS (ui ) =

g(x )
h(ui − P(x ))p(x ) dx .
p(x )

g(P−1 (u))
du .
p(P−1 (u))
uniform sampling

c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

(2)

warped pre-filter
(spatially variant)

Quadrature based on importance sampling with filtered
samples (2) yields an alias-reduced integral estimate. Unlike
for uniform sampling, the pre-filter is now spatially variant,
with size inversely proportional to the PDF—smaller filter is
used in areas of high sample density.
4. Illumination Integral Evaluation
We now use the analysis from the previous section in evaluation of the illumination integral that gives the outgoing radiance in the direction of the camera, o (o), as a hemispherical
integral over all incoming lighting directions x of the incoming radiance, i (x), multiplied by the BRDF, fr (x, o), and the
cosine term, cos θx :
o (o) =

Importance sampling is an effective means for variance reduction in Monte Carlo integration. Samples are generated
proportionally to a probability density function (PDF), p, so
that many are taken where the integrand has large values.
The inversion method generates a sample, x, by transforming a uniformly distributed random variable, u, by the inverse of the cumulative distribution function (CDF), P(x) =
x
−1
−∞ p(t)dt, as follows: x = P (u). In 2D, the transformation is given by the inverse of the marginal and conditional
CDF [Fis96]. For brevity, we use the same notation as in 1D:
x = P−1 (u).

1149

i (x) f r (x, o) cos θx dx

.

We simplify the notation by dropping o, since it is fixed inside the integral, and by folding fr (x, o) cos θx into a single function f (x) to get: o = i (x) f (x)dx. We use BRDFproportional importance sampling combined with filtering of
i (x) to evaluate this integral. The following facts motivate
this choice. (1) The incoming radiance, i , represented by
an environment map, can be efficiently filtered using MIPmapping. (2) The BRDF, given by an analytical formula, can
be efficiently sampled, but not filtered.
4.1. Filtered Samples for the Illumination Integral
We use three interrelated spaces in the derivation of filtered
samples for an alias-reduced estimation of the illumination
integral:
Mx Unit sphere. Illumination integral is defined here.
Mu Unit square, [0, 1]2 . Related to the sphere, Mx , by the
inverse CDF: x = P−1 (u). Therefore, importance sampling in Mx corresponds to uniform sampling in Mu .
Ms Environment map representation, e.g. a cube map or a
dual paraboloid map, related to the sphere, Mx , through
s = R−1 (x). The the Jacobi determinant of R is denoted r.
First, we warp the illumination integral from Mx to Mu .
A filtered sample is then given by the convolution with the

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

1150

pre-filter, h, in the domain of Mu . Then, we warp the convolution from Mu to Ms to get the filtered sample in terms of
filtering the environment map with a spatially variant filter:
f (x )
[h(ui − P(x ))p(x )r(s )]ds
p(x )
f (P−1 (ui ))
≈
i (x ) [h(ui − P(x ))p(x )r(s )] ds ,
p(P−1 (ui ))

SII (ui ) =

i (x

)

spatially variant pre-filter

where x = R(s ). On the last line, we moved f /p out from
the integral, so that the filter only acts upon the environment
map, i . Effectively, we assume f /p is constant over the support of h. This is a fairly good approximation, since the support is small and the PDF, p, is proportional to the BRDF.
The above derivation can be extended to support shadowing by introducing the visibility function v(x) in the illumination integral. In the derivation of the filtered sample,
SII , the visibility would be taken out of the integral, assuming any occlusions are constant over the pre-filter support [GKD07].

component. Uniformly distributed numbers are computed on
the CPU and uploaded into the constant registers. BRDF importance sampling code that transforms these into directions
is implemented in a pixel shader, or partially pre-computed
on the CPU, if using homogeneous materials. For each direction, we perform a MIP-mapped texture lookup of the
environment map with the level, l, computed according to
Section 4.2:
l = max log4 K

w·h 1
1
,0
N p(xi ) r(si )

Here, w and h are the dimensions of the environment map; N
is the number of samples; and xi is the i-th sample direction.
Constant K is the extent of the un-warped pre-filter h,
derived empirically. For MIP-maps constructed with the
box filter, we found the best image quality is obtained with
K = 4. Finally, we attenuate the incoming radiance by the
visibility evaluated for the sample direction. Pseudo-code of
the shader in the Cg language is as follows:

4.2. Approximation of the Pre-filter
To make filtering efficient, we opt for a rather coarse approximation of the pre-filter—we replace the mapping R ◦ P
locally around the i-th sample by isotropic scaling, i.e.
P(R(s)) ≈ ui + (s − si ) [p(xi )r(si )] ,
where xi = R(si ). Recall that p and r are the Jacobi determinants of P and R, respectively. With this approximation,
shape of the pre-filter is not altered by the mapping; only
its size is scaled by 1/p(xi )r(si ). Such a filter can be implemented by a MIP-mapped lookup in the environment map. A
disadvantage of our choice is the loss of anisotropy in filtering, which may occasionally lead to blurring in the rendered
images (see Fig. 4).
We experimented with replacing the R ◦ P mapping by
its local affine approximation [Hec89] similarly to path differentials [SW01]. We use finite differences to estimate the
partial derivatives and HLSL’s tex2Dgrad() to perform
the lookup. Surprisingly, the image quality is almost always worse than with isotropic filtering, except for highly
anisotropic BRDFs. Moreover, there is nearly a tenfold drop
in performance due to the partial derivatives computation
and the anisotropic texture lookup.
5. Implementation
5.1. Filtered Importance Sampling
A detailed description of the implementation (bar the visibility, explained in the next subsection) is given in [CK07a].
However, we review it here for completeness. We use spherical harmonics for the diffuse component [RH01] of the material, and BRDF-proportional importance sampling with environment map filtering according to Section 4 for the glossy

Environment Representation. We use dual paraboloid
mapping [HS98] scaled by a factor of b = 1.2 so that the
texture for each hemisphere contains more information from
the opposite hemisphere, thus reducing artifacts due to independent MIP-map filtering for each hemisphere. The Jacobi
determinant of this mapping is r(z) = 4b2 (|z| + 1)2 , where
z is the z-component of the sample direction. We do not use
cube maps since independent filtering of each face results in
image artifacts (discontinuities).
5.2. Visibility Approximation
Representation. To support shadowing, we follow the observation of Kozlowski and Kautz [KK07] and Green et
al. [GKD07] that a precise visibility representation on glossy
surfaces is often unnecessary. Similar to Green et al., we
represent the visibility at a point with 4th order spherical
harmonics (SH) and assume constant visibility over the support of the pre-filter. The eval_visibility() function in
the FIS shader uses SH coefficients stored in a visibility
texture to compute the visibility factor for a particular direction. Representing the visibility multiplied by the cosine
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

0

10

20
30
40
Filtered Samples

50

(a)

10

60

0

20

40
60
80
100
120
Visibility Samples (shadow maps)

(b)

Figure 2: (a) The execution time for rendering a glossy
sphere at a resolution of 512 × 512 with (red) and without
(blue) visibility. (b) Time for generating the spherical harmonics coefficients for visibility and rendering a diffuse surface with different polygon counts. Both times vary close to
linearly with respect to the number of samples, where their
sum represents the total rendering time for a frame in a dynamic scene. The non-linearity in (a) at 45 shadowed filtered
samples results from a device-specific optimization shift on
the GPU due to the increased number of instructions.

Filtered BRDF IS

2

2

1.5

1.5

RMS

Time (ms)

Time (ms)

10

Environment IS

6k
12k
18k

20

RMS

30

FIS
Shadowed FIS

1

0.5

1

0.5

0
50 100
Env. Samples

150

200

10

1000
100
Spec. Exp.

0
50 100 150
Filtered Samples

200

10

1000
100
Spec. Exp.

(a)
Visualization

Error

Visualization

Error

0.3
Filtered IS

20

1151

0.2

Computation. Green et al. [GKD07] computes the visibility at each vertex in a pre-processing step with a ray tracer.
To allow dynamic scenes, we instead propose to compute
the visibility directly on the GPU. We perform importance
sampling of the environment map using a standard approach
based on marginal and conditional probabilities [PH04]. For
each direction chosen, we sample the visibility function by
(1) rendering the scene into an orthographic shadow map
in one pass and (2) updating the SH coefficients for each
texel in the visibility texture in another pass. We reconstruct
the SH coefficients from non-uniform samples by a leastsquares fit using the Moore-Penrose pseudoinverse on the
normal equations [Bis06].
Using environment map luminance as the importance for
sampling visibility may seem counterproductive and, indeed,
may not be optimal for sampling the visibility function itself.
However, doing so is beneficial since the visibility is captured for directions that produce the most pronounced shadows.
The angular discretization due to the visibility sampling is
hidden by the smoothness of spherical harmonics. Nonetheless, spatial discretization caused by the use of shadow maps
may lead to artifacts and requires further treatment. Although a rough approximation, filtering the SH coefficients
spatially in texture space alleviates the problem.
6. Results and Discussion
Performance. Our results were gathered on a PC running
Windows XP with an Intel 2.66GHz Dual Core2 CPU and
an NVIDIA GeForce 8800 GTX GPU. We obtain real-time
performance when rendering dynamic scenes with arbitrary
BRDFs given by an analytic formula (we have tested Phong,
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

0

Reference

term reduces the illumination integral on diffuse materials to
a scalar product and, additionally, reduces ringing artifacts.

Env. IS

0.1

Phong n = 17, 100 samples

Phong n = 3, 5 samples

(b)

(c)

Figure 3: Comparison of our filtered BRDF importance
sampling (IS) to environment IS. (a) shows the RMS error
when rendering a sphere lit by the Grace light probe. While
both methods converge at a rate of N −1/2 , filtered BRDF
IS has a lower RMS overall, especially on more glossy materials. Visually, the BRDF IS better captures many of the
subtle features of the environment (b). Although the RMS figures suggest better performance for BRDF IS, even for lowfrequency glossy reflections with few samples, environment
IS provides more visually pleasing images is such cases (c).

Lafortune [LFTG97], Ward [War92], and the Halfway vector disk [EBJ∗ 06] models). The proposed filtering affords
using only a small number of samples (40-50 in practice) for
visually and numerically acceptable results, making the implementation amenable to the GPU. As seen in Figure 2, the
run-time performance is directly proportional to the number
of samples for evaluating both filtered importance samples
and visibility samples (shadow maps).
Error. When comparing against the common technique of
environment map proportional sampling, where the environment is represented by a set of directional lights, we obtain
numerically and visually superior results for a wide variety
of glossy BRDFs with the small additional cost of a tri-linear
filtered texture lookup per sample (see Fig. 3). However,
when using only a few samples with low-frequency BRDFs,

50 Samples

200 Samples

Reference

Visualization (a) Reference

50 Samples

5 Samples

(b) 16 samples

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

1152

0.1

(a) Phong, n=50
Error

RMS

0.6
0.4
0.2
0

0

SH
Reference
(c)

50

100
Filtered Samples

150

200

(b)
Figure 4: On complex geometry, undersampling appears as
blurring and dulling of the highlights. However, visually acceptable results are found around 50 samples per pixel (a).
The blurring on complex geometry affects the RMS (b) such
that more samples are required to obtain an error similar to
the spheres in Figure 3. However, the high-frequency contours on the geometry mask the error seen on smooth surfaces.

environment map importance sampling provides more pleasing images. Surprisingly enough, the RMS error for filtered
importance sampling is still consistently lower.
The actual rendering error depends upon the complexity
of the geometry. For instance, smoother meshes, such as the
sphere in Figure 3, require fewer samples than more complex
ones, Figure 4, to reach the same RMS error. However, the
visual appearance of artifacts on the complex mesh is less
noticeable due to the high frequency contours of the surface
masking the errors.
Visibility. When evaluating the visibility, we use a rather
rough approximation, often only 16 samples (shadow maps),
but obtain fairly convincing results as demonstrated in Figure 5. A comparison with a reference spherical harmonicbased visibility function computed per pixel using 10,000
samples reveals that after 16 visibility samples, most of the
error originates from the low-pass filter used to remove the
spatial aliasing from the undersampled shadow maps.

8 Visibility
Samples
(d)

16 Visibility
Samples
(e)

64 Visibility
Samples
(f)

Figure 5: Comparison between a Monte Carlo estimate (a)
computed with 30,000 shadow rays versus our solution (b)
rendered with 16 shadow maps. To reveal the consequences
of sparse visibility sampling, we compare our results to a
reference SH fit computed per pixel using 10,000 stratified
samples (c). This provides the best possible solution attainable by a SH-based visibility representation. The error incurred when using sparse sampling (d-f) is mostly gone by
16 samples with the error at 64 samples occurring mostly
from the low-pass filter used to remove the shadow maps’
spatial aliasing.

Dynamic scenes. The combination of our filtered importance sampling and visibility approximation provides a
method for rendering spatially-varying materials in dynamic
scenes (Figure 1a). Moreover, since we use deterministic
sampling, the rendering does not suffer from any temporal
flickering, noise, or aliasing. In our accompanying video,
we demonstrate the ability to change the material properties in real time and view animated scenes without precomputation.

7. Conclusion and Future Work
We have shown that analyzing numerical quadrature using
sampling theory provides a new way of thinking about the
problem and can be useful in designing efficient rendering
algorithms. Applying our analysis to the evaluation of the
illumination integral results in a simple and efficient GPUbased algorithm for real-time rendering of glossy objects under image-based illumination.
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

(a) αx= 0.14, αy= 0.01

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

αx= 0.01
αy= 0.01
(b)

αx= 0.01
αy= 0.08
(c)

1153

[AUW07] A KERLUND O., U NGER M., WANG R.: Precomputed
visibility cuts for interactive relighting with dynamic BRDFs. In
Proc. of Pacific Graphics (2007).
[BAOR06] B EN -A RTZI A., OVERBECK R., R AMAMOORTHI R.:
Real-time BRDF editing in complex lighting. ACM Trans.
Graph. 25, 3 (2006).
[BGH05] B URKE D., G HOSH A., H EIDRICH W.: Bidirectional
importance sampling for direct illumination. In Proc. of Eurographics Symposium on Rendering (2005), pp. 147–156.
[Bis06] B ISHOP C. M.: Pattern Recognition and Machine Learning. Springer, 2006.
[Bun05] B UNNELL M.: Dynamic ambient occlusion and indirect
lighting. In GPU Gems 2 (2005), Addison-Wesley Professional.

αx= 0.01
αy= 0.29
(d)
Figure 6: The Ward anisotropic BRDF rendered using filtered importance sampling. The method works well on complex surfaces (a) as well as high frequency materials (b) with
slightly anisotropic reflections (c). However, the isotropic
filter approximation breaks down when rendering more
anisotropic materials (d).

[CAM08] C LARBERG P., A KENINE -M ÖLLER T.: Practical product importance sampling for direct illumination. Comp. Graph.
Forum (Proc. of Eurographics – to appear) 27, 2 (2008).
[CETC06] C LINE D., E GBERT P. K., TALBOT J. F., C ARDON
D. L.: Two stage importance sampling for direct lighting. In
Proc. of Eurographics Symposium on Rendering (2006).
[CJAMJ05] C LARBERG P., JAROSZ W., A KENINE -M ÖLLER T.,
J ENSEN H. W.: Wavelet importance sampling: efficiently evaluating products of complex functions. ACM Trans. Graph. 24, 3
(2005), 1166–1175.
ˇ
J.: GPU-based importance
[CK07a] C OLBERT M., K RIVÁNEK
sampling. In GPU Gems 3 (2007), Addison-Wesley Professional.

Our current implementation can handle only moderately
anisotropic BRDFs (Figure 6). Lifting this limitation is left
for future work. Additionally, we would like to find a heuristic to automatically choose the number of samples based
on the properties of the BRDF, environment, and geometry. Most importantly, further investigations should relate our
theoretical analysis to the work of Ramamoorthi and Hanrahan [RH04] and Durand et al. [DHS∗ 05]. We believe that our
theory could eventually link the frequency-space and Monte
Carlo approaches to image synthesis.
Acknowledgements
This work has been supported by the Ministry of Education, Youth and Sports of the Czech Republic under the research program LC-06008 (Center for Computer Graphics),
the Aktion Kontakt grant no. 48p11 and by the US National
Science Foundation grants SES0527675 and DRL0638977.
Many thanks to Dan Sýkora for the discussions and Petr
Olšák for checking the math.
References
[ADM∗ 08] A NNEN T., D ONG Z., M ERTENS T., B EKAERT P.,
S EIDEL H.-P., K AUTZ J.: Real-time, all-frequency shadows in
dynamic scenes. ACM Trans. Graph. 27, 3 (2008).
[ARBJ03] AGARWAL S., R AMAMOORTHI R., B ELONGIE S.,
J ENSEN H. W.: Structured importance sampling of environment
maps. ACM Trans. Graph. 22, 3 (2003), 605–612.
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

ˇ
J.: Real-time shading with
[CK07b] C OLBERT M., K RIVÁNEK
filtered importance sampling. In SIGGRAPH Sketches (2007).

[Col08] C OLBERT M.: Appearance-Driven Material Design.
PhD thesis, University of Central Florida, 2008.
[CPB03] C LAUSTRES L., PAULIN M., B OUCHER Y.: BRDF
measurement modelling using wavelets for efficient path tracing.
Comp. Graph. Forum 22, 4 (2003), 701–716.
ˇ
J.: BRDF[CPK06] C OLBERT M., PATTANAIK S., K RIVÁNEK
Shop: Creating physically correct bidirectional reflectance distribution functions. IEEE Comp. Graph. Appl. 26, 1 (2006).

[CPL85] C LARK J. J., PALEMER M. R., L AWRENCE P. D.: A
tranformtation method for the reconstruction of functions from
nouniformly spaced samples. IEEE Trans. on Accoustic, Speech,
and Signal Processing ASSP-33, 4 (1985).
[DHS∗ 05] D URAND F., H OLZSCHUCH N., S OLER C., C HAN
E., S ILLION F. X.: A frequency analysis of light transport. ACM
Trans. Graph. 24, 3 (2005).
[EBJ∗ 06] E DWARDS D., B OULOS S., J OHNSON J., S HIRLEY P.,
A SHIKHMIN M., S TARK M., W YMAN C.: The halfway vector
disk for BRDF modeling. ACM Trans. Graph. 25, 1 (2006).
[Edw07] E DWARDS T. S.: Effects of aliasing on numerical integration. Mechanical Systems and Signal Processing 21, 1 (January 2007), 165–176.
[FDA03] F LEMING R. W., D ROR R. O., A DELSON E. H.: Realworld illumination and the perception of surface reflectance properties. Journal of Vision 3 (July 2003), 347–368.
[Fis96] F ISHMAN G. S.: Monte Carlo: Concepts, Algorithms,
and Applications. Springer-Verlag, 1996.

1154

J. Kˇrivánek & M. Colbert / Filtered Importance Sampling

[GKD07] G REEN P., K AUTZ J., D URAND F.: Efficient reflectance and visibility approximations for environment map rendering. Comp. Graph. Forum 26, 2 (2007), 495–502.

[NRH04] N G R., R AMAMOORTHI R., H ANRAHAN P.: Triple
product wavelet integrals for all-frequency relighting. ACM
Trans. Graph. 23, 3 (2004), 477–487.

[GT96] G UENTER B., T UMBLIN J.: Quadrature prefiltering for
high quality antialiasing. ACM Trans. Graph. 15, 4 (1996).

[ODJ04] O STROMOUKHOV V., D ONOHUE C., J ODOIN P.-M.:
Fast hierarchical importance sampling with blue noise properties.
ACM Trans. Graph. 23, 3 (2004), 488–495.

[Hec89] H ECKBERT P. S.: Fundamentals of Texture Mapping and
Image Warping. Master’s thesis, University of California, Berkeley, 1989.
[HS98] H EIDRICH W., S EIDEL H.-P.: View-independent environment maps. In Proc. of Graphics Hardware (1998).
[HS06] H ENSLEY J., S CHEUERMANN T.: Dynamic glossy environment reflections using summed area table. In ShaderX4
(2006), Charles River Media.
[HSK∗ 05]

H AVRAN V., S MYK M., K RAWCZYK G.,
M YSZKOWSKI K., S EIDEL H.-P.:
Interactive system for
dynamic scene lighting using captured video environment maps.
In Proc. of Eurographics Symposium on Rendering (2005).

[KK03] KOLLIG T., K ELLER A.: Efficient illumination by high
dynamic range images. In Proc. of Eurographics Symposium on
Rendering (2003), pp. 45–51.
[KK07] KOZLOWSKI O., K AUTZ J.: Is accurate occlusion of
glossy reflections necessary? In Proc. of Symposium on Applied
Perception in Graphics and Visualization (2007).
[KLA04] K AUTZ J., L EHTINEN J., A ILA T.: Hemispherical rasterization for selfshadowing of dynamic objects. In Proc. of Eurographics Symposium on Rendering (2004).
[KSS02] K AUTZ J., S LOAN P.-P., S NYDER J.: Fast, arbitrary
BRDF shading for low-frequency lighting using spherical harmonics. In Proc. of Eurographics Workshop on Rendering
(2002), pp. 301–308.

[OSB99] O PPENHEIM A. V., S CHAFER R. W., B UCK J. R.:
Discrete-Time Signal Processing, 2nd ed. Prentice Hall, 1999.
[PH04] P HARR M., H UMPHREYS G.: Physically Based Rendering: from Theory to Implementation. Morgan Kaufmann, 2004.
[QSS00] Q UARTERONI A., S ACCO R., S ALERI F.: Numerical
Mathematics. Springer-Verlag, New York, NY, 2000.
[RGKM07] R ITSCHEL T., G ROSCH T., K AUTZ J., M ÜLLER S.:
Interactive illumination with coherent shadow maps. In Proc. of
Eurographics Symposium on Rendering (2007).
[RH01] R AMAMOORTHI R., H ANRAHAN P.: An efficient representation for irradiance environment maps. In Proc. of SIGGRAPH (2001).
[RH02] R AMAMOORTHI R., H ANRAHAN P.: Frequency space
environment map rendering. ACM Trans. Graph. 21, 3 (2002).
A signal[RH04] R AMAMOORTHI R., H ANRAHAN P.:
processing framework for reflection. ACM Trans. Graph. 23, 4
(2004), 1004–1042.
[RWS∗ 06] R EN Z., WANG R., S NYDER J., Z HOU K., L IU X.,
S UN B., S LOAN P.-P., BAO H., P ENG Q., G UO B.: Real-time
soft shadows in dynamic scenes using spherical harmonic exponentiation. ACM Trans. Graph. 25, 3 (2006), 977–986.
[SA07] S HANMUGAM P., A RIKAN O.: Hardware accelerated
ambient occlusion techniques on GPUs. In Proc. of the Symposium on Interactive 3D graphics and games (2007).

[KVHS00] K AUTZ J., VÁZQUEZ P.-P., H EIDRICH W., S EIDEL
H.-P.: A unified approach to prefiltered environment maps. In
Proc. of Eurographics Workshop on Rendering (2000).

[SKS02] S LOAN P.-P., K AUTZ J., S NYDER J.: Precomputed
radiance transfer for real-time rendering in dynamic, lowfrequency lighting environments. ACM Trans. Graph. 21, 3
(2002), 527–536.

[LFTG97] L AFORTUNE E. P. F., F OO S.-C., T ORRANCE K. E.,
G REENBERG D. P.: Non-linear approximation of reflectance
functions. In Proc. of SIGGRAPH (1997), pp. 117–126.

[SW01] S UYKENS F., W ILLEMS Y. D.: Path differentials and
applications. In Proc. of Eurographics Workshop on Rendering
(2001).

[LJR96] L IU N., J IN H., ROCKWOOD A. P.: Antialiasing by
gaussian integration. IEEE Comp. Graph. Appl. 16, 3 (1996).

[SZC∗ 07] S UN X., Z HOU K., C HEN Y., L IN S., S HI J., G UO B.:
Interactive relighting with dynamic BRDFs. ACM Trans. Graph.
26, 3 (2007).

[LRR04] L AWRENCE J., RUSINKIEWICZ S., R AMAMOORTHI
R.: Efficient BRDF importance sampling using a factored representation. ACM Trans. Graph. 23, 3 (2004), 496–505.
[LRR05] L AWRENCE J., RUSINKIEWICZ S., R AMAMOORTHI
R.: Adaptive numerical cumulative distribution functions for efficient importance sampling. In Proc. of Eurographics Symposium
on Rendering (2005), pp. 11–20.
[LSSS04] L IU X., S LOAN P.-P., S HUM H.-Y., S NYDER J.: Allfrequency precomputed radiance transfer for glossy objects. In
Proc. of Eurographics Symposium on Rendering (2004).
[MLH02] M C A LLISTER D. K., L ASTRA A., H EIDRICH W.: Efficient rendering of spatial bi-directional reflectance distribution
functions. In Proc. of Graphics Hardware (2002).
[MSW04] M EI C., S HI J., W U F.: Rendering with spherical radiance transport maps. Comp. Graph. Forum 23, 3 (2004).

[TCE05] TALBOT J. F., C LINE D., E GBERT P.: Importance resampling for global illumination. In Proc. of Eurographics Symposium on Rendering (2005), pp. 139–146.
[TS06] T SAI Y.-T., S HIH Z.-C.: All-frequency precomputed radiance transfer using spherical radial basis functions and clustered tensor approximation. ACM Trans. Graph. 25, 3 (2006).
[War92] WARD G. J.: Measuring and modeling anisotropic reflection. In Proc. of SIGGRAPH (1992), ACM Press.
[WTL04] WANG R., T RAN J., L UEBKE D.: All-frequency relighting of non-diffuse objects using separable BRDF approximation. In Proc. of Eurographics Symposium on Rendering
(2004).
[ZHL∗ 05] Z HOU K., H U Y., L IN S., G UO B., S HUM H.-Y.: Precomputed shadow fields for dynamic scenes. ACM Trans. Graph.
24, 3 (2005).

c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

