DOI: 10.1111/j.1467-8659.2011.02067.x

COMPUTER GRAPHICS

forum

Volume 30 (2011), number 8 pp. 2341–2353

An Optimal Control Approach for Texture Metamorphosis
Ilknur Kabul1 , Stephen M. Pizer1 , Julian Rosenman1,2 , and Marc Niethammer1
1 Department

of Computer Science, UNC Chapel Hill, NC, USA
{ilknurk, pizer, mn}@cs.unc.edu
2 Department of Radiation Oncology, UNC Chapel Hill, NC, USA
rosenmju@med.unc.edu

Abstract
In this paper, we introduce a new texture metamorphosis approach for interpolating texture samples from a source
texture into a target texture. We use a new energy optimization scheme derived from optimal control principles
which exploits the structure of the metamorphosis optimality conditions. Our approach considers the change in
pixel position and pixel appearance in a single framework. In contrast to previous techniques that compute a
global warping based on feature masks of textures, our approach allows to transform one texture into another by
considering both intensity values and structural features of textures simultaneously. We demonstrate the usefulness
of our approach for different textures, such as stochastic, semi-structural and regular textures, with different levels
of complexities. Our method produces visually appealing transformation sequences with no user interaction.
Keywords: texture interpolation, metamorphosis, texture synthesis, image morphing, registration, optimal control
ACM CCS: I.3.7 [Computer Graphics]: Three-Dimensional Graphics and Realism—Colour, Shading, shadowing
and texture; I.3.6 [Computer Graphics]: Methodology and Techniques

1. Introduction
Although image registration only deals with the alignment
of a source to a target image, image metamorphosis also
considers changes in image appearance allowing to compute
transitions from a source to a target image. Consequentially,
image metamorphosis has been of increasing importance in
computer graphics as well as in medical imaging. It has been
used to morph between faces, to mix multiple images and to
accommodate for appearance changes in image registration
in general.
To obtain an image metamorphosis requires the computation of point correspondences over time (a time-dependent
warp field) as well as an optimal change of pixel intensity to
allow for an exact match to the target image. This joint optimization problem has, for example, been studied in [TY05,
Hol09] and is a natural extension of fluid flow registration methods which estimate time-dependent velocity fields

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics
Association and Blackwell Publishing Ltd. Published by
Blackwell Publishing, 9600 Garsington Road, Oxford OX4
2DQ, UK and 350 Main Street, Malden, MA 02148, USA.

to smoothly transform one image into another [BMTY05].
Figure 1 illustrates the difference between registration and
metamorphosis. In contrast to key-framing, for cartoon-like
images the image metamorphosis approach does not take
into account kinematics, but computes the space deformation using image information (and possible feature channels)
only.
Texture metamorphosis is a special case of image metamorphosis which is used to design new textures by interpolating between the input textures or to visualize the change
of material on the objects by creating a smooth transition between two textures. Structure features and appearance of the
interpolated textures should perceptually be between input
texture pairs. Creating a meaningful and smooth transformation is a difficult problem. Transformation of the intensity
values as well as the feature masks, such as edges and ridges,
should have an effect in the computation of the warping to
split or merge structural features.

2341

2342

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

phosis approach for structural textures. Section 7 presents
results.

2. Background

Figure 1: Comparison between registration and metamorphosism.

In this paper, we present a new texture metamorphosis
approach considering structural and appearance transitions
of textures in a single framework. Our method uses an optimal control framework (as proposed in [HZN09] for the
image registration problem) and proposes a new numerical
solution method which solves the metamorphosis problem as
an initial value problem (and can therefore exploit a numerical solution strategy from a widely used fluid registration
approach [BMTY05]). It is based on the large-displacementdiffeomorphic metric mapping (LDDMM) formulation of
fluid registration [BMTY05, HZN09].
Our approach results in an intuitive solution method for
texture metamorphosis and has a number of advantages compared to other approaches for texture metamorphosis.
1. It is designed to interpolate textures while considering
appearance and features in a single framework. This removes the need for an additional blending or synthesis
scheme.
2. It can easily accommodate different image information,
such as colour or structural feature masks.
3. It can easily accommodate different measures of image/feature similarity, such as simple sum of squared
differences, correlations or mutual information.
4. It is designed to be symmetric with respect to the two
textures.
5. It is robust and automatic. It neither requires user input
for feature correspondences nor the selection of transition
functions.
6. It interpolates structural textures as well as stochastic and
natural textures.
The remainder of the paper is organized as
follows: Section 2 discusses related work on texture metamorphosis. Section 3 presents the overview of our method.
Section 4 illustrates our optimal control based texture metamorphosis approach. How to add colour information is explained in Section 5. Section 6 details our texture metamor-

Several approaches have been proposed to find the transformation from one image to another. Bar et al. [BJEYLW01]
proposed a semi-morphing approach in which 50/50 blends
of textures are created by performing texture analysis using
wavelets. The first approach for morphing structural textures
was presented in [LLSY02] using a pattern-based approach
in which the user specifies landmarks and their correspondences for two textures. The landmarks are used to create
a warp field and cross-dissolving accommodates texture appearance changes. This approach assumes that texture images
are composed of similar texture patterns. In addition, it requires a large amount of user interaction. Later, in [WLi03],
an algorithm for synthesizing texture mixtures from different input textures is presented. In this method, weight images
are used to control how each source texture affects the result
texture.
Zhang et al. [ZZV*03] synthesized progressively variant
textures by using a texton mask as the feature image for
input textures. In their method, first a mixed feature mask
is generated by blending and binary-thresholding. Then this
mixed feature mask is used to synthesize the mixed output
texture. The main disadvantage of this approach is that it does
not guarantee a smooth transformation from one image to another. In addition, an arbitrary number of images between two
input images cannot be generated. Liu et al. [LLH04] propose
a system to design novel textures by analysing and manipulating textures. Their method allows the user to manipulate
texture features which can be used for alignment in morphing. User-defined feature maps are also used in [MZD05] to
produce warps between textures. They also propose a histogram matching technique to avoid blurring of features.
Their approach is only applicable to textures that are similar
to each other. A level set advection method for morphing
between texture features was proposed in [RLW*09]. This
method first finds the warped texture features between two
texture feature images. Then, a constrained texture synthesis
approach is applied to generate texture with a given feature
mask. Recently, a new patch-based approach was proposed
in [RSK10]. In this approach, initially individual neighbourhoods of the input textures are locally warped and blended
and then they are used to create new textures by an optimization algorithm. The disadvantage of this approach is that
it cannot handle materials with large differences in feature
scales. In addition, since the warping is done using only feature information, it cannot handle textures that do not have
clear, meaningful features.
The metamorphosis formulation that our approach builds
on has been studied, for example, in [TY05, Hol09] and
numerical solution methods have been proposed in [MY01]

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2343

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

and [GY05]. This line of work has mostly been concerned
with morphing grey-valued or colour images and has so far
not dealt with the problem of texture morphing.

sible. This requires determining the time and spatially
dependent q such that the exact match is achieved under
the image flow constraint.

The use of optimal control formulations for image timeseries has been proposed in [BIK02, CL10, NHZ09]. In contrast to metamorphosis, these approaches address image deformations only, but not appearance changes. Furthermore,
in contrast to our metamorphosis formulation and [NHZ09,
HZN09], [BIK02, CL10] solve the associated transport equation for the image directly, which requires advanced numerical methods to avoid image blurring.

Solving the optimization problem in Equation (1) is challenging. We make use of an adjoint solution method as proposed
in [HZN09] for image registration. Details of the solution
method and its relation to the corresponding image-to-image
registration approach are given in Section 4.

3. Overview
Given two texture images I 0 and I 1 , we want to create interpolated images I(t). Here, t corresponds to time t ∈ [0, 1]
under the constraint that I(1) = I 1 and I(0) = I 0 , which enforces that the initial and the final texture images are matched
exactly under metamorphosis.
Since there are infinitely many possible ways to morph image I 0 into I 1 , the solution space needs to be constrained in a
meaningful way. In metamorphosis, this is accomplished by
formulating an optimization problem which seeks to determine a time-dependent velocity field v and a time-dependent
source term q which are appropriately regularized.
In an optimal control setting, the metamorphosis optimization problem is equivalent to minimizing the following energy E under a dynamic constraint for the image change.
1

E(v, q) =

v
0

2
L

+ q

2
Q dt

(1)

subject to It + (DI )v = q, I (0) = I0 , I (1) = I1 .
Here, the control variables v (the time and space-dependent
velocity field) controls the image deformation (flow of image
over time), q controls the change in appearance over time and
D denotes the Jacobian. L and Q denote norms to penalize v
and q. The deformation map can be computed from v.
The following constraints are imposed onto the optimization problem:
1. Image flow: This constraint is simply a transport equation with a source term q and controls the flow of the
image from I 0 to I(t). Intuitively, it can be considered as
a constraint which imposes that image intensity along a
streamline of the velocity field v changes over time only
through q. For q = 0, intensities will be constant along
such a streamline (characteristic).
2. Initial and final constraints: To allow for texture morphing between two texture exemplars, the initial and the
final condition for I are fixed. This is the main difference
to standard image registration where an inexact match of
the warped source image to the target image is admis-

4. Texture Metamorphosis
Image registration involves finding a transformation which
maps one image to another image as well as possible. In contrast to image metamorphosis, image registration is only concerned with determining this mapping and does not consider
appearance changes. Therefore, perfect image matching is in
most cases not achievable in image registration because of
image noise, structural differences or appearance differences
in the images.
In fluid flow registration, the deformation is achieved
by flowing the image I 0 with respect to a time-dependent
velocity field v. The fluid flow registration problem is highly
complex, because the full spatio-temporal velocity field
needs to be estimated. To make this problem computable,
non-smoothness of the velocity field is penalized, to obtain
spatially coherent registration solutions [BMTY05, HZN09].
In fact, by choosing an appropriate norm to penalize nonsmoothness diffeomorphic image transformations can be
assured.
The energy to be minimized in LDDMM [BMTY05,
HZN09] fluid flow registration is
E(v) =
subject to

v

2
L dt

+

1
I (1) − I1
σ2

2

(2)

It + (DI )v = 0, I (0) = I0 ,

where v 2L = Lv, Lv and L is a differential operator to encourage smoothness of the velocity field, typically chosen of
the form L = −α∇ 2 + γ . Here, α encourages smoothness of
the vector field. For instance, for large α strong deformations
are discouraged and the interpolations looks like blending; γ
controls how much the overall travel distance of a particle is
counted in the energy. Intuitively, a large γ will favour small
overall displacements over an accurate image match. σ is a
scalar which controls the trade-off between image match and
transformation smoothness. Note that the only difference to
the metamorphosis problem in Equation (1) is that the final
constraint I(1) = I 1 has been replaced by an inexact matching
term I(1) − I 1 2 . See [HZN09] for details on how to solve
such an optimization problem.
To allow for exact matching, the metamorphosis formulation (1) adds a control variable q to the transport equation
which controls the image intensity change and is penalized

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2344

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

according to q
where q 2Q = Qq, Qq and Q is a
chosen differential operator. (Note that for an easy numerical
solution the operator is chosen as Q = id, the identity.) In
Equation (1), the weighting parameters of the source term q
and the velocity term v are set to the same value. Changing
the weights of these terms would produce different results.
For example, increasing the weight for the source term and
decreasing the weight for the velocity term would shift the
balance towards stronger deformation and less aggressive
blending.
2
Q,

To solve this constrained optimization problem, we convert
it to its unconstrained form by adding the dynamic constraint
through a time and space-dependent Lagrangian multiplier
λ. We add the final state condition through the Lagrangian
multiplier τ and obtain the unconstrained energy
1

E(v, q, λ, I , τ ) =

v
0

2
L

+ q

2
Q

+ λ, It + (DI )v − q dt + τ, I (1) − I1
with respect to v(x, t), q(x, t), I and the Lagrangian multipliers
λ(x, t), τ (x).
For a candidate minimizer of the unconstrained energy, its
variation with respect to v, q, I, λ and τ need to vanish (Details
of how the differential equations are solved is presented in
the Appendix). Computing the first variation and rearranging
terms yields
δE(v, q, λ, I ; dv, dq, dλ, dI )
1

=

2L† Lv + λ(DI )T , dv

3. Final Conditions: Sets the final image and provides a final
condition for the adjoint.
λ(1) = 2q(1),

I (1) = I1 .

(3)

4. Adjoint Equation (Scalar Conservation Law): Governs
the dynamics of the adjoint (Lagrangian multiplier λ).
Since the final condition λ(1) is given by (3), this equation can be solved backward in time. Note that the
adjoint corresponds to the concept of moments in physics
[MTY06] and the scalar conservation law for the adjoint
consequentially resembles the physical law of conservation of momentum.
−λt − div(λv) = 0.
5. Compatibility Condition:
2L† Lv + λ(DI )T = 0,

2q − λ = 0.

The first equation is used to compute the gradient of E with respect to v on the interval t = [0,
1
1]. From δE(v, q, λ, I ; dv, dq, dλ, dI ) = 0 2L† Lv +
T
L2
λ(DI ) , dv dt, the gradient ∇v E(v) = 2L† Lv +
(DI )T λ with respect to the L2 norm or ∇vV E(v) =
2v + (L† L)−1 ((DI )T λ) in the V-norm (induced by the
operator L) is obtained.
The second equation illustrates that q is directly related to the adjoint λ (subject to a potential smoothing operator Q). To simplify the problem, we assume that the appearance control is penalized by an L2 norm which makes
Q = id and the second compatibility condition becomes
2q − λ = 0.

0

+ 2Q† Qq − λ, dq + It + (DI )v − q, dλ
+ −λt − div(λv), dI dt + λ, dI |10 + dτ, I (1) − I1
+ τ, dI (1) .
Since δE needs to vanish for any dv, dq, dI, dλ and dτ ,
fulfilling the boundary conditions (i.e. zero boundary conditions for v, I(0) = I 0 , I(1) = I 1 ) at optimality the following
conditions need to hold:
1. Initial Condition: Sets the starting point for the images at
time t = 0.
I (0) = I0 .
2. State Equation (Transport Equation): Flows the image
forward to time t = 1 using the velocity field v. The
source term in the transport equation simply changes
image appearance and thus makes the appearance and
disappearance of structures in an image possible.
It + (DI )v = q.

The optimality conditions reveal an interesting structure: the only difference to the image-to-image registration
[HZN09] case are the source term q in the transport equation
(the forward model), the additional compatibility condition
on q as well as the final condition on I.

4.1. Adjoint solution method
An analytic solution can in general not be obtained from the
optimality conditions for metamorphosis. Numerical solution
methods have been proposed in [MY01] and [GY05]. In both
cases, the metamorphosis problem is cast as a boundary value
problem, subject to the fixed source and target images and the
solution proceeds by alternating gradient solution schemes
for the image values (implicitly accounting for the image
source terms, q, in the transport equation) and for the velocity
field.
Here, by exploiting the relation between λ and q, we
sidestep an iterative update of the image I and only perform
gradient descent with respect to the velocity field v. This approach results in an initial value problem which allows using
a similar map-based solution as in [BMTY05], reveals the

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2345

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

simple structure of the underlying optimality conditions and
allows to easily integrate alternative image-matching terms
(as they only affect the estimates for the velocity field through
the final condition for the adjoint; see [HCF02] for computations of these final conditions). Although the use of maps
is not strictly necessary for the solution of the optimization
problem [HZN09], it is beneficial to avoid smoothing due to
numerical dissipation effects.
Figure 2: Optimal control solution framework for computing I(t).

Algorithm 1: Texture metamorphosis
Require: I 0 , I 1 , L
Ensure: v
Assume an initial flow field v is given
repeat
Flow image forward using
Ito + (DI o )v = 0, I (0) = I0
Find q(1) according to Eq. (9)
Find adjoint λ(1) from q(1) using q = λ2
Flow adjoint λ(t) backward using Eq. (6)
Compute q(t) from the solution of the adjoint using q = λ2
Compute the image I(t) according to Eq. (7)
Compute the gradient for v from the compatibility conditions
Perform a gradient descent step using ∇ v E
until Convergence

Figure 3: Optimal control solution framework for computing ∇ v E.

transformed image I 0 ◦ (t) as
Specifically, given an estimate of the velocity field v, we
compute the deformation maps t and rt from t = 0 to t =
1 using
t

−

r
t

+ (D )v = 0,
− (D

r

(0) = id,

)v = 0,

r

(1) = id

(4)
(5)

where id denotes the identity map, D denotes the Jacobian and
r
t maps to t = 1. This allows to replace the direct solution
for λ and I by solutions of transport equations on the maps
and r . The advantage of the map-based approach is that
the maps are expected to be smooth (since the velocity fields
are regularized according to L) and are therefore easier to
propagate numerically.
To compute λ at each time step according to the adjoint
equation, λ(1) is transported backwards in time using r (t).
To conserve the values over time, the transformation is multiplied by |D r (t)|, which corresponds to the amount of deformation the map has undergone.
λ(t) = |D

r

(t)|λ(1) ◦

r

(t).

(6)

Using these maps to compute the solutions, I(t) is slightly
more complicated than in the standard image registration
problem [BMTY05, HZN09] due to the source term q, which
needs to be integrated along the characteristics (streamlines)
of the velocity field to affect the overall intensity value. This
can be expressed by adding the change of intensity to the

I (t) = I0 ◦

t

(t) +

q(τ ) ◦

0

where

t,τ

=

(t) ◦

−1

t,τ dτ,

(7)

(τ )

which simply sums up all the q contributions over time in the
current reference coordinate system at time t.
Our proposed solution strategy builds on the observation
that given a velocity field v we can compute the final condition λ(1) related to the source term q which results in I(1) =
I 1 exactly. This is possible since we know from the optimality
conditions that q = λ2 . Specifically, we observe that
q(1) =

I1 − I o (1)
1
1
dt
0 |D 1,t |

(8)

pointwise (The details of this equation are explained in the
Appendix.). Given q(1) we can compute λ(1) and in turn q(t).
Here, I o (1) denotes the solution to the sourceless transport
equation Ito + (DI o )v = 0; I (0) = I0 using the given velocity field v.
The so-called adjoint solution method proceeds according
to the Algorithm 1 which is illustrated in Figures 2 and 3.
In effect, given an estimate of v one (i) computes the solution
to the sourceless transport equation, (ii) uses it to compute
the final condition for q, (iii) which then allows the computation of λ(t), q(t) and I(t) and (iv) from which the gradient
∇ v(t) E can be computed. After taking a gradient descent step

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2346

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

energy function is
1

E(v, q) =

v
0

2
V

+ (1 − t) qF

2
Q

+ t qB

2
Q dt

(9)

subject to IF ,t + (DIF )v = qF ,
IB,t + (DIB )v = qB ,

IF (0) = IB (0) = I0 ,

IF (1) = IB (1) = I1 ,
where I F (t) denotes the transformed image in the forward
direction from I 0 to I 1 at time step t, and I B (t) refers to the
transformed image in the backward direction from I 1 to I 0 at
time step t.
Figure 4: The texture sequences along with the deformation
fields obtained in different steps of iteration.

The resulting optimality conditions are similar to the ones
obtained previously (now for two sets of equations) except
for the compatibility condition which becomes
2L† Lv + (1 − t)λF (DIF )T + tλB (DIB )T = 0. (10)
Note that this simply amounts to solving the problem twice
(in opposite directions) while keeping only one velocity field
that needs to be estimated. The gradient for the velocity field
is then a linear combination of the gradients for the image
solutions in the different directions and the image itself is
recovered as
I (t) = (1 − t)IF (t) + tIB (t).

Figure 5: Metamorphosis from one texture to another using
image intensities. Top row shows linear interpolation and
bottom row shows our results.

In what follows we assume that all equations are solved
numerically in this way without explicitly writing down the
resulting forward/backward equations.
5. Metamorphosis for Colour Textures

with respect to the velocity field, these steps are repeated to
convergence. Figure 4 shows the intermediate results along
with the deformation fields in each step.
Figure 5 illustrates our metamorphosis results. Even though there is no control in the structural features of the textures, our approach can split and merge the patterns by only
using the q term.

In texture metamorphosis, the traditional approach is to warp
single intensity values which come either from the texture
image or its feature mask. In our method, multiple channels
can be easily integrated into the energy equation by adding
q terms for each channel. The energy equation becomes
n

1

E(v, q) =

v
0

4.2. Combining forward and backward transition in
metamorphosis
According to the constraint I(1) = I 1 , the morphed image
I(1) should always match the target image I 1 . However, due
to numerical inaccuracies, the constraint may not be satisfied
exactly. To avoid this problem, we apply the solution method
in the forward direction and the backward direction, which
allows us to make the problem symmetric and to obtain exact
matching by construction. Specifically, we use two appearance control terms qF and qB and weight them linearly. Here,
qF controls the change in appearance from I 0 to I 1 and qB
controls the change in appearance from I 1 to I 0 . The modified

2
L

+

qi

2
Q dt

(11)

i=1

s.t. Iti + (DI i )v = q i , I i (0) = I0i , I i (1) = I1i , (12)
where n is the number of channels that should be considered
in the optimization framework. In our examples, we used
the red, green and blue colour channels. For each channel
independently, the same optimality conditions for metamorphosis are obtained (i.e. initial and final condition, transport
equation and conservation law). The compatibility condition
for v that is used to compute the gradient changes becomes
n

2L† Lv +

λi (DI i )T = 0.

(13)

i=1

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

6. Metamorphosis for Structured Textures

Algorithm 2: Feature-based texture metamorphosis

Some of the textures have strong structural components, such
as edges, ridges, etc. These features should be considered
in metamorphosis to obtain visually pleasing results since
the structural components may undergo topological changes
such as splitting and merging. In this optimization framework, our aim is to simultaneously morph one image into
another with respect to appearance (intensities) while aligning their feature masks (without appearance change). This
can be accomplished by adding the feature mask as an inexact matching term (as in image registration) subject to a
transport equation without source term. The energy equation
to be minimized becomes
1

E(v) =

v
0

2
L

+ q

2
Q dt

+

1
F (1) − F1
σ2

2347

2

(14)

s.t. It + (DI )v = q, I (0) = I0 , I (1) = I1 ,
Ft + (F I )v = 0, F (0) = F0 .

Require: I 0 , I 1 , F 0 , F 1 , L
Ensure: v
Assume an initial flow field v is given
repeat
Flow image forward using
Ito + (DI o )v = 0, I o (0) = I0
Flow feature image forward using
F t + (FI)v = 0, F(0) = F 0
Find q(1) according to Eq. (8)
Find adjoint λ(1) from q(1) using q = λ2
Flow adjoint λ(t) backward using Eq. (6)
Flow adjoint ω(t) backward using
−ωt − div(ωv) = 0, ω(1) = σ22 (F (1) − F1 )
Compute q(t) from the solution of the adjoint
Compute the image I(t) according to Eq. (7)
Compute the gradient for v from the compatibility conditions
Perform a gradient descent step using the gradients ∇ v E
until Convergence

This can be combined with multiple colour channels for
metamorphosis as desired. Note that the feature image does
not have a final state constraint.
Adding the inexact matching term results in optimality
conditions for F and its adjoint ω which are the same as for
image registration [HZN09]. The compatibility condition for
v changes, respectively, to include the influence of the feature
image (i.e. the feature image influence is added). All other
optimality conditions remain the same as in Section 4.
Ft + (DF )v = 0,

F (0) = F0 ,

†

−ωt − div(ωv) = 0,

2L Lv + λ(DI ) + ω(DF )T = 0,
T

ω(1) =

2
(F (1) − F1 ).
σ2

(15)

See Algorithm 2 for a description of the solution steps.
In Figure 6, the comparison of our approach with a texture
synthesis based interpolation approach is shown. As can be
seen in this figure, the intensity changes in the interpolated
images are not smooth in the results obtained using the approach of [RLW*09]. The bright regions inside the pattern
are getting bigger first and then they are getting smaller to
match with the target image. On the other hand, in our results,
the bright regions move inside the patterns to generate the
regions in the target image.

Figure 6: First and second rows show the results obtained
using the approach in [RLW*09]. Third and fourth rows
illustrate our results.

7. Results

to define structures and the correspondences between them.
Especially, the interpolation between pink flowers to white
flowers created new flowers that have features present in both
input images. The interpolated textures in this figure can be
easily used in texture synthesis to generate textures on the
surface of 3D models to visualize the change of materials
over regions.

Our technique is suited for regular, semi-regular and stochastic textures, since we perform the deformation and appearance change in a single framework. In Figure 7, we illustrate the results our approach generated using only image
intensity information. As can be seen, our approach created
textures which are sharp and detailed, even when it is hard

In Figure 8, we show the effect of using feature channels
in metamorphosis. We obtained smooth and seamless transitions by propagating structural features and appearance by
constraining the change in the feature along with intensity.
Our results show that the addition of feature channels in
metamorphosis provides more control over deformation.

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2348

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

Figure 7: When meaningful features cannot be defined in the textures, such as natural textures, our metamorphosis can morph
between textures by only considering appearance information. For each texture pair, first column shows the results with linear
interpolation and second column illustrates the results with our approach.

Figure 8: Including feature channel in metamorphosis changes the deformation. (a) Linear interpolation, (b) metamorphosis
without using structural features and (c) metamorphosis using structural features.

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

2349

Figure 9: Comparison of interpolation results from
[RLW*09] with our results. (Left-hand panel) Linear blending, (middle panel) our approach and (right-hand panel)
results from [RLW*09].

there are no meaningful structural patterns in the input textures, we only used image information in the energy equation. Our approach created smooth transformations from the
leopard texture to the dice texture by forming the dots on
the dice from the spots on the leopard texture. In Figure 9,
we used the structural feature information along with the
image information to create interpolated textures. Since the
method presented in [RLW*09] interpolates texton masks
using an advection algorithm and then synthesizes interpolated textures constrained by these masks, the transition of
the intensity values is not smooth and perceptually pleasing. In addition, the interpolated textures may contain new
structures which are not available in either of the input textures. On the other hand, our approach deforms the structural
features in the texture along with their intensity values. In
Figure 11, we compared our results with those presented in
[RLW*09] and [RSK10]. In this comparison, the textures in
the middle of the sequence are different. Our approach seems
to represent a nice compromise between blending of colour
while at the same time achieving a good transition in terms
of texture structure.

In Figures 9 and 10, we show the comparison of our results with those presented [RLW*09]. In Figure 10, since

In Figure 12, we compare our results with the image registration method proposed in [HZN09]. We apply registration
from I 0 to I 1 and I 1 to I 0 , and combine the results obtained

Figure 10: Comparison of interpolation results from [RLW*09] with our results. Top row shows the results obtained using
linear interpolation, middle row illustrates the results from [RLW*09] and the bottom row shows the results obtained using our
approach.
c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2350

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

Figure 11: Comparison of results from with our results. (a) Linear blending, (b) results from [RSK10], (c) results from [RLW*09]
and (d) our approach.
from them using linear interpolation. As it is shown in the
figures, the results obtained using registration and interpolation look more blurry. For the dots example in the first row,
since the colour channels are treated independently in registration and there are no objects of corresponding colours
in the source and target images, the algorithm shrinks the
dots.
In Figure 13, we illustrate the effect of changing α
in the differential operator L. Here, it can be seen that
for large α strong deformations are discouraged, and the

transformation becomes like blending. In Figure 14, some
cases in which our approach fails are presented. For the
textures that have many overlapping structural features,
our approach sometimes fails to create valid intermediate
textures.
The implementation of the proposed approach is done in
Matlab and the source code is not optimized. The run time
is usually in 5–10 minutes for 64 × 64 texture images. A
GPU implementation of our approach would run within a
few seconds.

Figure 12: For each initial and target texture, top row shows the results obtained using registration and linear interpolation,
and bottom rows show the results obtained using our metamorphosis approach.
c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2351

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

Acknowledgements
This material is based upon work supported by the National
Science Foundation (NSF) under Grant No. EECS-0925875
and by the National Institutes of Health (NIH) under Grant
Nos. (2 P41 EB002025-26A1, 1 R01 MH091645-01A1).
Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and
do not necessarily reflect the views of NSF or NIH.
Figure 13: Top row illustrates results obtained by setting α
is 0.01, and bottom row illustrates results obtained by setting
α is 0.001.

Appendix
Optimality Conditions
For a minimizer of energy, its variation with respect to v, λ,
I and γ need to vanish. Computing
δE(v, q, λ, I ; dv, dq, dλ, dI )
=

∂
E(v + dv, I + dI , λ + dλ) |
∂

=0

yields
δE(v, q, λ, I ; dv, dq, dλ, dI )
1

=

2L† Lv, dv + 2q, dq

0

+ dλ, It + (DI )v − q
+ λ, (dI )t + (DdI )v
+ (DI )dv − dq dt + dτ, I (1) − I1
+ τ, dI (1) .
Figure 14: Failure cases. (a) Initial texture; (b) interpolated
texture; (c) target texture.

Since
1

1

λ, dIt dt =
0

−λt , dI dt + λ, dI |10 ,
0

and (by Green’s theorem) λ, (DdI)v is equal to

8. Conclusion and Future Work
In this paper, we have presented a novel optimal control
based texture metamorphosis approach, which warps one
texture into another by considering the appearance and
feature information in a single framework. In contrast to
other techniques that are based on warping in texture features and texture synthesis (or blending) in creating interpolated textures, our approach can create consistent and visually
pleasing interpolated images, even when it is not possible to
define the features in the texture. In future work, we will
integrate alternative features and landmarks into the energy
equation to better control the transformation of the textures.
Moreover, we only investigated the interpolation between
two input textures. It would be interesting to design a new
optimization framework with additional penalty terms and
constraints to perform the interpolation between a number of
input textures. In addition, metamorphosis between 3D solid
textures would be interesting future work.

−div(λv), dI +

∂

dI λv · dS = −div(λv), dI ,

we get
δE(v, q, λ, I ; dv, dq, dλ, dI )
1

=

2L† Lv + λ(DI )T , dv

0

+ 2Q† Qq − λ, dq + It + (DI )v − q, dλ
+ −λt − div(λv), dI dt + λ, dI |10
+ dτ, I (1) − I1 + τ, dI (1) ,
assuming zero boundary conditions for v and a known
I(0) = I 0 . Since δE needs to vanish for any dv, dI, dλ, fulfilling the boundary conditions of the problem, the optimality
conditions are obtained.

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

2352

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

Source Term
To be able to compute the values for q without implicitly
obtaining them through a gradient descent on I, we can make
use of the fact that for the L2 norm penalizer, q is directly
related to the adjoint λ and therefore also has to fulfil a scalar
conservation law. Note that for a transport equation without
a source term, values stay constant along the characteristics
(streamlines) of the transport equation. With a source term the
source values get integrated along the characteristic. Hence,
along a characteristic
t

I (t) = I (0) +

q(t)dt
0

needs to hold. In particular, for our exact matching problem,
we need to have
1

I1 − I0 =

q(t)dt.
0

However, representing everything in the coordinate frame of
image I 1 , we know that
q(t) =

1
|D

1,t |

q(1),

since it needs to fulfil a scalar conservation law. Assuming we
discretize time into n intervals spanning [0, 1] and assuming
q is piecewise constant over the time intervals
n−1

i=0

1
|D

1,t |

q(1) t = I1 − I o (1),

which can be solved for
q(1) =

I1 − I o (1)
n−1

i=0

1
|D

1,t |

.
t

In the limit as t → 0 the sum becomes an integral and we
get the desired expression (which holds pointwise)
q(1) =

I1 − I o (1)
.
1
1
dt
0 |D 1,t |

expressed in the coordinate system of image I 1 .
References
[BIK02] BORZ`I A., ITO K., KUNISCH K.: Optimal control formulation for determining optical flow. SIAM
Journal on Scientific Computing 24 (March 2002),
818–847.
[BJEYLW01] BAR-JOSEPH Z., EL-YANIV R., LISCHINSKI D.,
WERMAN M.: Texture mixing and texture movie synthesis using statistical learning. IEEE Transactions
on Visualization and Computer Graphics 7 (2001),
120–135.

[BMTY05] BEG M., MILLER M., TROUVE´ A., YOUNES
L.: Computing large deformation metric mappings via
geodesic flows of diffeomorphisms. International Journal of Computer Vision 61, 2 (2005), 139–157.
[CL10] CHEN K., LORENZ D. A.: Image sequence interpolation using optimal control. CoRR abs/1008.0548, (2010).
[GY05] GARCIN L., YOUNES L.: Geodesic image matching:
A wavelet based energy minimization scheme. In Lecture
Notes in Computer Science (2005), vol. 3757, p. 349.
[HCF02] HERMOSILLO G., CHEFD’HOTEL C., FAUGERAS O.:
Variational methods for multimodal image matching. International Journal of Computer Vision 50, 3 (2002),
329–343.
[Hol09] HOLM D.: Euler’s fluid equations: Optimal control vs optimization. Physics Letters A 373, 47 (2009),
4354–4359.
[HZN09] HART G. L., ZACH C., NIETHAMMER M.: An optimal control approach for deformable registration. In Proceedings of the Workshop on Mathematical Methods in
Biomedical Image Analysis (MMBIA) (Miami, FL, USA,
2009).
[LLH04] LIU Y., LIN W.-C., HAYS J.: Near-regular texture
analysis and manipulation. ACM Transactions on Graphics 23, 3 (2004), 368–376.
[LLSY02] LIU Z., LIU C., SHUM H.-Y., YU Y.: Pattern-based
texture metamorphosis. In PG ’02: Proceedings of the
10th Pacific Conference on Computer Graphics and Applications (Washington, DC, USA, 2002), IEEE Computer
Society, p. 184.
[MTY06] MILLER M. I., TROUVE A., YOUNES L.: Geodesic
shooting for computational anatomy. Journal of
Mathematical Imaging and Vision 24 (2006), 209–
228.
[MY01] MILLER M. I., YOUNES L.: Group actions, homeomorphisms, and matching: A general framework. International Journal of Computer Vision 41, 1/2 (2001), 61–84.
[MZD05] MATUSIK W., ZWICKER M., DURAND F.: Texture design using a simplicial complex of morphable textures.
ACM Transactions on Graphics 24, 3 (2005), 787–794.
[NHZ09] NIETHAMMER M., HART G. L., ZACH C.: An optimal
control approach for the registration of image time-series.
In Proceedings of the Conference on Decision and Control
(Shanghai, China, 2009), pp. 2427–2434.
[RLW*09] RAY N., L´EVY B., WANG H., TURK G., RUNO
VALLET B.: Material-space texturing. Computer Graphics
Forum 28, 6 (2009), 1659–1669.

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

I. Kabul et al. / An Optimal Control Approach for Texture Metamorphosis

2353

[RSK10] RUITERS R., SCHNABEL R., KLEIN R.: Patch-based
texture interpolation. Computer Graphics Forum 29, 4
(June 2010), 1421–1429.

[WLi03] WEI LI: 2003: Texture synthesis from multiple
sources. In Proceedings of the SIGGRAPH 2003 Sketches
and Applications (San Diego, CA, USA, 2003).

[TY05] TROUVE A., YOUNES L.: Metamorphoses through lie
group action. Foundations of Computational Mathematics
5, 2 (2005), 173–198.

[ZZV*03] ZHANG J., ZHOU K., VELHO L., GUO B., SHUM H.Y.: Synthesis of progressively-variant textures on arbitrary
surfaces. ACM Transactions on Graphics 22, 3 (2003),
295–302.

c 2011 UNC Chapel Hill
Computer Graphics Forum c 2011 The Eurographics Association and Blackwell Publishing Ltd.

