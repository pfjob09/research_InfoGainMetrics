Sketch Retrieval Based on Spatial Relations

Shuang Liang, Zhengxing Sun, Bin Li
State Key Lab for Novel Software Technology, Nanjing University, 210093, P R China
Department of Computer Science and Technology, Nanjing University, 210093, P R China
szx@nju.edu.cn

Abstract

sketch data in a database and retrieve them later with a
sketch query.

In this paper, we propose an effective approach for

Sketch

retrieval

falls

into

the

category

of

sketch retrieval. Given sketches are firstly decomposed

content-based visual information retrieval (CBVIR), and

into basic geometric primitives and represented as a

there is some related research about sketch retrieval.

topological graph that encodes both the intrinsic

Some systems assume that the query consists of a single

attributes of the primitives and their relationships. The

shape, such as QBIC system [1], where global features

graph spectrum descriptor is then adopted to translate

are used in shape matching, and Sciascio’s system [2]

the graph-match into the computation of vector distances.

where the Fourier descriptors are used for shape

Sketches retrieval is finally done by means of similarity

comparison. Others like Lopresti et al. [3] and Kato et al.

calculation of feature vectors based on dimensionality

[4] view sketch as a certain kind of image, and use

reduction. The relevance feedback is also introduced to

approaches in CBIR to achieve sketch retrieval. But since

refine the retrieval results. Experiments prove the

they do not consider sketch’s own information, their

effectiveness and efficiency of the proposed method in

methods seem not suitable. Recently, Leung [5] proposed

sketch content retrieval and user independent.

to create multiform representations of a sketch under user
variations, and he used relevance feedback to improve the
retrieval performance. But his approach pays too much

1. Introduction

attention on stroke information and neglected other
spatial features. Fonseca et al. [6] used stroke hierarchy

As a natural form of pen-based computing and

and shape geometry to retrieve complex drawings. But

human-computer interaction, freehand sketching has

only stroke hierarchies may not always be the most

recently attracted a lot of attention. It is an effective way

efficient method for comparison.

to enhance collaboration and communication efficiency.

In this paper, we propose an effective approach for

The release of Pen-based devices and products such as

sketch retrieval to improve the retrieval performance in

Tablet PC offer people a convenient sketch-input manner,

terms of archiving desired materials from the database

and there will be more and more sketches with useful

with minimum number of trials. Our experimental results

information created. Redrawing existing sketch wastes

show the effectiveness and efficiency of this method.

time and energy. So it is very necessary to collect the

1
Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

Figure 1. Framework of our sketch retrieval system based on spatial relations

2. Framework of the proposed approach

3. Feature Extraction

The framework of our sketch retrieval system is

There may be a great diversity of the original sketch

shown in figure 1, which mainly contains three modules:

data under user variations, which must be preprocessed

feature extraction, matching and relevance feedback.

first. We perform stroke segmentation based on both

In the feature extraction module, we first preprocess
[7]

the

strokes

to

create

a

relevant

users’ pen speed and curvature [7] to cut the users’ input

consistent

strokes into primitive shapes as lines, arcs and ellipses.

representation of sketches. Then we consider eight kinds

Since a sketch can only be segmented into a group of

of spatial relations between strokes and extract these

primitive shapes in a fixed way, stroke segmentation can

features of sketches. We also introduce a graph spectrum

create a relevant consistent representation of sketches and

to describe the extracted features.

low down the retrieval complexity to a large extent.

In the matching module, we first get the feature vector

In order to choose the representational features of

of each sketch after dimensionality reduction. Then we

sketches, we should take the characteristics of sketch

consider the Euclidean distance between the feature

retrieval into consideration, and pay attention to the

vectors of the input query sketch and sketches in the

following factors. First, features should reflect the

database, according to which we can calculate the

graphics structure of the sketch and describe the sketch

similarity and perform matching of two sketches. We

correctly. Second, features should accommodate scale,

regard the sketches with the highest similarities in the

translation and rotation invariance to find the similar

database as the candidate result set, and return them to

sketches. Finally, features should be easy for the users to

users.

express and not influenced greatly by the users’ drawing

In the relevance feedback module, user-judgement

styles. According to these factors, we choose eight kinds

was performed on the candidate result set first. If the

of spatial relations to be the sketch features, as shown in

retrieval succeeds, the process of retrieval is over.

figure 2. Though users have different drawing styles, the

Otherwise, the user marks the relevant sketch in the

spatial relations of sketch are relevantly explicit.

candidate result set and the system will adjust the feature
vector of the query sketch to make a new match. The
more times of relevance feedback, the closer the
candidate results move to the users’ intentions.
These three main modules will be discussed in detail
in the following sections.

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

Figure 2. Features of spatial relations

For representing the features we extracted, a set of

4. Matching

topology graphs are used. Let Gi=(V,Ei) be a topology
graph representing the i-th spatial relation, where V is the
set of graph vertices and Ei ⊆ V × V is the set of graph

For different sketches with different number of
primitive shapes, the dimensionality of their spectrum

edges. Every vertex represents a primitive shape of the
sketch. Edge ( j , k ) ∈ Ei if and only the i-th spatial

descriptors will be different, which gives rise to the

relation exists between the two vertices j and k. Take the

dimensionality reduction to reduce the multidimensional

spatial relation of adjacency for example, as we can see

spectrum descriptor to the Euclidean distance between

in figure 3, the original sketch can be segmented into

the vector point and the origin in the coordinates, as we

three primitive shapes (“a”, “b” and “c”), and primitive

can see in figure 5. If two vector points of spectrum

shape “a” is adjacent to both “b” and “c”. So the

descriptor are close in the n-dimensional Euclidean space,

corresponding topology graph for adjacency is shown in

their distance values from the origin are close too.

difficulty of comparison. We introduce the idea of

figure 3 as follows. Note that “b” and “c” are not adjacent
(actually they are half-cross), so there is no edge between
primitive shapes “b” and “c” in the topology graph for
adjacency.

Figure 5. Dimensionality reduction
Figure 3. Topology graph of adjacency relation

For spectrum descriptor of each kind of spatial
relation, dimensionality reduction is performed, so we

In order to avoid computing the isomorphism between

will totally get eight distance values for a sketch. We

topology graphs, we introduce graph spectrum [8] to
describe the topology graph of the sketch features. Graph

organized these eight values together as an
eight-dimensional vector D = [ d 1 , d 2 , d 3 , " , d 8 ] , and

spectrum is the set of graph eigenvalues, and we can

this forms the feature vector in our approach. It represents

calculate the spectrum of a graph from the eigenvalues of

the features we extracted of the sketch, and also describes

its adjacency matrix. Using graph spectrum, topology

the sketch effectively.

graphs can be mapped into multidimensional vectors,

As we have pointed out, a distance function should be

which we called spectrum descriptor in this paper. These

used to compare the feature vectors of sketches. We

descriptors can capture the graph structure validly and

employ Euclidean distance in our method, in which the

effectively [9]. Figure 4 presents the block diagram for

distance between two vectors A and B is computed over

computing the spectrum descriptor.

dimensions between them. Given feature vectors of the
query sketch and the sketch in the database are
D = [ d 1 , d 2 , d 3 , " d 8 ] and D ' = [ d 1 ' , d 2 ' , d 3 ' , " d 8 ' ] respectively,
their Euclidean distance will be

Figure 4. Spectrum descriptor calculation

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

Dis =

¦ [ FeatureVec (i)'− FeatureVec (i)]
i =1

=

adjustment approach is to construct a new vector point

2

8

that is “closer” to relevant sketches. Figure 6 shows how

.

8

¦ (d '− d )
i

this approach works for our hypothetical two-dimensional
feature space based on Euclidean distance. After

2

i

i =1

adjustment, the query point moves to an area that is

The smaller the value of Euclidean distance Dis, the

closer to relevant results.

more similar the two corresponding sketches look like;
and vice versa. We introduce a threshold to normalize the
similarity, and the similarity between sketches can then
be calculated derived from the Euclidean distances as
follows:

­0
°
Dis
Similarity= ®
1−
°¯ threshold

if Dis ≥ threshold
if Dis < threshold

Figure 6. Feature vector adjustment

This normalization is simple and effective, which

The best-known approach to achieve feature vector

makes Similarity fall into the range of [0,1]. We regard

adjustment is based on a formula initially developed by

the sketches with the highest similarities in database as

Rocchio [11]. Let Srel= {Oj| Oj is a relevant sketch object}

the candidate result set, and return the sketches to users

be the set of relevant sketches of the user feedback. The

with similarities descending.

new feature vector point is an incremental change over

Compared to traditional graph-based matching of
sketches, our approach successfully transforms the
problem of matching topology graphs to similarity
calculation between feature vectors, which reduce the

the original feature vector point as follows, which is
moved towards the relevant points:

FeatureVecnew = α * FeatureVecold
+

computing complexity to a large extent. Supposing m
sketch objects have been collected in database, the time
complexity and the spatial complexity to calculate

β
Srel

*

¦ FeatureVec
j

O j ∈Srel

The speed at which the old vector point moves

similarities of all the sketches in database are both O(m).

towards relevant feature points is determined by the
parameters α , and β , where α + β = 1 . In our system,

5. Relevance Feedback

we let α = 0.2 and β = 0.8 . The purpose of retaining part
of the original vector point is to avoid “overshooting”.

We introduce relevance feedback to capture the users’

The main advantages of this approach are its

understanding of the sketch structures. Users look

simplicity and effectiveness to generate good results. It is

through the candidate sketches and provide judgements

simple and intuitive to understand. Meanwhile it closely

as the quality or relevance of the candidates, which

mimics what a human user would do to improve the

together with the original results information contribute

retrieval result, that is, to restate the query sketch with a

to the incremental refinement the retrieval results. We

different feature vector.

employ the strategy of feature vector adjustment in our

After feature vector adjustment, we can do similarity

relevance feedback, which is similar to principles of

calculation again with new feature vector of the query.

relevance feedback in CBIR [10].

First we recalculate the Euclidean distance between the

We regard a sketch as a feature point or vector point in

adjusted query and the sketches in the database. Then we

the feature space, the objective of the feature vector

normalize the Euclidean distance Dis to Similarity as

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

mentioned above in section 4. Thus we can obtain new

experiment, in order to evaluate user variations, we

candidates which get closer to the user intention. After

combine the 10 sketch database of different people to be

iterations of feedback, the retrieval results are refined

a multi-user sketch database. The results are averaged

incrementally.

over all queries. We perform relevance feedback to refine
the retrieval results for both single-user and multi-user

6. Experiments and Evaluation

retrieval experiments.
Figure 8 and 9 are PR graphs of single-user and

We design our experiments as follows: In order to

multi-user experiment. It can be seen that as the number

for

of iteration of feedback increases, retrieval performance

communication and collaboration, we carry out the

is also increased. After several times of iterations, the

experiments with both single-use sketch database and

retrieval system refines the result step by step, and finally

multi-user sketch database. We also perform relevance

the system finds out the user’s wanted sketch. But the

feedback for experiments of both single-user and

multi-user retrieval precision is not improved as much as

multi-user database.

the single-user experiment and requires more times of

evaluate

how

the

retrieval

system

works

For the data collection, we captured the sketches

refinement. This is because the bigger the set of relevant

drawn by users. We chose a database of 55 classes of

objects gets, the smaller the influence the feedback

sketches, as shown in figure 7. The sketches were

algorithm has on the retrieval precision.

collected by 10 people in our group. Every person drew 2
repetitions of each of the 55 classes of sketches. So there
are a total of 1100 sketches in the database.

Figure 8. Single-user sketch retrieval
Figure 7. All 55 classes of sketches

To evaluate the retrieval performance, the recall and
precision graph (or RP graph) [12] is plotted based on the
ranks of those sketches from the same class as the query
sketch. In a recall and precision graph, the higher the
curve, the better the retrieval performance, since for the
same recall value, a higher curve signifies a higher
precision value.
Our experiment environment is Pentium 4 1.6G
CPU, 256MB memory, Windows XP, Visual C++ 6.0.
For single-user experiment, people input the sketch query
and retrieves in the database of their own. For multi-user

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

Figure 9. Multi-user sketch retrieval

The time cost used in the retrieval process is also a

[2]

E.D. Sciascio, and M. Mongiello, “Query by Sketch and

much-concerned factor for evaluating our approach’s

Relevance Feedback for Content-Based Image Retrieval

performance. Especially, in our real-time interactive

over the Web”, Journal of Visual Languages and

sketch retrieval environment, the time cost should be as

Computing, 10(6), 1999, pp565-584.

small as possible. In our experiments, the response time

[3]

D. Lopresti, A. Tomkins, and J. Zhou, “Algorithms for

is 2.4 milliseconds for single-user database, and 8.7

matching hand-drawn sketches”, Proc. of the Fifth Intl.

milliseconds for multi-user sketch database. Generally,

Workshop on Frontiers in Handwriting Recognition,

the time cost is much smaller than a one-tenth second.
The performance is sufficiently fast for real-time

September 1996, pp233-238.
[4]

interaction.

T. Kato, T. Kurita, N. Otsu, and K. Hirata, “A Sketch
Retrieval Method for Full Color Image Database”, Proc.
of the 11th Intl. Conf. On Pattern Recognition, The

7. Conclusion

Neitherlands, August 1992, pp530-533.
[5]

In this paper, we propose an effective approach for

Matching and Relevance Feedback for Sketch Retrieval”,

sketch retrieval to improve the retrieval performance.
Given a sketch, we extract the sketch’s features after

Howard Leung, “Representations, Feature Extraction,

Ph.D dissertation, CMU, June 2003.
[6]

M.J. Fonseca and J.A. Jorge, “Towards Content-Based

preprocess to get the feature vector. Then we perform the

Retrieval

similarity matching of the sketches and return the

Dimensional Indexing”, Proc. of the 1st Ibero-American

sketches with the highest similarities to users. We also

Symposium in Computer Graphics, Portugal, July 2002,

use relevance feedback to refine the retrieval result.

pp263-270.

Experiments show the effectiveness and efficiency of the

[7]

of

Technical

Drawings

through

High

J.F. Yin and Z.X. Sun, “Temporal-based Multi-Strokes

retrieval and relevance feedback algorithm of our

Sketchy Graphics Recognition”, Journal of Computer

approach. Our retrieval method is invariant to arbitrary

Science (In Chinese), 2004, pp538-545.

drawing orders, and to rotation and scale variations. The

[8]

D. Cvertkoviü, P. Rowlinson and S. Simiü, Eigenspaces of

feedback algorithm refines the retrieval results to capture

Graphs, Cambridge University Press, Cambridge, United

the users’ intentions.

Kingdom, 1997.

Of course, no methods can be perfect; there is

[9]

Shokoufandeh, S. Dickson, K. Siddiqi, and S. Zucker,

something in our method that needs to be improved. In

“Indexing Using a Spectral Encoding of Topological

our relevance feedback algorithm, we may consider more

Structure”, Proc. of the IEEE Conference on Computer

kinds of information of relevance, such as local and

Vision and Pattern Recognition, June 1999, pp491–497.

syntax information, to capture the users’ intentions more

[10] P. Aigrain and H. Zhang, “Content-Based Representation

precisely. This guides the direction of our future work, in

and Retrieval of Visual Media: A State of the Art

which we should consider using additional information to

Review”, Multimedia Tools and Applications, 1996(3),

improve the precision of the retrieval process.

pp179-202.
[11] J.J. Rocchio, “Relevance Feedback in Information

References

Retrieval”. The SMART Retrieval System, Experiments in
Automatic

[1]

C. Faloutsos, R. Barber, M. Flickner, et al, “Efficient and
Effective Querying by Image Content”, Journal of
Intelligent Information Systems, 3, 1994, pp231-262.

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

Document

Processing,

Prentice

Hall,

Englewood Cliffs, New Jersey, USA, 1971, pp 313–323.
[12] C.J. Van Rijsbergen, Information Retrieval, Butterworths,
London, 1979.

