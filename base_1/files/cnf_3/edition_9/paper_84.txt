RF-Sim: a Treatment Planning Tool
for Radiofrequency Ablation of Hepatic Tumors
Caroline Villard, Luc Soler, Nicolas Papier, Vincent Agnus,
Afshin Gangi, Didier Mutter and Jacques Marescaux
IRCAD - 1, place de l’Hˆopital - F67091 STRASBOURG - France
caroline.villard@ircad.u-strasbg.fr
www home page: http://www.ircad.org/

Abstract
With recent advancements of technology, radiofrequency
ablation has become one of the most used techniques to
treat liver tumors. But radiologists still have to face the
difﬁculty of planning their treatment while only relying on
2D slices acquired from CT-scan. We present in this paper a tool called RF-Sim, being part of a complete 3D reconstruction and visualization project, and including both
a realistic radiofrequency ablation simulator for training
and rehearsal, and an automatic treatment planner taking
into account tumor’s environment. They help radiologists to
have a better visualization of patients anatomic structures
and pathologies, and allow them to easily ﬁnd an adequate
treatment. They run on a common laptop and can be used
in the operating room.

1. Introduction
In the past few years, new minimally invasive techniques
emerged as an alternative for the treatment of unresectable
liver tumors. These techniques also have the advantage to
be lighter for the patient than classic surgery. Among them,
radiofrequency (RF) ablation is considered as one of the
easiest, safest, and most predictable [5]. It consists in a tumor denaturation, caused by the emission of radiofrequency
from the tip of a needle-like probe that heats and causes
necrosis of the cancerous cells.
The success of RF treatments relies on 3 main criteria:
a maximum volume of eliminated cancerous cells, a minimum volume of healthy tissue damaged, and the choice
of secure trajectories for needle insertions. However, the
planning of such a treatment is still difﬁcult for radiologists
that can only rely on 2D scanner slices. That is why recent
techniques of scanner image reconstruction were developed
to help radiologists in having a better 3D visualization of

their patients anatomy [10], and improving the information
at their disposal remain a topical subject of research.
After a brief state of the art, we describe how we developed a system based on the 3D view of patients organs,
that allow to realistically simulate needle placement, and
lesion growth. Then, we will explain the second functionality of our system, that is the automatic planning of needle
positions, optimizing the criteria. We will particularly put
the accent on the last criterion, the choice of trajectories
avoiding vital organs, that is the most recent improvement.
Before concluding, we will expose some of our signiﬁcant
results.

2. State of the art
Recent published studies and measurements showed a
direct relationship between several anatomic, pathologic, or
technical factors and lesion size and shape. Most of these
factors inﬂuence lesion size: the model of generator supplying power [3], blood supply occlusion [9], a cirrhosis of
the liver [4]. Another major factor rather inﬂuences lesion
shape: the “heat-sink effect” is due to the presence of large
vessels ( > 2mm) and results in a cooling of the surrounding zone, reducing the beneﬁts of the RF treatment in
this area. All these factors have to be taken into account for
an accurate RF ablation simulation.
On the technical aspect, until now very few developments have been carried out in the domain of RF ablation
simulation and planning. A few studies concern other minimally invasive treatments such as cryotherapy [8], or are
centered on ﬁnite elements modeling and does not seem
to be real time [11]. T. Butz proposed a very interesting
cryotherapy simulator and planner, included in 3D-Slicer,
that can also be extended to one type of RF probe [1]. However, it can only compute the best positioning of cryoprobes
within a predeﬁned window of the body, and does not take
into account the presence of surrounding organs.

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

Figure 1. Deformation of the necrosis zone
due to the presence of surrounding vessels

3. Simulation of the necrosis zone
In response to a need from radiologists to improve patients anatomy visualization and treatment planning, our researches leaded to the development of a tool called RF-Sim.
This tool makes the link between 3D reconstruction of slices
obtained from an enhanced spiral CT scan, using an automated algorithm described in [10], and a 3D viewer and
virtual treatment simulator.
A user can visualize and manipulate the 3D scene representing a patient’s organs, he can add and place one or
several probes, and see the predicted lesion simulated as a
meshed spheroid, and then he can freely move and rotate it
to see the updated lesion. Indeed, to take into account the
heat-sink effect, the lesion is deformed by “repulsing” its
vertices according to the proximity of a vessel. If the user
moves the probe, the lesion is updated in real time. This
method and obtained results are detailed in [12]. An illustration is presented on Fig.1.
This simulator allows the radiologist to rehearse, to try
various scenarios before the treatment, and to immediately
see what will be the effects of these needles placements according to tumor location, shape and size. The real-time
aspect of our simulator allows it to be run on a common
laptop, being able to be carried and used in the operating
room.

4. Automatic treatment planning
The previous realistic lesion simulation functionality is
complemented by an automatic needle placement planning
system, that helps radiologists in ﬁnding an optimal treatment strategy. This is done using 2 functions. One function computes, for a ﬁxed location and orientation of a needle, the minimal spheroid containing the tumor plus its additional security margin (mandatory to prevent local recurrence of a tumor after treatment [2]). The second minimizes
the volume resulting from the ﬁrst function by trying other

locations and orientations, progressively converging to an
optimal situation. To ensure a total burning of the whole
volume of the tumor and its margin, we use the voxel representation of the shape to include.
The ﬁrst one is a quite simple algorithm, that we called
ComputeBestSize, based on a simpliﬁcation of ellipsoid ﬁtting. Indeed, the lesions we mesh are particular spheroids
with radii r1 , r2 , and r3 verifying: r3 = r1 and r2 = k.r1 ,
where k is the following ratio: {major axis size} / {minor
axis size}. The algorithm then computes the smallest r1 allowing every voxel of the tumor and margin shape to be in2
2
2
side the spheroid deﬁned by the equation xr2 + ky2 r2 + zr2 =
1
1
1
1. The returned result is the volume of the spheroid V =
4
3
3 πkr1 . This algorithm is generalized for the treatment of
larger or multiple tumors by several needle insertions, and
then is called ComputeBestSizeMoreSpheroids: we sort tumor shape voxels according to their nearest needle tip, and
each subset of voxels will be included their own spheroid.
The volume obtained in return is the total volume of the
spheroids. This step is illustrated on Fig.2(a) and (b).

(a)

(b)

(c)

Figure 2. (a) and (b): ﬁtting an ellipse with
ﬁxed center and orientation around a 2D
shape; (c): ﬁtting a minimal ellipse around
a 2D shape
The second algorithm, called is an adaptation of one
of the classical minimization methods, Downhill Simplex
method [7]. The value to minimize is the volume obtained
from algorithm 1. Parameters are the location and orientation of the needle, with a precision used as the stopping
criterion. Starting from an initial simplex for the parameters, composed of the initial position given by the user and
a weighting of unit vectors, the initial simplex contracts itself into a valley ﬂoor after a few iterations, and returns
an optimized position. We also tried other minimization
methods, such as Powell’s direction set method, or simulated annealing algorithm, but with less efﬁcient results in
terms of volume size and execution time. This algorithm

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

5.1. Intersection between needle and organ

Figure 3. Minimization of the burning zone using 2 overlapping spheroids

is also extended for multiple needle placements, by simply increasing the number of vertices in the simplex. An
example of a result is shown on Fig.3 where 2 overlapping spheroids, whose placement were found automatically,
minimally cover a tumor.

Let us recall that we want our prototype to run on a
common laptop, so we have some efﬁciency requirements
that compels us to simplify the computations. Therefore,
we chose to replace the needle by a simple segment. That
way, the intersection computation is quicker, and can be performed by a simple line/mesh intersection algorithm.
To speed up even more the process, we chose to take advantage of the graphic cards by using an accelerated picking
to compute the intersections. A customized picking function, derived from rendering techniques, allows us to cast
a ray from the origin of the needle and following its direction, and to obtain in return a sorted list of all touched
organs, with the depth of the intersections. We only keep
intersections located between the origin and the tip of the
needle. This part of the process is as fast and robust as the
rendering of one part of the scene, that is accelerated by
every 3D graphic card.
We parse the intersections list, and we eliminate intersections with skin, liver, and tumor shape and margin. Then,
if one or more intersections persist, it means that the considered trajectory is not secure and has to be avoided. This
is illustrated on Fig.4, where the left scheme is acceptable
because needle only crosses skin, liver, and tumor and its
margin, but right scheme shows a wrong trajectory because
needle also crosses a bone.

5. Taking into account surrounding organs
The previous section described how we compute optimized placements for consecutive needle insertions, maximizing volume of burnt cancerous tissue, and minimizing
affected healthy tissue. This responds to the two ﬁrst criteria of a successful treatment, but the third one is still to be
considered.
For now, a minimal spheroid including tumor and margin
shapes is found, but we still do not take into account surrounding organs, and the trajectories we recommended may
still pass through bones or gallbladder for instance. To have
an appropriate prediction of the optimal trajectory to follow,
we have to avoid all trajectories that would go through vital
or rigid organs.
First of all, we have to determine what kind of trajectory has to be avoided. A trajectory is acceptable only if
it intersects skin, liver, and a tumor and its margin. All
trajectories intersecting other organs are forbidden, either
because a needle insertion through them would be fatal, or
cause serious damages (heart, portal vein, etc.), or because
their physical properties do not allow a needle to go through
(bones). Therefore, for each considered trajectory, we need
to compute its intersections with the patients organs.

(a) acceptable trajectory

(b) trajectory to reject

Figure 4. Finding intersections between organs and needle

5.2. Treatment planning preserving vital organs
Once this intersection computation function is established, we have to include it as a part of the optimization
process.
We chose to use the result of the unwanted intersections
research as a condition to weigh the volume returned by
ComputeBestSizeMoreSpheroids. If the trajectory is wrong,
this function will return such a high volume that the op-

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

timization function will necessarily decide to give up progression in this direction and search for a more secure path.
Practically talking, if the needle, for the lesion of which
we are going to compute the best size, is going to cross a
forbidden organ, then we do not perform the best volume
computation, and we place instead as a volume a very high
value, prohibitive enough for the optimization process. That
way, we save time as many of the tried trajectories will not
need a ﬁtting computation, and the time used to compute
intersections will be more or less compensated.

5.3. Results
A series of experiments was performed on 9 patients
cases, whose data came from the Strasbourg Civil Hospital. These tests included 7 small single tumors (< 10mL),
1 large single tumor needing 2 needle insertions, and 1 multiple tumor. These multiple tumors are considered as one
with several connected components, each of them needing
a separate needle insertion. Table 1 summarizes the results
of these experiments.
For each patient case, we detailed the number of connected components and the total volume of the tumor (plus
additional margin). This tumor information is followed by
information on the lesions predicted by the optimization
process in two cases: with or without the use of intersection tests. For each of these two categories, we speciﬁed
both the predicted volume, and the associated percentage
{volume of tumor} / {burnt volume}. The last data represents the loss of efﬁciency induced by the introduction of
the intersection tests.

on tumors located deep inside vessel network, or in a central position in the body, surrounded by organs. This point
conﬁrms that, the proximity of a complicated shape such as
the vessel network decreasing the range of possible trajectories, it is more difﬁcult to ﬁnd a satisfactory position for the
needle; but this difﬁculty would have also been encountered
if the planning was made manually.
We also have to take these results cautiously, as the experiments were performed on patients reconstructions in
3D that did not include stomach and intestine, because the
automatic reconstruction part of the project is not yet designed to recognize these organs. Therefore, the results may
change for the patients whose tumor is located right behind
the intestine when we will have these additional organs at
our disposal. Nevertheless, we can even so conclude that
our study totally reached one of its goals: we can automatically ﬁnd trajectories avoiding given vital organs and bones,
and giving results that have the smallest possible reduction
of efﬁciency in terms of burnt volume. Obviously, stomach
and intestine reconstructions will always have to be available when we will use our prototype in routine, in order to
have correct trajectories.
Another point of comparison between the processes with
and without intersection test is the execution time. A comparative table is presented below.

Table 2. Execution times (in sec.) with and
without intersection test
case nb.
1
2
3
4
5
6
7
8
9

Table 1. Resulting volumes of minimizations
(in mL) with and without intersection test
case

tumor(s)

nb nb volume nb
1 1
7.4
1
2 1
6.5
1
3 1
5.2
1
4 1
2.1
1
5 1
3.1
1
6 1
4.1
1
7 1
3.7
1
8 1 18.7 2
9 2
6.9
2

volume with
no collision
10.6
10.1
8.8
2.9
3.8
5.8
4.5
21.6, 15.4
3.4, 6.7

lesion(s)
efﬁc. volume with
of burn collision
69.8%
11.7
64.3%
10.5
59.1%
10.3
72.4%
3.7
81.6%
3.9
70.7%
6.4
82.2%
4.6
n.c. 16.7, 18.5
61.1% 3.5, 6.8

loss
efﬁc.
of
of burn percent.
63.2% 6.6%
61.9% 2.4%
50.5% 8.6%
56.7% 15.7%
79.5% 2.1%
64.1% 6.6%
80.4% 1.8%
n.c.
n.c.
67%
1.3%

These results lead us to the conclusion that even if there
is a loss with the addition of the collision test, this loss does
not seem to be so detrimental, as the average is 5.6%, and
the worst loss is 15.7%, and all efﬁciency percentages remain above 50%. We notice that the smallest losses mainly
concern tumors located far away from the vessel network,
and close to the skin, while largest losses are encountered

time w/ inter. test
9
4
6
1
7
4
5
115
32

time w/o inter. test
45
16
20
22
29
33
32
260
101

On this table, we can see that the intersection tests performed at each iteration of the optimization process noticeably slow it down. The average execution time is 6.5 times
slower with intersection tests than without tests. Even if
this can still be tolerable for a small tumor such as case #2
(16s.), this increases the duration of the process and can
reach prohibitive times when the tumor requires several needle insertions because of its size or its number of connected
components. For instance, in our experiments, it takes more
than 2 minutes to compute the 2 optimal trajectories to treat
a tumor of 18.7 mL, on an Athlon XP 1800+ with 512Mo
RAM, and a GeForce3 Ti 200 64Mo. We conclude that

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

more efforts have to be concentrated on the reduction of the
execution time, by optimizing the algorithms.
However, our method is still much faster than T. Butz’s
algorithm [1], as he announce 15 minutes of computation
to place optimally 2 probes, using a 440 Mhz workstation
with 512Mo RAM, and only within a small optimization
space deﬁned by the radiologists, i.e. without taking into
account surrounding organs.
Note that a validation process is currently in progress,
in collaboration with the Strasbourg Civil Hospital’s radiology service. It consists in a preoperative automatic treatment planning, and then a comparison a posteriori with the
effective treatment in terms of efﬁciency and accuracy, and
will concern in total about 20 patients.

5.4. Discussion and future works
Future works will be focused on two main points: the
reduction of the execution time, that is as we said earlier one
of the drawbacks of the method, and the improvement of the
security and the feasibility of the predicted trajectories.
Indeed, on this second point, we noticed that if the prototype ﬁnds a minimal trajectory passing closely between
veins through the vascular network, or nearby a vital organ,
it will consider this trajectory as being optimal and secure
and will return it. However, this may not be the point of
view of the radiologist that may consider this trajectory as
too risky, because in practice there is a danger of perforation
due to imprecisions during the operation. This situation is
illustrated on Fig.5.

associating to each point of the 3D space a scalar representing its distance to an organ. It would allow us to compute
a distance map for the whole patient’s anatomy, to be able
to determine for each trajectory the minimal distance to the
surrounding organs. That way, we could be warned if a
trajectory comes too close to vital structures, and avoid it.
Another possibility is to propose the user to choose the sensitivity degree of the tool, by allowing him to modify the
parameters of the optimization process with a dialog box.
That way, he could deﬁne how large is the range for the allowed position and orientation attempts, starting from the
initial position he gave. He would have a better control over
the zone in which he wishes the needle to be placed. However, this restriction of the research zone would forbid the
program to ﬁnd possibilities in other distant locations.
In a similar idea, another situation is considered by the
prototype as a good result, and by the radiologist as an unfeasible scenario: if the needle does not cross any organ
except for tumor, margin and liver, it also means that it does
not cross the skin, so it may be parallel to the body of the
patient (see Fig.6). In that case, the radiologist will not be
able to insert the needle following this trajectory. It sometimes occurs because some information is missing about the
patient, due to a restriction of the area acquired with the CT
scan. To avoid this, we could try to acquire larger zones of
the patients, but above all we could impose the trajectory
to cross necessarily the skin of the patient. If the scanned
zone is not extensive, this could reduce the range of possible
trajectories, but in compensation it would avoid impossible
ones.

Figure 6. Trajectory impossible to reproduce
in practice
Figure 5. Trajectory involving major risks
To avoid this scenario, we plan to use a method derived
from the distance transform [6], that is a technique coming from the image processing domain, and that consist in

Some improvements also have to be done as regards to
the problem of long execution times. As it seems to us that
it would be difﬁcult to accelerate even more the intersec-

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

tion test function, we have to search other means. We could
ﬁnd a way to avoid testing collisions at every iteration, for
instance by using the above mentioned distance transform
to create a “risky zone” around each organ, and eliminate
quicker large portions of space. We also could try to ﬁnd
other optimization methods, that would be faster than those
we have implemented so far (Downhill Simplex, Powell’s
conjugate, and simulated annealing methods). Lastly, we
could study criteria allowing us to adjust automatically optimization parameters according to tumor location and environment for instance.

6. Conclusion
We introduced a tool, called RF-Sim, that is part of
a whole project allying 3D reconstruction of 2D slices
acquired from an enhanced spiral CT-scan, and radiofrequency ablation simulation and planning, within the framework of hepatic tumors treatment.
The simulator part predicts the treatment’s result, given
a position and an orientation of the needle, and displays a
realistic spheroid representing what would be the necrosis
zone according to various surrounding factors. This tool
allows the radiologist to have a better visualization of his
patient’s anatomy, and to see what would be the efﬁciency
of some treatment strategies. It is aimed to be used as a
training and rehearsal tool.
RF-Sim also includes an automatic treatment planner,
that is able to compute the optimal placement and orientation for a RF needle in order to burn the whole tumor and
its security margin, and to preserve healthy tissue and avoid
the perforation of vital organs. Our method is based on an
intersection function derived from 3D rendering techniques,
and relies on the 3D card acceleration.
Both tools use voxel representations of some of the
anatomical structures to allow faster computations. Thanks
to this, the simulator is real-time, and can be used on every
common laptop and be brought in an operating room, and
our treatment planning tool is noticeably faster than those
developed so far in the domain.
However, some improvements still have to be done, especially to verify if the recommended trajectory is technically feasible, and if it is not too risky for the patient’s vital
structures.

References
[1] T. Butz, S. K. Warﬁeld, K. Tuncali, S. G. Silverman, E. van
Sonnenberg, F. A. Jolesz, and R. Kikinis. Pre- and intraoperative planning and simulation of percutaneous tumor
ablation. In MICCAI, pages 317–326, 2000.
[2] B. Cady, R. L. Jenkins, G. D. S. Jr., W. D. Lewis, M. D.
Stone, W. V. McDermott, J. M. Jessup, A. Bothe, P. Lalor,
E. J. Lovett, P. Lavin, and D. C. Linehan. Surgical margin in hepatic resection for colorectal metastasis: a critical
and improvable determinant of outcome. Annals of Surgery,
227:566–571, 1998.
[3] T. de Baere, A. Denys, B. J. Wood, N. Lassau, M. Kardache, V. Vilgrain, Y. Menu, and A. Roche. Radiofrequency
Liver Ablation: Experimental Comparative Study of WaterCooled Versus Expandable Systems. Am. J. Roentgenol.,
176(1):187–192, 2001.
[4] T. Livraghi, S. N. Goldberg, S. Lazzaroni, F. Meloni, L. Solbiati, and G. S. Gazelle. Small hepatocellular carcinoma:
Treatment with radio-frequency ablation versus ethanol injection. Radiology, 210(3):655–661, 1999.
[5] J. F. McGahan and G. D. Dodd III. Radiofrequency ablation of the liver: Current status. American Journal of
Roentgenology, 176(1):3–16, 2001.
[6] A. Meijster, J. B. T. M. Roerdink, and W. H. Hesselink. A
general algorithm for computing distance transforms in linear time, 2000.
[7] W. H. Press, S. A. Teukolsky, W. T. Vetterling, and B. P.
Flannery. Numerical Recipes in C++: The Art of Scientiﬁc
Computing (Second Edition). Cambridge University Press,
2002.
[8] J. C. Rewcastle, G. A. Sandison, P. Kennedy, B. J. Donnelly,
and J. C. Saliken. 3-dimensional visualization of simulated
prostate cryosurgery. In Soc. Cardiovascular & Interv. Radiology 25th Ann. Meeting, San Diego, 2000.
[9] S. Rossi, F. Garbagnati, R. Lencioni, H.-P. Allgaier,
A. Marchiano, F. Fornari, P. Quaretti, G. D. Tolla, C. Ambrosi, V. Mazzaferro, H. E. Blum, and C. Bartolozzi. Percutaneous Radio-frequency Thermal Ablation of Nonresectable Hepatocellular Carcinoma after Occlusion of Tumor Blood Supply. Radiology, 217(1):119–126, 2000.
[10] L. Soler, H. Delingette, G. Malandain, J. Montagnat, N. Ayache, C. Koehl, O. Dourthe, B. Malassagne, M. Smith,
D. Mutter, and J. Marescaux. Fully automatic anatomical,
pathological, and functional segmentation from ct scans for
hepatic surgery. Computer Aided Surgery, 6(3):131–142,
2001.
[11] S. Tungjitkusolmun, S. Staelin, D. Haemmerich, J.-Z. Tsai,
J. G. Webster, F. T. Lee, D. M. Mahvi, and V. R. Vorperian. Three-dimensional ﬁnite element analyses for radiofrequency hepatic tumor ablation. IEEE Trans. Biomed.
Eng., 49(2):3–9, 2002.
[12] C. Villard, L. Soler, N. Papier, V. Agnus, S. Thery, A. Gangi,
D. Mutter, and J. Marescaux. Virtual radiofrequency ablation of liver tumors. In IS4TM (to appear), jun. 2003.

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

