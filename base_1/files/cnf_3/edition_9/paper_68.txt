Visual Simulation of Refraction Phenomena in the Earth’s Atmosphere
Jaroslav Sloup
Department of Computer Science and Engineering
Faculty of Electrical Engineering, Czech Technical University
Karlovo n´am. 13, 121 35 Prague, Czech Republic
sloup@fel.cvut.cz

Abstract
We present a simple method for visual simulation of refraction phenomena in the Earth’s atmosphere. The method
divides the atmosphere into a set of spherical layers and
the rays are approximated by circular arcs within the layers. The curvature of arcs is related to the variations of
the refractive index. The path of the ray through the atmosphere is found by intersecting the circular arcs with the
layers boundaries. The curved rays produce the shape and
position distortions of the objects observed through the atmosphere. Depending on the type of distortion we distinguish a large variety of refractive phenomena such as mirages, omega sunsets, fata morgana, green ﬂashes, etc. The
described method has been embedded into the simple ray
tracer and some images are shown to demonstrate our approach.

1 Introduction
The relevant topic of todays photo-realistic image synthesis is a development of efﬁcient methods that solve the
problem of light transport in the participating media. Special attention has been dedicated to the Earth’s atmosphere
which is the most essential gaseous participating medium
for the computer graphics. Many papers have been published about the methods for modeling and rendering of the
atmosphere. Most of these methods are based on the light
transfer equation which fully characterizes the distribution
of light within the atmosphere. These methods have been
used to simulate various fascinating atmospheric phenomena such as sky color [17, 15], night sky [10], fog, aerosols,
rain, ozone [8], clouds [16], lightning [6], halo phenomena
[9], and aurora borealis [1].
Although the mentioned methods are able to produce
very realistic images of various atmospheric phenomena
they are based on assumption that the light travel along
the straight lines. It is not true for a real refractive atmo-

sphere, where the light rays are bent according to the continuously changing refractive index to traverse the atmosphere as fast as possible. It introduces the curvature of
light rays as a function of the refractive index. The refractive index of air depends on the temperature, pressure and
wavelength. Since the refraction phenomena occur usually
over a small scale of heights, the variations in pressure become very small. Therefore the changes of refractive index
are caused mainly by the temperature variations. The curvature of light rays can produce the shape, position and color
distortions of the observed objects through the atmosphere.
Depending on the type of distortion we distinguish a large
variety of refractive phenomena such as superior and inferior mirages, fata morgana, green ﬂashes, twinkling of the
terrestrial light sources, scintillation of the stars, etc. See
Minnaert’s [14] and Greenler’s [7] books for detailed description and pictures.
For modeling and rendering of the refractive effects
within the atmosphere we need two components: (1) a
representation of the refractive index of air, and (2) a ray
path equation describing path of the rays through the atmosphere. In this paper we address the problem of ray path
equation and present its simple approximation which uses
the circular arcs as a substitution for the real curved light
rays traveling through the Earth’s refractive atmosphere. To
our best knowledge, these equation have not appeared in
this form before in computer graphics literature. We incorporate this approximation into the standard ray tracer. Some
images of refractive effects were rendered by this method to
demonstrate the applicability of this approach.

2 Related work
The problem of refraction within the atmosphere is well
known and well studied problem in optics and astronomy.
The methods solving this problem can be divided into two
sorts: numerical methods and approximations. The numerical methods [12, 20, 21] usually expand a ray path equation into a power series and perform a numerical integra-

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

tion. This procedure is very time consuming and is not
suitable for direct use in computer graphics. Alternatively,
the method based on the transfer characteristics can be used
[13]. The transfer characteristic is a graph of apparent versus actual elevation of object points at a single speciﬁc distance from the observer. This form is sufﬁciently accurate
if the object’s longitudinal extent is small relative to its distance from the observer.
A simple yet accurate model for optical ray tracing in
the refractive atmosphere was developed by Lehn[11]. He
approximates the atmosphere by a ﬁnite number of concentric spherical layers. The temperature within these layers is
taken to vary linearly with respect to the increasing height.
Then, the curvature of nearly horizontal rays is almost constant within the layer. Thanks this the rays are approximated
by parabolic arc inside the layers. Our work builds on this
method with some minor modiﬁcations and is discussed in
details in the next sections.

Q

βi

P

β i+1

αi

ni

β0
ri

n i+1

α i+1

n0
ri+1

r0
C
Figure 1. Trajectory of the ray through the layered atmosphere.

Only minimal attention have been devoted to the problem of atmospheric refraction in the ﬁeld of computer
graphics. First who dealt with this problem was Berger et
al. [3]. They simulated the atmospheric refraction by incorporating a special object called atmospheric box into the
scene. This box consists of multiple plane-parallel layers
and each layer has a constant refractive index. The light
rays passing through such object are repeatedly refracted or
reﬂected on the layer boundaries according to the Snell’s
law of refraction and thereby approximating the real ray
path. The amount of bending within the atmospheric box
is controlled by the size and refractive index of individual
layers. No relation between the variations in the refractive
index and the structure of the atmosphere was introduced.
This method can be used to simulate refraction effects only
in a small scale because it owing to the plane-parallel approximation neglects the sphericity of the atmosphere.

Stam et al. [19] explore the theory of optical deformations and introduce the general method of solution. They
use a well known perturbation technique from geometric
optics to compute linear approximations to the deformed
rays by expanding these non-linear rays into a series of perturbations. The ﬂuctuations of the index of refraction are
modeled as superposition of blobs. The temporal evolution
of blobs is achieved by advecting their centers through a
turbulent wind ﬁeld. The perturbation approximation and
the blob representation was efﬁciently employed by the ray
tracer. In addition they presented a stochastic model for the
ray deviations derived from an empirical model of air turbulence. They used this stochastic model to precompute the
deformation maps which are then used in the ray tracer to
perturb the rays. Although the method is very powerful in
modeling of local ﬂuctuations caused by turbulence it is not
suitable to model the refractive index distribution in a huge
environment such as the Earth’s atmosphere.

3 Trajectory of rays in the refractive atmosphere
To derive the ray path equation for the refractive atmosphere we follow the classical approach [18]. We assume
that the atmosphere is horizontally stratiﬁed, i.e., that the
Ò ´Ö µ
refractive index of air Ò is radially symmetric, Ò
where Ö is distance from the center of the Earth. Now, we
divide the atmosphere into the thin spherical layers with
constant index of refraction (see ﬁgure 1). On the boundaries of layers the refractive index changes discretely and it
produces a refraction of incident rays. The refraction fulﬁlls
Ò
the Snell’s law ×× ÒÒ «¬ ·½
Ò ·½ .
·½
Using the atmosphere geometry depicted in ﬁgure 1 it
can be derived from the triangle ÉÈ that × ×Ò´Ò « ·½
¬µ
Ö
Ö ·½ . Regarding to the trigonometric equation × Ò´  ¬ µ
× Ò ¬ we can express × Ò « ·½ from the previous equation;
substituting it into the Snell’s law we derive equation

ÒÖ

× Ò¬

Ò ·½ Ö ·½ × Ò ¬ ·½

Ã¼

(1)

Now we take into account common pre-condition that
the layers are inﬁnitesimally thin. This leads to the general
expression for the ray path equation through the refractive
Ã¼ , where Ò is the absolute index
atmosphere ÒÖ × Ò ¬
of refraction, Ö is the distance from the Earth’s center, ¬ is
the angle between the ray and the vertical direction and Ã¼
is constant given by initial condition Ã¼ Ò¼ Ö¼ × Ò ¬¼ .
From the equation 1 we can derive the curvature of the
ray trajectory. For any point on the ray the curvature is
expressed as

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

  × ÒÒ ¬

Ò
Ö

  Ò ÖÖÒ× Ò ¬
¼ ¼

¾

¼

Ò
Ö

(2)

Ò is the derivative of refractive index at altiwhere ÒÖ
Ö
tude Ö. See [2] for details about the derivation.
The change of refractive index according to the altitude
in the visible part of the light spectrum is given by
Ò
Ö

 ´Ò¼   ½µ ÔÌ¼ÌÔ¾
¼

Ê

·

Ì
Ö

(3)

where Ò¼ resp. Ò denotes the refractive index at the temperature Ì¼ and associated pressure Ô¼ resp. temperature Ì
and pressure Ô. ÌÖ denotes the change of temperature per
¼ ¼¿ ¾ÃÑ ½
unit length in the vertical direction and Ê
(Ê is the gas constant and is acceleration due to gravity)
expresses the temperature decay per unit length in homogeneous atmosphere. If the temperature decrease is less than
¿ ¾Ã per ½¼¼Ñ ( Ê · ÌÖ ¼) then the refractive index
¼) and the ray
decreases with the increasing altitude ( ÒÖ
bends from the vertical direction. Otherwise, if the temperature decreases greater than ¿ ¾Ã per ½¼¼Ñ the refractive
index increases and the ray turns towards the vertical direction.

3.1 Approximation of the Ray Path Equation
Although the equation 1 gives an expression that describes the path of a ray through an atmosphere it is not
in reference to any ﬁxed coordinate frame. Therefore we
follow the approach introduced by Lehn [11] and lately improved by Bruton [4] to solve the mentioned problem in
our work. The atmosphere is divided into a ﬁnite number of standard concentric spherical layers. The boundaries
of these layers are isothermal surfaces and the temperature
gradients within the layers are constant. Thus, the temperature proﬁle of the atmosphere is a piecewise-linear function
whose corners deﬁne the layers boundaries. We treat the
curvature of the rays passing through the layers constant.
It allows us approximate the curved rays by circular arcs
½ . The path of the ray
with the radius of curvature Ö
through the layered atmosphere is then found by intersecting the circular arcs with the layer boundaries. A ray can
enter a layer from above or below, and in each case there
are two possibilities for its exit (see ﬁgure 2). In the rest
of this section we derive equations relevant to an upwardheading and downward-heading rays.
Let be the center of the Earth, È the location of the
observer, and Ö the viewing direction. Each layer with index lies between elevations À ÓØØÓÑ and ÀØÓÔ and has assigned average value of curvature (calculated from equation 2). To ﬁnd ray intersection with this layer we perform the following steps. At the beginning we determine
the plane in which bending of ray occurs. In this plane the
layer boundaries are replaced by the circles and the ray is
approximated by the circular arc with curvature . The intersection is then found analytically intersecting the circles

with the ray. When the intersection is known we transform
it back from the plane coordinate system to the 3D space.
Firstly, we have to determine the plane of bending which
is deﬁned by two vectors. One of these vectors is the viewing direction Ö . The second vector ÙÔ is easily calculated
from the knowledge that observer location È and the center
of the Earth lie in the sought plane. Thus, vector ÙÔ is
given by the following equation
ÙÔ

×

 ´

µ

Ö ×

Ö

(4)

where × È   is a vector pointing towards the point È .
The Ö and ÙÔ should be normalized before further application. The equation 4 above is valid only when the rays
are not collinear otherwise we can neglect the ray curvature
and approximate it by a straight ray.
Now we deﬁne the rectangular coordinate system with
the beginning at Ë and with the axes and to simplify
the searching of intersection in the plane of bending. The
ËÜ ËÝ is found as a projection of
onto the
center Ë
  Ö È and ËÝ  ÙÔ È are signed
plane, where ËÜ
distances from the planes deﬁned by the normal vectors Ö
and ÙÔ. The axis goes through the center of the circular
Ê Ë
arc Ê
¼  Ö and is given by
.
Ê Ë
The axis is deﬁned such that the projected point È onto
the plane has the positive coordinate. is given by
  when É ¼, otherwise we choose the reverse
direction
  . Point É is the projection of È into the
rectangular coordinate system and É  Ë
 ËÜ  ËÝ .
Deﬁned rectangular coordinate system is used to calculate the intersection of the ray with the layer boundaries.
Before evaluation of the intersection we have to determine
which layer boundary will be intersected by the ray. All
possible situations are captured in ﬁgure 2. Now we approximate the ray by a circular arc ´Ü   Ü µ¾ · Ý ¾ Ö¾ and the
¾.
equation of tested layer boundary is given by Ü¾ · Ý ¾
Ö is the radius of ray curvature within the layer ,
is the
appropriate layer boundary height (found from table on ﬁgÊ   Ë is the distance between the origin
ure 2), and Ü
of the coordinate system Ë and the center of the ray Ê. The
intersection between the layer boundary and the ray is then
easily evaluated and that yields a simple expression for the
Ü-coordinate of the intersection
Ü

Ü·
¾

¾

¾   Ö¾

(5)
Ü
The correspondingÔ
Ý -coordinate of intersection is then de¾   Ü¾ . The proper sign of Ý is chotermined as Ý ¦
sen according to ﬁgure 2. The calculated intersection point
ÁÄ
Ü Ý is then transformed from the rectangular coordinate system to the plane of bending by Á Ë · Ü · Ý .
Finally Á is transformed back to the 3D world coordinate
È · ÁÜ Ö · ÁÝ ÙÔ. The new ray direcsystem by
tion after exiting the layer is calculated as a tangent to the

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

ξ

ξ

dir

ξ

dir

τ

P

dir

P

up
IL

A

P

τ

B

ray

layer i
i

H bottom

S

R

τ

dx

τ

C

dir

dir

P

ri

i
H top

τ

D
P

ξ

ξ

τ
τ
P

ξ

dir

E
ray curvature sign
condition
y-coordinate sign
tested elevation
next layer index
ﬁgure
ray curvature sign
condition
y-coordinate sign
tested elevation
next layer index
ﬁgure

ξ

P

P

τ

ξ

P

τ

dir

dir

dir

ξ

F

G

H

upward-heading ray
+
ÀØÓÔ
ÀØÓÔ
ÀØÓÔ
ÀØÓÔ
Ü· Ö
Ü· Ö
Ü· Ö
Ü· Ö
+
+
À ÓØØÓÑ
À ÓØØÓÑ
ÀØÓÔ
ÀØÓÔ
i-1
i+1
2(A)
2(C)
2(B)
2(D)
downward-heading ray
+
+
Ö   Ü À ÓØØÓÑ
Ö
À
 
À
À
·
Ö
Ü
Ü
Ü
ÓØØÓÑ
ÓØØÓÑ · Ö
ÓØØÓÑ
+
+
ÀØÓÔ
ÀØÓÔ
À ÓØØÓÑ
À ÓØØÓÑ
i+1
i-1
2(E)
2(G)
2(F)
2(H)
+

Figure 2. Refraction geometry of a spherically symmetric atmosphere for the upward-heading and
downward-heading rays with all possible situations for the ray intersection with the layer boundaries.

circular arc at the point ÁÄ and transformed to the world coordinate system by the similar manner as intersection point.

The index of layer entered after exiting the current  
Ø layer is given in the table on ﬁgure 2. The described
calculation process is then repeated for different layers until
the ray exits the atmosphere or hits any object in the scene
including the Earth’s surface.

4 Implementation and results
The method discussed in previous section had been implemented and embedded into a simple ray tracer. To improve the accuracy of ray tracing we use the analytic formulas of the refractive index which were derived by Ciddor
[5]. The U.S. Standard Atmosphere is used to deﬁne the
temperature and pressure proﬁle. The pressure proﬁle is approximated by well known equation Ô´ µ Ô¼ ÜÔ ´  À¼ µ,
where Ô¼ is the pressure near the Earth’s surface, the el-

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

À

evation above the the ground and ¼
Ñ is a scale
height of the atmosphere. The gradients of the temperature
proﬁle of the U.S.S.Atmosphere were taken from [4]. We
modify this proﬁle near the Earth’s surface to accompany
the temperature variations that can produce the refraction
phenomena. We do not use the circular arcs approximation
to the ray path equation directly because it requires a great
deal of time when it is tested for intersection with the object. Instead, we recursively subdivide the circular arcs into
a chain of line segments which allow us to use the standard
acceleration techniques commonly used in ray tracers.
We demonstrate our approach using three examples. The
scene in all examples contains only the Earth (sphere) and
the Sun. Absorption and scattering of light on particles suspended in the air have been taken into account to produce
realistic images of the setting sun. Utilizing the light transfer equation we calculate for each viewing ray the spectrum
of incoming radiance which is converted to the RGB triplet
to be displayed on color monitor.
The ﬁrst example (in ﬁgure 3) shows the phenomenon
called omega sunset. The height of the observer is 50m
above the ground. The warm layer bellow the observer
makes the rays to bent up and produces the inferior mirage.
The altitudes of the Sun are 0.25, 0.18, 0.1 and -0.05 degrees. Figure 5 and 6 show so called mock mirage which
arises from the crossing of the viewing rays. The mirage
image in ﬁgure 5 was formed by two inversions in the temperature proﬁle while the image in ﬁgure 6 by one inversion
only. Every inversion produces one blank strip on the ﬁnal
image. The height of the observer is 150m and the sun altitudes are 0.15, 0.05, 0.0 and -0.35 degrees for ﬁgure 5. For
the image in ﬁgure 6 the height of the observer is 10m and
the sun altitudes are 0.25, 0.1 and 0.04 degrees.

5 Conclusions
The problem of ray path equation in the refractive atmosphere has been discussed in this paper. The simple method
for the simulation of the refraction phenomena has been
shown. The method divides the atmosphere into a set of
spherical layers and the rays are approximated by circular
arcs within the layers. The path of the ray through the atmosphere is found by intersecting the circular arcs with the
layers boundaries. Finally, the described method has been
embedded into simple ray tracer to produce some images
which demonstrate the applicability of this approach.

6 Acknowledgments
This work has been partly supported by the Ministry of
Education, Youth and Sports of the Czech Republic under
research program No. Y04/98: 212300014 (Research in the
area of information technologies and communications).

References
[1] G. Baranoski, J. Rokne, P. Shirley, T. Trondsen, and R. Bastos. Simulating the Aurora Borealis. In Proceedings of Paciﬁc Graphics 2000, pages 2–14, 2000.
[2] J. Bedn´aˇr. Pozoruhodn´e jevy v atmosf´erˇe. Academia, 1989.
[3] M. Berger, N. Levit, and T. Trout. Rendering Mirages and
Other Atmospheric Phenomena. In Proceedings of EUROGRAPHICS ’90, pages 459–468, Sept. 1990.
[4] D. Bruton. Optical Determination of Atmospheric Temperature Proﬁles. PhD thesis, Texas A&M University, 1996.
[5] P. E. Ciddor. Refractive Index of Air: New Equations for
the Visible and Near Infrared. Applied Optics, 35(9):1566–
1573, Mar. 1996.
[6] Y. Dobashi, T. Yamamoto, and T. Nishita. Efﬁcient Rendering of Lightning Taking into Account Scattering Effects
due to Clouds and Atmospheric Particles. In Proceedings of
Paciﬁc Graphics 2001, 2001.
[7] R. Greenler. Rainbows, Halos, and Glories. Cambridge
University Press, 1991.
[8] D. Jack`el and B. Walter. Modeling and Rendering of the
Atmosphere Using Mie-Scattering. Computer Graphics Forum, 16(4):201–210, 1997.
[9] D. Jack´el and B. Walter. Simulation and Visualization of
Halos. In Proceeding of ANNIGRAPH ’97, 1997.
[10] H. W. Jensen, M. M. Stark, S. Premoˇze, P. Shirley, F. Durand, and J. Dorsey. A Physically-Based Night Sky Model.
In Proceedings of SIGGRAPH 2001, pages 91–100, 2001.
[11] W. H. Lehn. A Simple Parabolic Model for the Optics of the
Atmospheric Surface Layer. Applied Mathematical Modelling, 9:447–453, Dec. 1985.
[12] W. H. Lehn and M. B. El-Arini. Computer-Graphics
Analysis of Atmospheric Refraction.
Applied Optics,
17(19):3146–3151, Oct. 1978.
[13] W. H. Lehn and W. Friesen. Simulation of Mirages. Applied
Optics, 31(9):1267–1273, Mar. 1992.
[14] M. G. J. Minnaert. Light and Color in the Outdoors.
Springer-Verlag, 1993.
[15] T. Nishita, Y. Dobashi, K. Kaneda, and H. Yamashita. Display Method of the Sky Color Taking into Account Multiple
Scattering. In Proceedings of Paciﬁc Graphics ’96, pages
117–132, 1996.
[16] T. Nishita, Y. Dobashi, and E. Nakamae. Display of Clouds
Taking Into Account Multiple Anisotropic Scattering and
Sky Light. In Proceedings of SIGGRAPH ’96, pages 379–
386, 1996.
[17] A. J. Preetham, P. Shirley, and B. Smits. A Practical Analytic
Model for Daylight. In SIGGRAPH ’99 Proceedings, pages
91–100, 1999.
[18] W. M. Smart. Text-Book on Spherical Astronomy. Campbridge University Press, 1936.
[19] J. Stam and E. Languenou. Ray Tracing in Non-Constant
Media. In Proceedings of the 7th Eurographics Workshop
on Rendering, pages 225–234, June 1996.
[20] M. E. Thomas and R. I. Joseph. Astronomical Refraction.
Johns Hopkins Apl Technical Digest, 17(3):279–284, 1996.
[21] E. Tr¨ankle. Simulation of Inferior Mirages Observed at the
Halligen Sea. Applied Optics, 37(9):1495–1505, Mar. 1998.

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

Figure 3. The omega sunset.
120

350

Temperature Profile

300

100

40

80
Altitude [m]

Altitude [m]

60

Temperature Profile

100

250

80
Altitude [m]

120

Temperature Profile

200
150

60
40

100
20
0
272

20

50

274

276

278

280

Temperature [K]

282

284

0
283

0
284

285

286

287

288

272

274

276

Temperature [K]

278

280

Temperature [K]

Figure 4. Temperature proﬁles for ﬁgures 3 (left), 5 (middle) and 6 (right).

Figure 5. The mock mirage caused by two inversions in the temperature proﬁle.

Figure 6. Mirage with one inversion in the temperature proﬁle.

Proceedings of the Seventh International Conference on Information Visualization (IV’03)
1093-9547/03 $17.00 © 2003 IEEE

282

284

