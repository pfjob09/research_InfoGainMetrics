2011 Eighth International Conference Computer Graphics, Imaging and Visualization

Invariant Digital Image Watermarking Using Adaptive
Harris Corner Detector
Xiao-Chen Yuan, Chi-Man Pun
Department of Computer and Information Science
University of Macau, Macau SAR, China
cmpun@umac.mo


attacks and can be used as reference points for both watermark
embedding and extraction. The experimental results showed
that the performance of the watermarking scheme is not good
against rotation. Zheng et al. [4] proposed a watermarking
scheme based on rotation invariant feature and image
normalization. In the scheme, the Bayesian image segmentation
was used to segment the cover image into several homogeneous
regions. The rotation invariant features were extracted from the
segmented areas and were selected as reference points.
Sub-regions centered at the feature points were used for
watermark embedding and extraction. Image normalization
was applied to the sub-regions to achieve scaling invariance.
Although the scheme was stated to perform well against
rotation, scaling, and JPEG compression, the capacity of the
watermarking scheme needs to be improved.
In this paper, a robust and geometric invariant digital image
watermarking based on feature extraction and histogram
distribution is proposed. In the scheme, the Adaptive Harris
Detector is proposed based on the Harris Corner Detector. By
adjusting the response threshold value and ranking the response
R value, a specific number of feature points are extracted and
each square region centering at the extracted feature points is
for watermark embedding and extraction. For watermark
embedding, some pixels are moved to form a specific pattern in
the intensity-level histogram distribution in each embedding
region, indicating the watermark; position of the feature points
is recorded and encoded as a KEY. For watermark extraction,
the Rotation Restoration Algorithm is proposed to restore the
image to its original un-rotated position. The KEY is decoded
to indicate the feature points and thus obtain the embedded
regions. According to the intensity-level histogram distribution
in each embedded region, the watermark is extracted.
The details of the scheme will be addressed in the following
sections. SectionⅡdescribes the Adaptive Harris Detector used
in the proposed scheme. SectionⅢ illustrates the procedure of
watermark embedding and section Ⅳ covers the details of
watermark extraction procedure. Experimental results in
sectionⅤ show the performance of this scheme. And finally the
conclusions are drawn in sectionⅥ.

Abstract—A robust and geometric invariant digital image
watermarking scheme based on feature extraction and histogram
distribution is proposed in this paper. The feature extraction
method called Harris Corner Detector is adopted and revised by
adjusting the response threshold value and ranking the response
R value to extract feature points and thus define the regions for
watermark data bits embedding and extraction. Each embedding
region is a square matrix centering at the selected feature points.
For watermark embedding, some pixels are moved to form a
specific pattern in the intensity-level histogram distribution in
each embedding region, indicating the watermark. For
watermark extraction, the Adaptive Harris Corner Detector is
adopted to restore the image to its original un-rotated position.
According to the intensity-level histogram distribution in each
embedded region, the watermark is extracted. Experimental
results show that the proposed scheme is very robust against
rotation, scaling, JPEG compression, median filtering, low-pass
Gaussian filtering and also noise pollution.
Index Terms—Geometric Invariant, Feature Extraction,
Histogram Distribution, Harris Corner Detector

I. INTRODUCTION
Digital watermarking has emerged as a potentially effective
tool for multimedia copyright protection and authentication.
Meanwhile, the robustness against geometrical distortion and
JPEG compression becomes more than challenging and
problematic. Quite a number of rotation and scaling invariant
algorithms have been proposed in the past years [1].
Some feature-based watermarking schemes have been
proposed in literature [2-6]. Alghoniemy and Tewfik [2]
proposed a geometric invariant watermarking scheme based on
moments and image normalization. Geometric moments were
used to geometrically normalize the image before watermark
embedding at the encoder and before watermark extraction at
the decoder. Tang and Hang [3] proposed a feature-based
robust watermarking scheme. The scheme extracted feature
points of the cover image and used the disk regions centered at
the feature points for watermark embedding and extraction.
Meanwhile, image normalization was applied in the scheme to
make those disk regions invariant to rotation and scaling. It was
stated that the extracted feature points can survive a variety of

II. ADAPTIVE HARRIS CORNER DETECTOR
The Harris corner detector was developed for 3-D
reconstruction by Harris and Stephens [12]. It uses differential

978-0-7695-4484-7/11 $26.00 © 2011 IEEE
DOI 10.1109/CGIV.2011.22

109

features of the image to extract salient points. Moravec
constructed the corner detector functions by considering a local
window in the image [13]. The response function E x , y is

extraction is achieved by applying a threshold on the
response RH ( x, y ) , and searching for the positions where the

calculated for a shift ( x, y ) from the central point (u , v ) , it is
given by:

Harris corner detector is a good tool to finding feature points.
Once the feature points are extracted, they can be used as the
reference for watermark embedding and detection. Yu et al.
[14] developed a watermarking scheme based on feature points
and RS-invariant domain. The Harris corner detector was used
to extract feature points, and the disks centered at the feature
points were for watermark embedding. Then the watermark
was embedded into the RS-invariant domain of each disk
repeatedly. Liu and Zhao [15] proposed an adaptive feature
point detection method for digital watermarking. They used the
Harris corner detector to detect feature points and use adaptive
threshold to work on various attacked images. The threshold
was adjusted and finally three points passed all the challenges
are used to form a triangle, which was used for watermark
embedding. Although the schemes were stated to be robust
against some geometric attacks and signal processing, through
experiments, it is found that the feature points can not be
located accurately when the watermarked images go through
distortions and geometric transforms.

Ex , y   wu ,v | I x u , y  v  I u ,v |2

local maxima of RH ( x, y ) is larger than the threshold.

⑴

u ,v

Where wu ,v specifies the image window centered on (u , v) ,
it is unity within a specified rectangular region, and zeros
elsewhere; I u ,v represents the intensities of the target image at
the coordinate (u , v) . The shifts ( x, y ) are considered
comprise [(1,0),(1,1),(0,1),(-1,1)]. Thus the corner detector is
simply looking for local maxima in min (E) above some
threshold value.
Harris reformulates the detection function in matrix as
equation (2):

Ex , y  [ x, y ]M x , y [ x, y ]T
Where the 2  2 symmetric matrix

⑵

M x , y is:

 Ax , y Cx , y 
M x, y  

 Cx , y Bx , y 
Ax , y  X 2  w

⑷

Bx , y  Y 2  w

⑸

Cx , y  ( XY )  w

⑹

⑶
The Adaptive Harris Detector is proposed to extract a given
number of feature points with much more robustness. Fig.1,
Fig. 2 and Fig. 3 show the feature point’s extraction
comparison of traditional Harris detector and the adaptive
Harris detector.

Where  denotes the convolution product,

X  I   1, 0,1  I / x

⑺

Y  I   1, 0,1  I / y

⑻

T

Note that Ex , y can be considered as a local auto-correlation
function of the image, with M x , y describing its shape at the
origin. Harris and Stephens gave a new definition of the
detector function of the eigenvalues of the matrix M x , y , 
and  .
To avoid the explicit eigenvalue decomposition of M x , y , the
Fig. 1 Number of extracted feature points comparison. (a1), (b1) and (c1) show
the feature points extracted by traditional Harris Detector; (a2) (b2) and (c2)
show the feature points extracted by adaptive Harris Detector.

new criterion is based on the trace and determinant of M x , y ,

Tr ( M x , y ) in equation (9) and Det ( M x , y ) in equation (10),
respectively.

Tr ( M x , y )      A  B

⑼

Det ( M x , y )    AB  C 2

⑽

Fig. 1 shows the comparison of number of feature points
extracted by adaptive Harris Detector and traditional Harris
Detector. As Fig. 1-(a1), (b1) and (c1) shows, given threshold =
20, by applying Harris Corner Detector into test images
‘Baboon’, ‘Boat’, and ‘Lena’, we can get different number of
feature points from different images. Meanwhile, by applying
the Adaptive Harris Detector into the same test images, we can
get a fixed number of selected feature points, respectively, as

Hence,

RH ( x, y )  Det ( M x , y )  kTr 2 ( M x , y )

⑾

Where k is an arbitrary constant. The feature points

110

shown in Fig. 1-(a2), (b2) and (c2).

Fig.2 Adaptive Harris Detection under different distortions

Fig. 3 Traditional Harris Detection under different distortions

Fig. 2 and Fig. 3 show the adaptive Harris Detection and
traditional Harris Detection under different distortions. (a) – (f)
respectively shows the feature points detection under the
circumstance of: (a) original image, (b) 30 degrees rotation, (c)
JPEG compression with a quality factor of 30, (d) scaling with
scale factor of 0.5, (e) 3 x 3 Gaussian low-pass filtering with the
standard deviation of 1.5, and (f) ‘Salt & Pepper’ noise addition
with the variance of 0.02. The extraction results show that the
Adaptive Harris Detector robust against all these attacks while
the traditional Harris Detector only robust against JPEG
compression in this example.

Fig. 4 Flow chart of watermark embedding

For watermark embedding, firstly, the Adaptive Harris
Detector is applied to the host image and the N feature points
are extracted. With the feature points, the regions for
watermark embedding can be defined. The number of feature
points is equal to bits of watermark W, hence, the N bits
watermark are embedded into N embedding regions
respectively, using the Region Matrix Embedding Algorithm,
which will be explained later.

III. WATERMARK EMBEDDING SCHEME
IV. WATERMARK EXTRACTION

In this scheme, a random number generator is used to
generate the watermark W, which is a sequence of w bits of “0”
and “1” bits. The flow chart of the proposed watermark
embedding is shown in Fig. 4.

For the watermark extraction, the position of the feature
points can be obtained by decoding the KEY, and consequently
the embedded regions are produced, based on the premise that
the pixel location of the image is unchanged. In this paper, six
types of distortions are tested: rotation, JPEG compression,
scaling, median filtering, low-pass filtering, and noise pollution;
of which, all the distortions will not change the image pixel

111

location except image rotation. Hence, the image needs to be
restored to its original un-rotated position before the watermark
extraction process, to settle this problem. According to the
intensity-level histogram distribution in each embedded region,
the watermark is extracted. The flow chart of watermark
extraction is shown in Fig. 7

Fig. 7 Flow chart of watermark extraction

V. EXPERIMENTAL RESULTS
In the experiments, five standard gray images of size
512*512 from The USC-SIPI Image Database [16]: ‘Baboon’,
‘Boat’, ‘Lena’, ‘Pepper’, and ‘Tank’, are selected to evaluate
the scheme performance. N is set to be 16, that is, 16 feature
points are selected for each test image, thus, a 16-bit watermark
of sequence of ‘0’ and ‘1’ is generated and embedded into the
16 embedding regions centering at the feature points in each
test images. The radius of the embedding region r is set to be 5,
and PSNR (Peal Signal-to-Noise Ratio) is used to evaluate the
distortion of the embedded image; the larger PSNR value
means less distortion. Fig. 8 shows the test images and their
watermarked images, with the 16-bit watermark embedded;
and also the PSNR between them are given. The PSNR values
between the original and the watermarked images are 40.56,
39.25, 42.83, 41.53, and 43.37dB for ‘Baboon’, ‘Boat’, ‘Lena’,
‘Pepper’ and ‘Tank’, respectively.

Fig. 8 Watermarked images & corresponding PSNR

VI. CONCLUSION
In this paper, a robust and geometric invariant digital image
watermarking scheme was proposed based on feature
extraction and histogram distribution. The scheme uses the
Adaptive Harris Detector to extract reliable feature points for
watermark embedding and employees the properties of
histogram distribution to implement the watermark embedding
and extraction process; it can survive both geometric
distortions and signal processing attacks: image rotation with
rotation angle from 0o to 360o; image scaling with the scale factor
bigger than 0.3; JPEG compression with a low quality factor of
up to 10; median filtering with its neighborhood up to 12  12;
Gaussian low-pass filtering with its standard deviation up to 1.7;
‘Salt & Pepper’ noise pollution with the density smaller than
0.8 and Gaussian noise pollution with variance smaller than

112

0.007. The capacity of the proposed scheme is flexible, since
we can manipulate the number of feature points as we want; the
greater capacity, the more distortion. Accordingly, the balance
between watermark capacity and image distortion should be
maintained. In the experiments, the capacity is set to be 16 for
using similar experiment setting as the scheme in [3] for better
comparison and also for less distortion. For the future work, the
performance of the proposed scheme could be improved if the
feature points were even more robust for watermark extraction;
the famous detectors such as SUSAN Detector and SIFT can be
the choice for further research.

[14]

[15]

[16]

Acknowledgment
The authors would like to thank the referees for their
valuable comments. This work was supported in part by the
Research Committee of the University of Macau and the
Science and Technology Development Fund of Macau SAR.
REFERENCES
[1]
[2]
[3]
[4]

[5]
[6]

[7]

[8]

[9]

[10]

[11]

[12]
[13]

D. Zheng, Y. Liu, J. Zhao, and A. E. Saddik, "A survey of RST
invariant image watermarking algorithms," ACM Comput. Surv.,
vol. 39, p. 5, 2007.
M. Alghoniemy and A. H. Tewfik, "Geometric Invariance in image
watermarking," Image Processing, IEEE Transactions on, vol. 13,
pp. 145-153, 2004.
T. Chih-Wei and H. Hsueh-Ming, "A feature-based robust digital
image watermarking scheme," Signal Processing, IEEE
Transactions on, vol. 51, pp. 950-959, 2003.
Z. Dong, W. Sha, and Z. Jiying, "RST Invariant Image
Watermarking Algorithm With Mathematical Modeling and
Analysis of the Watermarking Processes," Image Processing, IEEE
Transactions on, vol. 18, pp. 1055-1068, 2009.
A. Nikolaidis and I. Pitas, "Robust watermarking of facial images
based on salient geometric pattern matching," Multimedia, IEEE
Transactions on, vol. 2, pp. 172-184, 2000.
P.Bas, J. M. Chassery, and B. Macq, "Robust watermarking based
on the warping of pre-defined triangular patterns," Proc. SPIE
Security and Watermarking of Multimedia Contents vol. 3971, pp.
99-109, 2000.
C. H. Lin, D. Y. Chan, H. Su, and W. S. Hsieh, "Histogram-oriented
watermarking algorithm: colour image watermarking scheme robust
against geometric attacks and signal processing," Vision, Image and
Signal Processing, IEE Proceedings -, vol. 153, pp. 483-492, 2006.
C. M. Pun and X. Yuan, "Robust Block and Gray-Level Histogram
Based Watermarking Scheme," in Advances in Multimedia
Information Processing-PCM2009, P. Muneesawang, F. Wu, I.
Kumazawa, and et.al., Eds. Berlin: Springer-Verlag, 2009.
Y. Hyang-Mi, L. Sang-Kwang, and S. Jae-Won, "Fragile
Watermarking Based on Localized Histogram Modification," in
Consumer Communications and Networking Conference, 2009.
CCNC 2009. 6th IEEE, 2009, pp. 1-2.
F. Zheng and Z. Yao, "Image Watermarking Resisting to
Geometrical Attacks Based on Histogram," in Intelligent
Information Hiding and Multimedia Signal Processing,
International Conference on 2006. IIH-MSP '06. , 2006, pp. 79-82.
W. Xiaoyun, "Reversible Semi-fragile Watermarking Based on
Histogram Shifting of Integer Wavelet Coefficients," in Digital
EcoSystems and Technologies Conference, 2007. DEST '07.
Inaugural IEEE-IES, 2007, pp. 501-505.
C. Harris and M. Stephens, "A combined edge and corner detector,"
in Proceeding of the 4th Alvey Vision Conference, 1988, pp.
189-192.
H. Moravec, "Obstacle Avoidance and Navigation in the Real
World by a Seeing Robot Rover," tech. report CMU-RI-TR-80-03,

113

Robotics Institute, Carnegie Mellon University & doctoral
dissertation, Stanford University,1980.
Y. Yanwei, L. Zhengding, L. Hefei, and Z. Fuhao, "A robust blind
image watermarking scheme based on feature points and
rs-invariant domain," in Signal Processing, 2006 8th International
Conference on, 2006.
L. Yan and Z. Jiying, "A Robust Image Watermarking Method
Based on Adaptive Feature Points Detection," in Communications,
Circuits and Systems Proceedings, 2006 International Conference
on, 2006, pp. 49-53.
The USC-SIPI Image Database, Signal & Image Processing
Institute,
University
of
Southern
California,
http://sipi.usc.edu/database/.

