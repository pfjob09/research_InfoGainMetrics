Concealment of Damaged Block Coded Images Using Intelligent Two-Step
Best Neighborhood Matching Algorithm
Xiao Liang1
Huang chenrong1 Liang Haijun2
Wu Huizhong1
(Department of Computer Science & Technology, Nanjing University of Science & Technology,
Nanjing 210094)
2
(Department of Automation, Nanjing University of Science & Technology, Nanjing 210094)
{Email: xtxiaoliang@163.com}

1

Abstract
Imperfect transmission of block-coded images often
results in lost blocks. Best neighborhood matching(BNM)
is a very good error concealment algorithm to achieve
high quality restored image. However, the computation
complexity of BNM is high due to the full search method.
A fast error concealment method named Intelligent
Two-Step BNM (ITSBNM) is proposed, where an
intelligent search method is developed for most time
consuming stage. We alternatively use browse search and
fine search in block matching process. The fine search
used herein employs strategy of diamond search to find
matching blocks. Simulation experiments have been
performed on blocks lost images, and simulation results
show that ITSBNM can achieve a good tradeoff between
the computation and the visual quality of image
restoration, meanwhile it is about only 8-10% of BNM in
term of processing speed. Lots of simulation results
demonstrate the feasibility of the proposed algorithm.

1.

Introduction

Error concealment plays an important role in data
communication (image or video), since real-world
communication channels are not error free, the coded data
transmitted on them may be corrupted. Although
block-based techniques have proved to be the most
practical and are adopted by most existing image and
video compression standards such as JPEG, MPEG and
H.261, block–based image coding system are vulnerable
to transmission impairment[1~3]. Loss of a single bit
often results in loss of a whole block and may cause
consecutive block losses.
Error concealment is intend to ameliorate the effect
of channel impairment, such as bit-errors in noisy
channels or block loss in packet networks, by utilizing a
priori information about typical images in conjunction
with available image redundancy to create subjectively
acceptable images. Broadly, there two classes of
technique for improving the quality of decoded images in
the presence of transmission errors:
(i) The image bitstream can be modified to improve the

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

quality of decoded pictures in the presence of
transmission errors. Examples of algorithms include the
addition of resynchronization information to the bitstream,
forward error correction techniques, and a variety of
methods which change the order in which the various
variable length codewords that make up the image are
transmitted.
(ii) The decoder can apply error concealment
techniques to the received image to reduce the perceived
distortion due to transmission errors.
The algorithm described in this paper fall into the
second class. As we know, the two steps in solving an
error concealment problem are the detection of and the
recovery of the errors. In this paper, it assumes we know
which blocks in the image are received correctly and
which are not. Hence, we will focus on the recovery of
the errors and will not discuss the detection of the errors.
Our algorithm is developed in the previous framework of
best neighborhood matching (BNM)[4], which is proved
to be a very good error concealment algorithm to achieve
high quality restored image. In BNM algorithm, a special
kind of a priori information block-wise similarity within
the image is used. For a lost block in received image, a
lager size of block is extended which may contain both
missing pixels and good pixels. So the extended block can
be divided into two parts - the lost part and good parts.
The good part is used to find the most matching block
which has the same size and shape of extended block in
the whole image. Then the missing pixels in the lost block
are replaced or transformed by the good pixels in the most
matching block. Hence, two key aspects in BNM
algorithm are the definition of criteria of similarity and
the searching method for the most matching block.
However, due to the full search method the computation
complexity of BNM is very high, which restricts its real
applications.
This leads us to design a new searching method. Based
on the Markov Random Field (MRF) theory, every image
has different degree dependence among pixels. At the
same time, the correlativity seems to have the proximity
effect. In other words, if a block has higher similarity
with the matched block, then the surrounding blocks also
have higher similarity. Otherwise, the surrounding blocks

may have lower similarity. Hence, the Intelligent
Two-Step BNM(ITSBNM) will be proposed employs this
correlative properties. We alternatively use browse search
and fine search in block matching process. The fine
search used herein employs strategy of diamond search to
find matching blocks. Simulation experiments have been
performed on blocks lost images, and test results show
that ITSBNM can achieve a good tradeoff between the
computation and the visual quality of image restoration,
meanwhile it is about only 8-10% of BNM in term of
processing speed. Lots of simulation results demonstrate
the feasibility of the proposed algorithm.

2.

Best neighborhood matching without
luminance transform
A damaged image I : Ω → R may contain both

good

pixels

and

missing

pixels.

Let

I i , j and

I inew
represent the pixel value at position (i, j ) in the
,j
damaged image and restored image respectively. Since
assuming the position of the lost block can be detected
correctly, it is adequate to give a binary flag f i , j
indicating

f i, j = 1

whether
the
pixel
is
means (i, j ) is
missing

lost,
and

new

I i , j = I m ,n ,

In BNM algorithm, the perceptual distance d perc is
adopted the normalized sum of squared difference metric
(MSE)
N −1 N −1

MSE M =

corner

at

(t , s ) and d perc (ω (t , s),ω (t ' , s' ))

denote some perceptual distance between two patches.
The purpose of the searching procedure is to find a good
N × N block (no pixel is missing) in the image can be
best appropriate the matching part of the range block
through a simple pixel’s value replacement. We call the
good block a domain block. Hence, the problem of error
concealment can be modeled as the following
optimization problem:

ω* = i nf d perc (ω ' , ω (k , l ))
ω '∈Ω

Here ω* represents the closest matching patch of the
damaged patch.
Then the missing pixels’ value of the damaged block
can be simply replaced by the corresponding pixels’ value
in the best matching block

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

m = 0 n =0

k + m ,l + n

)( I i + m , j + n − I k + m , l + n ) 2

N −1 N −1

m=0 n=0

k + m ,l + n

)

In theory, the optimization procedure can be solved by
full searching for a good candidate domain block with the
same size of the range block in the whole image.
However, full search (FS) is used by exhaustively
evaluating all possible candidate blocks within the whole
image and the computation complexity of is very high
although it can achieve the best visual quality of
restored image. Therefore, fast search algorithms are
highly desired to significantly speed up the process
without sacrificing the distortion seriously.
The whole image
Searching range block

range block
Matching &
Recovering

f i , j = 0 means it is good. Consider an M × M fully
damaged block D ( p, q ) with its up-left corner
at ( p, q ) , we will extend it to get an N × N block with
its up-left corner at ( k , l ) in the damaged image. It is

up-left

¦¦ (1 − f

¦ ¦ (1 − f

i.e,
flag

clear that the extension block may contain both good
pixels and missing pixels, so the block can be divided into
two parts – the lost part and the good part. In BNM
algorithm, the good part is also called the neighborhood
of the lost part or the matching part of the whole block
because them will be applied a matching test on it.
Such N × N block with lost part and matching part is
called range block in BNM algorithm. Let
ω (t , s ) denote the square N × N window with its

(i, j )∈ D ( p , q ), (m, n )∈ ω *

lost block
domain block
Figure1: lost block, range block and domain block

3.
3.1.

Intelligent Two-Step BNM algorithm
Browse search and fine search

Firstly, as we know, in many motion compensated
video coding standard, block –matching motion
estimation is the vital technique, which is aimed to exploit
the strong temporal redundancy between successive frame.
Similar with BNM algorithm, the matching block
searching method is also the vital aspects in matching
motion estimation. Furthermore, many computationally
efficient variant, were developed, typically among which
are three-step search (TSS), new three-step search
(NTSS)[5], four-step search[6], block-based gradient
descent search (BBGDS) and diamond search (DS)
algorithms[7]. Secondly, the intelligence of human visual
system (HVS) inspires us to investigating the searching
strategy.
Secondly, based on the Markov Random Field (MRF)
theory, every image has different degree dependence
among pixels. At the same time, the correlativity seems to
have the proximity effect. In other words, if a block has
higher similarity with the matched block, then the
surrounding blocks also have higher similarity and

otherwise the surrounding blocks may have lower
similarity. On the other hand, when human beings search
a best matching for a lost block in the whole image, they
often adopt browse search and roughly determinate the
similar regions and then fine search the best matching
block in the similar regions.
To simulate the intelligence of HVS, The proposed
algorithm divides the process of search into two steps.
The first step is browse search, i.e. fast searching the most
similar regions. We adopt a larger search patterns to
implementing the browse search. And the search pattern
is shifting in the whole image with S pixels stepsize
( S >1), which is named by Coarse Align Search Step
(CASS).
Once the most similar region is found currently, a fine
search with using a diamond search pattern is carried out
in the region. Fine search is starting from the center of the
most similar region and gradually expand to outer area to
find the local best matching point. If the best matching
point in the previous most similar region is found, the
next browse search centered at the local best matching
point is repeated. So in our algorithm, browse search and
fine search are alternatively used to find the approximate
global best matching point. Hence the block with the
same size as lost block centered at the approximate global
best matching point is the desired block. So the missing
pixels’ value of the damaged block can be simply
replaced by the corresponding pixels’ value in the best
matching block.

3.2. Diamond search in most fine search
procedure
In TSS, NTSS, 4SS and BBGDS algorithms,
square-shaped search patterns of different sizes are
employed. However the DS algorithm adopts a
diamond-shaped search pattern, and it is mainly based on
the assumption that motion vectors are in general center
biased. Furthermore, based on the statistics, most of the
motion vectors are close to the center of the search region.
DS algorithm has been demonstrated faster processing
with similar distortion in comparison with NTSS and
4SS[7]. This inspires us to adopt the DS algorithm in
most fine search procedure. It is very reasonable to
search the region first, and then expand to outer area. Our
algorithm in fine search procedure consists of two
different search patterns, one is large diamond search
pattern (LDSP), and the other is small diamond search
pattern (SDSP), as shown in Figure 2 and 3 respectively.

Figure 2. LDSP

3.3.

block can be summarized in the following step.
Step 1. Extract a lost block from the image together
with its neighborhood as a range block.
Step 2. Browse search with coarse align search step in
the whole image for a good candidate domain
block. If the current domain block has minimal
MSE with the range block, then its center pixel
is viewed as the current best matching point and
go to step3, other wise repeated browse search
until on the border of the maximum image
range, i.e. the while algorithm is over.
Step 3. Starting from the current best matching point,
compute the matching MSE for the nine search
points in the LDSP arrangement. Pick the point
that has the smallest MSE.
Step 4. The diamond search is repeated with the center
moved to the current best matching point
resulting from the previous step. It then go to
step5 if the best matching point is the center
point, or on the border of the maximum search
range, otherwise, repeat step 4.
Step 5. The search step size (the radious of the diamond)
is reduced and SDSP is applied. It tests five
search points in the SDSP arrangement and
designate the one with the smallest MSE as the
best matching point.
Step 6. When diamond search is over, go to Step2.

4.

Simulations

The peak signal-to-noise ratio(PSNR) is used to give
a quantitative evaluation on the quality of the
reconstruction image. The proposed restoration algorithm
has been tested on some standard 8 bit/pixel grey-level
images with sizes 512 × 512, such as Goldhill and Baboon
(Figure 4(a) and (b)). Two cases of damaged images are
generated by randomly discarding some 8 × 8 blocks from
the original image. In the first case, the lost blocks are
restricted to be isolated, i.e., all of their eight surrounding
blocks are good blocks (Figure 4(c)); In the other cases,
no restriction is applied. So that some adjacent missing
blocks may be connected into big lost regions(Figure
4(d)). In simulation tests, the sizes of all range and
domain blocks are set to be 10 × 10ˈi.e. N=10, and the
CASS is 3, 4, 5 pixels respectively, and the block lost rate
is from 2.5% to 15%.

Figure 3. SDSP

Algorithm development
Briefly speaking, the ITSBNM algorithm for a lost

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

(a)



(b)

(c)

(d)

Figure 4. The reference image and the block lost
image: (a) the reference Goldhill image; (b) the
reference Baboon image; (c) the damaged Goldhill
image with 10% block lost rate, PSNR is 16.36dB; (d)
the damaged Baboon image with 10% block lost rate,
PSNR is 15.74dB.

(a)


(c)
(d)
Figure 5. The restored image handled by BNM
algorithm and ITSBNM algorithm respectively: (a) the
restored Goldhill handled by BNM algorithm with
PSNR is 34.09dB; (b) the restored Baboon handled
by BNM algorithm with PSNR is 28.79dB; (c) the
restored Goldhill handled by ITSBNM algorithm with
PSNR is 28.79dB; (d) the restored Baboon handled
by ITSBNM algorithm with PSNR is 28.67dB;

The Full Search BNM algorithm and our ITSBNM
algorithm are both developed to recover the lost blocks.
Both of them can greatly improve PSNR by a large
magnitude and almost have the approximate visual quality.
For example. Figure 4 (c) and (d) show the damaged
Goldhill and Baboon image with 10% block lost rate,
their PSNR are 16.36dB and 15.74dB respectively. Figure
5 shows the restored image handled by BNM algorithm
and ITSBNM algorithm with CASS is 5 respectively.
From the experimental results, it is easy to see both two
algorithms have very good objectively and subjectively
visual quality.

(b)

Table 1. TITSBNM TBNM comparison for the computing efficiency of ITSBNM algorithm and BNM algorithm
Block lost rate (%)

TITSBNM TBNM
for different test
images (%)
Goldhill
Baboon

2.5

5

7.5

10

12.5

15

8.8
8.29

8.73
8.18

8.76
8.38

8.88
8.69

9.01
8.95

9.29
9.35

On the other hand, in order to evaluate the computing
efficiency, we define the total time (in milliseconds)in term
of processing ratio between ITSBNM algorithm and BNM
algorithm by TITSBNM TBNM . Some experimental results
are listed in Table 1.
From Table 1, it is easy to see that ITSBNM algorithm
is about only 8-10% of BNM algorithm in term of
processing speed, meanwhile comparable restoration
quality can still be obtained, which demonstrates the
feasibility of the proposed algorithm.
The performance including PSNR and computing
efficiency of ITSBNM algorithm depends on the selection
of Coarse Align Search Step (CASS). Lager CASS will
improve the computing efficiency and decrease the
magnitude of PSNR(see in Figure 6 and 7). Experimental
results show that CASS is 4 is good choice.

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE


Figure 6. Total time for CASS in ITSBNM algorithm
on damaged Goldhill image with 10% lost block.

Figure 7. PSNR performance for CASS in ITSBNM
algorithm on damaged Goldhill with 10% lost block.

To illustrate the total performance our ITSBNM
algorithm compared with BNM algorithm, total time and
PSNR performance handled by ITSBNM algorithm and
BNM algorithm with respecting to the damaged Goldhill
image with block lost rate ranging from 2.5% to 15 % are
illustrated by Figure 8 and Figure 9. All the results are
obtained on the PC with 2.4GHz CPU and 512M RAM.

processing speed and it is about only 8-10% of BNM.
Meanwhile, the proposed algorithm can still improve both
subjective and objective visual quality block lost damaged
image. The ITSBNM algorithm is not restricted to the
particular 8 × 8 block size and can recover different
categories blocks without considering their neighborhood
direction or complexity. So the algorithm will have good
application in block-based image or video communication.
Further improvements include generalizing the ITSBNM
technique for color images, image sequence and other
kinds of signals.

Acknowledgements
This work was partially funded by the NUST Youth
Foundation No.Njust200401 and the National Special
Foundation of Doctoral Programs Grant No.
200288024 (in Chinese).

References

Figure 8. Total time for Full Search BNM algorithm
and ITSBNM algorithm on damaged Goldhill image
with the block lost rate ranging from 2.5% to 15% .

Figure 9. PSNR performancefor Full Search BNM
algorithm and ITSBNM algorithm on damaged
Goldhill image with the block lost rate ranging from
2.5% to 15%.

5.

Conclusions

In this paper, a novel information loss restoration
technique, ITSBNM, is presented. A lot of simulation
results show that this algorithm provides significant
improvement over original BNM algorithm in terms of

Proceedings of the Computer Graphics, Imaging and Vision: New Trends (CGIV’05)
0-7695-2392-7/05 $20.00 © 2005 IEEE

[1] G Walleye. The JPEG still image picture compression
standard . Communication of ACM, 1991, 34 (4):
30~44
[2] D Le Gall. MPEG : A video compression standard for
multimedia applications . Communication of ACM,
1991, 34 (4) : 46~58
[3] Rijkse, Karel. H.263 : Video coding for low-bit-rate
communicatio. IEEE Communication Magazine,1996,
34 (12) : 42~45
[4] Z Wang, Y L Yu, D Zhang. Best neighborhood
matching :An information loss restoration technique
for block-based image coding system . IEEE
Transactions on Image processing, 1998, 7 (7) :
1056~1061
[5] R Li, B Zeng, and M L Liou. A new three-step search
algorithm for block motion estimation. IEEE
Transaction on Circuits Systems for Video
Technology, 1994, 4 (4) : 438~422
[6] L M Po and W C Ma. A novel four-step search
algorithm for fast block motion estimation. IEEE
Transaction on Circuits Systems for Video
Technology, 1996, 6 (3) : 313~317
[7] Zhu S, Ma K K. A new diamond search algorithm for
fast block-matching motion estimation IEEE
Transaction on Image Processing, 2000, 9(2) :
287~290

