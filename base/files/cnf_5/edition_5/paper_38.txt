Architecture and Software Implementation of HDTV Video Decoder on a Singlechip, MPEG Decoder
Yuhuang Ye, Yuanjiu Li, Kaixiong Su
Dept. of Information and Communication Engineering
Fuzhou University, Fuzhou, China
{yeyuhuang@fzu.edu.cn, akju2001@163.com.cn, skx@fzu.edu.cn}
Abstract
This paper presents the architecture and software
design of HDTV video decoder on a 200-MHz single-chip
microprocessor. First, the paper analyzes the hardware
architecture of video decoder system on this MPEG
decoder and describes the function of each module in this
system, including the PES Parser, Decode pipeline, SC
Analyzer, and Display Processor. Then it gives the
software control and implementation of
this video
decoder. This video decoder meets the requirements for
MPEG-2 MP@HL real-time decoding. The outcome of this
paper should be helpful to the design of HDTV Set Top
Box.
Keywords--- HDTV, MPEG-2, video decoder, set
top box

1. Introduction
Currently, the DTV (digital television) is developing
quickly in China. The HDTV (high-definition television) is
the commanding point of DTV. Because it is impossible to
integrate MPEG-2 video decoder into television system in
the short-term, it results in the development of HDTV STB
(Set-Top Box). The study and the development of high
performance, multi-purpose and low cost real-time MPEG2 video decode system have the practical significance and
should be beneficial to lost of applications. Digital HDTV
uses the High-Level, Main-Profile definition (MP@HL) of
the MPEG-2 International Standard and generates video
signals for display. The aspect ratio is often 16: 9. The
image size can go up to 1080 lines by 1920 pixels. Both
interlaced and progressive pictures are supported with 24Hz, 30-Hz, and 60-Hz coding modes [1].

The video bitstream in MPEG-2 is a hierarchical
structure with six layers [2]. From top to bottom, the layers
are: Video Sequence, Group of Pictures (GOP), Picture,
Slice, Macroblock (MB), and Block. In these six layers,
except the Macroblock and block layer, other four start
from a corresponding Start Code (SC). This code is
especially reserved and may be used as the synchronized
recognition. Each layer has the different signal processing.
For example, Video Sequence is the random access point
of program; GOP which start from I picture is the random
access point for video edition; Picture is the unit for
coding; Slice is used as synchronization; Motion
compensation works at the Macroblock layer; and each 8 ×
8 block (which is an 8-sample × 8-line set of Y, Cb, or Cr
values) is processed by an 8 × 8 DCT.
Recently, MPEG-2 decoders have been developed
either as software based applications or hardware based
ASIC custom chips. It must be aware that MPEG-2 defines
a decoding process but not hardware architecture.
Normally, a particular decoder is just one kind of the
decoding methods. Parallel decode processing and dataflow approaches are used to lower processing frequency.
The paper introduces a video decoder on a singlechip, MPEG decoder that with integrated system
demultiplexer, audio decoder, graphics engine and a 32-bit
RISC CPU. This decoder demultiplexes, decrypts and
decodes HD or SD video stream with associated
multichannel audio. Then the paper figures out the
software architecture of video decoding and describes the
designing methods.

2. HDTV Video Decoder Architecture
Figure 1 shows block diagram of the video decoder
architecture in this HDTV decoder.
This diagram tells us the work flow of video decoder.
When the Control Unit receives a Vsync signal from the
application, the Data Interface accepts the incoming

Proceedings of the International Conference on Computer Graphics, Imaging and Visualisation (CGIV'06)
0-7695-2606-3/06 $20.00 © 2006

MPEG-2 video bitstream which comes from the
Demultiplex module. The PES (Packetized Elementary
Stream) Parser extracts the actual video data and the
DTS/PTS (Decode Time Stamp/Presentation Time Stamp)
information independently, then puts the bitstream to the
Bit Buffers. When the SC Analyzer gets the video layer’s
header, the Control Unit distributes data to parallel
Decoder pipeline. The ES (Element Stream) data is
converted here into actual pixel data. The MPEG-2 decoder
starts the decoding, stores the data in Video Frame Buffers.
At last, after the Digital Post Processing, the video data is
output and displayed.
Bit Buffers

sends the data to Video Decoder. The functions of Control
Unit are comprised of the following elements:
communication with application, correct Setting of
parameter, controlling the video flows, and so on. The
application program contains all the necessary commands
to control the decoder.

2.3. MPEG-2 System Demultiplexer
The integrated and programmable MPEG-2 System
Demultiplexer (Demux) provides efficient, cost-effective
MPEG-2 transport layer demultiplexing. It complies with

External Memory

Frame Buffers

MPEG-2 Decoder
PES Parser

FIFOs

SC extract

SC Analysis

˄VLDǃIZZǃIQǃ
IDCTǃMC˅

Digital
Post
Processor

PTS extract
Internal Bus

Control Unit

MPEG-2
D/A Unit

Demux

VSYNC
Host Interface

Video stream

Video Out

Figure 1. Block diagram of Video Decoder System
In this video decoder system, the Demultiplexer, the
PES Parser, MPEG-2 Decoder are done by hardware, while
the SC data retrieval and analysis, PTS association are
done by software. And the Bit Buffers, Frame Buffers
which are in the DDR SDRAM device are configured by
software.

the MPEG-2 and DVB specifications and providers a
comprehensive feature set.
The Demux demultiplexes TS packets into PES, ES,
PSI, SI, system and private data. It support multiindependent user definable queues for PES, ES, and SI
filtered data.

2.1. External Memory

2.4 PES Parser

This HDTV system optimizes external memory by
using the DDR devices to store the data. It can be used as
Bit Buffers (which store the transport stream extracted data
and compressed video data), Frame Buffers (which store
the display data) and address buffer. For HDTVˈthe size
of ES Bit Buffers is about 2056Kbytes, and each Frame
Buffer needs 1920h1080h1.5˙2025Kbytes.

PES Parser with input buffer (FIFO) receives
incoming bitstream which is then transferred to the Bit
Buffers. The PES Parser analyzes the compression data,
produces the ES data. Before the decoder gets the header,
the parser already completed the localization of the video
ES, DTS/PTS. The PES parsing is performed during a
DMA transfer of PES data to an ES buffer. During this
operation, PTS’s are extracted and written in memory for
later usage by the parsing software. An interrupt is raised
to the software at the end of each DMA transfer.

2.2. Control Unit
The Control Unit receives the command from User,
accepts the incoming MPEG-2 video bitstream (PES) and

Proceedings of the International Conference on Computer Graphics, Imaging and Visualisation (CGIV'06)
0-7695-2606-3/06 $20.00 © 2006

2.5. SC Analysis
During DMA transfer of PES to ES, a Start Code
detection is also performed by the DMA and start codes
values are written in memory together with their address
for later usage by the parsing software. The software later
accesses start code header data directly in memory. This
engine locates start codes in the Bit Buffers, raises an
interrupt for each, and provides their value to the software.
Then CPU reads the header data which after the SC.
Commonly, when a picture is begun to decode, SC analysis
is done again.

2.6. MPEG-2 Decoder
The MPEG-2 decoder is a hardware decoding engine
(see the Figure2). It provides a single manual decoding
mode where a picture is decoded providing the address in
memory of the beginning of the picture data. It reads the
ES from the Bit Buffers, and decodes them (VLDǃIZZǃ
IQǃIDCTǃMC). After decoding, it stores the data in the
Video Display Buffer [2][6].

Variable

Inverse

Length

Scan

Decoding

Interpolation,
Horizontal
Peaking,
Chrominance
Interpolation, YUV-to-RGB Matrixing, and Gamma
Correction.
The internal display unit outputs filtered video data
for displays. It supports the different display modes,
flexible output data formats and picture quality
enhancement.

3 Software Control and Implementation
On the base of this MPEG decoder chip, we have
developed a set of integrated video decoder software
system. The software code of the video decoder is basically
programmed to decode the MPEG-2 data stream with the
development kit provided by the chip provider.
The software system controls the driver of decoding
hardware directly to implement the decoding and display
[4][5]. Figure 3 is the architecture of it.
Command Interface

Reset

Interrupt

Timing

Header

Watch

Handle

Control

Process

Frame
Memory

Hardware Abstract Layer

Initialization

Decoded
Inverse

Inverse

Motion

Quanti-

DCT

Compe
sation

sation

samples

Figure 3. Decoder Software System Structure

3.1 Initialization
Figure 2: Structure of the ISO/IEC
13818-2 MPEG-2 video decoder
The output of each Decode Engine consists of slices
of macroblock-ordered pixel data. However, the
constituent frames may contain “residual” data, because
only the “Intra” frames (I frames) form complete pictures,
while the other frames are not yet fully reconstructed.
These remaining frames are comprised of predictivelycoded frames (P frames), and bidirectionally-coded frames
(B frames).

2.7. Digital Post Processor
The Digital Video Post Processor prepares the digital
video signal from the output of the Video Display Buffer
for actual display. The unit is realized on one PCB,
performing the following functions: Horizontal

Initialization is responsible for the initialization of
working conditions for decoding software system. It
assigns the space which decoding needs, establishes the
picture chain table. After initialization, the video driver has
a default state: it is stopped. Then, it can be started, paused,
etc. In order to decode all pictures of the current standards,
a minimum of 4 frame buffers is required.

3.2 Hardware Abstract Layer
The Hardware Abstract Layer controls the hardware
directly, and provides the interface to other modules. It
provides the necessary functions (called video driver) to all
kinds of application features. It includes three modules:
VIDBUF, VIDDEC, and VIDDISP.

Proceedings of the International Conference on Computer Graphics, Imaging and Visualisation (CGIV'06)
0-7695-2606-3/06 $20.00 © 2006

The VIDBUF allocates and manages the Bit Buffer
and the Frame Buffer. The video driver software initiates
DMA transfers of the data from the input (PES) buffer into
the ES bit buffer. Those data transfers are done so that data
is consumed before the input buffer is full, otherwise
useful data may be overwritten or some data may be lost in
the injecting engine. The video driver software manages
the fact that there is always room in the ES bit buffer to
transfer.
The VIDDEC parses the PES data, and then decodes
the pictures as soon as possible. After a Start command, the
parsing and decoding start as soon as the decoder has data
ready and a sequence start code is found.
The VIDDISP puts the pictures in the display
sequence to video compositor which mixes the video signal
and the OSD data. According to the timing, VIDDISP unit
determines whether to skip/repeat the picture or not.

buffers, synchronization, the decoding picture situation, the
processing decides whether to start the new decoding or to
enter the waiting. It impels the entire decoding work.
Start
Grave
Mistake

Software Reset
N

Stop the decoding

N

Vsync
Top/Bottom

Y
current_field=top/bottom

N
Vsync_interrupt_rountine

PSD

Y
PSD Process

N
Buffer Full

Y
get_first_picture

N

3.4 Interrupt Handle

Y
Start decoding

N
Header hit

Y
All kinds of header processing

N

The decoder Interrupt Handler responses all kinds of
interrupts, controls the status switch of decoding, and
implements the MPEG decoding loop functions. It is the
essential part of the software system. The Figure 4 shows
the handle flow of Interrupt Handler.
After the decoding hardware has the interrupt, the
operating system automatically transfers this interrupt
handling routine. The routine first inspects whether is
"grave mistake interrupt", if is, the counts of grave mistake
interrupt adds one, when the counts surpasses the certain
value, reset software system. The routine inspects whether
is "pipeline idle interrupt", if is, stops the decoding work
under the appropriate condition.
Then, the decoding interrupt handling routine inspects
whether is "Vsync interrupt ", if is, establishes the current
decoding field is the top field or the bottom field, executes
the corresponding processing. Mainly according to the

Y

Pipe idle

3.3 Reset Watch Task
In order to prevent the decoding software work is
exceptional, the Reset Watch Task monitors the reset
signal which is sent by software system. The video driver
provides an Error recovery which describes the ability of
the video driver to behave the best when errors in the input
data occur, with visible consequences. When the count of
errors is up to a certain value, the reset signal is identified,
and then the entire video software system is reset. A ‘live
reset’ watchdog timer is continuously monitoring the
behavior of the video driver. Would it see no decode
happening for a too long amount of time (which should be
impossible if the video is alive and if the injection is
continuous), it automatically stops and re-starts the video
driver in order to reset it.

Y

End

Figure 4: Decoding Interrupt Handle Flow
The decoding interrupt handling routine continues to
inspect whether is "decoding synchronization (Dsync)
interrupt", executes the corresponding processing. The
routine inspects whether is "buffer full interrupt", if is,
inspects whether the system is getting the first picture after
the sequence header. If is, it starts to decode.
At last, the decoding interrupt handling routine
inspects whether is "start code interrupt", if is, gains start
code value from memory. And it judges the type of start
code, carries out the corresponding start code handling
procedure.

Proceedings of the International Conference on Computer Graphics, Imaging and Visualisation (CGIV'06)
0-7695-2606-3/06 $20.00 © 2006

3.5 Timing Control
According to the PTS/DTS information from the
memory, the Timing Controller synchronizes and controls
decode and display timing. Its internal STC counter and
time stamp management functions are used to provide
accurate control of decode, display, and rate conversion.
Film mode and trick modes such as freeze, skip, slow
motion, and fast forward are supported with its highly
programmable control features.

3.6 Header Process
Header Process gets and analyzes each kind of header
data, and performs PTS association. According to the
corresponding head information, it can get the information
about the pictures, such as the size, aspect ratio, frame rate,
resolution and so on. The header process sets the
corresponding conditions of decoding and displaying work.

3.7 Command Interface
The Command Interface handles all communication
between the external user and internal functions. The
application may start and stops decoding, sets the
corresponding decoding and the display mode. The video
driver displays the presented pictures on video layers
(plans), within video viewports (rectangle windows).
The MPEG-2 video decoder is a picture decoding, it
may independently complete a picture decoding. Therefore
the entire work mainly lies on the systems control,
completes analysis and processing of the picture layer and
above. The software should analysis the information of
sequence header and picture header, establishes the
corresponding decoding and the display parameter, and
also relates decode and display synchronization with the
time stamp. After the errors accumulate to the certain
degree, the system should carries on the replacement to
guarantee the stability of the system.

4

output. The HD display is multiformat capable (1080I,
720P, 480P, 480I).

5

Conclusions

The hardware and software analysis of the video
decoding system on a chip is presented. The video decoder
converts encoded bitstreams into displayable video signals.
Various video and film frame rates are supported. It shows
that this decoder can provide sufficient signal processing
performance to deal with broadcast-quality video in lowpower, low-cost, consumer products. Our experience with
this system gives us confidence that such a design is viable.

References
[1] Digital Television Standard For HDTV Transmission, United
States Advanced Television Systems Committee, Doc. A/53, 12
April, 1995.
[2] ISO/IEC 13818-2 Generic coding of moving pictures and
Associated audio Information; Video, Jan, 20, 1995
[3] Aldo Cugnini and Richard Shen, MPEG-2 Video Decoder for
Digital HDTV Grand Alliance System, IEEE Transactions on
Consumer Electronics, Vol.41, No-3, August 1995
[4] Jui-Hua Li and Nan Ling, “An Efficient Video decoder
Design for MPEG-2 MP@ML” IEEE International Conference
on Application-Specific Systems, Architecture and Processors,
July 14-16, 1997.
[5] Nam Ling, and Nien-Tsn Wang, “Real-Time Video Decoding
Scheme for HDTV Set-Top Boxes”ˈIEEE TRANSACTIONS
ON BROADCASTING,VOL.48. NO.4, DECEMBER 2002
[6] Su Kaixiong, and Guo LitingˈǉDigital Satellite Television
Receive Technology, Beijing˗Publishing house of People's posts
and telecommunicationsˈ2002

Implementation Results

We designed the target of the MPEG decoder that we
would realize. It is a DTV receiver with a front end˄tuner
˅which based on DVB-C. Then based on this, we carried
out the system analysis and design of the software. An
application program to simulate and monitor the decoding
process in the system is developed. It can decode MPEG-2
video stream in real-time and is compatible with
the reception of analog TV. The system we have been
working for not only realized the basic function of MPEG
video decoder, but also realized some special function on
the need of practice. It supported both HD output and SD

Proceedings of the International Conference on Computer Graphics, Imaging and Visualisation (CGIV'06)
0-7695-2606-3/06 $20.00 © 2006

