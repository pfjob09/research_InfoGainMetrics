Visual 4D MRI Blood Flow Analysis with Line Predicates
Silvia Born∗

Matthias Pfeifle†

Michael Markl‡

Gerik Scheuermann§

¨ Leipzig
Universitat

University Hospital Tubingen
¨

Northwestern University Chicago

¨ Leipzig
Universitat

(a)

(b)

(c)

(d)

Figure 1: Aneurysm in the descending aorta. (a) Pathlines crossing the displayed ROI (white arrow) at t = 100ms. (b) Further subdivision
into pathlines entering the brachiocephalic artery (yellow), the left carotid artery (light blue), and the left subclavian artery (blue). (c) Gray lines
represent particles residing in the aneurysm for more than 150ms. Color-coded lines pass the aneurysm in less than 150ms. (d) Streamlines (at
t = 180ms) with mean velocity greater than 80 cm
are directed at the aneurysm wall (white arrow).
s

A BSTRACT
4D MRI is an in vivo flow imaging modality which has the potential to significantly enhance diagnostics and therapy of cardiovascular diseases. However, current analysis methods demand too
much time and expert knowledge in order to apply 4D MRI in the
clinics or larger clinical studies. One missing piece are methods
allowing to gain a quick overview of the flow data’s main properties. We present a line predicate approach that sorts precalculated
integral lines, which capture the complete flow dynamics, into bundles with similar properties. We introduce several streamline and
pathline predicates that allow to structure the flow according to various features useful for blood flow analysis, such as, e.g., velocity
distribution, vortices, and flow paths. The user can combine these
predicates flexibly and by that create flow structures that help to
gain overview and carve out special features of the current dataset.
We show the usefulness of our approach by means of a detailed
discussion of 4D MRI datasets of healthy and pathological aortas.
Index Terms:
I.6.9.a [Computer Methodologies]: Simulation, Modeling, and Visualization—Applications; I.6.9.b [Computer Methodologies]: Simulation, Modeling, and Visualization—
Flow Visualization; J.3 [Computer Applications]: Life and Medical
Sciences—;

∗ e-mail:

silvia.born@medizin.uni-leipzig.de

† e-mail:matthias.pfeifle@uniklinikum-tuebingen.de
‡ e-mail:mmarkl@northwestern.edu
§ e-mail:scheuermann@informatik.uni-leipzig.de

IEEE Pacific Visualization Symposium 2012
28 February - 2 March, Songdo, Korea
978-1-4673-0866-3/12/$31.00 ©2012 IEEE

1

I NTRODUCTION

In the cardiovascular system, the blood hemodynamics and the morphology of heart and vessels strongly affect each other. The asymmetric and curved geometry of the human heart leads to an efficient
ejection of blood into the pulmonary arteries and the aorta [16]. On
the other hand, the flowing blood exerts varying forces on the vascular morphology and causes a continuous remodeling of the heart
and vessel tissue [6]. Therefore, the effective interplay of hemodynamics and morphology, where both are perfectly attuned to one
another, characterizes a healthy cardiovascular system.
As a consequence, this system can be destabilized by alterations
of blood flow or morphology due to disease or surgery. That way,
modified morphology causes changes in the blood flow behaviour
which may lead again to further unfavorable remodeling. In the
long run, serious diseases may result from this vicious cycle [6].
After all, information about patient-specific spatiotemporal
blood flow behaviour, in addition to the traditional morphological
images (CT angiography, MR angiography), turns out to be valuable for diagnosis and prognosis of cardiovascular diseases. In clinical routine, however, flow examinations are usually, if at all, carried out in 2D with either Doppler Ultrasound or 2D phase-contrast
MRI measurements.
A relatively new method to obtain more comprehensive blood
flow information is the flow-sensitive phase-contrast magnetic resonance imaging (4D MRI). Here, 3D morphology and time-resolved
blood flow velocities (in 3 directions) are acquired simultaneously
over the complete cardiac cycle and with a high spatial resolution.
The 4D nature allows for a flow analysis at every desired location
without the risk of missing crucial information because of an adversely positioned 2D measurement plane. Valuable insight in cardiovascular physiology, pathologies, and associated hemodynamics have been gained with this imaging technique. For a recent
overview, we refer to Markl et al. [21].
To exploit the full potential of 4D MRI, appropriate analysis

105

methods are inevitable. Currently, physicians analyze 4D MRI data
mainly by inspecting the flow or derived flow parameters on 2D
cross-sections defined in the region of interest. For a 3D impression
of the flow dynamics, the course of streamlines or pathlines started
from these 2D planes is examined [1]. The aforementioned research
results were mainly achieved with these approaches. However,
for larger patient studies or the clinical routine, they do not suffice. The main reason is the high degree of user interaction which
makes the analysis very time-consuming and the results strongly
user-dependent. Further, the current methods fail to provide a good
overview of the flow situation. Physicians are not always interested
in a confined anatomical area. Often, they rather want to get insight
into the overall flow dynamics to detect areas with irregular flow
behaviour. Gaining overview can be tedious with current analysis
techniques and with that the risk of missing crucial aspects rises.
In this paper, we start to attend to the problem of lacking
overview. Our aim is to provide an analysis method for 4D MRI
data which captures the overall flow structure instead of local flow
patterns. The flow structure is the division of a flow field into areas
with similar characteristics. A flexible approach of determining this
flow structure are line predicates which have been introduced before for the analysis of non-medical CFD simulation data [26, 27].
We utilize and adapt this method to blood flow analysis in measured
and, therefore, noisier 4D MRI data.
The entity of integral lines represents the spatiotemporal behaviour of a flow field. To make sense of the flow, it is not useful to inspect thousands of single lines. Instead, the idea of line
predicates is to sort these lines into groups according to specific
properties. Thus, each group represents a subflow with a certain behaviour. Flow behaviour can be defined according to various characteristics, such as flow paths, vortices, velocity, or residence time.
In blood flow analysis, usually more than one or combinations of
these properties are useful. By choosing the appropriate predicates,
the user can bring in his medical knowledge and query the specific
data according to the current interest. With our method, it is possible to explore the flow by answering questions like: ”Where are the
main vortices located and which areas are influenced by them?”,
”Where occurs the highest flow velocity and how does this change
over time?”, or ”What part of the blood flows into the left subclavian artery?”.
The establishment of 4D MRI in the clinics is the goal of current research. Still, the domain experts we mainly address at this
point are medical researchers who want to understand the role of
blood hemodynamics in the development of cardiovascular diseases. Their findings from clinical studies - in addition to appropriate analysis methods - will have a strong impact on the clinical
use of 4D MRI.
In summary, these are our main contributions:
• We present a line predicate approach capturing the main blood
flow structure in 4D MRI data according to various properties,
such as vortices, flow paths, velocity, residence time.
• The method allows the user to set queries to identify areas
with interesting or abnormal flow characteristics, but it is also
suited for automatic overviews.
• We evaluate our work by presenting case studies of two patients with aortic pathologies and one healthy volunteer showing that our approach allows conclusions that were not possible with current methods yet.
• We show that vortex detection techniques developed for the
analysis of CFD simulation data are applicable to measured,
and therefore noisier, 4D MRI data.

106

2

R ELATED W ORK

4D MRI is a rather young imaging modality which has not found
its way into the clinical routine yet. Mainly 4D MRI experts have
been engaged with the data analysis for research purposes in the last
years. Common 4D MRI analysis methods adopted standard flow
visualization techniques, such a 3D streamlines or pathlines [4, 3]
or the depiction of flow information on 2D planes by means of
color-coding, vector plots, or velocity profiles [19]. These methods
have enhanced a lot [1, 11, 21] but still demand a lot of interaction
and user knowledge to find unknown flow patterns in the data.
As 4D MRI matures, the visualization community discovers 4D
MRI blood flow as an exciting research area. There is interest in
supporting users by improving the existing methods in terms of usability and comprehensiveness. Van Pelt et al. apply an easier interaction for the selection of 2D vessel cross-sections. Further, they
use illustrative methods like arrow-trails to depict time-dependent
blood flow dynamics and exploded planar reformats to connect 3D
and 2D views of the flow [33]. Gasteiger et al. tackle the problem of occlusion and clutter occurring when vessel morphology and
embedded complex flow are visualized together. They introduce a
ghosted view approach that displays the vessel surface but reveals
the blood flow depending on the orientation between surface and
viewer [9]. An approach to encode a multitude of parameters on the
2D plane separating an aneurysm from the main vessel is presented
by Neugebauer et al [22]. Furthermore, interaction widgets are introduced which are tailored to the needs when examining cerebral
aneurysms. A probing approach introduced recently by van Pelt et
al. allows flow exploration by interactive seed injection into the 4D
MRI flow field and the observation of the flow behaviour based on
illustrative renderings and animations [32].
Thus, there exist several promising approaches to improve the
depiction of 3D integral lines or flow parameters on 2D planes. A
remaining problem, however, is the interpretation of the flow concerning flow patterns and the overall flow behaviour which is still
mainly left to the user. To assist the user in this task, Heiberg et
al. introduced an automatic detection of swirling flow based on a
vector pattern matching technique and showed its applicability to
4D MRI data [10]. Krishnan et al. depict flow with similar paths
by segmenting integral lines starting from a 2D plane according to
their anatomical target area. The clusters are displayed on the emitter planes [17]. Eriksson et al. are concerned with the quantification
of blood flow in the left ventricle [6]. They group pathlines based
on their start and target regions into several groups (entering, exiting, passing, staying in the ventricle) and determine the volume of
the different compartiments from this.
Our approach is related to these methods in the sense that our aim
is also to detect specific behaviour in the flow. But while the aforementioned methods each deal with one specific behaviour, we apply
a more flexible approach that allows to structure the flow according
to several properties. To achieve this, we adapt the line predicate
approach introduced by Salzbrunn et al. [26, 27] to blood flow analysis. The pathline attributes by Shi et al. are also closely related to
our line predicate approach [28]. They apply linked views to select
pathlines with specific parameters in non-medical data. However,
our concept of line selection based on features of the underlying
velocity or anatomical data is not readily possible with their technique.
3

C ONCEPTS

Our work is based on the application of line predicates. In the following sections, we briefly recapitulate the basics concerning integral lines and line predicates according to previous work [26, 27].
3.1

Integral Lines

The infinite set of streamlines or pathlines incorporates the information about the dynamics of a given 3D flow field. A pathline rep-

resents the trace of a virtual particle emitted into an unsteady flow
field at a specific time and is tangent to the flow vectors. A pathline
p running through an unsteady velocity field v : D × I → R3 (with
the field domain D ⊂ R3 , timespan I = [t0 , tn ], and starting time
τ ∈ I) is defined as
pa,τ : Ia,τ → D
pa,τ (τ ) = a
t → pa,τ (t)
∂pa,τ
(t) = v(pa,τ (t), t)
∂t
for any position a ∈ D and any time t ∈ I. Ia,τ ⊂ I is the maximal
lifespan of the particle in D during I.
Streamlines depict the flow situation in a steady field, i.e., in our
case a single timestep of the complete 4D MRI measurement, and
are at every point tangent to the field vectors. Steady flow can be
regarded as a special case of unsteady flow and, thus, streamlines
and pathlines coincide here. Along theses lines, streamlines are a
special case of pathlines with time kept fixed (t = ti and τ = 0):
p a : Ia → D
pa (0) = a
s → pa (s)
∂pa
(s) = v(pa (s), ti )
∂s
For streamlines, the line parameter is not equivalent to time and
therefore depicted by s. Integral lines describing the path of the
same particle or, in the steady case, running through the same position x are equivalent. The set of all equivalent classes of integral
lines is expressed by P.
3.2 Line Predicates
Predicates are boolean functions. Thus, a line predicate P evaluates
to either true or false depending on whether an integral line p ∈ P
meets a certain characteristic:
P : P → {true, false},
p → P (p)
The corresponding characteristic set CP defines all points in spacetime visited by particles fulfilling the line predicate P .
CP = { (x, t) ∈ D × I | P (px,t ) = true}
For characteristic sets of streamline predicates is t = ti . By evaluating a line predicate, the flow field (represented by the set of integral lines P) is therefore divided into two disjoint groups (of similar behaviour) which is a simple example of a flow structure. For
blood flow visualization, it is useful to combine several line predicates to more complex queries resulting in more meaningful flow
structures. But here it must be assured that every line is assigned
to one and only one characteristic set. In other words, the chosen
set of line predicates G needs to yield disjoint characteristic sets. A
flow structure is then defined as the partitioning of the flow domain
into these disjoint groups:
P=

C Pγ
γ∈Γ

with an index set Γ. Usually, predicate sets do not yield disjoint
line groups automatically. By defining flow structures (consisting
of predicates PX and PY ) like this, the requirements can still be
met:
G = {PX ∧ PY , PX ∧ PY , PX ∧ PY , PX ∧ PY }

3.3

Line-based and Derived Features

Line predicates can be divided into line-based and derived predicates. They differ in the data that is needed for their evaluation: For
line-based predicates the examined feature depends only on characteristics of the integral line itself. Derived predicates deal with
features detected in the subjacent velocity field or the anatomical
volume dataset. The detection of a derived feature can be reduced
to the evaluation of a point predicate. If a feature is present at a
point x ∈ D, the point predicate P evaluates to true:
P : D ⊂ R → {true, false},
x → P (x)
The result of the point predicate is used as input for the line predicate, i.e., if at time t a line is present at a point x where P (x) =
true, the line predicate resolves to true:

 true
if p(t) = x and P (x) = true
for some t ∈ I,
P (p) =
(1)
 f alse
otherwise.

For the steady case with t = ti and line parameter s:

 true
if p(s) = x and P (x) = true
for some s ∈ I,
P (p) =
 f alse
otherwise.
4

(2)

B LOOD F LOW A NALYSIS

Visualizing flow with streamlines and pathlines is straight-forward
and intuitive, but the large number of lines hinders the insight into
the flow structure. We achieve better overview by grouping the lines
into subsets which can be visualized more comprehensively. As
mentioned before, we use line predicates (introduced in Sec. 3.2)
for this grouping process. The crucial point is to define line predicates that are useful for the physician. Useful means that either a
single or a combination of line predicates results in the display of
flow structures allowing to draw conclusions about the overall flow
behaviour or to answer questions concerning specific flow aspects.
In Sections 4.2 and 4.3, we describe features and the corresponding line predicates that are derived from the input of the domain
experts and, thus, meet this requirement. As a prerequisite for the
predicate approach, several data preprocessing steps are necessary
which are described in the following section.
4.1

Data Preprocessing

With 4D MRI, one acquires a 3D anatomical dataset and the velocity value in 3 directions at every voxel. A dataset covers an averaged cardiac cycle split into 17 - 22 timesteps which corresponds
to a temporal resolution of ∼ 40ms. The spatial resolution is in
the range of about 1.6 × 1.6 × 2.0 mm3 . More details about the
data used in this paper are given in Section 5. To use our flow structure approach on this 4D MRI data, several preprocessing tasks are
necessary.
Vessel Segmentation First, the aorta is segmented, since it
is needed as seed mask for the integral lines and as context for the
visualization lateron. Since the anatomical datasets are not contrastenhanced, the segmentation is done based on the velocity data. For
every voxel, the sum of squares of the absolute velocity value over
all timesteps is calculated. The result is a scalar volume dataset containing the average velocity value for each voxel. Therefore, vessels
appear brighter than areas where no blood flow took place. With a
region-growing approach, the vessels are segmented from this data
and, finally, the aorta is manually separated from the neighboring
vessels.

107

Integral Line Calculation Streamline calculation is carried
out with a DOPRI5 integration [5] for every timestep of the 4D MRI
dataset. To cover the whole aorta and to capture all flow patterns
up to a resolution of at least twice the voxel size, the integration is
started in every voxel of the segmentation mask. Thus, the number of lines is in the range of the number of aorta voxels (∼25000,
depending on data resolution). Integration is not terminated when
the aorta boundary is reached. Instead, after starting the integration
in the aorta, the course of the lines depends only on the quality of
the 4D MRI data. Lines leaving the vessel are a sign of insufficient
data quality and inefficient data preprocessing [21].
Pathlines are also generated with the DOPRI5 integration. We
request that every temporal flow pattern larger than twice the voxel
size is captured by the pathlines. The trivial approach of seeding
a particle in every voxel at every timestep results in a number of
lines that renders the predicate evaluation inefficient. So we reduce
the number of lines as described in [27]: The goal is that for every
timestep at least one particle is present in a voxel. We seed particles
for the complete segmentation mask only in the first timestep. In
the second timestep particles are emitted in voxels unvisited at that
point in time. In order to capture the complete life span of these
additional particles, the integration is done backward and forward
in time. This procedure is repeated for all timesteps until all voxels
are visited in every timestep. Compared to the trivial approach, the
number of lines is reduced by this method by 81-91%.
Both, streamlines and pathlines, are then represented as line
strips and for each vertex the current velocity is recorded. For pathlines, the time when the particle passed this vertex, is stored as well.
Voxelization Derived predicates (see Sec. 3.3) evaluate lines
according to whether they run through voxels with a certain property (e.g., a detected vortex). To avoid unnecessary computations
of intersections of line strips and voxels, a voxel representation of
the streamlines and pathlines is generated in addition to the line
strips. The velocity and time parameter are transferred into voxel
representation by linear interpolation.
Line Parameters For the line-based predicates (see Sec. 4.2),
several line parameters are necessary which are also precomputed for each integral line p (with velocity vi (p) at vertex xi ∈
{0, ..., n}):
• Line length: len(p) =

n
i=1

|xi (p) − xi−1 (p)|

• Maximal velocity: vmax (p) = max(v0 (p), ..., vn−1 (p))
• Mean velocity: v¯(p) =

len(p)
tmax (p)−tmin (p)

4.2 Analysis of Steady Blood Flow
In the context of 4D MRI data, steady blood flow analysis is concerned with the flow situation at a fixed time during the cardiac
cycle. The following streamline predicates allow to structure flow
such that specific features of interest are pointed out.
Region-of-interest (ROI) Predicate An apparent way of
structuring blood flow is by means of flow paths. With the regionof-interest predicate, flow paths are depicted by showing the blood
flowing through an anatomical area. By combining more areas, the
paths of the streamlines can be followed even more closely, e.g.,
from the aorta into the left carotid artery. This predicate evaluates
to true, if the course of a respective streamline crosses the anatomical area, i.e., the streamline and the ROI share at least one voxel.
ROIs are subsections of the segmentation of the examined structure
(e.g., vessel slices). The user identifies a ROI by selecting cutting
planes or free-hand cutting surfaces (i.e., on a 2D slice of the segmentaion a free-hand curve is defined and orthogonally extended
into 3D). A special version of the ROI predicate evaluates whether
the beginning of the line is inside the ROI. This helps to select lines
starting at a specific anatomical area.

108

Vortex Predicate Another main flow feature are vortices,
which are of special interest for blood flow analysis. Vortices
emerging, e.g., in the healthy human aorta or the left ventricle are
rather well-understood [8, 15]. The occurrence of abnormal vortices may therefore be an indication for a pathology and significant
for disease prognosis. Further, blood flow in vortices is slower than
usual. If the velocity falls below a certain threshold, these areas are
likely to develop thrombogenesis, which may have severe complications.
With the vortex predicate, streamlines running through a vortex
can be determined. This way, not only the vortex itself, but the
flow area influenced by the vortex, is identified. A prerequisite for
this predicate is the detection of vortices in the underlying vector
field (derived predicate). Various methods for vortex detection can
be found in literature. For a survey, we refer to [14]. The only
method that has been applied to medical 4D MRI data is the pattern
matching technique by Heiberg et al. [10]. Since the vortex core
line detection by Sujudi and Haimes [31] and the λ2 vortex region
detection by Jeong et al. [13] belong to the standard methods in
CFD simulation data, we decided to examine to what extent they are
applicable with 4D MRI data. These vortex detection methods can
be restated to the evaluation of point predicates, which determine
for each voxel whether a vortex or a vortex core line respectively
is present at this position or not [27]. Based on this, the vortex
predicate Ps,vor itself is evaluated to true, if the streamline traverses
a voxel where the vortex point predicate is fulfilled (see Eq. 1). The
point predicate for the λ2 method [13] is expressed by

 true
if S 2 + Ω2 at position x
P (x) =
has 2 negative eigenvalues,
 f alse
otherwise.

S = 12 (J + J T ) and Ω = 12 (J − J T ) are the symmetric and
asymmetric parts of the vector field’s Jacobian matrix J.
The vortex core line detection by Sujudi and Haimes [31] formulated with the parallel vectors operator by Peikert et al. [24] results
in the following point predicate:

 true
if v(x) (∇v(x))(v(x))and∇v(x)
has complex eigenvalues,
P (x) =
(3)
 f alse
otherwise.

Since 4D MRI data contains more noise than simulation data, it is
most likely that a vortex detection method produces false positives.
Therefore, we combine the previously described techniques: On the
one hand, we detect vortex core lines and discard lines shorter than
30mm (in the case of aorta examinations). On the other hand, we
apply the λ2 -method. Finally, we define a vortex as detected if at a
voxel a core line is present and the λ2 point predicate returns true.
So far, only the vortex core line is detected. The obvious choice
is to determine the vortex region based on the λ2 -result. In practice,
however, this depends on a well-chosen threshold, as 0 does not
always give usable results, especially with measured data. As an
alternative, we considered the dilation of the voxelized vortex core
line by one voxel layer. Comparison of the two possibilities shows
that the results of the vortex predicates do not differ significantly
for the majority of vortices (see Fig. 2) and we therefore apply the
dilation method here. However, further research is needed on this
topic as for very small or very large vortices the regions might be
overestimated or underestimated respectively.
Maximal Velocity Predicate This predicate identifies streamlines with a maximal velocity in a specified interval [v1 , v2 ]. With
[v1 , ∞], e.g., this allows the physician to identify areas with high
velocity, which correspond to the main flow paths. If these fast
flow paths are redirected in the pathological case, the adjoining vessel boundaries are likely to be exposed to higher forces and shear

are queried for whether they flow through the respective area at a
specific time t:
Pp,vor (pa,τ , tr ) =

Figure 2: Result of vortex predicate in the aorta aneurysm dataset
based on λ2 (left) and based on a dilated vortex core line (right).
Color mapping shows mean velocity of a line.

stress which may result in further pathological remodeling. Thus,
these flow paths can be a significant criterion in a therapy decision. The maximal velocity predicate Ps,vmax is line-based, i.e., it
is evaluated according to the precalculated parameter vmax (s) (see
Sec. 4.1) for each streamline s:
Ps,vmax (s) =

true
f alse

if vmax (s) ∈ [v1 , v2 ] ,
otherwise.

(4)

Mean Velocity Predicate Along the lines of the previous
predicate, this function identifies integral lines with a mean velocity in a specific interval [v1 , v2 ]. As a result, areas with a high
average velocity can be distinguished from areas with low average
speed. The respective predicate Ps,¯v is defined analog to Equation 4
and evaluated based on the precalculated mean velocity v¯ of each
streamline (see Sec. 4.1).
Length Predicate The length predicate Ps,len allows to structure the flow according to streamline length and allows to, e.g., filter
out shorter lines, which oftentimes lead to clutter. It identifies lines
with a length in the interval [l1 , l2 ] and is defined analog to Equation 4.
4.3 Analysis of Unsteady Blood Flow
While the steady analysis of a single timestep of the 4D MRI data
allows to explore flow patterns at a fixed point in time, the unsteady
analysis allows to capture the path of flowing particles over time.
As the steady case is a special case of the unsteady flow analysis,
the previously explained predicates can be applied here as well. The
predicates concerned with mean velocity, maximal velocity, line
length, and flow through a region of interest can be adopted without
change. The vortex predicate is transformed into a time-dependent
variant. For the ROI predicate an additional time-dependent version
is also useful. Both are explained in the following.
Time-dependent ROI predicate When inspecting the course
of pathlines, one might be interested in pathlines that flow through
a specific area at a certain time ti . This is, e.g., useful to identify
pathlines seeded in an area at given time and examine their subsequent behaviour by applying further predicates. As in the steady
case, the region of interest is defined by the user and the ROI predicate then determines all pathlines flowing through this area at the
given time ti .
Pp,ROI (pa,τ , ti ) =

true
f alse

if pa,τ (ti ) = x and P (x) = true,
otherwise.

As explained in Section 4.1, for the pathlines a voxelized version is
generated and for each voxel, the time when the respective particles
passes this voxel is available. With this information, the predicate
can be evaluated efficiently.
Time-dependent Vortex Predicate In an unsteady flow field,
the location and shape of vortices change over time. Therefore,
the vortices need to be detected for each timestep and the pathlines

true
f alse

if pa,τ (t) = x and P (x) = true,
otherwise.

Inspecting the influence of a vortex on a pathline over a longer
time is accomplished by combining vortex predicates for subsequent timesteps. Tracking a vortex over several timesteps can be
accomplished geometrically, similar to the volume tracking method
of Silver et al. [30]. This approach is feasible, as the vortices occurring in large vessels are rather low in number, their size is relatively
large compared to the vessel diameter, and they do not dislocate a
lot over time. Still, for future work an application of the method
described by Weinkauf et al. [34] is advisible.
Residence Time Predicate This pathline predicate determines whether a particle spends longer than a specified time span tr
in a predefined area. The residence time of particles in the aorta or
the heart can be used as a measure for the efficiency of the working
heart. Further, long residence times of particles in, e.g., a vortex
region, indicates a higher risk for thrombogenesis. The residence
time predicate Pp,res can be expressed with:

true
if ∃t1 , ∃t2 , (t2 − t1 ) ≥ tr ,


∀t ∈ [t1 , t2 ] ,
Pp,res (pa,τ , tr ) =
Pp,ROI (pa,τ , t) = true,


f alse
otherwise.

As with the steady blood flow analysis, the previously described
predicates can be freely combined. When defining the flow structure with a set of predicates, it is important to make sure that the
resulting characteristic sets are disjoint (see Sec. 3.2).
4.4 Flow Structure Visualization
The line bundles resulting from the predicate evaluations are visualized in the context of the corresponding aorta mesh and the anatomical MRI slice data. The integral lines are rendered as color-coded
tubes. The color-coding represents either the line’s mean velocity,
the change of the velocity or the line parameter along the line. The
latter encoding gives information about the flow direction in case
this may not be clear from the context. Despite of the perceptual
disadvantages of the rainbow color map, it is still the common way
of depicting line parameters in medical software and publications.
Not following this convention, but the advice of Silva et al. [29],
we decided on a diverging map ranging from orange (small values)
to purple (large values). To show the course of lines over time, it
is also possible to display not the complete line but only segments
according to the line parameters s (for streamlines) and time t (for
pathlines) (see Fig. 4).
Rendering single line groups directly is appropriate in many
cases as this results in a compact representation emphasizing the
shape of the flow fulfilling a certain property. However, when occlusion hinders insight in more complex flow, the reduction of lines
is necessary. Here, it is important that the thinned line bundle still
represents the flow behaviour of the original bundle. For this, we
applied the deterministic streamline placement method as described
in [25]. The skeleton of the voxel representation of the bundle’s
characteristic set is generated with the topology-preserving thinning approach by Pal`agyi and Kuba [23]. Then the minimal set of
integral lines visiting all skeleton voxels is calculated. So, for every
line the number of visited skeleton voxels are determined and the
line with the maximal number of visits, is included in the thinned
bundle. This is repeated for the remaining lines until all skeleton
voxels are visited by at least one line (see Fig. 3(b) for an example).
If only the area of the identified flow is of interest or to achieve
a less dense representation if several line groups are visualized, it
is possible to show line groups as isosurfaces. Here, the surface of

109

(a)

(b)

(c)

(d)

Figure 3: Healthy aorta (a,b). (a) Yellow isosurface represents the union of all streamlines running through the vortex in the ascending aorta.
Yellow lines are a subset running also through the vortex in the descending aorta. The color-coded streamlines through the arch vortex are
outside this isosurface and, thus, do not interact with the ascending vortex. (b) Characteristic set of streamlines starting at the ROI (white
arrow) and running through vortex in the descending aorta reveal retrograde vortical flow in late systole. Distorted aorta dataset (c,d). Pathlines
. (c) Velocity color mapping reveals these areas of fast flow. (d) Time color
representing particles which are at some point faster than 130 cm
s
mapping shows at what time during the cardiac cycle the velocity was high. Note also the left-handed swirl developing further downstream of the
bent in late systole.

the voxelized characteristic set is displayed transparently and thus
allows to overcome occlusion (see Fig. 3(a)).
We implemented the line predicate approach as a scene graph
addition to our medical visualization framework. The predicates
are represented by separate scene graph nodes, which can be combined freely by drag-and-drop during run-time. Except for the userdefined predicate parameters (e.g., velocity of interest), no parameter adjustment is necessary.
5

A PPLICATION AND R ESULTS

In this section, we discuss the application of our line predicate
method to 4D MRI aorta datasets of one healthy volunteer and two
patients with different pathologies. As a full discussion of each
dataset is beyond the scope of this paper, we present selected features of each case. The datasets were preprocessed as introduced
in [2, 20]. After that, aorta segmentation, precalculation of integral lines, as well as vortex detection is accomplished as described
previously. For a typical 4D MRI dataset, the complete preprocessing (until the predicates can be applied to the data) takes around
1.8 hours wherein only for the segmentation task explicit user interaction is needed. This time can be reduced, e.g., with a GPUacceleration of the line integration which we have not implemented
yet. The evaluation of predicates is done in real-time. However, for
the derived predicates (e.g., ROI predicate) a delay in the order of
seconds occurs depending on the number of lines being processed.
5.1

Healthy Aorta

Using the example of the 4D MRI (spatial resolution: 1.67 ×
1.67 × 2.2 mm3 ; temporal resolution: 40.8 ms; 17 timesteps; ve)
locity sensitivity (maximal velocity that can be measured): 150 cm
s
of a healthy volunteer, we examine typical flow patterns occurring in the aorta during a cardiac cycle. It is known, e.g., that a
right-handed vortex forms in the healthy ascending aorta during
systole [3, 12, 15]. In the present dataset, two other vortices develop in the descending aorta at t = 100ms (one close to the arch,
one further downstream). Applying vortex predicates to streamlines
reveals the interplay of these three vortices at a specific timestep.
The yellow isosurface in Figure 3(a) represents the characteristic
set of the vortex predicate for the ascending vortex, i.e., all streamlines flowing through this vortex are within this surface. The color-

110

coded streamlines result from the vortex predicate for the arch vortex. These lines are outside the characteristic set of the ascending vortex. This indicates that these vortices do not interact at this
timestep. We can confirm this finding by evaluating the combined
vortex predicate for the ascending and the arch vortex which results in an empty characteristic set. The yellow streamlines display
a subset of streamlines flowing through the ascending and the descending vortex. Exploring the interaction of vortices as shown here
for the steady or unsteady provides insights into the overall flow behaviour, which is not possible with current methods yet.
During end systole (at around t = 300ms) rotating and retrograde flow evolves in the healthy aorta, especially in the descending
part [3, 12, 15]. Figure 3(b) shows streamlines involved in the descending vortex at t = 350ms that are starting in the depicted ROI
(white arrow). This reveals the course of reverse flow in the vortex.
Again, we have an advantage to current methods. In addition to the
possibility to inspect reverse flow by starting integral lines from a
2D cross-section, we can select and visualize the reverse flow in a
specific vortex. Other subsets as the reverse flow into an anatomical
region of interest or the like are also thinkable and useful.
5.2

Distorted Shape in Descending Aorta

This 4D MRI (spatial resolution: 1.67 × 1.67 × 2.2 mm3 ; temporal resolution: 40.8 ms; 22 timesteps; velocity sensitivity: 150 cm
)
s
of a female patient (72 years) was acquired after an MRI revealed
an uncommonly bent shape of the descending aorta. This distortion
leads to changes in the blood hemodynamics compared to a healthy
aorta [18]. A consequence of the kink is, e.g., an increase in velocity. Flow with unusual high velocity occurring at any time during
the cardiac cycle can be easily identified with a maximal velocity
predicate applied to the complete pathline set. In this dataset, this
predicate reveals an (expected) high-speed flow at the proximal ascending aorta where the blood enters from the left ventricle (purple
arrow in Fig. 3(c)) and the aforementioned area of high velocity at
the kink in the descending aorta (yellow arrow in Fig. 3(c)). To
find out in what phase of the cardiac cycle the high velocities occur,
the line color mapping can be switched from velocity to time (see
Fig. 3(d)). Thus, we provide a method to quickly identify the flow
with unusually high velocity. With this information, these areas can
be further inspected with streamlines of the respective timesteps or

Figure 4: Vortex in the proximal descending aorta of the 4D MRI of the distorted aorta. Pathlines run through the evolving vortex at t = 102ms.
The dark line represents the vortex core line at t = 102ms, the light blue line (leftmost image) represents the core at t = 347ms. The remaining
images show the course of the pathlines from seeding time until (from left right) 140ms, 200ms,300ms, 350ms ,500ms, 600ms, 700ms.

2D analysis planes, for example.
A further specialty of this dataset is a vortex in the proximal
descending aorta [18], which is depicted in Figure 4. A timedependent vortex predicate identifies pathlines running through the
vortex area detected in the third timestep of this dataset (t =
102ms). The single images show the swirling of the pathlines
around the core and the temporal development of the vortex.
We are certain that the structuring of the flow according to vortical flow and velocity as presented in this section, is not possible
with other methods yet.
5.3

can then be subdivided by means of one ROI predicate for each
branching vessel (see Fig. 1(a,b)). It can be learned from the result
that, e.g., blood entering at the ventral part of the aorta flows into
the left carotid artery, that parts of the vortical flow in the ascending
aorta find the way in the brachiocephalic artery, and that a considerable vortex evolves at the entry to the left subclavian artery. With
current methods, findings like these are only possible by observing
a larger number of pathlines over time and visually detecting the
interesting patterns. However, it is not possible to preselect and visualize only the lines that are of interest, i.e., that flow into a certain
region, as we provide it here.

Aneurysm in Descending Aorta

This patient (19 years, male) underwent surgical repair of aortic
coarctation several years ago. During a regular follow-up with
MR angiography the development of a postoperative aneurysm in
the descending aorta had been observed, which was further examined with 4D MRI (spatial resolution: 1.77 × 1.77 × 2.6 mm3
; temporal resolution: 40 ms; 20 timesteps; velocity sensitivity:
150 cm
) [7].
s
In the aneurysm a strong vortex prevails and influences the flow
patterns in the whole aorta. Since the vortex takes up the whole
aneurysm over large portions of a cardiac cycle, it is interesting to
analyze to what extent the blood flow is interrupted by this. The
residence time of the particles in this vortex is a measure for the,
probably decreased, efficiency of the blood transport and is very
likely to correlate with the risk of blood clot development. We can
examine this aspect with the residence time predicate. We preselect all pathlines of a certain minimum length (length predicate
with l1 = 10cm and l2 = ∞) crossing a region of interest in
the aortic arch during the second timestep (time-dependent ROI
predicate). This set of pathlines is then divided into lines residing in the aneurysm for more or less than 150ms respectively (see
Fig. 1(c)). With the residence time predicate, we could also identify a large number of particles staying in the aneurysm for more
than 300ms which corresponds to the duration of an average systole (not shown). ROI definition, predicate evaluation, and visualization take no longer than 2min altogether and allow insight into
the residence times of particles and their paths. This information is
of interest when assessing the risk of blood clot development.
For the estimation of the risk of an aneurysm rupture, highvelocity jets are of interest. The application of the mean velocity
predicate to streamlines at t = 180ms shows the high-velocity
flow faster than 80 cm
during that timestep (see Fig. 1(d)). Here,
s
it is especially interesting that these fast streamlines are directed at
the aneurysm wall which is an indication of high forces on the vessel boundary. This flow behaviour is likely to be connected to the
aneurysm development.
Further, we show how line predicates can be used to inspect flow
into the main branches of the aortic arch. Assuming that we want to
inspect the flow of particles entering the aorta during early to midsystole, we select a ROI at the proximal ascending aorta and apply
the time-dependent ROI predicate (t = 100ms). These pathlines

6

D ISCUSSION AND C ONCLUSION

4D MRI is a relatively new imaging modality which has the potential to significantly enhance diagnostics and therapy of cardiovascular diseases. One of the remaining challenges, however, is to overcome problems in the data analysis, which still requires a lot of time
and expert knowledge. Authors have asked for more automated and
standardized visualization techniques to open the door for the application of 4D MRI in the clinics or for larger patient studies [21].
This request incorporates methods which are capable of allowing
the physician to gain a quick overview of the main characteristics
and any anomalities of the respective dataset. We believe that the
development of methods illustrating the overall flow behaviour in
3D is an important step towards this goal.
Our approach is based on the fact that the main behaviour of a
flow field is encoded in its full set of integral lines. To make the
flow visualization more comprehensible, we segment these lines
into groups of similar behaviour. For this grouping, we adapted the
line predicate approach by Salzbrunn et al. [26, 27] which allows
to structure integral lines according to certain characteristics and to
combine these queries flexibly. We defined line predicates based on
the physicians’ needs. Thus, they are concerned with, e.g., velocity,
anatomical passage areas, and vortices. With our method, users can
freely combine these predicates and create flow structures answering their questions about the current dataset. With that, we provide
a better insight into the main flow characteristics of 4D MRI data
than other methods presented in literature so far.
Current analysis techniques that rely on the seeding of integral
lines from 2D planes have two major problems. First, the seeding
pattern on the plane strongly influences the features that can be detected. Second, the tracking of all integral lines leads to clutter and
makes it difficult to spot the interesting aspects. With our approach,
the seeding problem does not evolve and the clutter problem is reduced by the grouping of lines according to similar properties.
The discussion of the results with a 4D MRI expert revealed several advantages and potential improvements of our line predicate
approach. The reliable and automated in vivo identification of secondary flow patterns was considered one of the main benefits, since
it may help identify patients with a high risk of developing vascular complications. Especially, the detection of vortices and helical
flow was mentioned as an advancement compared to current anal-

111

ysis methods. Further, it was positively valued that the visualization of altered hemodynamics and the possible correlation to cardiovascular pathologies in clinical studies may contribute to the understanding of the mechanisms leading to disease development. It
was emphasized that previous in vivo flow studies relied mostly on
purely visual analysis and manual definition of regions of interest.
In contrast to this, our approach is considered helpful for the improvement of this procedure by systematically identifying regions
with irregular flow. Concerning the visualization, the simultaneous
display of multiple information by showing several line bundles and
color-codings was regarded as an improvement of the flow depiction. Our decision to rely on static renderings was supported as
animations are difficult to introduce in a potential clinical setting.
Finally, the expert suggested standardized color maps for the different quantitative information (line parameters, residence times)
and emphasized that automatic methods would decrease the interobserver variability of the findings. Automatic analysis could be
achieved by introducing predefined predicate combinations.
There are many starting points for future work. Line clutter
could be further decreased by displaying a line bundle’s representative flow behaviour and direction by more abstract methods. As
this approach is limited to the detection of features covered by the
predicates, more predicates can become necessary when examining
other anatomical structures. So, the development of new predicates
and the design of the aforementioned standardized flow visualizations are thinkable. Finally, the analysis is mainly qualitative so
far, which helps in gaining overview and understanding the data’s
overall flow dynamics. Still, for diagnostics and therapy decisions
quantitative flow measures are necessary as well. We are confident that our method is suited for an expansion towards a combined
qualitative and quantitative analysis of 4D MRI data.
R EFERENCES
[1] A. Barker, J. Bock, R. Lorenz, and M. Markl. 4D flow MR imaging.
Am J Neuroradiol, 18:46–52, 2010.
[2] J. Bock, A. Frydrychowicz, A. F. Stalder, T. A. Bley, H. Burkhardt,
J. Hennig, and M. Markl. 4D phase contrast MRI at 3T: Effect of
standard and blood-pool contrast agents on SNR, PC-MRA, and blood
flow visualization. Magn Reson Med, 63(2):330–338, 2010.
[3] H. G. Bogren and M. H. Buonocore. 4D magnetic resonance velocity mapping of blood flow patterns in the aorta in young vs. elderly
normal subjects. J Magn Reson Imaging, 10(5):861–869, 1999.
[4] M. H. Buonocore. Visualizing blood flow patterns using streamlines,
arrows, and particle paths. Magn Reson Med, 40(2):210–226, 1998.
[5] J. R. Dormand and P. J. Prince. A family of embedded Runge-Kutta
formulae. J Comput Appl Math, 6(1):19–26, 1980.
[6] J. Eriksson, C. J. Carlh¨all, P. Dyverfeldt, J. Engvall, A. F. Bolger, and
T. Ebbers. Semi-automatic quantification of 4D left ventricular blood
flow. J Cardiovasc Magn R, 12(1):9, 2010.
[7] A. Frydrychowicz, R. Arnold, D. Hirtler, C. Schlensak, A. F. Stalder,
J. Hennig, M. Langer, and M. Markl. Multidirectional flow analysis
by cardiovascular magnetic resonance in aneurysm development following repair of aortic coarctation. J Cardiovasc Magn R, 10(1):30,
2008.
[8] A. Fyrenius, L. Wigstrom, T. Ebbers, M. Karlsson, J. Engvall, and
A. Bolger. Three dimensional flow in the human left atrium. Heart,
86(4):448–455, 2001.
[9] R. Gasteiger, M. Neugebauer, C. Kubisch, and B. Preim. Adapted surface visualization of cerebral aneurysms with embedded blood flow
information. Eurographics Workshop on Visual Computing for Biology and Medicine, pages 25–32, 2010.
[10] E. Heiberg, T. Ebbers, L. Wigstrom, and M. Karlsson. Threedimensional flow characterization using vector pattern matching.
IEEE T Vis Comput Gr, 9(3):313–319, 2003.
[11] E. Heiberg, J. Sj¨ogren, M. Ugander, M. Carlsson, H. Engblom, and
H. Arheden. Design and validation of Segment - Freely available software for cardiovascular image analysis. BMC Med Imaging, 10:1,
2010.

112

[12] T. A. Hope, M. Markl, L. Wigstr¨om, M. T. Alley, D. C. Miller, and
R. J. Herfkens. Comparison of flow patterns in ascending aortic
aneurysms and volunteers using four-dimensional magnetic resonance
velocity mapping. J Magn Reson Imaging, 26(6):1471–1479, 2007.
[13] J. Jeong and F. Hussain. On the identification of a vortex. J Fluid
Mech, 285(-1):69–94, 1995.
[14] M. Jiang, R. Machiraju, and D. Thompson. Detection and visualization of vortices. In C. D. Hansen and C. R. Johnson, editors, The
Visualization Handbook, chapter 14, pages 295–309. Academic Press,
2005.
[15] P. J. Kilner, G. Z. Yang, R. H. Mohiaddin, D. N. Firmin, and D. B.
Longmore. Helical and retrograde secondary flow patterns in the aortic arch studied by three-directional magnetic resonance velocity mapping. Circulation, 88:2235–2247, 1993.
[16] P. J. Kilner, G. Z. Yang, A. J. Wilkes, R. H. Mohiaddin, D. N. Firmin,
and M. H. Yacoub. Asymmetric redirection of flow through the heart.
Nature, 404(6779):759–761, 2000.
[17] H. Krishnan, C. Garth, J. Guhring, M. A. Gulsun, A. Greiser, and K. I.
Joy. Analysis of time-dependent flow-sensitive PC-MRI data. IEEE T
Vis Comput Gr, 17(11), Apr. 2011.
[18] M. Markl. Marked three-dimensional flow pattern changes in distorted
aortic geometry. Eur Heart J, 32(6):679, 2011.
[19] M. Markl, F. P. Chan, M. T. Alley, K. L. Wedding, M. T. Draney, C. J.
Elkins, D. W. Parker, R. Wicker, C. A. Taylor, R. J. Herfkens, and N. J.
Pelc. Time-resolved three-dimensional phase-contrast MRI. J Magn
Reson Imaging, 17(4):499–506, 2003.
[20] M. Markl, A. Harloff, T. A. Bley, M. Zaitsev, B. Jung, E. Weigang,
M. Langer, J. Hennig, and A. Frydrychowicz. Time-resolved 3D MR
velocity mapping at 3T: Improved navigator-gated assessment of vascular anatomy and blood flow. J Magn Reson Imaging, 25(4):824–
831, 2007.
[21] M. Markl, P. J. Kilner, and T. Ebbers. Comprehensive 4D velocity
mapping of the heart and great vessels by cardiovascular magnetic
resonance. J Cardiovasc Magn R, 13(7), 2011.
[22] M. Neugebauer, G. Janiga, O. Beuing, M. Skalej, and B. Preim.
Anatomy-guided multi-level exploration of blood flow in cerebral
aneurysms. Comput Graph Forum, 30(3):1041–1050, 2011.
[23] K. Pal`agyi and A. Kuba. A 3D 6-subiteration thinning algorithm for
extracting medial lines. Pattern Recogn Lett, 19(7):613–627, 1998.
[24] R. Peikert and M. Roth. The parallel vectors operator: A vector field
visualization primitive. IEEE Visual, pages 263–270, 1999.
[25] T. Salzbrunn. Flow visualization and analysis based on integral line
predicates. PhD thesis, University of Leipzig, 2008.
[26] T. Salzbrunn, C. Garth, G. Scheuermann, and J. Meyer. Pathline predicates and unsteady flow structures. Visual Comput, 24(12):1039–
1051, 2008.
[27] T. Salzbrunn and G. Scheuermann. Streamline predicates. IEEE T Vis
Comput Gr, 12(6):1601–1612, 2006.
[28] K. Shi, H. Theisel, H. Hauser, T. Weinkauf, K. Matkovic, H.-C. Hege,
and H. P. Seidel. Path line attributes - An information visualization
approach to analyzing the dynamic behavior of 3D time-dependent
flow fields. In H.-C. Hege, K. Polthier, and G. Scheuermann, editors,
TopoInVis, Mathematics and Visualization, pages 75–88, 2009.
[29] S. Silva, B. Sousa Santos, and J. Madeira. Using color in visualization:
A survey. Comput Graph, 35(2):320–333, 2011.
[30] D. Silver and X. Wang. Volume Tracking. In IEEE Visual, volume D,
pages 157–164. IEEE Computer Society Press, 1996.
[31] D. Sujudi and R. Haimes. Identification of swirling flow in 3D vector
fields. Technical Report AIAA Paper 95–1715, American Institute of
Aeronautics and Astronautics, 1995.
[32] R. van Pelt, J. O. Besc´os, M. Breeuwer, R. E. Clough, M. E. Gr¨oller,
B. T. H. Romenij, and A. Vilanova. Interactive virtual probing of 4D
MRI blood-flow. IEEE T Vis Comput Gr, 17(12):2153–62, Dec. 2011.
[33] R. van Pelt, J. Oliv´an Besc´os, M. Breeuwer, R. E. Clough, M. E.
Gr¨oller, B. ter Haar Romeny, and A. Vilanova. Exploration of 4D
MRI blood-flow using stylistic visualization. IEEE T Vis Comput Gr,
16:1339–1347, 2010.
[34] T. Weinkauf, J. Sahner, H. Theisel, and H.-C. Hege. Cores of
swirling particle motion in unsteady flows. IEEE T Vis Comput Gr,
13(6):1759–1766, 2007.

