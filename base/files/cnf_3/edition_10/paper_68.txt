Colour correction for panoramic imaging
Gui Yun Tian Duke Gledhill Dave Taylor
The University of Huddersfield
David Clarke
Rotography Ltd
Abstract: This paper reports the problem of
colour distortion in panoramic imaging.
Particularly when image mosaic is used for
panoramic imaging, the images are captured under
different lighting conditions and viewpoints. The
paper analyses several linear approaches for their
colour transform and mapping. A new approach of
colour histogram based colour correction is
provided, which is robust to image capturing
conditions such as viewpoints and scaling. The
procedure for the colour correction is introduced
and implemented. The conclusions are derived
after experimental tests.

compensation algorithms in modern cameras don’t
work well.

1. Introduction
Panoramic images are used as a computerised
“virtual view” visualisation of the real world. A
panorama can show a user the 3D environment of
a different location. For example if a person goes
on holiday, they might capture a panorama of their
holiday location and then show that to people
back home whom could then visualise the holiday
as though they themselves had been there. Some
other uses for panoramas involve virtual
environment visualisation, real estate, tourism,
sporting and news events.
Panoramas are usually built from multiple
images captured at a single location. Examples of
captured images might be 15 images captured in a
cylindrical format using a standard 35mm camera
rotated about the optical centre of the camera, or 2
hemispherical images captured using a 180° field
of view fisheye lens, one in each direction. The
images that are captured have to be “stitched”
together to form the final panoramic image.
Unfortunately when capturing the images, the
automatic exposure control in cameras can and
does change the exposure between captures. This
translates into a possible underexposed dark
image and the next in the sequence being an
overexposed bright image. Examples of
differently exposed images are shown in Fig. 1.
Particularly,
some
automatic
embedded

Fig.1 Two Panoramic source images with
different exposures by the same camera
Image stitching for panoramas will apply the
individual images with overlap [1-2] or without
overlap from video sequences to integrate together
[3]. In reality, the source images may be from
different cameras, which are normally not
calibrated or difficult to calibrate [4]. To be
stitched properly, linear transforms have been
used for geometric mapping and colour mapping
[1-2]. There are many papers that discuss
correspondence point based homography for
geometric transform and correction [5-9]. But the
reports on colour transform and correction, which
is important to human perception, are ignored in
panoramic imaging. In this paper, we will
investigate the colour transformation and colour
correction among panoramic images. The rest of
the paper is organised as: Section 2 discusses the
colour transform among two images and their
colour correction; Section 3 provides a new
approach of histogram based colour correction for
image stitching for panoramas; Section 4
introduces experimental results using different
line transform for colour correction and their
results on panoramas; Finally, some conclusions
will be derived from the discussion.

Proceedings of the Sixth International Conference on Information Visualisation (IV’02)
1093-9547/02 $17.00 © 2002 IEEE

2. Colour
constancy

correction

and

colour

The digital camera records large shifts in
image colours under different illuminations.
However, a human observer viewing each scene
will be able to discount the colour of the
illumination and perceive the colours in each
scene as the same. This property of compensating
for illumination is called colour constancy [10].
Colour constancy is a subconscious colour
correction that all humans have. In the study, we
try to overcome the problem of colour distortion
by capturing images under different lighting or
different camera properties by linear colour
correction. To do this, we need to understand the
principle of colour variation between the two
images.
The machine colour constancy problem can
be defined as follows. First, chose some
illumination as the standard, or canonical,
illumination. The choice of canonical illumination
matters little so long as it is not unusual. Then
consider the 3 band RGB image obtained by any
standard colour camera of a scene under some
other, unknown illumination. The machine colour
constancy problem requires converting the RGB
at every pixel to be what it would have been had
the same scene been illuminated by the canonical
illumination. In this way, all the RGB values in
the image of the scene measured under the
unknown illumination are converted to
standardized RGB descriptors relative to the
canonical illuminant. Once these standardized
descriptors have been obtained, they can be used
for object recognition or for creating an image of
the scene as it would appear under some other
illuminant. The key to solving this problem is
discovering the colour of the unknown
illumination.
Two well-known colour constancy methods,
which work under limited circumstances, are the
grey world algorithm and the white patch
algorithm. The grey world algorithm assumes that
the average of all colours in an image is grey, i.e.
the red, green and blue components of the average
colour are equal. The amount the image average
differs from grey determines the illuminant RGB.
The white patch algorithm, which is at the heart of
many of the various retinex [11] algorithms,
presumes that in every image there will be some
surface or surfaces such that there will be a point
or points of maximal reflectance for each of the R,
G, and B bands.

For example left image in Fig.1 might want to
have the same lighting as the right image, which is
what human vision systems do. A common
approach to colour constancy is the use of the
estimation illumination to correct the images to a
canonical light. Finlayson et al [12] suggested that
if a transform is linear, a diagonal model might be
sufficient to model the colour transform.
Generally colour cameras are tri-chromatic, which
means in a colour image, each pixel is a 3 vector,
one component per sensor channel and works
independently. However, with the increasing
colour fidelity, more accurate transform will be
required [13]. Different linear colour transforms,
where the colour variation may be caused by
lighting, viewpoints or capturing devices, are
discussed as follows. The transform Matrix M
cross images I1 and I2 can be represented as

I1 * M = I 2

(1)

1) Diagonal model
α
M = 


α=



β

γ 

(2)

mean( R2 )
, where R is the red channel
mean( R1 )

image intensity values in the two images. β and
γ are similar for green and blue channels.
General features:
• Simple, not accurate enough
• Based on greyworld principle and does not
need same pixels in the 2 images
2) Diagonal model plus affine transform

α
M = 


α , β ,γ

α1 
β
β 1 
γ γ 1 

(3)

and offset α 1 , β 1 , γ 1 can be obtained
from polyfit in the individual channels.
General features:
• More accurate than diagonal model
• Two images have the same corresponding
pixels

Proceedings of the Sixth International Conference on Information Visualisation (IV’02)
1093-9547/02 $17.00 © 2002 IEEE

3) Linear model
a
M =  d
 g

c
f 
i 

b
e

(4)

h
Where can be computed by

[

T

]

−1

T

M = I1 I1 I1 I 2
(5)
Where I 1 , I 2 is [n, 3] matrix and n is the number
of pixels in the images.
General features:
• Good accuracy
• Need the same corresponding pixels in both
images
• Computationally expensive
4) Linear model with affine:
a b
M = d e
 g h

c
f
i

a1 
e1 
i1 

(6)

In addition to equation (5), the offset can be
obtained by

a1   mean( R2 )   a b
 e  = mean(G ) − d e
2 
 1 

 ii   mean( B2 )   g h

c   mean( R1 ) 
f  × mean(G1 )
i   mean( B1 ) 

affecting image development and subsequent
scanning. Even worse, many exposure related
factors are outside the control of the photographer
like automatic exposure settings in some cameras
and scanners, or scanning services To balance two
stitching images, some colour correction is
required. The normal approach applies the
overlapping region of an image for estimating a
colour transform matrix [15]. Due to the variation
of capturing conditions such as camera resolution,
noise and viewpoints, the pixels in the
overlapping area are difficult to correspond to
each other. In other words, the overlapping areas
in two images may have different pixels due to
variations of viewpoints and scaling. The
difference of colour values at identical locations is
not a very suitable optimization criterion. Real
world images never fit together perfectly, and
unavoidable spatial errors of one pixel or more
between image 1 and image 2 may completely
screw the optimization.
To be independent of the spatial alignment of
the images and apply general linear models (over
3 parameters in the transform matrix), we use the
matching of histograms of colours in the
overlapping region of images 1 and 2. Fig 2
illustrates the step 1 process of our approach. A,
B, C, D and A’, B’, C’, D’ are corresponding
points in the two images I1 and I2, in which the
maximising overlapping area is covered.

(7)
The general features are the same as the linear
model in 3).
As described above, to obtain better colour
correction, more parameters in linear transforms
will be used. We will use and compare diagonal
model plus affine transform, linear model and
linear model plus affine for colour correction in
image correction for the panorama.

3. Histogram
correction

map

based

Overlapping area
A

B

I1
B’

A’
C

I2

D

colour

Colour and brightness variations often make it
difficult to combine photographs into panoramic
images [14]. The individual source images remain
distinguishable. This effect counteracts any effort
to improve panorama resolution by using many
photographs as sources. There are several origins
for these variations even if the photographer takes
care to keep constant exposure for each image: 1)
Change of lighting conditions during the photo
session; 2) Shutter speed variations; 3) Many
more random and non reproducible parameters

C’

D’

Step1 Find maximising overlapping
area in the two stitching images
Fig 2 Step 1 of the new approch of color
correction
As illustrated in Fig 3, the overlapped areas may
have different histograms. We can map the
histogram, where A1B1C1D1 area has the same
‘geometrical content’ as ABCD in image I1 but
has the same histogram as A’B’C’D’ in image I2.
Then, in Step 3, we can apply the histogram

Proceedings of the Sixth International Conference on Information Visualisation (IV’02)
1093-9547/02 $17.00 © 2002 IEEE

A

mapped image for estimating colour transform
matrix M, where A1B1C1D1 and ABCD areas
have
same
image
pixels
with
good
correspondence. The transform matrix can be
calculated by any linear transform as described in
section 2. Finally, we can apply the transform
matrix for the entire image I1 or I2 colour
calibration, as shown in Fig 4.

B

C

D
Estimating the
transform
matrix M

A1

C1
A

B

C

B1

D1

Colour correction for
the stitching images
by M
D

I1

Histogram from overlap region of I1

A’

Step3 Estimating the transformation
matrix and using it two stitching
images

B’

C’

D’

I2

Fig 4 Linear transform matrix estimation and
colour correction before image stitching and
panorama

Histogram from overlapping region of I2

4. Colour correction for panoramic
imaging

A1

Based on the above-proposed approach, we
have applied it for panoramic source image colour
corrections. Fig. 5a illustrates the overlapping area
from two stitching images in Fig 1. A histogram
map will be applied to the two overlapped images.
Then, following the steps described in sections 2
and 3, transform matrixes can be estimated by
different linear models. Finally, apply the
transform matrix for colour correction and image
stitching. Fig 5b shows the colour corrected
images to image 1 or image 2 capturing
conditions.
At the end of the paper, Fig 6 illustrates four
panoramic images with the proposed colour
correction approach. Linear transformation which
considers the correlation of RGB channels can
provide slight better results. However, the
diagonal model plus affine transform can provide
near perfect results.

C1

B1

D1
Histogram mapped image for
overlapping region of I1, whose
histogram is equal to the overlapping
region in I2

Step2 Histogram mapping over the
overlapping areas

Fig 3 Step 2 of new approch of color correction

Proceedings of the Sixth International Conference on Information Visualisation (IV’02)
1093-9547/02 $17.00 © 2002 IEEE

a) Overlapping area of the stitching images in Fig
1

is better than the diagonal model. A histogram
map based colour correction has been proposed
and tested. The major advantages of
the
histogram mapping approach for colour correction
are robust to capturing devices, viewpoints and
scales. In other words, the new approach has
overcome the problems for stitching images
variation including not only colour, but also
resolution, view geometry and noise. Different
colour correction based different linear
transformations can be used in the proposed
approach. The choice of linear transformation
matrix for colour correction can be affected by the
accuracy and computing time. The diagonal model
plus affine can provide near perfect results as
general linear models. In the future, more
panoramic imaging will be tested and evaluated.

6. Acknowledgement
The authors would like to thank EPSRC and
Rotography Ltd for funding the work.

7. References
1.

2.
3.
4.

5.
6.

b) Colour correction based on M or M-1
Fig 5 Histogram based colour correction for
image stitching pre-process

5. Conclusions

7.
8.

9.

Colour correction for image mosaic based
panoramic imaging is important. Several colour
linear transformations have been discussed. The
performance of linear models for colour correction

Proceedings of the Sixth International Conference on Information Visualisation (IV’02)
1093-9547/02 $17.00 © 2002 IEEE

R. Szeliski and H. Shum, “Creating full view
panoramic image mosaics and environment maps”,
Computer
Graphics
Proceedings,
Annual
Conference Series, pages 251-258, Proc.
SIGGRAPH'97 (Los Angeles), August 1997
G. Y. Tian, D. Gledhill and D. Taylor, “Interest
points based comprehensive imaging mosaic”, to
submit to the Journal of Pattern Recognition Letter
Y. Caspi and M. Irani, “Alignment of NonOverlapping Sequences”, the proceedings of ICCV
2001 volume II, pages 76-83.
Q. T. Luong and O. D. Faugeras, “Self-calibration
of a moving camera from point correspondences
and fundamental matrices”, Int. J. of Computer
Vision, 22(3), 261-289, 1997.
R. Szliski, “Video mosaics for virtual
environments”. IEEE Computer Graphics and
Applications 1996; 22-30.
R. Szeliski, H. Y. Shum, “Creating Full View
Panoramic Image Mosaics and Environment
Maps”, (1998).
L. Zhao and Y. H. Yang, “Mosaic image method: a
local and global method”, The IEICE Transactions
Information and Systems.
P. Bao and D. Xu, “Complex wavelet-based image
mosaics using edge-preserving visual perception
modelling”, Computers & Graphics 23 (1999), pp
309-321.
I. Zoghlami, O. Faugeras and R. Deriche, “Using
geometric corners to build a 2D mosaic from a set
of images”, In Proc. IEEE Conference on Computer
Vision and Pattern Recognition, pages 420--425,
San Juan, PR, June 1997.

10. http://www.cs.sfu.ca/~colour/research/colourconstancy.html
11. E. H. Land, and J. J. McCann, “Lightness and
retinex theory” , J. Opt. Soc. Am, 61:1-11, 1971.
12. G. Finlayson, M. Drew, and B. Funt, “Color
Constancy: Generalized Diagonal Transforms
Suffice”, J. Opt. Soc. Am. A, 11(11):30113020,1994
13. B. V. Funt, and B. C. Lewis, "Diagonal versus
Affine Transformations for Color Correction"

a)

Journal of the Optical Society of America A, Vol
17, No. 11, Nov. 2000.
14. http://www.panoguide.com/technique/colour_correc
tion.html
15. http://www.fhfurtwangen.de/~dersch/cbcorrect/cb.html
16. http://www.path.unimelb.edu.au/~bernardk/tutorials
/360/technical/ colour01.htm

Mini panorama without colour correction processing

b) Minipanorama using dialoganl model plus affine colour correction

d) Mini panorama with linear correction pre-processing

e) Mini panorama with linear plus affine correction pre-processing
Fig 6 Different colour correction for panoramic imaging

Proceedings of the Sixth International Conference on Information Visualisation (IV’02)
1093-9547/02 $17.00 © 2002 IEEE

