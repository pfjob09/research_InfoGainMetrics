A Novel Method for Accelerating the Visualisation Process
Used in Virtual Colonoscopy
M. Sharghi
Department of App,!ied Computing,
University of Dundee,
Dundee DD14HN,
Scotlana', UK
msharghi @ computing.dundee.ac.uk

I. W. Ricketts
Department of Applied Computing,
University of Dundee,
Dundee DDI 4HN, '
Scotland, UK
ricketts @computing.dundee.ac.uk

Abstract

of colorectal cancer varies with age, race and gender, it is
a major source of morbidity and mortality in all countries.
Early detection of cancer significantly increases the
chances of survival. Unfortunately, early-stage colorectal
cancer usually produces few if any symptoms and
therefore early detection relies on population screening.
According to one long-term study, regular screening for
colorectal cancer can decrease mortality by one third [3].
There are five different clinically approved and widely
used colon screening methods, which are digital rectal
examination, faecal occult blood test, barium enema,
sigmoidoscopy, and colonoscopy. The American Cancer
Society guidelines recommend annual testing for
colorectal cancer for everyone over the age of 50. The
National Cancer Institute recommends regular screening
for all residents over the age 40.
Colonoscopy, though not completely reliable, is
currently the most sensitive and specific method of colon
examination [6, 71. To be successful, a screening
technique should be efficient in several respects including
its ability to reliably detect abnormalities, to maximize
patient safety, be widely available, minimize discomfort,
and be low cost. None of the currently available screening
methods is optimal in terms of all the above criteria [SI.
Virtual colonoscopy was introduced in 1994 by
Vining et al [4] in an attempt to identify a screening tool
for colorectal cancer that was reliable, -acceptable to
patients and cost effective. It uses cross-sectional (slice)
images of the abdomen as the input to produce an internal
view of the colon with the capability of 'virtually'
navigating the colon to search for abnormalities. This
procedure usually involves four stages: patient
preparation, image acquisition, visualisation, and
interpretation of the results.
One of the most widely used techniques for the
visualisation stage is three-dimensional volume rendering
of the internal structure of the colon to produce a view
similar to that of conventional colonoscopy. Moreover,
when a suspected abnormality is found, volume rendering

Virtual colonoscopy is a non-invasive technique with
the potential for wide application in the early detection of
colorectal cancer. Unfortunately, to be clinically useful, it
is reliant on the rapid visua1i:;ationof three-dimensional
( 3 0 )data using personal computers. This is not possible
using current visualisation techniques. In this paper we
present a novel method to accelerate volume rendering
via ray casting as used in virtual colonoscopy. The
method uses a space leaping technique in which the space
inside the colon is approximated by maximal spheres
constructed using the distance transform of the cavity.
These spheres enable subsequent ray casting to traverse
the space in an eflcient way. The method has been
implemented on a personal computer and is
approximately 2.9 times faster when compared to the
usual ray casting method for virtual colonoscopy.
Potential uses of this method extend beyond virtual
colonoscopy to all endoscopic applications and indeed
any volume rendering application involving voxels with
uniform properties.

1. Introduction
Colorectal cancer is the third most commonly
diagnosed cancer in the US and Canada. Occurrence rates
are exceeded in males only by lung and prostate cancer
and in females by lung and breast cancer. Colorectal
cancer is also the second mos't common cause of death,
after lung cancer, in the US, Canada [l], and the UK [ 2 ] .
According to the American Cancer Society, more than
130000 new cases of colorectal cancer will be diagnosed
this year in the US and over 515000deaths will result [l].
The probability of developing colorectal cancer by an
American is one in 18 [I]. It also causes approximately
17000 deaths in the UK each year [ 2 ] . Although the onset

0-7695-1195;3/01$10.00 0 2001 IEEE

167

enables the clinicians to closely examine both the tumour
and its underlying tissue and thereby assists them in
distinguishing between benign and malignant lesions [8].
Volume rendering based systems can produce high
quality images but need significant computing resources.
This requirement for significant computing resources is a
barrier to volume rendering being used in interactive
visualisation systems where lower rendering rates would
make it difficult for the clinicians to control the viewing
point.

process. Wan et a1 [I61 applied this to virtual
colonoscopy. They calculated the distance transform for
all voxels within the colon. During ray casting, from any
starting voxel, the ray can then be extended in a single
step by the value of the distance transform of the starting
voxel. Since the distance transform value for any voxel is
the minimum distance to reach the colon wall therefore it
is guaranteed that the ray will reach but not enter the
colon wall. Once the ray reaches the colon wall the
normal ray casing process is used.

2. Previous Work

3. Overview

Successful- use of virtual colonoscopy relies on high
quality three-dimensional visualisation. Volume rendering
via ray casting is currently the preferred method for
producing these visualisations. A variety of methods have
been proposed to accelerate the ray casting process
including hierarchical structures (pyramid), space leaping,
image and object space coherency, frame coherency.
These methods are reviewed by Yagel et a1 [9, IO] and
Danskin et a1 [ 1 I]. Space leaping offers the additional
advantage that it does not degrade the quality of the
visualisation and is well matched to the anatomy of the
human colon which is characterized as a largely hollow
organ.
Space leaping involves the efficient traversal or
skipping of empty space by the ray casting method. Any
method which traverses the empty space in an efficient
way can be classified as a space leaping technique. There
have been several implementations of space leaping
techniques to accelerate the ray casting process. A
summary is given below of those that have been applied
to the task of virtual colonoscopy.
Vilanova et a1 [I21 introduced a space leaping
technique to accelerate ray casting in the endoscopic
examination of tubular shaped organs (e.g. colon, blood
vessels, etc). Cylinders were used to approximate the
empty space within the organ and then in the ray casting
phase the intersection of rays and these cylinders are
calculated to traverse the space in larger steps. The
cylinders are fitted along the centre line of the organ and
wholly within it. The diameter of the cylinders is
determined using the distance transform values of the
voxels along the centre line.
Avila et a1 [ 131 defined a polygon assisted ray casting
technique which uses the bounding box of the object
represented by polygons. You et a1 [I41 applied the
polygon assisted ray casting technique to accelerate
volume rendering in virtual colonoscopy. They used a
surface rendering algorithm to locate the bounding box of
the colon space. The intersection point of each ray and a
polygon representing the colon wall is then calculated and
space leaping used to accelerate the ray casting process.
Zuiderveld et a1 [ 151 were the first to propose the use
of the distance transform to accelerate the ray casting

The method presented in this paper can be classified
as a space leaping technique to accelerate volume
rendering. Space leaping means to rapidly traverse any
space without adversely affecting the quality of the
rendering. The important assumptions are that the inside
of the volume is largely space and that the viewing point
will also be internal. In the endoscopic applications, such
as virtual colonoscopy, these assumptions are valid and
make space leaping a strong candidate for accelerating the
process of ray casting and thus visualisation.
In our new method the space inside the colon is
approximated by spheres and then in the ray casting
process this approximation is used to traverse the space
more efficiently. The approximation is based on skeleton
extraction. Although the definition of the skeleton of an
object is not simple, one characteristic of a skeleton is that
the original object should be capable of being
reconstructed from it. Consequently skeletons can be used
to approximate an object in a compact way. Many
different techniques have been proposed to extract a
skeleton [17, 181. These techniques can be classified in
three groups: distance transforms, Voroni diagrams, and
thinning techniques. Our approach uses the distance
transform and in particular the skeleton of an object is
obtained by specifying those voxels with local maximum
distance transform values.
We approximate the space inside the colon by the
skeleton of the cavity comprised of those spheres whose
centres are the local maxima obtained from the distance
transform and whose corresponding radii are equal to the
distance transform. In the subsequent ray casting phase
this sphere approximation is used to traverse the cavity.
Once the colon wall is reached the usual ray casting
technique is performed. The method can be summarized
in the following steps:
0
Segmenting and preparing the volume data set
Calculating the distance transform
Identifying the local maxima
0
Approximating the colon cavity with spheres
Applying a modified ray casting technique to
traverse cavities at an accelerated rate

168

(4

(b)

(c)

Figure 1. The neighbours d a voxel; (a) the 6-neighbours, (b) the 12-neighbours & (c) the 8-neighbours
Borgefors [19] showed that setting wl=3, w2=4,and w3=5
minimizes the maximum difference between the Chamfer
approximation and the Euclidian distance transform.

4. Segmenting the voluime data set
The first step is to prepare the volume data set by
segmenting the voxels representing the colon from the
remainder of the volume data set. This voxel subset of the
colon is then divided into two groups, these being the
space inside the colon and the remaining voxels which
constitute the colon wall and its underlying tissue. The
next step is to identify the boundary voxels of the space
and to calculate the distance transform for all voxels.

6. Extracting local maxima

5. Calculating the distance transform
The distance transform value is calculated for each
voxel in the space and represents the minimum distance
from that voxel to a boundary voxel (i.e. colon wall).
Calculation of the exact distance transform can be
performed using the Euclidian distance between two
points in 3D. In practice it is not computationally efficient
or algorithmically trivial to find the Euclidian distance
transform values in 3D [17] A popular and efficient
approximation to the Euclidian distance is the Chamfer
distance.
A voxel has 26 neighbours that can be divided into
three groups 6-neighbours (Nn(v)),12-neighbours (N12(v)),
and 8-neighbours (N,(v)) as illustrated in Figure 1. In the
Chamfer method weights wl, w2,and w j are assigned to 6neighbours, 12-neighbours, and1 8-neighbours of a voxel v,
respectively. The Chamfer distance transform can then be
calculated using the following recursive formula in which
N26(v) is the union of the 6, 12, and 8-neighbours of the
voxel v:

d t ( v )=

Min(dt(v),dt(u) + weight(v, U))
if

VE

VU E

N,, ( V I

7. Approximating the colon with spheres

Background

w,

if

UE

w2

if

U E

N6(v)
N,,(v)

w3

if

U E

N,(v)

If dt(v) represents the distance transform value
associated with the voxel v then the set of voxels U , such
that the distance between U and v is less than dr(v),
represents a sphere around the voxel v . The sphere is
maximal if it is not entirely contained within the sphere of
another voxel. A maximal sphere can be partially
overlapped by the spheres of other voxels. The set of
voxels constituting the centres of maximal spheres is
sufficient to reconstruct the object [ 171, i.e. the union of
the maximal spheres represents the entire object. The set
of maximal spheres is one possible object skeleton.
Although a maximal sphere cannot be contained entirely
within another maximal sphere some of the maximal
spheres may be entirely contained within the union of
others. Therefore, the set of all maximal spheres is not the
minimum possible set for reconstructing the object. In the
next section we introduce a refinement to ignore any
maximal spheres that are redundant.
Each voxel with a distance transform value greater
than all of its 26 neighbours is a voxel at the centre of a
maximal sphere i.e. a voxel with a local maximum value
for its distance transform is the centre of a maximal
sphere. More succinctly voxel v is the centre of a maximal
sphere if:

Maximal spheres are used as the foundation for the
approximation method presented in this paper. The
general approach is to assign each voxel, within the colon
cavity, to the largest unique sphere. The method seeks to
minimize the calculations associated with the intersection

169

(a)

(b)

Figure 2. Approximation of the colon cavity with maximal spheres; (a) radius threshold=lO, (b) radius
thresholdz5.
casting process takes place. In either case after advancing
to the next point the procedure is repeated. When the ray
reaches the colon wall (i.e. the next point is not a space
voxel) the algorithm switches to the usual ray casting
mode. This process is illustrated the Figure 3 in which a
ray starts from the point A and extends toward B. Using
space leaping the first voxel that needs to be considered is
at the intersection of the ray and the sphere S I . The next
voxel that needs to be considered is at the intersection of
the ray with sphere s2. Beyond that, the ray’s path is not
within a maximal sphere, so the ray traversal uses the
normal ray casting process until the ray intersects with s3.
Similarly, space leaping enables the ray to skip the voxels
along the ray’s path within s3 and s4. Finally, the ray
traversal continues with the usual ray casting steps
reaching the colon wall and passing through the
surrounding tissues.

points of a ray and a sphere during the subsequent image
rendering. The primary goal is to minimise the number of
spheres intersected by a ray. A secondary goal is to
maximize the distance that a ray traverses within each
maximal sphere.
Two strategies have been developed to achieve these
goals. First, a minimum threshold is set for the radius of
the maximal spheres. Only those spheres with a radius
greater than the threshold participate in the
approximation. Second, the method seeks to avoid
assigning voxels to highly overlapped spheres.
To
achieve this, voxels are assigned to the maximal sphere
with the largest radius.
The approximation algorithm starts by using the
maximal sphere with the largest distance transform value.
A pointer to this sphere is then assigned to each voxel
contained within it. This process continues with the next
largest sphere whose centre is outside the previously
examined spheres. The process finishes when all maximal
spheres have been examined. Figure 2 shows the results
of this approximation with two different threshold settings
for the sphere’s radius.

.B

8. The modified ray casting method
This section examines the modifications required to
the basic ray casting algorithm so that it can use the
maximal spheres to accelerate the rendering process. In
the basic ray casting method each ray is resampled at
small equi-distant intervals regardless of whether it is in a
space or not. In the modified method, space leaping is
used to accelerate the process whenever the ray traverses
a space. The starting point for each ray, which
corresponds to the viewing point, is examined first. If the
point is within a maximal sphere then the intersection of
the ray and the sphere is calculated and becomes the
starting position for the next iteration. Alternatively, if the
point is not within a maximal sphere then the usual ray

Figure 3. An efficient traversal of space using
the maximal sphere during ray casting.

170

(a)

(b)

Figure 4. Two simulated callon data sets; (a) Data Set(1) 100x160~100and (b) Data Set(l1) 200x160~100.

9. Results

It is anticipated that a similar enhancement in
performance will be obtained when real data is used.
Predicting the exact magnitude of the improvement for a
particular data set is difficult given that the acceleration
rate varies with the shape of the object being viewed, the
direction of viewing and the threshold used for the
maximal spheres radii.

The method presented in this paper has been
implemented on a personal computer equipped with an
Intel Pentium processor operating at 500 MHz and with
128 MB of memory. Two simulated colon data sets were
used to verify the performance of the method. T o measure
the rendering speed, animations based on traversing the
centre-line of the simulated colons were recorded and the
average rendering time measured. Figure 4 illustrates the
two simulated colon data sets. Table 1 contains the results
of the experiment in terms of the frame per second
rendering speed for each of two directions of view. The
average improvement in rendering speed was 2.88.

10. Discussion and conclusions
This paper reports a novel space leaping technique
for accelerating volume rendering via ray casting and has
considerable potential for use in virtual colonoscopy
which demands high quality visualisation of 3D data sets
at interactive rates.
The method reported in this paper offers improved
performance over earlier approaches. In particular,
compared to the distance transform acceleration method
[16], our method normally assigns space voxels, that are
close to the colon wall, to spheres with larger radii than
their corresponding distance transform values and thereby
enhances the potential for space leaping to those rays that
pass through these voxels. A further refinement would be
to use the distance transform acceleration method [ 151,
instead of normal ray casting, for those rays traversing
spaces within the colon which lie outside maximal
spheres.
This novel method can also be used to accelerate the
visualisation process for other endoscopic applications
(e.g. bronchoscopy, cystoscopy, etc.) and has the potential
to accelerate any volume rendering application involving
voxels that exhibit uniform properties.

Table 1. Rendering speed with and without
acceleration

Accelerated
mage Data Viewing
;ize Set Direction

128
X

128

Usual
Threshold
=5

Threshold
=IO

1.49

0.49

0.53

1.46

0.50

0.65

2.69

0.87

0.8 1

1.76
0.44
'

X

256

3.41

1.38

1.46

3.20

1.29

1.51

6.19
3.90

I

1

11. Acknowledgements

I

I

X

I

0.45

2.32

1.19

I

I

The authors wish to acknowledge the support of the
Ministry of Science, Research, and Technology of the
Islamic Republic of Iran.

2.17
1.22

171

[ 11] J. Danskin. and P. Hanrahan, “Fast algorithms for volume
ray tracing”, 1992 Workshop on Volume Visualization, 1992, pp.
91-98.
[12] A. Vilanova, E. Groller, and A. Konig, “Cylindrical
Approximation of Tubular Organs for Virtual Endoscopy”,
http:Nwww.citcscer.nj.nec.co1n/320682.html, Last visited March
2001.
[ 131 R. Avila, L. M. Sobierajaski, and A. Kaufman, ‘Towards a
Comprehensive Volume Visualization System”, Proceedings of
Visualization ’92 , 1992, pp. 13-20.
[I41 S . You, L. Hong, K. Junyaprasert, A. Kaufman, S . Muraki,
and Y. Zhou, “Interactive Volume Rendering for Virtual
Colonoscopy”, Proceedings of Visualization ’97, 1997, pp. 433436.
[I51 K. Zuiderveld, A. H. J. Koning, and M. A. Viergever,
“Acceleration of Ray Casting Using 3D Distance Transform”,

12. References
(11 “Colorectal Cancer Facts and Figures”, Colon Cancer
Alliance, http://www.ccalliance.org, Last visited Oct. 2000.
[2] Z. Kmietowicz, “NHS aims to improve care for colorectal
cancer”, BMJ, Vol. 315, 1997, pp. 1485-1486.
[3] D. Vergano, “Annual Colorectal Cancer Screening Cuts
Death Risk”, Medical Tribune, Vol. 40, No. 7, 1999, pp. 19.
[4] D.J. Vining, D.W. Gelfand, R. Bechold, E. Shading, E.
Grishaw, and R. Shifrin, “Technical Feasibility of Colon
Imaging with Helical CT and Virtual Reality”, Proc. Annual
Meeting of the American Rontgen Ray Society, 1994, pp. 104.
[5] C.D. Johnson and D.A. Ahlquist, “Computed tomography
colonography (virtual colonoscopy): a new method for
colorectal screening”, Gut, Vol. 44, 1999, pp. 301-305.
[6] P. Pescatore, T. Clucker, J. Delarive, R. Meuli, D.
Pantoflickova, B. Duvoisin, P. Schnyder, A. L. Blim, and G.
Dorta, “Diagnostic Accuracy and Interobserver Agreement of
CT Colonography (Virtual Colonoscopy)”, Gut, Vol. 47, 2000,
pp. 126-130.
[7] D.K. Rex, C.S. Cutler, G.T. Lemmel, E.Y. Rahmani, D.W.
Clark, D.J. Helper, G.A. Lehman, and D.G. Mark,
“Colonoscopic Miss Rates of Adenomas Determined by Backto-Back Colonoscopies”, Gastroenterology, Vol. 1 12, 1997, pp.
24-28.
[8] R. Shahidi, “Surface Rendering Versus Volume Rendering in
Medical Imaging: Techniques and Applications”, Proceedings
of Visualization ‘96, 1996, pp. 439-440.
[9] R. Yagel and Z. Shi, “Accelerating Volume Animation by
Space-Leaping”, Proceedings of lEEE Viualizarion ’93, 1993,
pp. 62-69.
[IO] R. Yagel, “Towards Real Time Volume Rendering”,
Proceedings of GRAPHICON P6, Vol. 1, July 1996, pp. , 230241.

Proceedings of Visualization in Biomedical Computing 92,

1992, pp. 324-335.
[ 161 M. Wan, Q . Tang, A. Kaufman, Z. Liang, and M. Wax,

“Volume Rendering Based Interactive Navigation Within the
Human Colon”, Proceedings of IEEE Conference Visualization
’99, NOV1999, pp. 397-400.
[ 171 N. Gagvani and D. Sliver, “Parameter Controlled Volume
Thinning”, Graphical Models and Image Processing, Vol. 61,
1999, pp. 149-164.
[I81 Y. Zhou and A. W. Toga, “Efficient Skeletonization of
Volumetric Objects”, IEEE Transactions on Visualization and
Computer Graphics, Vol. 5, No. 3, 1999, pp. 197-209.
[19] G. Borgefors, “On Digital Distance Transforms in Three
Dimensions”, Computer Vision and Image Understanding, Vol.
64, NO. 3, NOV1996, pp. 368-376.

172

