DOI: 10.1111/j.1467-8659.2010.01732.x
Eurographics Symposium on Rendering 2010
Jason Lawrence and Marc Stamminger
(Guest Editors)

Volume 29 (2010), Number 4

A Closed-Form Solution to Single Scattering for
General Phase Functions and Light Distributions
Vincent Pegoraro 1,2
1 University

of Utah

Mathias Schott 1
2 Saarland

University

Steven G. Parker 1,3
3 NVIDIA

Corporation

Abstract
Due to the intricate nature of the equation governing light transport in participating media, accurately and efficiently simulating radiative energy transfer remains very challenging in spite of its broad range of applications.
As an alternative to traditional numerical estimation methods such as ray-marching and volume-slicing, a few
analytical approaches to solving single scattering have been proposed but current techniques are limited to the
assumption of isotropy, rely on simplifying approximations and/or require substantial numerical precomputation
and storage. In this paper, we present the very first closed-form solution to the air-light integral in homogeneous
media for general 1-D anisotropic phase functions and punctual light sources. By addressing an open problem
in the overall light transport literature, this novel theoretical result enables the analytical computation of exact
solutions to complex scattering phenomena while achieving semi-interactive performance on graphics hardware
for several common scattering modes.
Categories and Subject Descriptors (according to ACM CCS): I.3.7 [Computer Graphics]: Three-Dimensional
Graphics and Realism—Color, shading, shadowing, and texture

ing single scattering have recently received attention in the
graphics community and were shown to be a very promising alternative to the former traditional rendering techniques.
However, current (semi-)analytical methods are limited to
the assumption of isotropy, rely on simplifying approximations and/or require substantial numerical precomputation
and storage of the sampled results.

1. Introduction
As they mathematically model radiative transfer in a vast
scope of natural elements, simulating light transport in participating media has considerable scientific implications.
Numerous applications exist in the entertainment industry
where visually appealing and realistic rendering of underwater scenes, god rays and other atmospheric phenomena drive
the next generation of special effects in movies, animated
films and video-games. Reliable simulations are also crucial in the automotive industry and architectural design when
conceiving car headlamps or stage lighting for instance, as
well as in safety-oriented research in order to assess the effectiveness of emergency exit signs in a smoke-filled room
or the visibility of traffic signs by foggy weather.

In this paper, we present the first closed-form solution
to the air-light integral in homogeneous media for general
azimuthally symmetrical anisotropic phase functions and
punctual light sources. Assuming a generic representation
of angular distributions, we provide a mathematical formulation of the problem and show how the latter may be effectively reduced to the knowledge of a single indefinite integral. In order to determine the antiderivative of interest, we
then introduce a novel analytical derivation leading to the
formulation of a closed-form solution which, to the best of
our knowledge, has never appeared before in the literature.

Unfortunately, the intricacy of the radiative transport
equation results in a formulation notoriously complex to
evaluate, making the efficient simulation of accurate light
transport in participating media very challenging. While numerical methods such as volume-slicing and ray-marching
provide a generic means of converging towards the solutions
to radiative transfer problems, analytical approaches to solvc 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.
Published by Blackwell Publishing, 9600 Garsington Road, Oxford OX4 2DQ, UK and
350 Main Street, Malden, MA 02148, USA.

This new theoretical result permits the analytical simulation of complex scattering phenomena which, up until now,
still represented an open problem in the overall light trans-

1365

1366

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

port literature. Unlike the many approximation methods proposed over the last 30 years, the technique enables the exact calculation of ground-truth solutions in a finite number
of computational steps while still achieving semi-interactive
performance on current-generation graphics hardware for
several common scattering modes.
After reviewing previous work relating to the topic of concern, this document provides an overview of the theoretical
background on the air-light integral. The assumed generic
representation of angular distributions is then introduced followed by a mathematical formulation of the problem and the
derivation of our closed-form solution. Finally, results evaluating both the accuracy and the performance characteristics
of the method are presented before discussing future work
orientations.
2. Related Work
Participating media rendering has led to a wide variety of techniques within the computer graphics literature,
and those most related to our single scattering model are
summarized below while referring the interested reader
to [CPCP∗ 05] for a more complete survey. Following
the work of Max [Max86a], several methods based on
volume-slicing [DYN00, DYN02, IJTN07] or ray-marching
[NMN87, Mak08, ED10] have been developed. While these
numerical techniques are both general and simple, such estimation schemes are however inherently prone to undersampling artifacts due to the Riemann summation that they
rely on. On the other hand, the pioneering work of Blinn
[Bli82] was the precursor to several analytical methods under the assumption of a directional light source [Max86b,
Wil87, HP02, HP03, REK∗ 04], while an image-based postprocessing technique was alternatively presented [Mit07].
Such an analytical approach was later proposed for
point light sources in homogeneous media by Lecocq et
al. [LMAK00] who reformulated the air-light integral under an angular parameterization. The integration then relies on a Taylor approximation of the integrand yielding a semi-analytical solution for isotropic light sources
while anisotropic distributions require numerical precomputation. Subsequent extensions [BAM06] also took visibility/occlusion of the light source into account by limiting the
integration domain to illuminated segments along a ray using shadow-volumes.
Later, Sun et al. [SRNN05] simplified the angular formulation further and proposed to tabulate sampled solutions of the integral. Although real-time performance may
be achieved on graphics hardware, this simple and practical approach nevertheless entails several limitations. First,
the method relies on lengthy numerical precomputation and
storage of the solution for various discrete sample points in
the continuous 2-D domain. During rendering, the result is
then interpolated to recover missing data between the samples which leads to visible artifacts. Additionally, the data

may only be tabulated for a finite subset of the semi-infinite
2-D space, and it is therefore impossible to guarantee that the
range of parameters needed for an arbitrary application will
be covered. The technique is then constrained to resort to
extrapolation which yields further inaccuracies. Finally, the
method is limited to isotropic light sources, and its extension to anisotropic phase functions requires the precomputation and storage of one additional table for each degree of
the phase function representation, therefore increasing precomputation cost and putting additional pressure on memory requirements. The approach was then hybridized with
ray-marching to render light-shafts [WR08] while Zhou et
al. [ZHG∗ 07] alternatively proposed an analytical approximation for inhomogeneous media but under the restriction
of isotropy.
More recently, Pegoraro and Parker [PP09] presented a
closed-form solution to the air-light integral for isotropic
phase functions and light sources. The approach was subsequently extended to 1-D anisotropic functions by deriving
a dual-formulation of the air-light integral [PSP09a] which
was further optimized in [PSP09b]. The semi-analytical solution however relies on a Taylor series expansion of angular distributions in the integration space which induces
several limitations. First, the formulation of the recursive
derivatives requires a human intervention, and while this is
doable for the first few terms of simple functions such as a
spotlight, the process becomes truly prohibitive for complex
anisotropic distributions due to the rapidly increasing length
of the resulting expressions. Moreover, since physical phase
functions or light distributions can generally not be faithfully
represented by a polynomial in the integration domain, the
approximation is inherently prone to inaccuracies.
Although numerous methods have been proposed over the
last 3 decades, the problem of concern has until now solely
been approached by numerical or (semi-)analytical approximations all exhibiting various inherent limitations, hence
justifying the ultimate need for a theoretically correct computational model. Based on the concepts introduced by Pegoraro et al., this paper presents the very first closed-form
solution to single scattering for general rotationally symmetrical angular distributions.
3. Closed-Form Single Scattering
This section first provides an overview of the theoretical
background on the air-light integral in homogeneous participating media considering arbitrary phase functions and light
sources. The assumed generic representation of their angular
distributions is subsequently introduced before presenting a
mathematical formulation of the problem and the derivation
of our closed-form solution. As in previous analytical approaches [LMAK00, SRNN05, PSP09a], the analysis to follow solely treats of fully-illuminated ray segments while referring the reader to the discussion section for an explanation
on how this restriction may be easily lifted.
c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

1367

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

3.1. Air-Light Integral
The air-light integral describes the radiance L at position xa
along a ray of direction ω through a homogeneous medium
with background boundary at xb as
L(xa , ω) = Lm (xa , xb , ω) + Lr (xa , xb , ω).

(1)

Defining the extinction coefficient κt = κa + κs with κa
and κs being the absorption and scattering coefficient respectively, the reduced radiance reads
Lr (xa , xb , ω) = e−κt (xb −xa ) L(xb , ω).

(2)

If the medium has a phase function Φ and is solely illuminated by a punctual light source of intensity I located at position pl and parameterized by the angle with the normalized
direction vl as recapitulated in table 1, then the formulation
of the medium radiance along the view ray of origin pe and
direction ve reads [NMN87, PSP09a]
√
Z xb −κt x+ h2 +(x−xh )2
e
κt xa
Lm (xa , xb , ω) = κs e
(3)
h2 + (x − xh )2
xa
Φ arctan

π
x − xh
+
I arccos
h
2

del x + dlel
h2 + (x − xh )2

where del = ve · vl and dlel = (pe − pl ) · vl , and where h is
the distance from the light to the ray and xh the coordinate
of its projection onto it as illustrated in figure 1.
The medium radiance may then be simplified by substih
tuting u = x−x
h such that the integrand becomes a function
of only 4 parameters [PSP09a]
Z

ua =

Description
Medium radiance
Reduced radiance
Eye position
Eye ray direction
Light position
Light ray direction
Projection vector of pl onto the eye ray
Lower bound of the integration domain
Upper bound of the integration domain
Projection coordinate of pl onto the eye ray
Distance from pl to the eye ray
Absorption coefficient
Scattering coefficient
Extinction coefficient
Optical distance from pl to the eye ray
Cosine angle between ve and vl
Projection coordinate of pe onto the light ray
Cosine angle between vh and vl
Phase function
Light intensity distribution
Phase function parameter angle
Light distribution parameter angle
Number of phase function coefficients
Phase function coefficients
Number of light source coefficients
Light source coefficients

c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

(4)

xa − xh
h

ub =

xb − xh
.
h

(5)

Defining Φc such that Φ(θ) = Φc (cos(θ))√and Ic such
that I(ϑ) = Ic (cos(ϑ)), the substitution v = u + 1 + u2 then
yields [PSP09a]
Lm (xa , xb , ω) =
Φc −

Symbol
Lm
Lr
pe
ve
pl
vl
vh
xa
xb
xh
h
κa
κs
κt
H
del
dlel
dc
Φ
I
θ
ϑ
NΦ
cΦ
NI
cI

2

where H = κt h is the optical distance from the light to the
(p −p )+x v
ray, dc = del xhh+dlel = vh · vl with vh = e hl h e being the
unit-length projection vector of the light onto the ray, and

dx

Table 1: Summary of the notation used in this document.

√

ub e−H(u+ 1+u )
κs
Lm (xa , xb , ω) = eκt (xa −xh )
h
1 + u2
ua
del u + dc
π
I arccos √
du
Φ arctan(u) +
2
1 + u2

v2 − 1
v2 + 1

κs κt (xa −xh )
e
2
h
Ic

Z vb −Hv
e
va

(6)

v2 + 1

del (v2 − 1) + 2dc v
v2 + 1

dv

where
va = ua +

1 + u2a

vb = ub +

1 + u2b .

(7)

Since the focus of this work is the evaluation of the
medium radiance, extinction phenomena are assumed to prevail in surface shading calculation. Defining β as the bidirec-

pl

vl
ϑ

d
θ
p e ve
xa x

h
xh

xb

Figure 1: Diagram illustrating the various quantities that
the air-light integral depends on.

1368

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

tional reflectance distribution function, the background radiance then reads
L(xb , ω) =

e−κt d(xb ,ω)
β(ω, ωi , nb ) ωi · nb Ic (−ωi · vl ) (8)
d(xb , ω)2

where d(x, ω) = h2 + (x − xh )2 represents the distance
from the light source to a point x along the ray, ωi is a unitlength vector directed towards the light source, and nb is the
surface normal at xb .
Considering the above problem formulation from Pegoraro et al. [PSP09a], the remainder of this document focuses
on addressing the evaluation of the medium radiance, and
this is precisely where our approach fundamentally differs
from theirs. The latter relies on an expansion of the phase
function and light distribution in the integration space, i.e.
on a representation as a polynomial of the variable v such
n
that Φc ()Ic () = ∑N−1
n=0 cn v . While the assumption simplifies
the antiderivatives to be solved, actual angular distributions
are however typically not exactly expressible in such form,
therefore involving inherent approximations. On the other
hand, we consider a polynomial basis in the cosine space as
formulated in equations 9 and 10, which is the native representation of most phase functions and many light distributions as discussed in section 3.2. Doing so results in rational
expressions in the integration space as illustrated in equation 20 which contrasts with the aforementioned polynomial
of the variable v assumed by Pegoraro et al. [PSP09a]. We
then analyze the whole formulation of the problem in section
3.3 and provide a significantly more general mathematical
solution to the resulting antiderivative enabling the air-light
integral to be solved in closed form as detailed in section 3.4.

into a Taylor series. In the latter case, the chosen representation is still of a practical nature as described in the following
subsections.
Due to the numerous advantages of the representation, we
make the same assumption regarding the light distribution of
order NI − 1 and define ς = cos(ϑ) such that
Ic (ς) =

NI −1

∑

cI (n)ςn .

(10)

n=0

The resulting polynomial expression allows to exactly model
both simple spotlights via a single term and complex sources
with very few Legendre coefficients, and all the concepts
subsequently discussed with respect to the phase function
representation are equally applicable to the light source distribution.
The above expressions form the common formulation on
which our solution is based as detailed in section 3.3. Besides discussing further the practical advantages of such representation, the following subsections additionally provide 2
methodologies for computing its coefficients.
3.2.1. Legendre Polynomials
Legendre polynomials are widely acknowledged as a standard basis to represent general phase functions and they are
broadly used in light transport simulation [Cha60]. A phase
function may be expressed as a series of such polynomials
as follows
Φc (µ) =

1 NΦ −1
∑ an Pn (µ)
4π n=0

(11)

where the coefficients are defined by
3.2. Representing Angular Distributions

an =

In order to accurately model a wide range of arbitrary phase
functions and light sources, we assume that the angular
distributions are expressible via a generic formulation. A
broadly used representation describes the phase function as
an NΦ -term polynomial of the cosine angle µ = cos(θ) as
follows
Φc (µ) =

NΦ −1

∑

cΦ (n)µn .

(9)

n=0

Most phase functions can be exactly represented under this
form including the isotropic, linear anisotropic (also called
Eddington), Rayleigh, hazy Mie and murky Mie phase functions [SH81]. The representation also allows exact formulations of implicitly energy-conserving phase functions expressed in terms of Legendre polynomials often used to
model complex distributions such as that of Mie scattering. On the other hand, a few rational formulations such as
the Henyey-Greenstein phase function are not exactly representable in the chosen basis and may only be approximated
via an expansion into a series of Legendre polynomials or

2n + 1
2

Z 1

−1

4πΦc (µ)Pn (µ)dµ.

(12)

The first coefficient evaluates to the integral of the representation over the whole spherical domain, and setting a0 =
1 consequently guarantees normalization of the phase function. Moreover, the second coefficient relates to the asymmetry coefficient g as follows a1 = 3g. Several phase functions
may be expressed in this polynomial basis, either exactly
with a finite number of terms, or approximately via truncation of the expansion into an infinite series. Coefficients for
common scattering modes are reported in table 2 while expansions of the Mie phase function are provided in [CC55].
Table 2: Coefficients of Legendre polynomials for several
standard phase functions.
Phase Function
Isotropic
Linear Anisotropic
Rayleigh
Henyey-Greenstein

Order
0
1
2
∞

Coefficients
a0 = 1
a0 = 1, −1 ≤ a1 ≤ 1
a0 = 1, a1 = 0, a2 = 12
an = (2n + 1)gn

c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

1369

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

The coefficients cΦ (n) can then be computed in-place
from the coefficients an in order of increasing index n as
follows
1 ≤NΦ −1 (−1)
cΦ (n) =
∑ ak 2k
4π k=n

k−n
2

k+=2

(k + n)!
k−n
2

k+n
2

!

! n!

tion in the integration space reads
Φc −

v2 − 1
v2 + 1

=

NΦ −1

∑

2n

∑

cΦ (n)

n=0

k=0
k+=2

. (13)

dΦ (n, k) = (−1) 2

In case a given phase function cannot be exactly expressed
in the chosen polynomial basis, an alternative is to expand
its formulation into a Taylor series representation. The expansion in the initial cosine space however presents numerous advantages over an expansion in the integration space as
done in [PSP09a].
First, the expression of the successive derivatives is generally much simpler to evaluate, hence greatly reducing human
burden, since the cosine parameter is considered as a single
entity rather than as being itself a convoluted function of the
variable of integration. In fact, the derivatives in the cosine
space may even be described analytically such that the function can be approximated to an arbitrary precision by taking
sufficiently many terms. For instance, we could easily derive
such analytical expression for the Henyey-Greenstein phase
function
1 − g2
1
4π 1 + g2 − 2gµ

3
2 +n

g
2

n

(2n + 1)!
. (14)
n!

1 NΦ −1−n (k+n)
(−µ0 )k
.
Φc
(µ0 )
∑
n! k=0
k!

(15)

Moreover, because a series is expressed in terms of powers of the variable, the expansion typically converges rapidly
whenever the magnitude of the latter is no greater than 1 and
slowly otherwise. Given that the space of the variable µ is inherently bounded to [−1, 1], the formulation given in equation 9 consequently yields relatively quick convergence with
only a few terms. This single formulation therefore naturally
achieves the goal sought by the two complementary formulations of Pegoraro et al. [PSP09a].

(17)

.

k
2

Similarly, the expression of the light distribution from
equation 10 becomes
Ic

del (v2 − 1) + 2dc v
v2 + 1

=

NI −1

∑

n=0

2n

cI (n) ∑ dI (n, k)
k=0

vk
(v2 + 1)n
(18)

where the coefficients read instead
n−|n−k|

∑

dI (n, k) =

(−1)n−

k+l
2

l=k mod 2
l+=2

n−l
(2dc )l del

n
l

n−l
k−l
2

.
(19)

The product of the phase function and light distribution
may therefore be generally expressed under the form
Φc −

v2 − 1
v2 + 1

N−1

2n

=

del (v2 − 1) + 2dc v
v2 + 1

Ic

vk

(20)

∑ c(n) ∑ d(n, k) (v2 + 1)n

n=0

The derivatives yield the coefficients of the truncated
power series centered in µ0 . The polynomial coefficients can
then be computed in-place from the latter in order of increasing index n by use of the binomial theorem to finally yield
cΦ (n) as follows
cΦ (n) =

(16)

n

k

(n)

vk
(v2 + 1)n

where the coefficients are defined as

3.2.2. Taylor Series

ΦHGc (µ) =

dΦ (n, k)

k=0

where N = NΦ + NI − 1 and c(n) = 1 with
min{NΦ −1,n}

∑

d(n, k) =

m=max{0,n−NI +1}

(21)

cΦ (m)cI (n − m)

min{2m,2⌊ 2k ⌋}

∑

l=max{0,2⌈ 2k ⌉−2(n−m)}
l+=2

dΦ (m, l)dI (n − m, k − l).

Substituting equation 20 into equation 6 finally yields
κs
(22)
Lm (xa , xb , ω) = eκt (xa −xh ) 2
h
N−1

2n

∑ c(n) ∑ d(n, k)

n=0

k=0

Z vb
va

e−Hv
(v2 + 1)n+1

vk dv

and it consequently follows that the problem can be effectively reduced to the knowledge of a single antiderivative.
3.4. Solving the Indefinite Integral

3.3. Formulating the Medium Radiance
Substituting the expression of the cosine angle from equation 6 into the chosen angular representation given in equation 9, expanding the numerator using the binomial theorem
and then rearranging the terms, the phase function formulac 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

Unlike the general mechanisms available for derivatives,
systematic methods for determining the antiderivative of an
arbitrary function unfortunately don’t exist and each indefinite integral must consequently be treated individually, typically via human intervention. Although the logical steps of
the analysis may be readily followed once a solution has

1370

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

been found for a given function, analyzing the problem and
determining the actual mathematical reasoning leading to
this solution is in general a rather non-trivial matter, and instances of known results are carefully compiled into comprehensive tables of integrals such as [GR07].
Since the previous antiderivative however appeared in
none of the various compilations we consulted and is speculated to be currently unknown, we were led to investigate
the problem on our own and the formulation of this new
theoretical result is one of the fundamental contributions of
our work. For n ∈ N and m ∈ N∗ , the antiderivative may
be rewritten by factorizing the denominator as the product
of terms of the imaginary entity ı2 = −1 using the identity
v2 + 1 = v2 − ı2
Z

eav
vn dv =
2
(v + 1)m

Z

eav
vn dv.
m
(v + ı) (v − ı)m

Multiplying the numerator by
simplifying subsequently yields
Z

av

e
ı
vn dv =
2
(v2 + 1)m

ı
2

(23)

eav
(v2 + 1)m

(v − ı) − (v + ı) = 1 and

ı
2

m m

∑ (−1)k

k=0

m
k

eav
(v + ı)m−k (v − ı)k

(25)

eav
(v2 + 1)m
(−1)m− j

Z

vn dv =

m

∑

j=1

ı
2

l=0

n
l

m

∑

j=1

ı
2

2m− j

(−1)m− j (−ı)n−l e−ıa
+ (−1)m ın−l eıa

2m − 1 − j
m−1

Z v+ı az
e l

vn dv.

2m− j

eav
vn dv + (−1)m
(v + ı) j

2m − 1 − j
m−1

eav
vn dv =
(v2 + 1)m

Z

∑
k=max{1, j−n}

Z

+

eav
vn dv .
(v − ı) j

Proceeding to a change of the variable of integration by
defining z = v + ı or z = v − ı in each of the above integrals
respectively, expanding the resulting nth -order polynomials
in the numerator using the binomial theorem, and rearrang-

≤n− j

∑

k=0

(27)

Z v−ı az
e l

zj

m

ı
2

∑

j=1

n
j−k

2m− j

z dz .

2m − 1 − j
m−1

(−1)m− j (−ı)n− j+k e−ıa

n
j+k

(−1)m− j (−ı)n− j−k e−ıa
+ (−1)m ın− j−k eıa

(28)
Z v+ı az
e

zk

Z v−ı az
e

zk

Z v+ı

Z v−ı

dz

dz

eaz zk dz

eaz zk dz

The above reformulation ultimately expresses the antiderivative in terms of the following known indefinite integrals [GR07]
eav vn dv =
Z

(26)

z dz

zj

Splitting each of the above sums into 2 sub-sums containing only terms with either negative or positive exponents of
the variable z, and substituting k = j − l or k = l − j respectively, subsequently leads to

Z

Recursively excluding from the process the terms whose
exponent of either v + ı or v − ı is zero in the denominator
while applying the previous factorization further to the remaining summands, and substituting j = m − k subsequently
leads to
Z

n

∑

vn dv =

av

e
vn dv (24)
(v + ı)m (v − ı)m−1
Z
eav
vn dv .
−
m−1
(v + ı)
(v − ı)m

Z

eav
(v2 + 1)m

+ (−1)m ın− j+k eıa

Z

vn dv =

Z

j

Repeating the above process m times simultaneously for
all summands then gives
Z

ing the terms then yields

eav
a

n

n!

vn−i

∑ (n − i)! (−a)i

i=0

m−2
(m − 2 − i)! eav ai
eav
am−1
Ei(av) − ∑
.
dv =
m−1−i
vm
(m − 1)!
i=0 (m − 1)! v

Finally substituting the above formulations, multiplying
the denominator so as to remove the imaginary entity from
the latter and expanding the corresponding factor in the numerator using the binomial theorem, the resulting expression
may then be rearranged and simplified to yield our solution
readily reported in equation 29 to follow, where the E function reads
E(a, v, j) =

1
2

ıj
eıa
Ei(av
+
ıa)
+
Ei(av − ıa)
eıa
ıj
j

= (−1)⌊ 2 ⌋ i(1−( j mod 2)) (a, v)

(30)

with Ei being the complex-valued exponential integral function [AS72] whose real ℜ and imaginary ℑ parts define
i0 (a, v) = sin(a)ℜ(Ei(av + ıa)) − cos(a)ℑ(Ei(av + ıa))

i1 (a, v) = cos(a)ℜ(Ei(av + ıa)) + sin(a)ℑ(Ei(av + ıa)).
c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

Z

eav
(v2 + 1)m

vn dv =

m−1

1
2m−1

∑
l=0

1
2l

− eav

+

eav
a

≤n−m+l

∑

k=0

min{m−1−l,n}

m−1+l
m−1

n
k

∑
k=0

m−1−l−k

∑

j=1

n−m+l−k

∑

j=0

n
k

am−1−l−k
E(a, v, m − n − l + k)
(m − 1 − l − k)!

am−1−l−k− j
( j − 1)!
(m − 1 − l − k)! (v2 + 1) j

≤j

∑

(−1)

(29)

m−n−l+k− j+i
2

i=(m−n−l+k− j) mod 2
i+=2

1
(n − m + l − k)!
j!
(−a)n−m+l−k− j

≤j

∑

i=(−m+l+k− j) mod 2
i+=2

(−1)

1371

−m+l+k− j+i
2

j i
v
i
j i
v
i

4. Implementation

5. Results

While the mathematics underlying the derivation might seem
daunting at first, implementing the method really only entails
literally converting the few relevant equations into code, and
figure 2 provides an algorithm outline in order to help identifying those involved in that process. Although the exponential integral is part of the commonly employed Boost C++
libraries, we used instead the implementation provided in
[PSP09a] in our experiments to ease portability onto graphics hardware.

The accuracy of the method was first assessed via a CPU
implementation facilitating quality evaluation in comparison
to that of previous approaches. Figure 3 illustrates the results obtained over a wide range of ray trajectories using an
environment camera while rendering high/low-density haze
with a Rayleigh phase function. In such setting, Lecocq’s 3term expansion [BAM06] yields strong ghosting artifacts in
light-backfacing directions while overall inaccuracies may
be most easily noticed in the skyline. The latter directions
are also problematic for Sun’s 512 × 512 precomputed tables
which lead to visual artifacts (see insets) divulging bilinear
interpolation errors in addition to those most prominent in
high-density media caused by extrapolation. In contrast, our
closed-form solution faithfully matches the reference image
computed offline using Monte Carlo estimation, as emphasized in figure 5.

With respect to efficiency, it is worth observing that redundant computation may be easily avoided by evaluating
the terms i0 and i1 in equation 30 only once before entering the loops as both are independent of the value of the
iterators from equation 29. Similarly, the various power and
factorial terms as well as the binomial coefficients involved
can be incrementally computed via pre-iterative initialization of the variables which may then be updated in constant
time within the loops. While doing so, the second and third
lines of equation 29 might
resort to basic manipulations of
m
j! m− j
a
= am! ∑mj aj!j allowing the external facthe type ∑mj m!
tor to be ultimately generated as a by-product of the iterative
process. Finally, although the following observation does not
hold true in arbitrary settings, our experiments have empirically shown that, when solving the air-light integral, the sum
on the third line of equation 29 systematically evaluates to
zero, which suggests additional potential for optimization.
ComputeEyeRadiance()

Figure 4 depicts the results obtained with relatively focused spotlight distributions. Using the first 4 terms of
the Taylor series as reported in [PSP09a], Pegoraro’s dualformulation leads to inaccuracies in the glows of the 2 leftmost light sources and to erroneous artifacts below the rightmost one where the approximation results in negative estimates of the positive integral. Although the artifacts might
be reduced by hand-coding additional terms in the series
whose lengths here become quickly intractable, inaccuracies
still remain even with 6 terms in the Taylor expansions. On
the other hand, our results here again match the reference
solution exactly as highlighted in figure 5.

1. Compute Lm ;
2.
Compute bounds of integral as in equations 5 and 7;
3.
Compute coefficients cΦ|I (n) as in equation 13 or 15;
4.
Compute Lm as in equation 22;
5.
Compute coefficient d(n, k) as in equation 17/19/21;
6.
Compute integral using equations 29 and 30;
7. Compute Lr as in equations 2 and 8;
8. Compute L as in equation 1;

In addition, figure 6 shows a complex anisotropic light
source distribution easily modeled using only 2 Legendre coefficients. Using our method, the solution can be efficiently
rendered in closed-form, whereas none of the previous approaches could conceivably handle such a case even semianalytically. We also wish to emphasize that all the results
presented in this paper use exact representations of the various angular distributions, and details about their expressions
may be found in table 3.

Figure 2: Algorithm outline summarizing the equations involved in implementing the method.

The performance characteristics of our closed-form solution compared to that of previous approaches were also evaluated via a Cg-based GPU implementation running on an

c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

1372

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

Figure 4: An underwater scene illuminated by the spotlights of a submersible, rendered using (top-left) Pegoraro’s
method with 4 terms, (top-right) Pegoraro’s method with 6
terms, (bottom-left) our closed-form solution, and (bottomright) offline Monte Carlo estimation.

Table 3: Number and order of the terms constituting the exact expressions of the various anisotropic functions used in
the respective figures.
Function
Isotropic
Linear Anisotropic
Rayleigh
Spotlight
Light Ball

Figure 3: An alley covered in respectively thick (left half)
and thin (right half) anisotropic haze lit by 4 colorful streetlamps, rendered using (from top to bottom) Lecocq’s method,
Sun’s method, our closed-form solution, and offline Monte
Carlo estimation.

NVIDIA GeForce GTX 280 under Windows XP 64-bit. The
calculation was carried independently for each color channel so as to support chromatic effects, and while the computational cost increases with the order of the integrand, interactivity is still maintained for various common scattering
modes as illustrated in table 4 which reports the frame rates
benchmarked on a low-geometry scene so as to predominantly measure the cost of the air-light integration schemes.

Terms
1
2
2
1
6

Orders
0
0, 1
0, 2
10
0, 2, 4, 6, 8, 10

Figure

3
4
6

Due to the simplifications that they rely on, we acknowledge that previous approaches are admittedly more suited to
time-critical applications whenever visible artifacts are tolerable. Nevertheless, it is important to recall that unlike previous techniques which approximate the solution for fairly
limited cases such as isotropic light sources [SRNN05] or
low-frequency distributions [PSP09a], our result is the mathematical solution to an actually much broader set of configurations including complex phase functions and light sources,
and it can therefore be used to effectively assess the quality
of the aforementioned inexact methods.
6. Discussion and Future Work
Thanks to their generality, numerical methods can most often implicitly account for visibility of the light sources along
view rays as part of the integrand, although doing so is inherc 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

1373

Table 4: Frame rates achieved with our closed-form solution
on graphics hardware compared to that of previous approximate methods at a resolution of 768 × 768 for various chromatic scattering modes. Both anisotropic light distributions
are of order 4, and the performance for Pegoraro’s dualformulation is reported for 4 and 6 terms in the Taylor series
expansion respectively.
FPS
Lecocq Sun Pegoraro Our method
Isotropic
932 998
315
Linear Anisotropic
984
80.7
Rayleigh
991 988
44.7
Spotlight
84.9/31.7
3.53
Light Ball
1.71

0

>89% 0

>1% 0

>305%

Figure 5: Color-coded visualization of the absolute error
of the results relative to the average image intensity (left)
from figure 3 for (from top to bottom) Lecocq’s method, Sun’s
method, and our closed-form solution, and (right) from figure 4 for (from top to bottom) Pegoraro’s method with 4 and
6 terms respectively, and our closed-form solution.

Figure 6: A concert stage lit by a high-frequency anisotropic
light ball rendered analytically using our closed-form solution (left) and compared against the reference image (right).

ently prone to under-sampling artifacts. In contrast, analytical approaches, including those from previous work as well
as the one presented in this paper, typically need to explicitly
handle the discontinuities due to volumetric shadows by partitioning the domain of integration so as to exclude occluded
intervals from the integral as done in [Jam03] or [BAM06].
Despite the extra computational cost entailed by the shadowvolumes algorithm, coupling our integration scheme with the
latter would consequently provide a simple means of effectively determining exact shadow boundaries.
c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

Moreover, the latter performance characteristics actually illustrate the main practical limitation of our solution,
namely, its computational cost which is a supra-linear function of the order of the angular distributions. While the approach performs reasonably well for several common scattering modes, interactive frames rates may currently not be
achieved for high-order representations and future directions
of research could consequently investigate alternatives to
improve the efficiency of the evaluation scheme.
On the other hand, the technique does scale linearly in the
number of light sources, and area lights may be easily represented as a set of several anisotropic point sources. Also,
while almost all naturally occurring phase functions are rotationally symmetrical about the incident direction, the 1-D assumption does not hold when dealing with light sources parameterized by both polar and azimuthal angles. Generalizations of the method could therefore consider 2-dimensional
light distributions in order to make the solution applicable to
a broader range of configurations. Finally, our analytical approach opens an avenue to many extensions, including the
derivation of closed-form solutions for non-punctual light
sources and inhomogeneous media as well as higher-order
scattering events.
7. Conclusion
In this paper, we have presented the very first closed-form
solution to the air-light integral in homogeneous media for
general 1-D phase functions and punctual light sources. Assuming a generic representation of angular distributions, we
have provided a mathematical formulation of the problem
and shown that the latter effectively reduces to the knowledge of a single indefinite integral. In order to determine the
antiderivative of interest, we have then introduced a novel
analytical derivation leading to the formulation of a closedform solution which, to the best of our knowledge, has never
appeared before in the literature.
This new theoretical result enables the analytical computation of exact solutions to complex scattering phenom-

1374

V. Pegoraro, M. Schott & S. G. Parker / Closed-Form Single Scattering for General Phase Functions and Light Distributions

ena which, up until now, still represented an open problem in the overall light transport simulation community.
The technique makes the calculation of ground truth solutions in a finite number of computational steps finally possible, and therefore the efficient generation of reference images to evaluate the quality of the many approximations
to the single-scattering model that have been proposed in
the past. Furthermore, it also allows high-quality results to
be achieved with semi-interactive performance on currentgeneration graphics hardware for several common scattering modes. Finally, although the solution is currently bound
to the assumption of single scattering, homogeneity of the
medium and punctuality of the light sources, we believe that
it represents a major step forward towards deriving more
generic analytical solutions to light transport and hope it will
stimulate subsequent research in the field.
Acknowledgements

[ED10] E NGELHARDT T., DACHSBACHER C.: Epipolar Sampling for Shadows and Crepuscular Rays in Participating Media
with Single Scattering. In Symposium on Interactive 3D Graphics and Games (2010), pp. 119–125.
[GR07] G RADSHTEYN I. S., RYZHIK I. M.: Table of Integrals,
Series, and Products, 7th ed. Academic Press, 2007.
[HP02] H OFFMAN N., P REETHAM A. J.: Rendering Outdoor
Light Scattering in Real Time. ATI White Paper, 2002.
[HP03] H OFFMAN N., P REETHAM A. J.: Real-Time LightAtmosphere Interactions for Outdoor Scenes. In Graphics Programming Methods. 2003, ch. 3.11, pp. 337–352.
[IJTN07] I MAGIRE T., J OHAN H., TAMURA N., N ISHITA T.:
Anti-Aliased and Real-Time Rendering of Scenes with Light
Scattering Effects. Visual Computer 23, 9 (2007), 935–944.
[Jam03] JAMES R.: True Volumetric Shadows. In Graphics Programming Methods. 2003, ch. 3.12, pp. 353–366.
[LMAK00] L ECOCQ P., M ICHELIN S., A RQUÈS D., K EMENY
A.: Mathematical Approximation for Real-Time Lighting Rendering through Participating Media. In Pacific Graphics (2000),
pp. 400–401.
[Mak08]
2008.

M AKAROV E.: Volume Light. NVIDIA White Paper,

The authors wish to thank Thiago Ize and Abe Stephens for
helpful discussions, Philipp Slusallek for allowing the ultimate stages of this work to be finalized after the first author
joined his research group, as well as the anonymous reviewers for their valuable feedback on improving the quality of
this document. Alley model courtesy of Matthew Schwartz
and Ben Watson, and submersible and concert-stage models
courtesy of the Google 3D Warehouse. This research was
supported by the U.S. Department of Energy through the
Center for the Simulation of Accidental Fires and Explosions, under grant W-7405-ENG-48.

[NMN87] N ISHITA T., M IYAWAKI Y., NAKAMAE E.: A Shading
Model for Atmospheric Scattering Considering Luminous Intensity Distribution of Light Sources. SIGGRAPH Computer Graphics 21, 4 (1987), 303–310.

References

[PP09] P EGORARO V., PARKER S. G.: An Analytical Solution
to Single Scattering in Homogeneous Participating Media. Eurographics (Computer Graphics Forum) 28, 2 (2009), 329–335.

[AS72] A BRAMOWITZ M., S TEGUN I. A.: Handbook of Mathematical Functions with Formulas, Graphs, and Mathematical
Tables. U.S. Department of Commerce, 1972.

[PSP09a] P EGORARO V., S CHOTT M., PARKER S. G.: An Analytical Approach to Single Scattering for Anisotropic Media and
Light Distributions. In Graphics Interface (2009), pp. 71–77.

[BAM06] B IRI V., A RQUÈS D., M ICHELIN S.: Real Time Rendering of Atmospheric Scattering and Volumetric Shadows. Journal of WSCG 14 (2006), 65–72.

[PSP09b] P EGORARO V., S CHOTT M., PARKER S. G.: Reduced
Dual-Formulation for Analytical Anisotropic Single Scattering.
High-Performance Graphics (Poster Session), 2009.

[Bli82] B LINN J. F.: Light Reflection Functions for Simulation
of Clouds and Dusty Surfaces. SIGGRAPH Computer Graphics
16, 3 (1982), 21–29.

[REK∗ 04] R ILEY K., E BERT D. S., K RAUS M., T ESSENDORF
J., H ANSEN C. D.: Efficient Rendering of Atmospheric Phenomena. In Eurographics Symposium on Rendering (2004),
pp. 375–386.

[CC55] C HU C.-M., C HURCHILL S. W.: Representation of the
Angular Distribution of Radiation Scattered by a Spherical Particle. Journal of the Optical Society of America 45, 11 (1955),
958–962.
[Cha60] C HANDRASEKHAR S.: Radiative Transfer. Dover Publications, 1960.
[CPCP∗ 05] C EREZO E., P EREZ -C AZORLA F., P UEYO X.,
S ERON F., S ILLION F.: A Survey on Participating Media Rendering Techniques. The Visual Computer 21, 5 (2005), 303–328.
[DYN00] D OBASHI Y., YAMAMOTO T., N ISHITA T.: Interactive Rendering Method for Displaying Shafts of Light. In Pacific
Graphics (2000), pp. 31–37.
[DYN02] D OBASHI Y., YAMAMOTO T., N ISHITA T.: Interactive Rendering of Atmospheric Scattering Effects Using Graphics Hardware. In Graphics Hardware (2002), pp. 99–108.

[Max86a] M AX N. L.: Atmospheric Illumination and Shadows.
SIGGRAPH 20, 4 (1986), 117–124.
[Max86b] M AX N. L.: Light Diffusion through Clouds and Haze.
Computer Vision, Graphics, and Image Processing 33, 3 (1986),
280–292.
[Mit07] M ITCHELL K.: Volumetric Light Scattering as a PostProcess. In GPU Gems 3. 2007, ch. 13, pp. 275–285.

[SH81] S IEGEL R., H OWELL J. R.: Thermal Radiation Heat
Transfer, 4th ed. Hemisphere Publishing Corporation, 1981.
[SRNN05] S UN B., R AMAMOORTHI R., NARASIMHAN S. G.,
NAYAR S. K.: A Practical Analytic Single Scattering Model for
Real Time Rendering. SIGGRAPH (Transactions on Graphics)
24, 3 (2005), 1040–1049.
[Wil87] W ILLIS P. J.: Visual Simulation of Atmospheric Haze.
Computer Graphics Forum 6, 1 (1987), 35–42.
[WR08] W YMAN C., R AMSEY S.: Interactive Volumetric Shadows in Participating Media with Single-Scattering. In Symposium
on Interactive Ray Tracing (2008), pp. 87–92.
[ZHG∗ 07] Z HOU K., H OU Q., G ONG M., S NYDER J., G UO B.,
S HUM H.-Y.: Fogshop: Real-Time Design and Rendering of
Inhomogeneous, Single-Scattering Media. In Pacific Graphics
(2007), pp. 116–125.

c 2010 The Author(s)
Journal compilation c 2010 The Eurographics Association and Blackwell Publishing Ltd.

