Eurographics Symposium on Rendering 2008
Steve Marschner and Michael Wimmer
(Guest Editors)

Volume 27 (2008), Number 4

An Analysis of the In-Out BRDF Factorization for
View-Dependent Relighting
Dhruv Mahajan, Yu-Ting Tseng and Ravi Ramamoorthi
Columbia University

Abstract
Interactive rendering with dynamic natural lighting and changing view is a long-standing goal in computer graphics. Recently, precomputation-based methods for all-frequency relighting have made substantial progress in this
direction. Many of the most successful algorithms are based on a factorization of the BRDF into incident and
outgoing directions, enabling each term to be precomputed independent of viewing direction, and re-combined at
run-time. However, there has so far been no theoretical understanding of the accuracy of this factorization, nor
the number of terms needed. In this paper, we conduct a theoretical and empirical analysis of the BRDF in-out
factorization. For Phong BRDFs, we obtain analytic results, showing that the number of terms needed grows linearly with the Phong exponent, while the factors correspond closely to spherical harmonic basis functions. More
generally, the number of terms is quadratic in the frequency content of the BRDF along the reflected or half-angle
direction. This analysis gives clear practical guidance on the number of factors needed for a given material. Different objects in a scene can each be represented with the correct number of terms needed for that particular
BRDF, enabling both accuracy and interactivity.
Categories and Subject Descriptors (according to ACM CCS): I.3.7 [Computer Graphics]: Three-Dimensional
Graphics and Realism

1. Introduction
Real-time rendering of scenes with complex lighting, reflectance and changing view is a long-standing challenge in
computer graphics. Recently, precomputed radiance transfer
or PRT [SKS02] has shown great promise in achieving this
goal, building on the seminal relighting work of [NSD94,
DAG95]. In this paper, we focus on the class of all-frequency
methods [NRH03], that seek to accurately reproduce intricate shadows and reflection effects, often using wavelet representations.
For view-dependent materials, a popular approach is to
factor the BRDF into terms that depend only on incident
and outgoing directions [LSSS04, WTL04].† This separable decomposition was originally proposed by [KM99] to
† Since the view is not known at precomputation, other factorizations like half and difference angles [Rus98] cannot be used for PRT.
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.
Published by Blackwell Publishing, 9600 Garsington Road, Oxford OX4 2DQ, UK and
350 Main Street, Malden, MA 02148, USA.

represent BRDFs for real-time rendering. Each light transport term can then be precomputed for a static scene, independent of viewing direction, and combined interactively.
Together with clustered PCA [SHHS03] to exploit signal
coherence across different spatial locations, these methods
for the first time enable real-time relighting of glossy objects with changing view.‡ Since its introduction, the in-out
BRDF factorization and variants have been used in most
subsequent PRT papers [WTL05,WTL06,TS06,OBARG06,
MKSRB07, SZC∗ 07, WZH07, IDYN07].
It is possible to determine the number of terms needed
for the in-out BRDF factorization directly by explicitly doing a SVD of the BRDF matrix, and looking numerically at
‡ An alternative approach of triple product integrals [NRH04], instead factors light transport into the visibility and BRDF. Since visibility and BRDF are in different spaces, it is not possible to exploit
spatial coherence with CPCA, and real-time results are not easily
achieved.

1138

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

for many common cases, allowing each material to be represented accurately with the correct number of BRDF terms
(an example is shown in Fig. 1). Equivalently, our work leads
to practical guidelines for what materials (how sharp a specular lobe) can be used, given a fixed computational budget
or frame rate.
2. Background
For direct lighting, the reflection equation can be written as
B(x, ω o ) =

Z

Ω

ωi )V (x, ω i )ρ(ω
ωi , ω o )(n(x) · ω i ) dω
ωi , (1)
L(ω

where B is the reflected light, L is the distant incident lighting, V is the (usually binary) visibility function, and ρ is the
BRDF (with n the surface normal). ω i and ω o are the incident and outgoing angles. For view dependent relighting,
it is common to factor the BRDF into a sum of terms, with
each term being the product of factors in incident and outgoing directions ω i and ω o ,

Figure 1: A scene with a number of different view-dependent
materials, rendered at interactive frame rates with in-out
BRDF factorization and CPCA. The number of terms for
each BRDF is chosen using our method, based on the theoretical analysis in the paper. As shown in the figure, more
terms are needed for the high-frequency measured materials with sharp specular reflections. Closeups comparing to
using a constant low number of terms, and to using the full
BRDF (ground truth) are shown in Fig. 8.

K

ωi , ωo ) =
ρ(ω

∑ σk hk (ωωo )gk (ωωi ),

where σk are the singular values in a Singular Value Decomposition (SVD) of the BRDF. This allows us to precompute
a transport function for each term
ωi )(n(x) · ω i ).
Tk (x, ω i ) = V (x, ω i )gk (ω

For Phong BRDFs, we are able to analytically compute
the factorization over the full sphere of directions, showing
that the factors correspond closely to spherical harmonic basis functions.§
We generalize these results to Phong and other BRDFs
limited to the visible hemisphere. A key result is that the
number of terms needed is linear in the Phong exponent,
and quadratic in the frequency content along the reflected
or half-angle direction. One consequence is that a low-term
factorization is accurate only for small to moderate glossiness. Practical guidance on numbers of terms needed is given
§ Our analysis has some similarities to spherical harmonic convolution approaches [RH01], as well as analytic PCA decompositions
of the light transport function [Ram02,MKSRB07], but is distinct in
focusing on the BRDF. In [MKSRB07], the analysis is done in 2D
and then extended by some empirical observations to 3D. In contrast, we provide precise and correct expressions for eigenvalues and
eigenvectors for phong (or any radially symmetric) BRDF in 3D.

(3)

Note that Tk is now view-independent, and relighting reduces
to
K

the falloff of eigenvalues. However, that does not confer insight nor generalize to different materials. Moreover, explicitly doing a SVD and choosing the number of terms can be
expensive. This paper addresses these questions analytically
and numerically.

(2)

k=1

B(x, ω o ) =

∑ σk hk (ωωo )
k=1
K

=

Z

ωi
L(x, ω i )Tk (x, ω i ) dω

∑ σk hk (ωωo )Tk · L,

(4)

k=1

where the integral over incident directions ω i is typically reduced to a simple dot product Tk · L in a wavelet representation for environment map lighting. Equation 4 corresponds
to the formulation introduced by [WTL04, LSSS04]. More
recently, [WTL06] describe a simple extension, that uses the
same BRDF factorization to also include interreflections.
In this paper, we analyze the BRDF factorization in equation 2 and the number of terms K needed. While our work is
focused on PRT, the results also have fundamental implications for BRDF representation and analysis. Note that the final image accuracy ultimately depends on equation 4. However, since natural illumination has content at all frequencies,
the accuracy of the BRDF filter is usually the limiting factor,
and we therefore focus on equation 2. Actual examples rendered with PRT and complex lighting, that verify the theory
developed in this paper, are shown in Figs. 1, 6 and 8.
3. Analysis for Phong BRDF
It is easiest for our analysis to start with the canonical Phong
BRDF. We will see that in this case, we can derive analytic
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

1139

Figure 2: Numerically computed eigenvectors and eigenvalues (same as singular values) for the BRDF matrix corresponding
to Phong over the full sphere of directions. Leftmost, we show rendered spheres with exponents s = 10 and s = 30 (a small
ωi ) and hk (ω
ωo ) with red
diffuse color is added here and in Fig. 3 only to aid in visualization). We show the eigenvectors gk (ω
denoting positive values and blue denoting negative values, and see that they correspond to the spherical harmonic (SH) basis
functions independent of exponent s (as predicted by the theory, the sign of hk depends on (−1)m ). Rightmost, we show a graph
of the numerically computed eigenvalues or singular values (circles) comparing to the theoretical predictions Fl (solid line),
with excellent agreement.

results that give considerable insight and indicate the number
of terms needed. While exact analytic formulae are not available in other cases, the same insights hold for many other
BRDF models.

We now set cos γ = R · L, where γ is the angle between
reflected and illumination directions. Then,
∞

ρ = f (γ) =

s+1
(R · L)s ,
(5)
2π
where s is the Phong exponent, R is the reflection of the
view direction about the surface normal, and L is the light
direction.

Much analytic insight is gained by considering the BRDF as
defined over the full sphere (rather than only visible hemisphere) of incident and outgoing directions. Since the Phong
lobe decays away from the reflected direction, this assumption does not significantly change the behavior of the model.
Later in this section, we will explicitly consider the restriction to the visible hemisphere only.
We now proceed by expanding in spherical harmonics Ylm
[Mac48]. Since all BRDF values and numerical computations use real numbers, we use the real (as opposed to complex) form,
√
2Nlm Plm (cos θ) cos mφ
m>0
Ylm (θ, φ) =
Yl0 (θ, φ) =
Ylm (θ, φ) =

√

Nlm Plm (cos θ)
|m|
2Nl|m| Pl (cos θ) sin | m | φ

where we use only the zonal harmonics Yl0 (γ, ·) since the
BRDF has no azimuthal dependence (is symmetric) when
written in this way. Now, we invoke the spherical harmonic
addition theorem,¶
Yl0 (γ, ·) =

3.1. Spherical Harmonic Expansion

m=0
m < 0, (6)

where (θ, φ) are spherical coordinates, Nlm is a normalization factor and Plm are the associated Legendre polynomials.
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

(7)

l=0

We start by considering the normalized Phong BRDF,
ρ=

∑ fl Yl0 (γ, ·),

=

l
4π
Y (R)Ylm (L)
∑
2l + 1 m=−l lm
l
4π
Y (θo , φo ± π)Ylm (θi , φi ). (8)
∑
2l + 1 m=−l lm

The first line above is simply the statement of the spherical harmonic addition theorem. The second line uses the fact
that the elevation and azimuthal angles for R are simply θo
and φo ± π, and also inserts the incident angles (θi , φi ) for
L. Finally, from the definitions in equation 6, it is clear that
Ylm (θo , φo ±π) = (−1)mYlm (θo , φo ). Applying this to the en-

¶ The complex form of the addition theorem is more commonly
∗ (R)Y (L), where Y ∗ is the complex
known, with the sum over Ylm
lm
lm
conjugate. It can be shown, by explicitly writing the complex harmonics in terms of real and imaginary parts, that this is equivalent
to equation 8 for real harmonics.

1140

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

tire BRDF, we obtain
∞

ρ(ωi , ωo ) = f (γ) =

l

∑ ∑

For Phong BRDFs, [RH01] have given an approximate
formula for Fl as

Fl (−1)mYlm (θo , φo )Ylm (θi , φi ),

l=0 m=−l

(9)
where Fl = fl 4π/(2l + 1). The reason for writing the
spherical harmonic expansion in this way, is that it provides
a direct analytic factorization into the form we seek with
terms that depend only on ω o (i.e. (−1)mYlm (θo , φo )) and
only on ω i (i.e. Ylm (θi , φi )).

l2
.
2s

Consider the SVD decomposition of the Phong function, defined over the full sphere of directions (we will consider a
restriction to the visible hemisphere, as required for physical
BRDFs, shortly).
We simply write the BRDF in the form of equation 2, and
identify the singular values σk as well as orthonormal basis
functions gk and hk . Consider the form of equation 9, using a
single index k to identify the terms (l, m). We can write σk =
ωo ) = (−1)mYlm (θo , φo ) gk (ω
ωi ) = Ylm (θi , φi ).
Fl , and hk (ω
The gk and hk are clearly orthonormal, since they are simply
spherical harmonic basis functions. Therefore, by uniqueness of the SVD, equation 9 directly represents the Singular
Value Decomposition of the BRDF.
To verify these results numerically, we constructed a
ωi , ω o ) using a resolution of (40)4 in
BRDF matrix ρ(ω
(θi , φi , θo , φo ). To preserve correct sampling on the sphere,
we uniformly sampled along cos θ and φ. We then computed
the SVD using Matlab, and plotted eigenvectors and eigenvalues. Figure 2 shows our results. We can verify that the
functions gk and hk are simply the spherical harmonics independent of the Phong exponent s. Moreover, the singular
values or eigenvalues are simply Fl (these depend on s, since
the decay of Fl is faster for smaller exponents). Note that
each eigenvalue Fl is repeated 2l + 1 times because m ranges
from −l to +l.
3.3. Number of Terms Needed
These results enable us to easily determine the number of
BRDF terms K needed for a given material. First, we must
determine up to what frequency l ∗ we need to represent the
BRDF accurately. Then, the number of terms
2

.

(10)

Note that K is quadratic in the frequency content l ∗ of the
BRDF, since there are 2l +1 terms for each singular value Fl .
We will see that this quadratic growth holds quite generally
for many BRDFs.

For simplicity of exposition, we use the terms eigenvalues and
eigenvectors loosely and interchangeably with the formally correct
nomenclature of singular values and left/right singular vectors.

(11)

One can use an appropriate threshold for how many terms
are needed to preserve accuracy. A common very conservative threshold is for the spherical harmonic coefficients
√ to
decay so that Fl ≈ exp[−3] which corresponds to l ∗ ∼ 6s.
Therefore, we have
K ≈ 6s.

3.2. SVD on Full Sphere

K = l∗ + 1

Fl ≈ exp −

(12)

The number of terms grows linearly with the Phong exponent.
These results are verified numerically in Fig. 3, where
we consider the number of terms needed for 99% accuracy
for Phong BRDFs of increasing exponent s (Fig. 3A). It is
seen that the number of terms needed grows linearly with
the Phong exponent as expected (graph is a straight line),
with 99% accuracy reached for K ≈ 5s (the value of K = 6s
in equation 12 is a bit too conservative). In the same figure, we show the effects of decreasing the number of terms
used (Fig. 3B). In effect, this corresponds to fewer spherical
harmonic coefficients and a lower-frequency BRDF. This is
essentially similar to decreasing the Phong exponent—the
result still looks like a glossy sphere, but is no longer accurate.
3.4. SVD on Hemispheres
In reality, the BRDF is defined (or non-zero) only over
the visible hemispheres for incident and outgoing angles.
Clamping it in this way can provide a more compact SVD
with fewer terms. We emphasize that any rendered images
(as in Figs. 3 and 4) will still consider the full sphere of
normals; the restriction applies only to the BRDF matrix,
where we restrict incident and outgoing angles (local light
and view directions) to the physically valid visible hemisphere. A fully analytic factorization is no longer possible,
but we can still derive and verify a number of significant results.
Most relevant to our analysis is the work of [MKSRB07],
that explicitly considers the reduction in the number of
eigenvalues when we go from a larger patch to a smaller one
(in this case, the full sphere to a hemisphere). That analysis
is based on the Szego eigenvalue theorem and its extension
to the spherical domain [GS58, Oki96]. We will not repeat
these rather technical details here, except for remarking that
our example, with a mathematical form of f (R · L) satisfies the relevant assumptions. The main result is that on the
hemispherical domain, we will need approximately half the
number of singular values for similar accuracy. The eigenmodes are no longer exactly spherical harmonics but still
low-frequency basis functions.
This is validated numerically in Fig. 4, where we show the
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

1141

Figure 3: Number of terms needed and accuracy for reconstructing the Phong BRDF over the full sphere and only the visible
hemisphere. A: Number of terms for capturing 99% of the energy. The graph is clearly linear with Phong exponent, and number
of terms ≈ 5s for SVD over the full sphere, and 2.5s when SVD is done over only the (physically valid) visible hemispheres. B:
Accuracy of rendered images for different numbers of terms. Using fewer terms effectively corresponds to a lower frequency
BRDF with smaller Phong exponent s. Using only 4 or 16 terms as in some previous works often does not suffice, and 5s terms
are needed for high accuracy. C: Same as B when SVD is done only over the physical hemisphere. Half the number of terms
2.5s now suffices.

Figure 6: Showing the effects of increasing the number of BRDF factors in complex lighting with an actual PRT rendering, for
Phong exponent 30. Using 4 or 12 factors, as in some previous works, does not suffice in this case. As predicted by our theory,
we need 75 terms here to accurately match ground truth images.
SVD representation for a Phong BRDF with different exponents s, over the limited hemispherical domain. In fact, the
low-frequency eigenmodes still closely correspond to some
spherical harmonic basis functions (restricted to the hemisphere). More precisely, they are linear combinations of the
Ylm , where different l indices are somewhat mixed (but not
the m indices, since that controls the variation with azimuthal
angle φ, and remains orthogonal over the hemisphere). Interestingly, we observe that the dominant terms are still lowfrequency harmonics, largely independent of the Phong exponent. However, the number of terms is approximately half
of that for the spherical case at each level (l + 1 instead of
2l + 1). In particular, terms with dominant Ylm where l + m
is even are preserved, while those with l + m odd are usually
folded into other factors.
The eigenvalues are plotted in Fig. 5. The solid line corc 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

responds to the spherical eigenvalues Fl as in the graph in
Fig. 2, but the x-axis is scaled so that l is now the frequency
for the hemispherical SVD (i.e. a given eigenvalue k corresponds approximately to eigenvalue 2k in Fig. 2 right).
Notice that the spherical and hemispherical eigenvalues are
approximately the same, but there are now l + 1 (instead of
2l + 1) eigenvalues for frequency l. Hence, we verify that the
number of eigenvalues needed for a given accuracy reduces
to approximately half that for the SVD on the full sphere.
Regarding the number of terms needed, K is still linear in
the Phong exponent s and quadratic in the frequency content
l ∗ , but we must now divide by a factor of 2,
2

K≈

(l ∗ + 1)
2

K≈

5s
.
2

(13)

1142

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

(2.5)s as expected. Similarly, Fig. 3C indicates that accuracy
degrades as fewer terms are used, leading to the perception
of a glossy material but with a much lower effective Phong
exponent. These results are also consistent with those for the
full sphere SVD in Figs. 3A and 3B.
Practical Implications: It is important to understand the
practical consequences of these results for the types of
BRDFs that can be used. A Phong BRDF of s = 1 requires
2 − 3 terms for accurate representation. Most previous work
has used at most K = 16 terms, which can give accurate results only for a low-frequency Phong BRDF with s ≈ 6. (As
seen in Fig. 3C, moderate Phong exponents like s = 30 cannot be represented accurately with 16 terms.) Most importantly, equation 13 provides immediate practical guidance as
to the number of terms K to use for a given material. Equivalently, for a given K, it tells us what types of BRDFs (how
sharp a specular lobe) we can accurately represent.
Figure 4: Numerical eigenvectors for SVD of BRDF matrix,
where incident and outgoing angles are restricted to the visible hemisphere of directions (compare to Fig. 2). The eigenmodes still correspond closely to spherical harmonic basis
functions, but mix Ylm with the same m. In general, dominant terms with Ylm where l + m is even are kept, while those
with l + m odd are incorporated into other eigenfunctions.
ωi ) and hk (ω
ωo ) are still low
The eigenvectors or factors gk (ω
frequency basis functions, largely similar (though not identical) for different Phong exponents s.

An example using an actual PRT system and environment map lighting is shown in Fig. 6, with Phong exponent s = 30. We see that increasing the number of BRDF
terms more accurately captures the specularities. As expected K ≈ 2.5s = 75 terms provides accurate results, and
smaller numbers of terms blur the specular reflections. We
chose drastically fewer terms for comparisons because these
are the typical number of terms used in most of the current
PRT methods. In general, the quality of the results increases
smoothly with the number of terms. This is not surprising
since our threshold is typically 99% of the energy, but other
thresholds like 90% or 95% could as well be used.
4. General BRDFs
Completely analytic results are not easily derived for general
BRDFs. However, we can make a number of observations.
First, consider half-angle BRDF models like Blinn-Phong
or Torrance-Sparrow with the simplified form

ρ=
Figure 5: Eigenvalues for SVD of BRDF matrix, where incident and outgoing angles are restricted to the visible hemisphere of directions. The solid line corresponds to Fl on the
full sphere, but l is now the frequency on the hemisphere—
note that there are now l + 1 eigenvalues for given l, instead
of 2l + 1 on the sphere. As expected from [Mahajan et al.
2007], the hemispherical and spherical eigenvalues are similar, but the number of terms needed for the hemispherical
SVD is reduced to approximately half.

These results are verified numerically in Figs. 3A and 3C.
The number of BRDF terms for 99% accuracy is linear in
the Phong exponent s. Comparing to the spherical case in
Fig. 3A, approximately half the terms are needed, i.e. K ≈

exp −

cos−1 (N·H)
σ

4πσ2

2

.

(14)

In general, these models are a function of the angle between
the normal N and half vector direction H. For exitant angles
far from grazing, it can be shown [RH01] that the spherical
harmonic coefficients Fl ≈ exp[−(σl)2 ].
The number of terms needed K is therefore proportional
to 1/σ2 . In fact, we find from Fig. 7C that l ∗ ≈ 1/(2σ2 ) for
σ ranging from 0.1-0.25 (the constant factors change somewhat, requiring higher l ∗ and more terms for larger σ). In
practice, because of the relation between the half-angle and
incident or reflected directions, we find that we need about
half as many terms as for the equivalent Phong model with
dependence on the reflected direction, (i.e. K ≈ (l ∗ )2 /4).
Therefore, a rough surface BRDF with σ = .2 would need
about 60 terms for accurate representation (many specular
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

1143

the measured BRDF database of [MPBM03]. For the measured materials, we first computed the θh dependence by
averaging BRDF values across different θd , omitting grazing angles where data is incomplete or noisy.∗∗ Some of
our data-driven θh curves are shown in Figs. 7A and 7B,
where we also show the Torrance-Sparrow model with σ
= 0.1 and 0.2 for reference. From this data, we find l ∗ by
a spherical harmonic transform. Figure 7C plots the number of terms K needed for many different measured materials and Torrance-Sparrow values of σ. As expected, K ≈
(l ∗ )2 /4, with most measured BRDFs lying close to the line
for Torrance-Sparrow.

Figure 7: Number of terms needed for general measured
and analytic BRDFs. A and B show half-angle curves (dependence on θh ) for two representative BRDFs from the
Matusik database, along with reference Torrance-Sparrow
curves. l ∗ can be found directly from these curves. C plots
the number of terms K for 99% accuracy vs (l ∗ )2 for
Torrance-Sparrow BRDFs with different roughness σ, as
well as for many measured materials. We verify that, in general, the number of terms K is quadratic in the frequency
content l ∗ , or linear in (l ∗ )2 . Moreover, K for most measured
materials is close to the line graph for Torrance-Sparrow, indicating the generality of our results for most BRDFs.

materials have σ in the range of 0.1 − 0.2). A broad specular
lobe of σ = .4 would still need about K = 10 − 20 terms.
These results can also be generalized to data-driven factorizations of BRDFs into functions of half and difference
angles [LBAD∗ 06]. In that case, one can determine l ∗ for
the half-angle curve, and then use the analysis above to find
the number of terms needed.
Practical Implications: The highest frequency components come from the specular 1D half-angle dependence,
and a spherical harmonic transform can give us frequency
l ∗ to a desired tolerance for measured data. For analytic
BRDFs like Phong or Torrance-Sparrow, l ∗ can be computed from the formulae given earlier. Once we know the
frequency content l ∗ , the number of terms will be quadratic,
so that K ∼ (l ∗ )2 (actually for the half-angle dependence,
K ∼ (l ∗ )2 /4). This provides a general recipe for determining the number of terms needed for both analytic and measured BRDFs. The Phong BRDF results
√ seen in Sec. 3 can
be seen as a special case, where l ∗ ≈ 6s, as noted above
equation 12.
Figure 7 verifies these results using both analytic
Torrance-Sparrow BRDFs, and a number of materials from
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

Finally, Fig. 1 shows an actual result of using our method
in PRT, on a scene of moderate complexity with 17,000
vertices. The number of BRDF terms is selected based on
the analysis above, for both the measured materials and the
Torrance-Sparrow BRDFs. As seen in the closeups in Fig. 8,
simply using a constant low number of terms for all objects, as in most previous work, does not suffice for accurate results. At the same time, using a very large number of
terms for all objects would slow performance below interactive rates. Our analysis enables the correct number of BRDF
terms to be used for each object, with accurate real-time results.
5. Conclusions and Future Work
This paper has conducted a theoretical analysis of the InOut BRDF factorization for view-dependent relighting, and
validated it with extensive numerical simulations. We have
shown that the number of terms needed grows quadratically
with the frequency content of the BRDF, and linearly with
the Phong exponent or equivalent.
These results make immediate practical contributions,
since equation 13 gives a prescription for choosing the number of terms, as illustrated by PRT images shown in Figs. 1, 6
and 8. Equivalently, given a fixed budget, it tells us how to
limit the specularity of materials in the scene. As examples
of general guidance, a Phong exponent of s = 1 requires
2 − 4 terms. A moderate Phong exponent of 20 would need
about 50 BRDF factors. In practical applications where the
number of terms K needs to be limited (to say 10 − 20), only
low frequency materials with s < 10 can be used accurately.
An interesting future direction is developing more compact factorizations for higher performance (using fewer
terms K). This line of work is especially challenging because
the requirement of view-independence for one of the BRDF
factors precludes alternatives like half and difference angles.
More broadly, we may consider general solutions to the difficult problem of all-frequency light and view manipulation
for highly specular materials. The main alternative is the use
∗∗ For this figure, we averaged across the RGB colors, but it is also
possible to simply treat the three color channels separately as in our
renderings.

1144

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

Sloan Research Fellowship, and an ONR Young Investigator
award N00014-07-1-0900.

References
[DAG95] D ORSEY J., A RVO J., G REENBERG D.: Interactive design of complex time-dependent lighting. IEEE
Computer Graphics and Applications 15, 2 (1995), 26–
36.
[GS58] G RENANDER U., S ZEGO G.: Toeplitz Forms and
Their Applications. University of Calif. Press, Berkeley
and Los Angeles, 1958.
[IDYN07] I WASAKI K., D OBASHI Y., YOSHIMOTO F.,
N ISHITA T.: Precomputed radiance transfer for dynamic
scenes taking into account light interreflection. In EuroGraphics Symposium on Rendering (2007), pp. 35–44.
[KM99] K AUTZ J., M C C OOL M.: Interactive rendering
with arbitrary BRDFs using separable approximations. In
EuroGraphics Symposium on Rendering (1999), pp. 247–
260.

Figure 8: Closeups of the apple and teapot from Fig. 1. Using a constant small number of 10 terms in the BRDF factorization, as in some previous methods, is insufficient to reproduce high-frequency specularities, while using the number
of terms predicted by our method provides accurate results.
Our method allows one to choose the required number of
terms separately for each object, with fewer terms required
for the lower-frequency materials in Fig. 1 (table and Buddha), and more for the objects shown here.

of triple product integrals [NRH04]. In that work however,
visibility and BRDF are factored and represented in different
spaces. This makes it very hard to exploit spatial coherence
using methods like CPCA, which are needed for real-time
performance. Thus, there remain fundamental challenges to
view-dependent relighting (how to exploit spatial coherence
in triple products, or how to more efficiently factor BRDFs).
Much of the recent progress in PRT is based on a number
of clever approximations and factorizations that give pleasing visual results. However, the accuracy of these approximations is often not clearly understood. With the growing
maturity of the field, it is critical to develop a firm mathematical foundation by conducting a careful theoretical and
empirical analysis of common approximations, and we see
this paper as an important step in that direction.
Acknowledgements
This work was supported in part by the NSF (grants CCF
03-05322, IIS 04-30258, CCF 04-46916, CCF 07-01775), a

[LBAD∗ 06] L AWRENCE J., B EN -A RTZI A., D E C ORO
C., M ATUSIK W., P FISTER H., R AMAMOORTHI R.,
Inverse shade trees for nonRUSINKIEWICZ S.:
parametric material representation and editing. ACM
Transactions on Graphics (SIGGRAPH 2006) 25, 3
(2006), 735–745.
[LSSS04] L IU X., S LOAN P., S HUM H., S NYDER J.:
All-frequency precomputed radiance transfer for glossy
objects. EuroGraphics Symposium on Rendering 2004
(2004), 337–344.
[Mac48] M AC ROBERT T.: Spherical harmonics: an elementary treatise on harmonic functions with applications.
Dover Publications, 1948.
D.,
K EMELMACHER [MKSRB07] M AHAJAN
S HLIZERMAN I., R AMAMOORTHI R., B ELHUMEUR
P.: A theory of locally low dimensional light transport.
ACM Transactions on Graphics (SIGGRAPH 2007) 26, 3
(2007), 62.
[MPBM03] M ATUSIK W., P FISTER H., B RAND M.,
M C M ILLAN L.: A data-driven reflectance model. ACM
Transactions on Graphics (SIGGRAPH 2003) 22, 3
(2003), 759–769.
[NRH03] N G R., R AMAMOORTHI R., H ANRAHAN P.:
All-frequency shadows using non-linear wavelet lighting
approximation. ACM Transactions on Graphics (SIGGRAPH 2003) 22, 3 (2003), 376–381.
[NRH04] N G R., R AMAMOORTHI R., H ANRAHAN P.:
Triple product wavelet integrals for all-frequency relighting. ACM Transactions on Graphics (SIGGRAPH 2004)
23, 3 (2004), 475–485.
[NSD94]

N IMEROFF J., S IMONCELLI E., D ORSEY J.:

c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

Dhruv Mahajan et al. / An Analysis of the In-Out BRDF Factorization for View-Dependent Relighting

Efficient re-rendering of naturally illuminated environments. In EuroGraphics Workshop on Rendering (1994),
pp. 359–373.
OVERBECK R., B EN -A RTZI A., R A R., G RINSPUN E.: Exploiting temporal
coherence for incremental all-frequency relighting.
In EuroGraphics Symposium on Rendering (2006),
pp. 151–160.

[OBARG06]

MAMOORTHI

[Oki96] O KIKIOULU K.: The analogue of the strong
Szego limit theorem on the 2- and 3- dimensional spheres.
Journal of the American Mathematical Society 9, 2
(1996), 345–372.
[Ram02] R AMAMOORTHI R.: Analytic PCA construction
for theoretical analysis of lighting variability in images of
a lambertian object. IEEE PAMI 24, 10 (2002), 1322–
1333.
[RH01] R AMAMOORTHI R., H ANRAHAN P.: A signal
processing framework for inverse rendering. In Proceedings of SIGGRAPH (2001) (2001), 117–128.
[Rus98] RUSINKIEWICZ S.: A new change of variables
for efficient BRDF representation. In EuroGraphics Symposium on Rendering (1998), pp. 11–22.
[SHHS03] S LOAN P., H ALL J., H ART J., S NYDER J.:
Clustered principal components for precomputed radiance
transfer. ACM Transactions on Graphics (SIGGRAPH
2003) 22, 3 (2003), 382–391.
[SKS02] S LOAN P., K AUTZ J., S NYDER J.: Precomputed
radiance transfer for real-time rendering in dynamic, lowfrequency lighting environments. ACM Transactions on
Graphics (SIGGRAPH 2002) 21, 3 (2002), 527–536.
[SZC∗ 07] S UN X., Z HOU K., C HEN Y., L IN S., S HI J.,
G UO B.: Interactive relighting with dynamic BRDFs.
ACM Transactions on Graphics (SIGGRAPH 2007) 26,
3 (2007), 27.
[TS06] T SAI Y., S HIH Z.: All-frequency precomputed radiance transfer using spherical radial basis functions and
clustered tensor approximation. ACM Transactions on
Graphics (SIGGRAPH 2006) 25, 3 (2006), 967–976.
All[WTL04] WANG R., T RAN J., L UEBKE D.:
frequency relighting of non-diffuse objects using separable BRDF approximation. In EuroGraphics Symposium
on Rendering (2004), pp. 345–354.
All[WTL05] WANG R., T RAN J., L UEBKE D.:
frequency interactive relighting of translucent objects
with single and multiple scattering. ACM Transactions on
Graphics (SIGGRAPH 2005) 24, 3 (2005), 1202–1207.
All[WTL06] WANG R., T RAN J., L UEBKE D.:
frequency relighting of glossy objects. ACM Transactions
on Graphics 25, 2 (2006), 293–318.
[WZH07] WANG R., Z HU J., H UMPHREYS G.: Precomputed radiance transfer for real-time indirect lighting usc 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

1145

ing a spectral mesh basis. In EuroGraphics Symposium
on Rendering (2007).

