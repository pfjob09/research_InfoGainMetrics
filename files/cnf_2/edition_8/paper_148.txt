Eurographics Symposium on Geometry Processing 2008
Pierre Alliez and Szymon Rusinkiewicz
(Guest Editors)

Volume 27 (2008), Number 5

G2 Tensor Product Splines over Extraordinary Vertices
Charles Loop1 and Scott Schaefer2

2 Department

1 Microsoft Research
of Computer Science, Texas A&M University

Abstract
We present a second order smooth filling of an n-valent Catmull-Clark spline ring with n biseptic patches. While
an underdetermined biseptic solution to this problem has appeared previously, we make several advances in this
paper. Most notably, we cast the problem as a constrained minimization and introduce a novel quadratic energy
functional whose absolute minimum of zero is achieved for bicubic polynomials. This means that for the regular
4-valent case, we reproduce the bicubic B-splines. In other cases, the resulting surfaces are aesthetically well
behaved. We extend our constrained minimization framework to handle the case of input mesh with boundary.
Categories and Subject Descriptors (according to ACM CCS): I.3.5 [Computer Graphics]: Curve, surface, solid, and
object representations

1. Introduction
Catmull-Clark subdivision surfaces have become a standard
modeling primitive in computer generated films and video
games [CC78]. The success of this algorithm is due to its
ability to model surfaces of arbitrary genus, possibly with
boundary [Nas87]. The modeling paradigm is simple: a user
specifies a coarse control mesh consisting of vertices, faces,
and edges that approximates a desired shape; the CatmullClark surface smoothly approximates the control mesh in
an intuitive fashion. Artists easily grasp the behavior of
these shapes relative to the control mesh. However, subdivision surfaces contain shape defects at extraordinary vertices (where the number of incident edges is not equal to 4).
In general the surface is only C1 at these isolated points. In
entertainment scenarios, the viewpoint is controlled or the
presence of isolated shape defects is acceptable. For modeling high quality shapes, subdivision surfaces are inadequate.
Subdivision surface behavior at extraordinary vertices
has been extensively studied and their shape artifacts are
by now well understood [DS78, Rei95, PR98, Pra98, RS99].
Tangent plane continuity at extraordinary vertices was formally established in [Rei95]. However, no modification to
the subdivision rules will result in curvature continuity at
these points [Pra98]. Modifications that bound the otherwise
unbounded curvature at extraordinary vertices have appeared
[Sab91, ADS06, GU07]. A weak form of curvature continuc 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.
Published by Blackwell Publishing, 9600 Garsington Road, Oxford OX4 2DQ, UK and 350
Main Street, Malden, MA 02148, USA.

ity has been achieved by locally projecting the control mesh
to a flat spot with zero curvature [Rei98, PU98]. True curvature continuity has been obtained by blending a disk shaped
region about the extraordinary vertex with a quadratic shape
[Zor06, Lev06]. All of these schemes are concerned with the
limiting behavior of the subdivision process, and not the removal of the underlying singularities in the mapping from a
manifold domain to an embedding space.

Figure 1: a) Each subdivision step adds a new spline ring to
the interior of the hole created by an extraordinary vertex. b)
The work presented in this paper fills the hole in a CatmullClark spline ring with n biseptic patches P0 , . . . , Pn−1 . Examples of vertex types 1, 2, and 3 are also shown.
These singularities, corresponding to the extraordinary
vertices of the control mesh, are a result of the inherently

1374

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

functional spline machinery used by many subdivision algorithms. That is, Catmull-Clark surfaces are bicubic tensor product B-splines, albeit over procedurally defined control meshes with infinite structure. Such a componentwise
functional spline is a deformation of a regular planar lattice,
so modeling an arbitrary genus surface with a more general
tessellation requires singularities. This fact is invariable ignored in the theoretical study of extraordinary vertex behavior under subdivision. Instead that study focuses on so-called
spline rings, a local collection of surface patches that form
an n-sided hole about an extraordinary vertex, see Figure 1a.
As subdivision proceeds, a new spline ring is formed inside
the hole such that the old and new spline rings join with the
smoothness of the underlying B-spline. In the limit, the nsided hole becomes infinitesimally small, but never vanishes.
This infinite set of polynomials and the limiting behavior at
extraordinary vertices complicates evaluation and processing of these surfaces [HKD93, Sta98] whereas surfaces composed of a finite set of polynomials are substantially simpler.

1.1. Problem Statement and Contributions
The problem we address can be reduced to the following:
Fill the hole in an n-valent Catmull-Clark spline
ring with n tensor product patches that join
each other and the spline ring with second order
smoothness.
See Figure 1b for an illustration. Our solution to this problem requires bidegree 7 patches. This result was originally
reported in [Loo04]. While that work established the existence of a biseptic solution space, ad-hoc means were used
to remove the extra degrees of freedom. Here we make several improvements and contributions; specifically
1. The derivation of the underdetermined biseptic solution
space is based entirely on properties of the correspondence maps between adjacent patches and the necessary
cocycle condition these maps must obey about vertices.
2. Our surface is defined as a constrained minimization over
a novel energy functional that achieves an absolute minimum of zero for bicubic patches and results in aesthetically pleasing shapes otherwise.
3. We solve for data independent basis functions explicitly,
as an off-line preprocess. Since the basis functions are
solved independent of the surface, we can manipulate
these surfaces in realtime.
4. We define basis functions to handle meshes with boundary such that the surface interpolates the cubic B-spline
curve defined by the mesh boundary.
Filling a spline ring with second order smooth surfaces has
practical applications in surface design. We use our results to
construct second order smooth surfaces over refined quadrilateral control meshes, where each quad has at most one incident extraordinary vertex. Refinement is needed to isolate

extraordinary vertices as is done for Catmull-Clark evaluation [Sta98]. Unlike Catmull-Clark surfaces, our surfaces are
second order smooth everywhere and contain a finite number
of polynomial patches.
1.2. Previous Work
Many papers addressing the problem of constructing first
and second order smooth patch complexes have appeared
over the last two decades. We mention here only those that
explicitly join tensor product polynomials with second order smoothness at extraordinary vertices. In [Pra97] an nvalent Catmull-Clark spline ring is filled with bidegree 6
patches; however, 4n such patches are needed. Similarly,
[GZ99] form a second order smooth join over extraordinary
vertices with 4n bidegree 5 patches. In [Pet02] a combination
of 2n bidegree 3 × 5 and 2n bicubic patches would be needed
to fill an n-sided hole surrounded by bicubics. In [KP07], a
collection 16n patches of bidegree 4 × 4 and 6 × 6 are used
to form a smooth complex surrounded by bicubic patches.
While other works have achieved lower bidegree, with respect to total control point count, bidegree 7 with n patches
is still the best result. This makes the scheme attractive for
GPU implementation since total data throughput is minimized. In this paper, we strive to improve shape quality, and
to make the results more practically applicable.
This paper is organized as follows. In Section 2 we present
aspects of geometric continuity necessary to derive our results. In Section 3 we specify the correspondence maps between adjacent patches as required by the definition of geometric continuity. In Section 4 we use the correspondence
maps to derive sets of constraints on the coefficients of adjacent patches needed for second order smoothness. In Section 5 we present a novel quadratic energy functional, then
show how this functional is minimized subject to our constraints in Section 6. We solve for data independent basis
functions, with support and boundary constraints in Section 7. Finally, we present results and conclude with Section 8.
2. Geometric Continuity
Given a pair of surface patches Pi , Pi+1 : [0, 1] × [0, 1] → Rm ,
we say Pi and Pi+1 meet with kth order geometric continuity
denoted Gk [DeR85], if there exists a map θ such that Pi
meets Pi+1 ◦ θ with parametric continuity Ck , that is
Gk

Ck

Pi = Pi+1 ⇒ Pi = Pi+1 ◦ θ .

More formally, this condition requires that the kth order
derivatives of the two patches after reparameterization with
respect to θ coincide. We refer to the map θ : R2 → R2 as
the correspondence map between Pi and Pi+1 . Technically θ ,
along with k of its transversal derivatives, only needs to be
defined on a line corresponding to the common patch boundary. However we find it convenient to define correspondence
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

maps in B´ezier form over the entire unit square; this way
transversal derivatives on edges and consistent mixed partial
derivatives at vertices are easily specified.
The derivatives of Pi+1 ◦ θ can be found via the chain rule
and yield a matrix equation of the form
Di = (Di+1 ◦ θ ) · Θ
where Di is a vector of the partial derivatives of Pi (i.e. Di =
∂ Pi
∂ Pi
∂ 2 Pi
... ) and Θ is a matrix obtained using
∂u
∂v
∂ u2
the chain rule that encodes the partial derivatives of θ . We
refer to Θ as the chain rule matrix of θ .
If we make the simplifying assumption that θ is the identity function along the common boundary, then the above
equation reduces to
Di = Di+1 · Θ,

(1)

when evaluated on the boundary. This assumption is reasonable as any other choice of θ would lead to higher degree
boundary curves with more smoothness constraints. Equation 1 tells us how to transform the derivatives w.r.t. the domain of Pi in terms of the derivatives of Pi+1 and θ .
For a cyclic collection of n patches Pi incident on a common vertex with correspondence maps θi between patches
Pi and Pi+1 , i = 0, . . . , n − 1 (indices taken modulo n), satisfying geometric continuity results in a cocycle condition
among the patches. If we evaluate equation 1 at the common
vertex for all patches, we find that

1375

3.1. Interior Correspondence Maps
We define interior correspondence maps in terms of the maps
φn : (u, v) → (x, y) defined by

φn,x (u, v) = b1 (u)T

0
1

cos

φn,y (u, v) = b1 (u)T

0
0

sin
tan

2π
n

1
2π
n
π
n

b1 (v),
b1 (v),

where bd (·) are degree d Bernstein polynomials. The geometry of φn is illustrated in Figure 2.1. Given that φn creates an
angle of 2nπ around the extraordinary vertex, the correspondence map from patch Pi to Pi+1 is φn−1 ◦ rn−1 ◦ φn where
rn is a counterclockwise rotation of 2nπ about the origin.
We verify the cocycle condition at a type 1 vertex using
the chain rule matrices Φn and Rn for φn and rn respectively. We form the composition of the correspondence maps
φn−1 ◦ rn−1 ◦ φn from patches 0 through n−1 and evaluate at
(0, 0), corresponding to the extraordinary vertex to get
−1
I = Φ−1
n · Rn · Φn

n

−1
= Φ−1
n · Rn

n

· Φn .

n

Notice that R−1
= I because rn−1 is a rotation of 2nπ . The
n
above expression only depends on Φn being locally invertible at (0, 0). The cocycle loop of correspondence maps incident on a type 1 vertex is illustrated in Figure 2.1.

D0 = D0 · Θn−1 · Θn−2 · . . . · Θ1 · Θ0 ,
for n patches incident on that vertex. Therefore, this relationship results in the additional requirement that
I = Θn−1 · Θn−2 · . . . · Θ1 · Θ0

(2)

3.2. Exterior Correspondence Maps

when evaluated at the common vertex [Hah89]. For Gk continuity a correspondence map must encode all kth order
transversal derivatives in the versal direction. If we differentiate k times in this direction, will get mixed partials of order
2k. These derivatives must agree at the common vertex in order to get a polynomial parameterization. Therefore, for Gk
continuity the chain rule matrices must encode derivatives
up to order 2k.

The second type of correspondence map we need is defined
over an edge between vertex types 2 and 3; this edge corresponds to the boundary of the spline ring. Unlike the interior
correspondence maps, we must carefully solve for the exterior correspondence maps. In previous work [Loo04] the
same correspondence maps were derived by appealing to the
embedding space of the resulting patches. Here we derive the
correspondence maps strictly in terms of abstract adjacency
relations of the underlying tessellation.

3. Correspondence Maps

We begin by defining maps ψn : (u, v) → (x, y), where n
is the valence of the nearby extraordinary vertex. The exterior correspondence maps will be defined by ψn (u, 1) and
ψn (1, v), where u, v ∈ [0, 1]. We require ψn to be the identity
on the edges (u, 0), (u, 1), (0, v), and (1, v). Parameter values
(1, 0) and (0, 1) correspond to type 2 vertices; (1, 1) corresponds to the type 3 vertex. Figure 2.2 illustrates the cocycle
loop where four patches meet at a type 2 vertex. Note that
this vertex might share an edge with another extraordinary
vertex of valence m, which is possible given the minimum
separation of extraordinary vertices we require. We can factor the cocycle composition into two parts, corresponding to

We will construct two types of correspondence maps on
edges joining three types of vertices:
1. an extraordinary vertex,
2. an edge adjacent neighbor of a type 1 vertex,
3. a face adjacent diagonal neighbor of a type 1 vertex,
see Figure 1b. Note that a type 1 vertex is n-valent, vertex types 2 and 3 are always 4-valent. Over the edge between vertex types 1 and 2 we define interior correspondence maps; over the edge between vertex types 2 and 3 we
define exterior correspondence maps.
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

1376

Figure 2: The cocycle maps for the 3 vertex types : 1) extraordinary vertex, 2) edge sharing neighbor of a type 1 vertex 3) face
sharing diagonal neighbor of a type 1 vertex

by equations 3 and 4 to find ψn,x (u, v) =


the two neighboring extraordinary vertices to get
I
−1

I = Q · Ψn · S · R−1
n · Φn

· Φn · Ψ−1
n

I

· Q · Ψm · S · R−1
m · Φm

−1

· Φm · Ψ−1
m ,

(3)

where Q is the chain rule matrix for q(u, v) = (u, −v) the
reflection across the u axis, S is the chain rule matrix for
s(u, v) = (v, u) the reflection across the diagonal u = v, Rn is
the chain rule matrix for a 2nπ rotation about the origin, and
Ψn is the chain rule matrix for ψn . Note that parameter for
evaluation of these matrices corresponds to the type 2 vertex. Both factors of equation 3 represent the identity and are
the same up to valence. The factor involving n will impose
constraints of various partial derivatives on ψn at the type 2
vertex.
Additional constraints on ψn come from the cocycle condition at the type 3 vertex. Figure 2.3 illustrates the cocycle loop where four patches meet at a type 3 vertex. We assume that this vertex may be a diagonal neighbor of four extraordinary vertices. By assuming the symmetry ψn (u, v) =
ψn (v, u), the cocycle composition at a type 3 vertex can be
factored into four parts, corresponding to the 4 arbitrary valence diagonal neighbors
I




4
T
b (u) 




0

0

0

0

1
4

5 c3n −3 c2n −15 cn +18
12 (cn −2)(2 cn −3)

c2n +2 cn −6
12 (cn −2)

1
4

cn +3
6
cn +9
12

1
2
3
4

1

c2n +3 cn −9
9 (cn −2)
cn +9
12

1
2
3
4

1

1

1






 3
 b (v),




2π
n

where cn = cos
. By the symmetry condition, we also
have ψn,y (u, v) = ψn,x (v, u). The derivation of this solution
is presented in Appendix A. Note that when n = 4, ψ4 = I.
4. Patch Smoothness Constraints
We now use the correspondence maps to determine second order smoothness constraints on the coefficients of the
patches Pi , i = 0, . . . , n − 1.
4.1. External Constraints
A Catmull-Clark spline ring surface is completely characterized by a 3-ring of points about an extraordinary vertex.
However, the second order behavior of the spline ring boundary can be described by a 2-ring. We label the points of this
2-ring in a cyclic fashion, as shown in Figure 3. Note that
we have n seven point sections and the central vertex is duplicated n times; doing so will give us a circulant system of
equations in Section 4.3.

I
−1

I = Ψk · (S · Ψk · S)
I

· Ψℓ · (S · Ψℓ · S)−1
I

−1

· Ψm · (S · Ψm · S)

· Ψn · (S · Ψn · S)−1 .

(4)

This expression holds since S · Ψn · S = Ψn .
We use the constraints imposed on the derivatives of ψn

We characterize the second order behavior of the spline
ring boundary with a set of n bicubic patches. The control
points of these bicubic B´ezier patches are found by applying
the cubic knot insertion operator


1

M=

1
6

 4
 1
0

0
4
2
0

0
2
4
0

0
1 
,
4 
1

c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

1377

and 7 are polynomials of known degree. From this, we can
deduce by degree counting, that the patches Pi must be bidegree 7.
To determine the number of constraints given by equations 5, 6, and 7, we note that each of these 3 equations is
a degree 7 polynomial with 8 degrees of freedom resulting
in 24 constraints. Therefore we have 48 constraints for both
edges of the external boundary. However, at u = v = 1 (corresponding to a type 3 vertex), the cocycle condition guarantees that the mixed partial derivatives will agree up to second
order, meaning that 9 of these constraints will be dependent;
so there are only 39 external constraints per patch, or 39n for
all patches sharing the type 1 vertex.

Figure 3: A 2-ring a with point labeling.

4.2. Internal Constraints
on the 2-ring control points. This will convert from B-spline
to Bernstein form resulting in n bicubic B´ezier patches
Hi (u, v) =




·

a10
i+2

a11
i+1

a21
i+1

a00
i

a10
i+1

a12
i−1

a10
i
a20
i

a11
i
a21
i


a20
i+1 

 a10
 i−1
b3 (u)T MT  11
 ai−1

 M b3 (v),


a12
i
a22
i

jk

where i = 0, . . . , n − 1 and ai are control mesh vertices from
Figure 3. Note that, due to the undefined control point (represented by a ”·” above), the patches Hi can only be evaluated along the external boundary (u, 1) and (1, v); however,
all derivatives up to second order are well defined on this
boundary. Furthermore, these derivatives will meet the surrounding spline ring with Ck continuity.
Next, we use the maps ψn from Section 3.2 to reparameterize the bicubic patches Hi to get constraints on the external edge of our patches; that is
∂ j P (1,t)
∂uj i

∂j
∂uj

=

(Hi ◦ ψn ) (1,t) ,

j = 0, 1, 2.

Expanding this expression using the chain rule results in the
following external constraints on patch Pi
Pi (1,t) = Hi (1,t),

(5)

∂
∂
∂
∂ u Pi (1,t) = ∂ x Hi (1,t) ∂ u ψn,x (1,t)
+ ∂∂y Hi (1,t) ∂∂u ψn,y (1,t),

(6)

∂ 2 P (1,t) = ∂ H (1,t) ∂ 2 ψ (1,t)
∂x i
∂ u2 i
∂ u2 n,x
2
+ ∂∂y Hi (1,t) ∂∂u2 ψn,y (1,t)
2

+ ∂∂x2 Hi (1,t)

∂ ψ (1,t)
∂ u n,x

2

2

We now derive constraints along internal patch edges. We
combine the internal correspondence map φn−1 ◦ rn−1 ◦ φn
between the pair of surface patches Pi (0,t) and Pi+1 (t, 0),
with the definition of second order geometric continuity to
get the relation
∂ j+k P (0,t) = ∂ j+k
∂ u j vk i
∂ u j vk

Pi+1 ◦ φn−1 ◦ rn−1 ◦ φn (t, 0)

where j + k = 0, 1, 2. Expanding this gives us G0 , G1 and G2
constraints
Pi (0,t) = Pi+1 (t, 0),
cn (1 − t)

∂
∂
∂ u Pi+1 (t, 0) + ∂ v Pi (0,t)

(8)
=

∂
∂
∂ v Pi+1 (t, 0) + ∂ u Pi (0,t)

2c2n (1 − t)

∂
∂
∂ v Pi+1 (t, 0) − ∂ u Pi (0,t)

2cn (1 − t) (1 + cn (1 − t))
= (1 + cn (1 − t))

,

(9)

+

∂2
∂2
∂ uv Pi+1 (t, 0) − ∂ uv Pi (0,t)

2
∂2 P
(t, 0) − ∂∂u2 Pi (0,t)
∂ v2 i+1

.

(10)

We count the number of constraints determined by these
equations as follows. Since patches Pi are biseptic, we can
deduce (by degree counting) the number of constraints in
equations 8, 9, and 10, are 8, 8, and 9 respectively; therefore we have 27 constraints per internal edge. However, the
external constraints derived in the previous section specify
the 9 second order mixed partial derivatives corresponding
to the type 2 vertex at Pi+1 (1, 0) and Pi (0, 1). By the cocycle condition, these derivatives will automatically satisfy 8,
9, and 10 resulting in 9 dependent constraints. Therefore the
geometric continuity conditions introduce 16n internal constraints.

+ 2 ∂∂xy Hi (1,t) ∂∂u ψn,x (1,t) ∂∂u ψn,y (1,t)
2

+ ∂∂y2 Hi (1,t)

∂
∂ u ψn,y (1,t)

2

.

(7)

The constraints along the boundary (t, 1) are defined similarly. All terms on the right hand sides of Equations 5, 6,
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

4.3. Constraint System
The 16n internal constraints combined with the 39n external
constraints results in a system of 55n equations. Each biseptic patch Pi has 64 coefficients, so we have a system of 55n

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

1378

equations in 64n unknowns. All of our constraints are polynomial equations that can written in terms of biseptic B´ezier
control points pijk and two-ring control mesh vertices alm
i .
We can write the constraints as a block circulant system
C p = W a,

6. Constrained Minimization
We can minimize quadratic energy pT E p subject to constraints Cp = W a using Lagrange multipliers. Differentiating with respect to p yields

∂
∂
pT E p =
pT CT − aT WT Λ,
∂p
∂p

(11)

that expands to

2E p = CT Λ.










c0

c1

0

c0

.
.
.
c1

0

···

.

.
.
.

.

.
0

···

0
c0















p0
p1
.
.
.
pn−1

w0



 wn−1


.

.

.
w1



These equations can be represented by a single block matrix




=


w1

···

w0
.

.

.



wn−1

.

.

.





w
1

wn−1

···

CT
0

E
C

w0

a0
a1
.
.
.
an−1






,



where pi are the unknown B´ezier control points of patch Pi ,
and ai the seven known vertices of the ith two-ring section
as labeled in Figure 3. Since this system is underdetermined,
we introduce an energy functional and find the solution that
minimizes this functional with respect to the constraints.

5. Bicubic Energy
Existing energy functionals, e.g. thin plate or biharmonics,
have the disadvantage that they are not zero for bicubic surfaces. Our constraint system will be consistent with tensor
product B-splines when n = 4. In order to generalize this
case, we must define a new energy functional. We therefore
introduce an energy functional, that to our knowledge has
not previously appeared in the CAGD literature, whose absolute minimum of zero is achieved for a bicubic tensor product patch, and all higher degree parameterizations of such a
patch.

p
Λ

=

1

1

energy =
0

0

∂ 4 F(u, v)
∂ u4

2

+

∂ 4 F(u, v)
∂ v4

2

du dv.

In our case, F = Pi is a biseptic patch. Since the coefficients
of Pi are at most squared, our energy functional can be written as a quadratic form
pTi E pi ,
where E is a symmetric 64×64 matrix. Because ∂ 4 /∂ u4 and
∂ 4 /∂ v4 are identically zero for all bicubic patches, any vector pi consistent with a bicubic patch (or a degree elevated
form) will be in the kernel of E, implying pTi E = E pi = 0.
We find the bicubic energy of the collection of patches Pi
by the product pT E p, where E is a block diagonal matrix
whose n blocks are the single patch bicubic energy matrix
E.

a.

This system can be put into block circulant form by permuting its rows and columns to get

















E
c0

cT0
0

0
0

cT1
0

0
c1

0
0

.
.
.

.

0
c1

0
0








=








0
w0

0
w1

0

.

.
cT1
0

0
0

···



0
c1
E
c0
0
wn−1

···

.
.
.

0
w0

wn−1
.
.
.

.

0
w1



.
.
.

cT0
0

E
c0

cT1
0

0
0

···

.

.

0
wn−1

···

0
w1
0
w0

0
0
cT0
0



p0

 λ
0


  p1

  λ1


.

.


.

  pn−1

λn−1




a0


  a1


.

.

.



an−1























,



Rather than solving this 119n × 119n system directly, we
transform the problem from the spatial to frequency domain
by applying the Discrete Fourier Transform to the blocks.
The Discrete Fourier Transform and Inverse Discrete Fourier
Transform are given by
n−1

xˆ j =

∑e

√
2π −1 i j
n

xi

and

xi =

i=0

Let F(u, v) be a tensor product patch. Our bicubic energy
functional is defined as the integral

0
W

1 n−1 −2π −1 i j
∑ e n xˆ j .
n j=0
√

We use the DFT to put the above system into block diagonal
form, where the solution is found by solving the n individual
119 × 119 blocks
E
cˆ j

cˆ Hj
0

pˆ j
λˆ j

=

0
ˆj
w

aˆ j ,

for j = 0, . . . , n − 1, where cˆ Hj denotes the conjugate transpose of cˆ j . The patch coefficients pi are found by taking the
IDFT of the solutions pˆ j .
7. Basis Functions
To this point, we have assumed that the two-ring data ai ∈
Rm comes from a control mesh. If we let ai take the form
[0, . . . , 0, 1, 0, . . . , 0] then we are instead solving for the bajk
sis function associated with some ai , corresponding to the
non-zero element. Since our constraint systems do not involve any actual data, only valence, we can solve for the
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

basis functions a priori, store the resulting basis patches and
multiply them by local mesh data at runtime. Since a tworing contains n sections of seven points, we only need to
find seven basis functions for each valence n. We label these
seven basis functions A00 , A10 , A20 , A11 , A21 , A12 , and A22 ,
where the indices correspond to the indices of aijk to which
they are associated.
An obvious question to ask about these basis function is:
are they non-negative? By inspecting the Bernstein coefficients of the basis patches, we find the answer to be no, but
just barely. There are a few negative coefficients on the order of 10−3 , so this prevents us from claiming the convex
hull property. We should point out that these negative values do not come from the external constraints; so a different
(yet to be determined) energy functional could lead to the
convex hull property. Alternatively, we could find the convex minimum to our constrained minimization problem; but
this is complicated by the fact that we solve our system in
the frequency domain, and convexity must be satisfied in the
spatial domain. We leave this option for future work.
Another issue concerning the basis function is their support; that is, the collection of faces where a basis function
non-zero. Presently, every basis function supported over an
extraordinary vertex, will have support over all faces incident on that vertex. Ideally, the support of a basis function
should not extend beyond the two-ring of its corresponding vertex. Otherwise, an extraordinary patch will depend
on vertices outside the 1-ring of a quadrilateral face (i.e.,
vertices not connected by an edge to one of the quad face
vertices). This extended support occurs for basis functions
A20 , A21 , A12 , and A22 . Note that the patches outside the
two-ring of the basis function are nearly zero, but not absolutely. We illustrate the point for the basis function A21 in
Figure 4. To deal with this issue, we enforce additional support constraints on patches associated with basis functions
A20 , A21 , A12 , and A22 .

1379

7.1. Support Constraints
To enforce ideal support we solve modified constraint systems. The cases of A20 , and A21 are similar; we treat A12 as
an instance of A21 since they are the same up to diagonal reflection. In these cases, we want the basis functions to have
support over two adjacent patches Pi (u, v) and Pi+1 (u, v) incident on the extraordinary vertex. We impose external constraints 5, 6, and 7 on these two patches, as well as the
internal geometric continuity constraints 8, 9, and 10 on
the shared boundary Pi (0,t) = Pi+1 (t, 0). Next, we add constraints to force the basis function support boundary Pi (t, 0),
and Pi+1 (0,t) to go to zero, along with all derivatives up to
second order
∂ k P (t, 0) = 0,
∂ vk i

∂ k P (0,t) = 0,
∂ uk i+1

for k = 0, 1, 2. All patches other than Pi and Pi+1 are set to
zero. We then solve for minimum bicubic energy as before.
Since we only need to solve for two patches, we do so in the
spatial domain.
Enforcing two-ring support on the basis function A22 is
similar, except we only need to solve for a single patch. We
use the external boundary constraints, along with constraints
that force all derivatives up to second order along boundaries
Pi (0,t) and Pi (t, 0) to zero.
Prior to enforcing the support constraints, the basis function were guaranteed to sum to 1 since the columns of the
matrix W in equation 11 sum to 1. Adding support constraints to select basis functions will cause this property to
be violated. We can restore a partition of unity by simply
defining
A00 = 1 −

∑ Aijk .
i jk

7.2. Boundary Basis Functions
Not all control meshes are closed. Frequently, artists model
control meshes with boundary. For Catmull-Clark subdivision surfaces, the subdivision rules are modified so that the
surface interpolates the cubic B-spline curve defined by the
boundary edges [Nas87, BLZ00]. We can adapt this behavior to our surfaces by imposing mesh boundary constraints
that force the surface to interpolate the boundary cubic Bspline curve.
Figure 4: Contours from −1/2000 to 1/2000 by 1/20000.
Red are positive contours, green zero, and blue negative.
This basis function reaches a maximum height 4/9 at the
solid dot, so the band of contours shown represents 0.225%
of the height of the basis function. The basis function A21 is
shown a) without support constraints, and b) with support
constraints

c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

We assume a boundary extraordinary vertex is surrounded
by a half two-ring of mesh control points. We denote the
valence of a boundary extraordinary vertex by m, the number
of incident faces. We use the same correspondence maps as
before, with the caveat that n = 2m.
First we need to modify the external boundary constraints
to take into account the presence of a mesh boundary. We

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

1380
define two bicubic patches




a10
2

a11
1

a21
1

 a00
 0
H¯ 0 (u, v) = b3 (u)T MT  10
 a0

a10
1


a20
1 

a20
0

a11
0
a21
0

¯ b3 (v),
M


a12
0
a22
0

and
H¯ m−1 (u, v) =


a10
m−2

¯ T
b (u) M
 a11
m−2
3

T

a12
m−2

a00
m

a10
m

a20
m

a10
m−1
a20
m−1

a11
m−1
a21
m−1

a12
m−1
a22
m−1




 M b3 (v),

where
¯ =
M

1
6



6
 0
0

4
2
0

2
4
0



1
4 .
1

Figure 6: From left to right: the control mesh, the patch
structure of a Catmull-Clark surface with bicubic patches
shown in gray (top) and our surface with biseptic patches
shown in blue (bottom), reflection lines and a zoom in close
to an extraordinary boundary vertex. For the Catmull-Clark
surface, we use the boundary rules of [BLZ00].

We define two new mesh boundary constraints as
∂ k P (1,t)
∂ uk 0

=

∂ P
(t, 1)
∂ vk m−1

=

k

∂k
∂ uk
∂k
∂ vk

(H¯ 0 ◦ ψn ) (1,t) ,
(H¯ m−1 ◦ ψn ) (t, 1) ,

for k = 0, 1, 2. We use the external patch boundary constraints 5, 6 and 7 for boundaries P0 (t, 1) and Pm−1 (1,t), and
for both external boundaries of patches Pi , i = 1, . . . , m − 2.
We include the internal geometric continuity constraints 8,
9, and 10 between pairs of patches Pi , Pi+1 , i = 0, . . . , m − 2.
Finally, we include the boundary cubic B-spline constraints
P0 (t, 0) =
Pm−1 (0,t) =

a10
m
a10
0

a00
0
a00
m

a10
0
a10
m

a20
0
a20
m

3

· M · b (t),
3

· M · b (t).

We then solve to minimize bicubic energy as before.

Figure 7: Comparison of Gaussian curvature for a CatmullClark surface (left), our technique (middle) and [Loo04]
(right).

8. Results
We show several examples of our surfaces in figures 5 to 11.
The quality of our shapes is quite good in general compared
with Catmull-Clark subdivision, especially near boundary
and high valence extraordinary vertices. One issue that we
have noticed are curvature ‘hotspots’, high positive Gauss
curvature, for valence n = 3; similar to the behavior of
Catmull-Clark surfaces. We have not treated this as a special
case in anyway; though doing so may result in better shapes.
The lack of a convex hull property warrants additional work
on this scheme.
References
¨
[ADS06] AUGSD ORFER
U., D ODGSON N., S ABIN M.: Tuning
subdivision by minimising gaussian curvature variation near extraordinary vertices. Computer Graphics Forum 25, 3 (2006),
263–272. 1

Figure 5: The control mesh, patch structures of the CatmullClark (top) and our surface (bottom) and the reflection lines.
Notice that the valence 8 vertex from the Catmull-Clark surface causes a noticeable kink in the reflection lines that is
absent with our G2 surface.

[BLZ00] B IERMANN H., L EVIN A., Z ORIN D.: Piecewise
smooth subdivision surfaces with normal control. In SIGGRAPH
’00: Proceedings of the 27th annual conference on Computer
graphics and interactive techniques (2000), pp. 113–120. 7
[CC78] C ATMULL E., C LARK J.: Recursively generated B-spline
surfaces on arbitrary topological meshes. Computer Aided Design 10, 6 (1978), 350–355. 1
[DeR85] D E ROSE A.: Geometric Continuity: A Parametrization
Independent Measure of Continuity for Computer Aided Geoc 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices

1381

Figure 8: Comparison of Gaussian curvature for a Catmull-Clark surface (left), our technique (middle) and [Loo04] (right).

Figure 9: Plots of the basis functions we compute for a valence 6 vertex. The Bezier nets (top row) of the basis functions (bottom
row) are composed of bicubic polynomials in the two-ring of an extraordinary vertex and biseptic patches in the one-ring.

[GZ99] G REGORY J., Z HOU J.: Irregular C2 surface construction
using b-polynomial rectangular patches. Computer Aided Geometric Design 16, 5 (1999), 423–435. 2
[Hah89] H AHN J.: Geometric continuous patch complexes. Computer Aided Geometric Design 6, 1 (1989), 55–68. 3
[HKD93] H ALSTEAD M., K ASS M., D E ROSE T.: Efficient, fair
interpolation using catmull-clark surfaces. Computer Graphics
27, Annual Conference Series (1993), 35–44. 2
[KP07] K ARCIAUSKAS K., P ETERS J.: Guided C2 spline surfaces with v-shaped tessellation. In IMA Conference on the Mathematics of Surfaces (2007), pp. 233–244. 2

Figure 10: Gaussian curvature plots of a boundary vertex
with four quads for a Catmull-Clark surface (left) and our
technique (right).

[Lev06] L EVIN A.: Modified subdivision surfaces with continuous curvature. Computer Graphics 25, Annual Conference Series
(2006), 1035–1040. 1
[Loo04] L OOP C.: Second order smoothness over extraordinary
vertices. In Proceedings of the Symposium on Geometry Processing (2004), pp. 169–178. 2, 3, 8

metric Design. PhD thesis, Berkeley, 1985. also tech report
UCB/CSD 86/255. 2

[Nas87] NASRI A. H.: Polyhedral subdivision methods for freeform surfaces. ACM Trans. Graph. 6, 1 (1987), 29–73. 1, 7

[DS78] D OO D., S ABIN M.: Behaviour of recursive division surfaces near extraordinary points. Computer Aided Design 10, 6
(1978), 356–360. 1

[Pet02] P ETERS J.: C2 free-form surfaces of degree (3,5). Computer Aided Geometric Design 19, 2 (2002), 113–126. 2

[GU07] G INKEL I., U MLAUF G.: Tuning subdivision algorithms using constrained energy minimization. In Mathematics
of Surfaces XII (2007), Martin R., Sabin M., Winkler J., (Eds.),
Springer-Verlag, pp. 166–176. 1
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

[PR98] P ETERS J., R EIF U.: Analysis of generalized B-spline
subdivision algorithms. SIAM Journal on Numerical Analysis
35, 2 (Apr. 1998), 728–748. 1
[Pra97] P RAUTZSCH H.: Freeform splines. Computer Aided Geometric Design 14, 3 (1997), 201–206. 2

1382

C. Loop & S. Schaefer / G2 Tensor Product Splines over Extraordinary Vertices
symposium on Geometry processing (2006), Eurographics Association, pp. 31–40. 1

Appendix A: Solving for ψn
We now use the constraints implied by the cocycle conditions on vertices to solve for a mapping ψn that will minimize the bidegree of our G2 surface spline. In the G2 case,
the cocycle condition must hold for all second order mixed
partial derivatives. In general, the kth order derivatives will
transform via Equation 1 in terms of all kth order derivatives
of the correspondence maps. However at type 2 and 3 vertices this is not the case since at these 4-valent vertices, various mixed partial derives of the mappings φn and ψn vanish.
Therefore, the matrices in Equations 3 and 4 are 8 × 8 and
contain the derivatives:
∂ ∂ ∂2
∂2
∂2
∂3
∂3
∂4
∂ u , ∂ v , ∂ u2 , ∂ u∂ v , ∂ v2 , ∂ u2 ∂ v , ∂ u∂ v2 , ∂ u2 ∂ v2 .

Specifically, let
 1 0



Ψn = 



0
0
0
0
0
0
0

1
0
0
0
0
0
0

0
0
1
0
0
0
0
0

x11
y11
0
1
0
0
0
0

0
0
0
0
1
0
0
0

x21
y21
2x11
2y11
0
1
0
0

x12
y21
0
2x11
2y11
0
1
0

x22
y22
2x211 + 2x12
2x21 + 4x11 y11 + 2y21
2y211 + 2y21
4x11
4y11
1






,



i+ j

Figure 11: Comparison of a valence 17 vertex for CatmullClark surface (left), and our technique (right). Below control
mesh: (top row) patch structure, (middle row) Gaussian curvature, and (bottom row) reflection lines.

[Pra98] P RAUTZSCH H.: Smoothness of subdivision surfaces at
extraordinary points. Advances in Computational Mathematics 9
(1998), 377–390. 1
[PU98] P RAUTZSCH H., U MLAUF G.: A G2 -subdivision algorithm. In Geometric Modelling, volume 13 of Computing suppl
(1998), G. Farin H. Bieri G. B., DeRose T., (Eds.), SpringerVerlag. 1
[Rei95] R EIF U.: A unified approach to subdivision algorithms
near extraordinary vertices. Computer Aided Geometric Design
12 (1995), 153–174. 1
[Rei98] R EIF U.: Turbs – topologically unrestricted rational bsplines. Constructive Approximation 14, 1 (1998), 57–77. 1
¨
P.: Curvature smoothness of subdi[RS99] R EIF U., S CHR ODER
vision surfaces. Tech. Rep. TR-00-03, Caltech, 1999. 1
[Sab91] S ABIN M.: Cubic recursive division with bounded curvature. In Curves and Surfaces (1991), Laurent P., M´ehaut´e A. L.,
, Schumaker L., (Eds.), Academic Press, pp. 411–414. Boston. 1
[Sta98] S TAM J.: Exact evaluation of Catmull-Clark subdivision
surfaces at arbitrary parameter values. Computer Graphics 32,
Annual Conference Series (1998), 395–404. 2

where xi j = ∂ ∂ui ∂ u j ψn,x (1, 0). While yi j can be defined similarly, we note that since (by assumption) the x and y components of ψn are symmetric, that is ψn,x (v, u) = ψn,y (u, v), we
i+ j
need only solve for ψn,x . Therefore yi j = ∂ ∂u j ∂ ui ψn,x (0, 1).
Multiplying together the matrices in Equation 3 leads to the
following four constraints on ψn,x
x11 = −cn ,
y12 = −2cn (y11 + cn ) ,

x21 = 0,
y22 = −2cn (2y21 − y12 ) .

It is possible to satisfy these constraints with a bidegree 3
mapping; with this solution, the derivative ∂∂u ψn,x (1, v) will
be degree 3. This term gets squared under the chain rule leading to higher degree surfaces than necessary. Instead we can
satisfy the above constraints with a bidegree 4 × 3 polynomial, leaving additional freedom to lower the overall surface
degree. We can write this polynomial ψn,x (u, v) =
 0 0

0
0

b (u) 

4

T

1
4
1
2
3
4

cn (c2
n (7cn +6)−18(cn +2)α )+27
12(cn −3)(2cn −3)
cn +3
6
cn +9
12

1

1

c2
n +3cn −18α
12(cn −3)

α
β
1

1
4
1
2
3
4

1

 3
 b (v).


We now solve for the 2 degrees of freedom α and β so that
∂
∂
∂ u ψn,x (1, v) is degree 2 and ∂ v ψn,x (u, 1) is degree 3. These
constraints result in

α=

c2n +3 cn −9
,
9 (cn −2)

β=

9+cn
12 .

As shown in a Section 4.1, the bidegree of the resulting surfaces are minimized.

[Zor06] Z ORIN D.: Constructing curvature-continuous surfaces
by blending. In SGP ’06: Proceedings of the fourth Eurographics
c 2008 The Author(s)
Journal compilation c 2008 The Eurographics Association and Blackwell Publishing Ltd.

